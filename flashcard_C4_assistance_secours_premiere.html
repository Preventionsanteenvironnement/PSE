<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R√©vision C.4 - Assistance et Secours Professionnel - Bac Pro Premi√®re</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
            transition: all 0.3s ease;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }
        
        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .btn-back {
            background: rgba(255,255,255,0.1);
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            border: 2px solid rgba(255,255,255,0.2);
            cursor: pointer;
        }
        
        .btn-back:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }
        
        .score-bar {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 50px;
        }
        
        .score-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .score-item .icon {
            font-size: 18px;
        }
        
        /* √âcrans */
        .screen {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .screen.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* √âcran d'accueil */
        .welcome-screen {
            text-align: center;
            padding: 30px 0;
        }
        
        .welcome-title {
            font-size: 36px;
            font-weight: 900;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #ff6b6b, #feca57, #48dbfb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .welcome-subtitle {
            font-size: 18px;
            color: rgba(255,255,255,0.7);
            margin-bottom: 30px;
        }
        
        /* Objectifs */
        .objectifs-card {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.3), rgba(254, 202, 87, 0.3));
            border: 2px solid rgba(255, 107, 107, 0.5);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            text-align: left;
        }
        
        .objectifs-card h3 {
            font-size: 18px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .objectif-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            font-size: 14px;
            line-height: 1.5;
        }
        
        .objectif-item:last-child {
            border-bottom: none;
        }
        
        .objectif-item .check {
            color: #4CAF50;
            font-size: 18px;
            flex-shrink: 0;
        }
        
        .competences-row {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .comp-badge {
            background: rgba(255,255,255,0.15);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
        }
        
        .comp-badge.c1 { background: rgba(16, 185, 129, 0.3); border: 1px solid #10b981; }
        .comp-badge.c2 { background: rgba(102, 126, 234, 0.3); border: 1px solid #667eea; }
        .comp-badge.c3 { background: rgba(245, 158, 11, 0.3); border: 1px solid #f59e0b; }
        .comp-badge.c4 { background: rgba(239, 68, 68, 0.3); border: 1px solid #ef4444; }
        .comp-badge.c5 { background: rgba(168, 85, 247, 0.3); border: 1px solid #a855f7; }
        .comp-badge.c6 { background: rgba(34, 197, 94, 0.3); border: 1px solid #22c55e; }
        
        /* Niveaux */
        .niveaux-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 25px;
        }
        
        .niveau-card {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .niveau-card:hover:not(.locked) {
            background: rgba(255,255,255,0.1);
            transform: translateX(5px);
            border-color: rgba(255, 107, 107, 0.5);
        }
        
        .niveau-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .niveau-card.completed {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }
        
        .niveau-icon {
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            flex-shrink: 0;
        }
        
        .niveau-info {
            flex: 1;
        }
        
        .niveau-info h4 {
            font-size: 16px;
            margin-bottom: 5px;
            font-weight: 700;
        }
        
        .niveau-info p {
            font-size: 13px;
            color: rgba(255,255,255,0.7);
            line-height: 1.4;
        }
        
        .niveau-progress {
            text-align: right;
        }
        
        .percent {
            font-size: 14px;
            font-weight: 700;
            color: #4CAF50;
        }
        
        .progress-mini {
            width: 60px;
            height: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .progress-mini-fill {
            height: 100%;
            background: #4CAF50;
            transition: width 0.3s ease;
        }
        
        /* √âcran de jeu */
        .game-header {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 15px 20px;
            margin-bottom: 20px;
        }
        
        .game-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 10px;
            color: #feca57;
        }
        
        .game-progress {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .card-counter {
            font-size: 14px;
            font-weight: 600;
            min-width: 50px;
        }
        
        .progress-bar {
            flex: 1;
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            transition: width 0.3s ease;
            border-radius: 4px;
        }
        
        /* Flashcard */
        .flashcard {
            background: rgba(255,255,255,0.08);
            border-radius: 20px;
            padding: 30px;
            position: relative;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            min-height: 400px;
            display: flex;
            flex-direction: column;
        }
        
        .card-competence {
            position: absolute;
            top: 15px;
            left: 20px;
            font-size: 11px;
            font-weight: 700;
        }
        
        .card-type {
            position: absolute;
            top: 15px;
            right: 20px;
            background: rgba(255,255,255,0.1);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
        }
        
        .question-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            margin-top: 30px;
            margin-bottom: 30px;
        }
        
        .question-text {
            font-size: 20px;
            font-weight: 600;
            line-height: 1.4;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .question-text .highlight {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            padding: 2px 8px;
            border-radius: 6px;
            font-weight: 700;
            color: #1a1a2e;
        }
        
        /* Types de questions */
        .keyword-input {
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            padding: 15px 20px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            text-align: center;
            outline: none;
            transition: all 0.3s ease;
            width: 100%;
            max-width: 300px;
            margin: 0 auto;
        }
        
        .keyword-input:focus {
            border-color: #feca57;
            background: rgba(254, 202, 87, 0.1);
        }
        
        .keyword-input::placeholder {
            color: rgba(255,255,255,0.5);
        }
        
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .option-btn {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 15px 20px;
            color: white;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 14px;
            min-height: 60px;
        }
        
        .option-btn:hover {
            background: rgba(255,255,255,0.1);
            border-color: rgba(254, 202, 87, 0.5);
            transform: translateY(-2px);
        }
        
        .option-btn.selected {
            background: rgba(254, 202, 87, 0.2);
            border-color: #feca57;
            transform: translateY(-2px);
        }
        
        .option-letter {
            background: rgba(255,255,255,0.1);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            flex-shrink: 0;
        }
        
        .vf-container {
            display: flex;
            gap: 20px;
            justify-content: center;
        }
        
        .vf-btn {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px 30px;
            color: white;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .vf-btn:hover {
            background: rgba(255,255,255,0.1);
            transform: translateY(-2px);
        }
        
        .vf-btn.selected {
            transform: translateY(-2px);
        }
        
        .vf-btn.vrai {
            border-color: rgba(76, 175, 80, 0.3);
        }
        
        .vf-btn.vrai.selected {
            background: rgba(76, 175, 80, 0.2);
            border-color: #4CAF50;
        }
        
        .vf-btn.faux {
            border-color: rgba(239, 68, 68, 0.3);
        }
        
        .vf-btn.faux.selected {
            background: rgba(239, 68, 68, 0.2);
            border-color: #ef4444;
        }
        
        .action-row {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: auto;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            outline: none;
            min-height: 48px;
        }
        
        .btn-hint {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 2px solid rgba(255,255,255,0.2);
        }
        
        .btn-hint:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            color: #1a1a2e;
            font-weight: 700;
            border: none;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
        }
        
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 2px solid rgba(255,255,255,0.2);
        }
        
        .btn-secondary:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .hint-text {
            background: rgba(254, 202, 87, 0.1);
            border: 2px solid rgba(254, 202, 87, 0.3);
            border-radius: 12px;
            padding: 15px 20px;
            margin: 20px 0;
            color: #feca57;
            font-size: 14px;
            text-align: center;
            animation: fadeIn 0.5s ease;
        }
        
        /* √âcran de r√©sultats */
        .results-screen {
            text-align: center;
            padding: 30px 0;
        }
        
        .results-icon {
            font-size: 80px;
            margin-bottom: 20px;
            animation: bounce 1s ease infinite alternate;
        }
        
        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-10px); }
        }
        
        .results-title {
            font-size: 32px;
            font-weight: 900;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #ff6b6b, #feca57);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .results-score {
            font-size: 48px;
            font-weight: 900;
            color: #4CAF50;
            margin-bottom: 30px;
            text-shadow: 0 0 20px rgba(76, 175, 80, 0.5);
        }
        
        .results-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #feca57;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 12px;
            color: rgba(255,255,255,0.7);
            text-transform: uppercase;
            font-weight: 600;
        }
        
        .errors-recap {
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid rgba(239, 68, 68, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: left;
            display: none;
        }
        
        .errors-recap h4 {
            color: #ef4444;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .errors-recap ul {
            list-style: none;
            padding: 0;
        }
        
        .errors-recap li {
            background: rgba(255,255,255,0.05);
            padding: 10px 15px;
            margin: 8px 0;
            border-radius: 8px;
            font-size: 14px;
        }
        
        /* Feedback overlay - FOND COMPL√àTEMENT OPAQUE pour mobile */
        .feedback-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(26, 26, 46, 0.95); /* OPAQUE pour lisibilit√© mobile parfaite */
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            padding: 20px;
        }
        
        .feedback-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        
        .feedback-card {
            background: linear-gradient(145deg, #2a2a3e, #1e1e2f); /* COMPL√àTEMENT OPAQUE */
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            transform: translateY(30px);
            transition: transform 0.3s ease;
            border: 1px solid rgba(255,255,255,0.1);
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .feedback-overlay.visible .feedback-card {
            transform: translateY(0);
        }
        
        .feedback-card.correct {
            border-color: rgba(76, 175, 80, 0.5);
        }
        
        .feedback-card.incorrect {
            border-color: rgba(239, 68, 68, 0.5);
        }
        
        .feedback-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }
        
        .feedback-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .feedback-card.correct .feedback-title {
            color: #4CAF50;
        }
        
        .feedback-card.incorrect .feedback-title {
            color: #ef4444;
        }
        
        .feedback-points {
            font-size: 18px;
            font-weight: 700;
            color: #feca57;
            margin-bottom: 20px;
        }
        
        .feedback-explanation {
            background: rgba(255,255,255,0.08); /* Opaque suffisant pour lisibilit√© */
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .feedback-explanation h4 {
            color: #feca57;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .feedback-explanation p {
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 15px;
        }
        
        .keyword-box {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            color: #1a1a2e;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 14px;
            margin: 15px 0;
        }
        
        .tip-box {
            background: rgba(72, 219, 251, 0.1);
            border: 2px solid rgba(72, 219, 251, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .tip-box h5 {
            color: #48dbfb;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .tip-box p {
            font-size: 13px;
            color: rgba(255,255,255,0.9);
            margin: 0;
        }
        
        /* Popup streak */
        .streak-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            color: #1a1a2e;
            padding: 20px 30px;
            border-radius: 15px;
            font-size: 24px;
            font-weight: 900;
            z-index: 2000;
            display: none;
            animation: popIn 0.5s ease;
        }
        
        @keyframes popIn {
            0% { transform: translate(-50%, -50%) scale(0); }
            70% { transform: translate(-50%, -50%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }
        
        /* Confettis */
        .confetti {
            position: fixed;
            width: 8px;
            height: 8px;
            background: #ff6b6b;
            animation: confetti-fall 3s ease-out infinite;
            z-index: 1500;
        }
        
        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .welcome-title {
                font-size: 28px;
            }
            
            .flashcard {
                padding: 20px;
                min-height: 350px;
            }
            
            .question-text {
                font-size: 18px;
            }
            
            .results-score {
                font-size: 36px;
            }
            
            .results-stats {
                gap: 20px;
            }
            
            .feedback-card {
                padding: 20px;
                margin: 10px;
            }
            
            .vf-container {
                flex-direction: column;
                gap: 12px;
            }
            
            .vf-btn {
                min-width: auto;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
            }
            
            .score-bar {
                order: -1;
            }
        }
        
        @media (max-width: 480px) {
            .welcome-title {
                font-size: 24px;
            }
            
            .question-text {
                font-size: 16px;
            }
            
            .option-btn {
                padding: 12px 15px;
                font-size: 13px;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <button class="btn-back" onclick="goHome()">‚Üê Retour Accueil</button>
            <div class="score-bar">
                <div class="score-item">
                    <span class="icon">üèÜ</span>
                    <span id="totalPoints">0</span>
                </div>
                <div class="score-item">
                    <span class="icon">üî•</span>
                    <span id="currentStreak">0</span>
                </div>
            </div>
        </div>

        <!-- √âCRAN D'ACCUEIL -->
        <div class="screen active" id="homeScreen">
            <div class="welcome-screen">
                <h1 class="welcome-title">üö® Module C.4</h1>
                <p class="welcome-subtitle">Assistance et Secours en Milieu Professionnel</p>
                
                <div class="objectifs-card">
                    <h3>üéØ Objectifs du Module</h3>
                    <div class="objectif-item">
                        <span class="check">‚úì</span>
                        <span>Agir de mani√®re responsable face √† une situation d'urgence en milieu professionnel</span>
                    </div>
                    <div class="objectif-item">
                        <span class="check">‚úì</span>
                        <span>Ma√Ætriser les num√©ros d'urgence et proc√©dures d'alerte</span>
                    </div>
                    <div class="objectif-item">
                        <span class="check">‚úì</span>
                        <span>Construire un message d'alerte efficace (QUI-O√ô-QUOI-COMBIEN-√âTAT)</span>
                    </div>
                    <div class="objectif-item">
                        <span class="check">‚úì</span>
                        <span>Conna√Ætre les obligations l√©gales d'assistance (Code p√©nal art. 223-6)</span>
                    </div>
                    <div class="objectif-item">
                        <span class="check">‚úì</span>
                        <span>Identifier les √©quipements de s√©curit√© et proc√©dures d'√©vacuation</span>
                    </div>
                    
                    <div class="competences-row">
                        <span class="comp-badge c1">C1 - Traiter information</span>
                        <span class="comp-badge c2">C2 - Analyser situation</span>
                        <span class="comp-badge c3">C3 - Expliquer r√©glementation</span>
                        <span class="comp-badge c4">C4 - Proposer solutions</span>
                        <span class="comp-badge c6">C6 - Communiquer efficacement</span>
                    </div>
                </div>

                <div class="niveaux-grid">
                    <div class="niveau-card" id="level1Card" onclick="startLevel(1)">
                        <div class="niveau-icon">üö®</div>
                        <div class="niveau-info">
                            <h4>Niveau 1 : Num√©ros et Services d'Urgence</h4>
                            <p>SAMU (15), Pompiers (18), Europe (112), SMS (114)</p>
                        </div>
                        <div class="niveau-progress">
                            <span class="percent" id="level1Percent">0%</span>
                            <div class="progress-mini">
                                <div class="progress-mini-fill" id="level1Bar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="niveau-card" id="level2Card" onclick="startLevel(2)">
                        <div class="niveau-icon">üèÉ‚Äç‚ôÇÔ∏è</div>
                        <div class="niveau-info">
                            <h4>Niveau 2 : Proc√©dures d'Alerte et √âvacuation</h4>
                            <p>P.A.S., plans d'√©vacuation, points de rassemblement</p>
                        </div>
                        <div class="niveau-progress">
                            <span class="percent" id="level2Percent">0%</span>
                            <div class="progress-mini">
                                <div class="progress-mini-fill" id="level2Bar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="niveau-card" id="level3Card" onclick="startLevel(3)">
                        <div class="niveau-icon">üìû</div>
                        <div class="niveau-info">
                            <h4>Niveau 3 : Message d'Alerte Structur√©</h4>
                            <p>QUI-O√ô-QUOI-COMBIEN-√âTAT, communication efficace</p>
                        </div>
                        <div class="niveau-progress">
                            <span class="percent" id="level3Percent">0%</span>
                            <div class="progress-mini">
                                <div class="progress-mini-fill" id="level3Bar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="niveau-card" id="level4Card" onclick="startLevel(4)">
                        <div class="niveau-icon">‚öñÔ∏è</div>
                        <div class="niveau-info">
                            <h4>Niveau 4 : R√©glementation et Obligations</h4>
                            <p>Code p√©nal art. 223-6, SST, responsabilit√©s l√©gales</p>
                        </div>
                        <div class="niveau-progress">
                            <span class="percent" id="level4Percent">0%</span>
                            <div class="progress-mini">
                                <div class="progress-mini-fill" id="level4Bar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="niveau-card" id="level5Card" onclick="startLevel(5)">
                        <div class="niveau-icon">üèÜ</div>
                        <div class="niveau-info">
                            <h4>Niveau 5 : Quiz Final Expert</h4>
                            <p>Tout m√©lang√© - Pr√©paration Bac Pro !</p>
                        </div>
                        <div class="niveau-progress">
                            <span class="percent" id="level5Percent">0%</span>
                            <div class="progress-mini">
                                <div class="progress-mini-fill" id="level5Bar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- √âCRAN JEU -->
        <div class="screen" id="gameScreen">
            <div class="game-header">
                <h3 class="game-title" id="levelTitle">Niveau 1</h3>
                <div class="game-progress">
                    <span class="card-counter"><span id="currentCard">1</span>/<span id="totalCards">10</span></span>
                    <div class="progress-bar">
                        <div class="progress-fill" id="gameProgress" style="width: 0%"></div>
                    </div>
                </div>
            </div>
            
            <div class="flashcard" id="flashcard">
                <div class="card-competence comp-badge c1" id="cardCompetence">C1</div>
                <div class="card-type" id="cardType">MOT-CL√â</div>
                
                <div class="question-section" id="questionSection">
                    <!-- Contenu dynamique -->
                </div>
                
                <div id="hintText" class="hint-text" style="display: none;"></div>
                
                <div class="action-row" id="actionRow">
                    <button class="btn btn-hint" onclick="showHint()">üí° Indice</button>
                    <button class="btn btn-primary" id="validateBtn" onclick="validateAnswer()">Valider ‚úì</button>
                </div>
            </div>
        </div>
        
        <!-- √âCRAN R√âSULTATS -->
        <div class="screen" id="resultsScreen">
            <div class="results-screen">
                <div class="results-icon" id="resultsIcon">üéâ</div>
                <h2 class="results-title" id="resultsTitle">Niveau termin√© !</h2>
                <div class="results-score" id="resultsScore">85%</div>
                
                <div class="results-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="correctCount">8</div>
                        <div class="stat-label">Bonnes r√©ponses</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="pointsEarned">+120</div>
                        <div class="stat-label">Points gagn√©s</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="bestStreak">5</div>
                        <div class="stat-label">Meilleur streak</div>
                    </div>
                </div>
                
                <div class="errors-recap" id="errorsRecap">
                    <h4>üìù Notions √† revoir :</h4>
                    <ul id="errorsList"></ul>
                </div>
                
                <div class="action-row">
                    <button class="btn btn-secondary" onclick="goHome()">üè† Accueil</button>
                    <button class="btn btn-primary" id="nextLevelBtn" onclick="nextLevel()">Niveau suivant ‚Üí</button>
                </div>
            </div>
        </div>
        
        <!-- FEEDBACK OVERLAY -->
        <div class="feedback-overlay" id="feedbackOverlay">
            <div class="feedback-card" id="feedbackCard">
                <div class="feedback-icon" id="feedbackIcon">‚úÖ</div>
                <h3 class="feedback-title" id="feedbackTitle">Bravo !</h3>
                <div class="feedback-points" id="feedbackPoints">+10 points</div>
                
                <div class="feedback-explanation" id="feedbackExplanation">
                    <!-- Contenu dynamique -->
                </div>
                
                <button class="btn btn-primary" onclick="nextCard()">Suivant ‚Üí</button>
            </div>
        </div>
        
        <!-- STREAK POPUP -->
        <div class="streak-popup" id="streakPopup"></div>
        
    </div>

    <script>
        // === DONN√âES ===
        let totalPoints = 0;
        let currentStreak = 0;
        let bestStreak = 0;
        let currentLevel = 1;
        let currentCardIndex = 0;
        let levelCorrect = 0;
        let levelPoints = 0;
        let levelErrors = [];
        let levelProgress = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 };
        let hintUsed = false;
        
        // Questions par niveau - Module C.4 Assistance et secours en milieu professionnel
        const levels = {
            1: { // Num√©ros et services d'urgence
                title: "Niveau 1 : Num√©ros et Services d'Urgence",
                competence: "C1",
                cards: [
                    {
                        type: "keyword",
                        question: "Quel num√©ro appeler pour une <span class='highlight'>urgence m√©dicale</span> ?",
                        answer: "15",
                        hint: "Service d'Aide M√©dicale Urgente",
                        explanation: "15 = SAMU (Service d'Aide M√©dicale Urgente). √Ä appeler pour toutes les urgences m√©dicales : malaises, accidents graves, d√©tresse respiratoire...",
                        keyword: "SAMU = 15 = urgences m√©dicales",
                        tip: "SAMU = √©quipes m√©dicalis√©es avec mat√©riel de r√©animation."
                    },
                    {
                        type: "keyword",
                        question: "Que signifie le sigle <span class='highlight'>SAMU</span> ?",
                        answer: "service aide m√©dicale urgente",
                        hint: "Service A_ _ _ M_ _ _ _ _ _ _ U_ _ _ _ _ _",
                        explanation: "SAMU = Service d'Aide M√©dicale Urgente. Service public qui assure les secours d'urgence et les soins m√©dicaux en situation critique.",
                        keyword: "SAMU = Service + Aide + M√©dicale + Urgente",
                        tip: "Le SAMU coordonne les moyens de secours m√©dicaux."
                    },
                    {
                        type: "qcm",
                        question: "Quel num√©ro appeler en cas d'<span class='highlight'>incendie</span> dans l'entreprise ?",
                        options: [
                            "15 - SAMU",
                            "18 - Pompiers", 
                            "17 - Police",
                            "112 - Num√©ro europ√©en"
                        ],
                        answer: 1,
                        explanation: "18 = POMPIERS = sp√©cialistes de la lutte contre l'incendie et du secours aux personnes en danger.",
                        keyword: "18 = Pompiers = incendies + secours",
                        tip: "Pompiers = incendie + secours + accidents + d√©sincarc√©ration."
                    },
                    {
                        type: "keyword",
                        question: "Quel num√©ro permet aux <span class='highlight'>sourds et malentendants</span> d'alerter par SMS ?",
                        answer: "114",
                        hint: "Num√©ro d'urgence par SMS",
                        explanation: "114 = Num√©ro d'urgence national accessible par SMS et fax aux personnes sourdes et malentendantes.",
                        keyword: "114 = SMS urgence sourds",
                        tip: "114 = accessible 24h/24, gratuit, redirige vers services appropri√©s."
                    },
                    {
                        type: "vf",
                        question: "Le num√©ro <span class='highlight'>112</span> fonctionne dans toute l'Europe.",
                        answer: true,
                        explanation: "VRAI ! 112 = num√©ro d'urgence europ√©en unifi√©. Fonctionne dans tous les pays de l'UE, m√™me sans r√©seau du t√©l√©phone habituel.",
                        keyword: "112 = urgence europ√©enne",
                        tip: "112 = utile √† l'√©tranger, localisation automatique du portable."
                    },
                    {
                        type: "qcm",
                        question: "En cas d'accident √©lectrique avec <span class='highlight'>risque cardiaque</span>, qui appeler EN PREMIER ?",
                        options: [
                            "15 - SAMU (urgence m√©dicale)",
                            "18 - Pompiers (secours)", 
                            "17 - Police (maintien ordre)",
                            "112 - Num√©ro europ√©en"
                        ],
                        answer: 0,
                        explanation: "15 - SAMU = PRIORIT√â pour les urgences m√©dicales vitales (risque cardiaque). √âquipes m√©dicalis√©es avec d√©fibrillateurs.",
                        keyword: "Urgence vitale = SAMU = 15",
                        tip: "SAMU = m√©decin r√©gulateur + √©quipes SMUR si n√©cessaire."
                    },
                    {
                        type: "keyword",
                        question: "Que signifie <span class='highlight'>SST</span> ?",
                        answer: "sauveteur secouriste travail",
                        hint: "Sauveteur S_ _ _ _ _ _ _ _ _  du T_ _ _ _ _ _",
                        explanation: "SST = Sauveteur Secouriste du Travail. Formation de base aux gestes qui sauvent en entreprise, recyclage tous les 2 ans.",
                        keyword: "SST = secours entreprise",
                        tip: "1 SST pour 15 salari√©s recommand√©. Formation 14h + recyclage 7h."
                    },
                    {
                        type: "vf",
                        question: "Les num√©ros d'urgence <span class='highlight'>15, 18, 112</span> sont gratuits depuis tous les t√©l√©phones.",
                        answer: true,
                        explanation: "VRAI ! TOUS les num√©ros d'urgence sont gratuits 24h/24, 7j/7, depuis t√©l√©phones fixes, mobiles, cabines publiques.",
                        keyword: "Num√©ros urgence = gratuits toujours",
                        tip: "M√™me avec forfait bloqu√© ou t√©l√©phone sans cr√©dit = urgences accessibles."
                    },
                    {
                        type: "qcm",
                        question: "Dans une entreprise de 50 salari√©s, combien de <span class='highlight'>SST minimum</span> sont recommand√©s ?",
                        options: [
                            "2 SST",
                            "3 SST",
                            "4 SST", 
                            "5 SST"
                        ],
                        answer: 2,
                        explanation: "4 SST = 50 salari√©s √∑ 15 (recommandation) = 3,3 ‚Üí arrondi √† 4 pour assurer pr√©sence permanente.",
                        keyword: "1 SST pour 15 salari√©s",
                        tip: "R√©partition sur √©quipes/horaires pour pr√©sence permanente."
                    },
                    {
                        type: "keyword",
                        question: "Quel √©quipement m√©dical peut sauver en cas d'<span class='highlight'>arr√™t cardiaque</span> ?",
                        answer: "d√©fibrillateur",
                        hint: "D_ _ _ _ _ _ _ _ _ _ _ _ _ _",
                        explanation: "D√âFIBRILLATEUR = seul moyen de relancer le c≈ìur en fibrillation. Utilisation simple, guidage vocal automatique.",
                        keyword: "Arr√™t cardiaque = d√©fibrillateur",
                        tip: "DAE = D√©fibrillateur Automatis√© Externe. Obligatoire dans ERP."
                    }
                ]
            },
            2: { // Proc√©dures alerte √©vacuation
                title: "Niveau 2 : Proc√©dures d'Alerte et √âvacuation",
                competence: "C2",
                cards: [
                    {
                        type: "keyword",
                        question: "Que signifient les 3 lettres de la m√©thode des premiers secours : <span class='highlight'>P.A.S.</span> ?",
                        answer: "prot√©ger alerter secourir",
                        hint: "P_ _ _ _ _ _ _ - A_ _ _ _ _ _ - S_ _ _ _ _ _ _",
                        explanation: "P.A.S. = Prot√©ger (s√©curiser la zone) - Alerter (appeler secours) - Secourir (gestes de premiers secours).",
                        keyword: "P.A.S. = m√©thode obligatoire secours",
                        tip: "TOUJOURS dans cet ordre ! Prot√©ger d'abord sinon vous devenez victime."
                    },
                    {
                        type: "qcm",
                        question: "Lors d'une √©vacuation incendie, que doit-on faire IMM√âDIATEMENT apr√®s avoir entendu l'alarme ?",
                        options: [
                            "Chercher l'origine du feu",
                            "Prendre ses affaires personnelles",
                            "√âvacuer par l'itin√©raire le plus proche",
                            "Attendre les consignes du responsable"
                        ],
                        answer: 2,
                        explanation: "√âVACUER IMM√âDIATEMENT par l'itin√©raire le plus proche = r√©flexe vital. Pas de perte de temps pour affaires ou recherches.",
                        keyword: "Alarme = √©vacuation imm√©diate",
                        tip: "Alarme = danger imminent. Chaque seconde compte pour la survie."
                    },
                    {
                        type: "vf",
                        question: "En cas d'incendie, on peut utiliser les <span class='highlight'>ascenseurs</span> pour √©vacuer plus vite.",
                        answer: false,
                        explanation: "FAUX ! JAMAIS d'ascenseurs en cas d'incendie = risque de panne, fum√©es toxiques dans la cabine. Escaliers uniquement.",
                        keyword: "Incendie = JAMAIS ascenseurs",
                        tip: "Ascenseurs = pi√®ges mortels en incendie (√©lectricit√©, fum√©es)."
                    },
                    {
                        type: "keyword",
                        question: "Comment appelle-t-on le lieu de <span class='highlight'>rassemblement</span> apr√®s √©vacuation ?",
                        answer: "point de rassemblement",
                        hint: "Point de r_ _ _ _ _ _ _ _ _ _ _",
                        explanation: "POINT DE RASSEMBLEMENT = zone de s√©curit√© pr√©d√©finie o√π se regrouper apr√®s √©vacuation pour faire l'appel et attendre secours.",
                        keyword: "√âvacuation ‚Üí point de rassemblement",
                        tip: "G√©n√©ralement au parking ou dans cour, loin des b√¢timents."
                    },
                    {
                        type: "qcm",
                        question: "Sur un <span class='highlight'>plan d'√©vacuation</span>, quelle couleur indique les sorties de secours ?",
                        options: [
                            "Rouge",
                            "Vert", 
                            "Jaune",
                            "Bleu"
                        ],
                        answer: 1,
                        explanation: "VERT = couleur universelle des sorties de secours et √©quipements de sauvetage (norme ISO 3864).",
                        keyword: "Sorties secours = VERT",
                        tip: "Vert = s√©curit√© et √©vacuation. Rouge = interdiction et lutte incendie."
                    },
                    {
                        type: "keyword",
                        question: "Quelle est la fr√©quence OBLIGATOIRE des exercices d'√©vacuation en entreprise ?",
                        answer: "6 mois",
                        hint: "Tous les _ mois",
                        explanation: "6 MOIS = fr√©quence minimale obligatoire pour les exercices d'√©vacuation (Code du travail art. R4227-39).",
                        keyword: "Exercices √©vacuation = 6 mois",
                        tip: "Permet de tester proc√©dures et former nouveaux salari√©s."
                    },
                    {
                        type: "vf",
                        question: "En √©vacuation, le <span class='highlight'>responsable d'√©quipe</span> doit √©vacuer en dernier pour v√©rifier que personne ne reste.",
                        answer: true,
                        explanation: "VRAI ! Le responsable √©vacue EN DERNIER apr√®s avoir v√©rifi√© que tous ses collaborateurs sont sortis et ont ferm√© les portes.",
                        keyword: "Responsable = √©vacue dernier",
                        tip: "Responsable = chef de file √† l'aller, serre-file au retour."
                    },
                    {
                        type: "keyword",
                        question: "Quel type d'<span class='highlight'>extincteur</span> utiliser sur un feu √©lectrique ?",
                        answer: "CO2",
                        hint: "C_ _",
                        explanation: "CO‚ÇÇ = gaz carbonique, n'est pas conducteur d'√©lectricit√©. Adapt√© aux feux de classe C (√©lectriques) sans risque d'√©lectrocution.",
                        keyword: "Feu √©lectrique = extincteur CO‚ÇÇ",
                        tip: "JAMAIS d'eau sur √©lectricit√© = risque d'√©lectrocution mortelle."
                    },
                    {
                        type: "qcm",
                        question: "Que faire si on d√©couvre un <span class='highlight'>d√©but d'incendie</span> dans l'entreprise ?",
                        options: [
                            "Essayer d'√©teindre seul avec extincteur",
                            "Donner l'alerte PUIS tenter d'√©teindre si possible", 
                            "√âvacuer imm√©diatement sans rien faire",
                            "Chercher de l'aide avant d'agir"
                        ],
                        answer: 1,
                        explanation: "ALERTER D'ABORD = priorit√© vitale, puis intervention si feu naissant et sans danger pour soi. Sauver des vies > sauver mat√©riel.",
                        keyword: "D√©but incendie = alerte PUIS action",
                        tip: "Si doute sur capacit√© d'extinction = √©vacuer imm√©diatement."
                    },
                    {
                        type: "vf",
                        question: "Les <span class='highlight'>portes coupe-feu</span> doivent toujours rester ferm√©es.",
                        answer: true,
                        explanation: "VRAI ! Portes coupe-feu ferm√©es = compartimentage efficace, ralentissement propagation feu et fum√©es. Obligation r√©glementaire.",
                        keyword: "Portes coupe-feu = toujours ferm√©es",
                        tip: "Porte ouverte = perte totale d'efficacit√© coupe-feu."
                    }
                ]
            },
            3: { // Message d'alerte structur√©  
                title: "Niveau 3 : Message d'Alerte Structur√©",
                competence: "C6",
                cards: [
                    {
                        type: "keyword",
                        question: "Quels sont les 5 √©l√©ments obligatoires d'un message d'alerte efficace ? (5 mots)",
                        answer: "qui o√π quoi combien √©tat",
                        hint: "Q_ _ - O_ - Q_ _ _ - C_ _ _ _ _ _ - √â_ _ _",
                        explanation: "QUI (identit√©) - O√ô (lieu pr√©cis) - QUOI (nature accident) - COMBIEN (nb victimes) - √âTAT (conscience, respiration, blessures).",
                        keyword: "Message alerte = QUI-O√ô-QUOI-COMBIEN-√âTAT",
                        tip: "Structure universelle pour tous types d'urgence."
                    },
                    {
                        type: "qcm",
                        question: "Dans 'QUI appelle', que doit-on OBLIGATOIREMENT donner ?",
                        options: [
                            "Seulement son nom",
                            "Son nom et sa fonction", 
                            "Son nom, fonction et num√©ro de rappel",
                            "Son adresse compl√®te"
                        ],
                        answer: 2,
                        explanation: "NOM + FONCTION + NUM√âRO = permet aux secours de rappeler pour pr√©cisions et d'identifier le niveau de cr√©dibilit√© du t√©moin.",
                        keyword: "QUI = nom + fonction + t√©l√©phone",
                        tip: "Num√©ro de rappel = ESSENTIEL pour √©changes avec secours."
                    },
                    {
                        type: "keyword",
                        question: "Pour l'√©l√©ment 'O√ô', quelle information est la plus importante ?",
                        answer: "adresse pr√©cise",
                        hint: "A_ _ _ _ _ _ pr√©cise",
                        explanation: "ADRESSE PR√âCISE = num√©ro, rue, ville, code postal + pr√©cisions d'acc√®s (√©tage, entr√©e, digicode...) pour localisation rapide.",
                        keyword: "O√ô = adresse compl√®te + acc√®s",
                        tip: "Ajoutez rep√®res visuels : '√† c√¥t√© de...', 'en face de...'."
                    },
                    {
                        type: "vf",
                        question: "Il faut donner tous les d√©tails possibles dans l'√©l√©ment <span class='highlight'>'QUOI s'est-il pass√©'</span>.",
                        answer: false,
                        explanation: "FAUX ! Donner l'ESSENTIEL = nature de l'accident, circonstances principales. √âviter d√©tails inutiles qui font perdre du temps vital.",
                        keyword: "QUOI = essentiel, pas d√©tails",
                        tip: "Efficacit√© = informations vitales rapidement communiqu√©es."
                    },
                    {
                        type: "qcm",
                        question: "Pour 'COMBIEN de victimes', que pr√©ciser si c'est <span class='highlight'>incertain</span> ?",
                        options: [
                            "Ne rien dire",
                            "Donner un chiffre au hasard", 
                            "Dire 'environ X personnes' ou 'au moins X'",
                            "Attendre de compter exactement"
                        ],
                        answer: 2,
                        explanation: "ESTIMATION HONN√äTE = 'environ', 'au moins', 'entre X et Y'. Les secours pr√©f√®rent estimation r√©aliste qu'absence d'info.",
                        keyword: "Nombre incertain = estimation claire",
                        tip: "Mieux vaut surestimer que sous-estimer le nombre de victimes."
                    },
                    {
                        type: "keyword",
                        question: "Dans '√âTAT des victimes', quels sont les 3 points vitaux √† v√©rifier ?",
                        answer: "conscience respiration blessures",
                        hint: "C_ _ _ _ _ _ _ _ - R_ _ _ _ _ _ _ _ _ - B_ _ _ _ _ _ _",
                        explanation: "CONSCIENCE (r√©pond ou non) - RESPIRATION (normale ou difficile) - BLESSURES visibles = bilan vital minimum pour orienter secours.",
                        keyword: "√âTAT = conscience + respiration + blessures",
                        tip: "Si inconscient + ne respire pas = urgence absolue !"
                    },
                    {
                        type: "vf",
                        question: "On doit raccrocher d√®s qu'on a donn√© toutes les informations aux <span class='highlight'>secours</span>.",
                        answer: false,
                        explanation: "FAUX ! Ne JAMAIS raccrocher en premier. Laisser l'op√©rateur secours raccrocher apr√®s avoir confirm√© qu'il a tout compris.",
                        keyword: "Ne jamais raccrocher en premier",
                        tip: "Op√©rateur peut avoir besoin de pr√©cisions suppl√©mentaires."
                    },
                    {
                        type: "qcm",
                        question: "Si la personne est <span class='highlight'>consciente mais ne peut pas parler</span>, comment d√©crire son √©tat ?",
                        options: [
                            "'Inconsciente'",
                            "'Consciente, r√©pond aux questions'", 
                            "'Consciente mais ne peut pas parler'",
                            "'√âtat difficile √† d√©terminer'"
                        ],
                        answer: 2,
                        explanation: "DESCRIPTION PR√âCISE = 'consciente mais ne peut pas parler'. Indique traumatisme sp√©cifique (voies respiratoires, gorge...) aux secours.",
                        keyword: "√âtat pr√©cis = description exacte",
                        tip: "Distinction conscience/communication = info m√©dicale cruciale."
                    },
                    {
                        type: "keyword",
                        question: "Exemple de MAUVAISE phrase pour d√©buter un message d'alerte ?",
                        answer: "venez vite",
                        hint: "'V_ _ _ _ vite' ou 'C'est urgent'",
                        explanation: "'VENEZ VITE !' = panique, pas d'info utile. Commencer par 'Je suis [nom], √† [adresse], accident de...' = efficace et structur√©.",
                        keyword: "√âviter panique = structure calme",
                        tip: "Parler calmement et distinctement = compr√©hension optimale."
                    },
                    {
                        type: "vf",
                        question: "Un message d'alerte efficace dure g√©n√©ralement <span class='highlight'>moins de 2 minutes</span>.",
                        answer: true,
                        explanation: "VRAI ! Message structur√© QUI-O√ô-QUOI-COMBIEN-√âTAT = 1 √† 2 minutes maximum. Efficacit√© = rapidit√© + pr√©cision.",
                        keyword: "Message efficace = moins 2 minutes",
                        tip: "Entra√Ænez-vous √† la structure pour √™tre rapide en urgence !"
                    }
                ]
            },
            4: { // R√©glementation obligations
                title: "Niveau 4 : R√©glementation et Obligations",
                competence: "C3", 
                cards: [
                    {
                        type: "keyword",
                        question: "Quel article du <span class='highlight'>Code p√©nal</span> traite de l'obligation d'assistance ?",
                        answer: "223-6",
                        hint: "Article 2_ _-_",
                        explanation: "Article 223-6 = obligation de porter assistance √† toute personne en danger, SANS risque pour soi ou autrui. Base l√©gale fondamentale.",
                        keyword: "Assistance = Code p√©nal art. 223-6",
                        tip: "223-6 = √† retenir absolument pour l'√©preuve !"
                    },
                    {
                        type: "qcm",
                        question: "Que risque quelqu'un qui <span class='highlight'>ne porte pas assistance</span> √† une personne en danger ?",
                        options: [
                            "Une amende de 1500‚Ç¨",
                            "6 mois de prison et 7500‚Ç¨ d'amende", 
                            "5 ans de prison et 75000‚Ç¨ d'amende",
                            "Aucune sanction si pas form√© secourisme"
                        ],
                        answer: 2,
                        explanation: "5 ans de prison + 75 000‚Ç¨ d'amende = sanctions maximales. 7 ans + 100 000‚Ç¨ si victime de moins de 15 ans.",
                        keyword: "Non-assistance = 5 ans + 75000‚Ç¨",
                        tip: "Sanctions lourdes car vie humaine = valeur supr√™me dans notre droit."
                    },
                    {
                        type: "vf",
                        question: "L'obligation d'assistance ne s'applique que si on a une <span class='highlight'>formation secouriste</span>.",
                        answer: false,
                        explanation: "FAUX ! TOUS les citoyens ont cette obligation, form√©s ou non. Former ou non = m√™me obligation d'assistance dans ses capacit√©s.",
                        keyword: "Assistance = obligation universelle",
                        tip: "Pas form√© ? Appeler secours = d√©j√† porter assistance !"
                    },
                    {
                        type: "keyword",
                        question: "Quelle condition LIMITE l'obligation d'assistance selon l'art. 223-6 ?",
                        answer: "sans risque",
                        hint: "Sans r_ _ _ _ _",
                        explanation: "SANS RISQUE pour soi ou autrui = condition essentielle. Pas d'obligation de se mettre en danger pour sauver quelqu'un.",
                        keyword: "Assistance = SANS RISQUE obligatoire",
                        tip: "H√©ro√Øsme ‚â† obligation. Prudence = protection de tous."
                    },
                    {
                        type: "qcm",
                        question: "En entreprise, qui est <span class='highlight'>responsable</span> de l'organisation des premiers secours ?",
                        options: [
                            "Les salari√©s SST uniquement",
                            "Le CHSCT ou CSE", 
                            "L'employeur",
                            "L'inspection du travail"
                        ],
                        answer: 2,
                        explanation: "EMPLOYEUR = responsabilit√© l√©gale de l'organisation des secours (Code du travail). Obligation de r√©sultat en mati√®re de s√©curit√©.",
                        keyword: "Secours entreprise = responsabilit√© employeur",
                        tip: "Employeur = peut d√©l√©guer l'ex√©cution mais reste responsable."
                    },
                    {
                        type: "keyword",
                        question: "√Ä partir de combien de salari√©s un <span class='highlight'>local d'infirmerie</span> devient-il obligatoire ?",
                        answer: "500",
                        hint: "_ _ _ salari√©s",
                        explanation: "500 salari√©s = seuil d'obligation d'un local d'infirmerie avec pr√©sence d'une infirmi√®re (Code du travail art. R4624-25).",
                        keyword: "Infirmerie = obligatoire 500 salari√©s",
                        tip: "200-499 salari√©s = local de premiers secours suffisant."
                    },
                    {
                        type: "vf",
                        question: "Un employeur peut <span class='highlight'>interdire</span> √† ses salari√©s d'intervenir en cas d'accident du travail.",
                        answer: false,
                        explanation: "FAUX ! Interdire l'assistance = contraire √† l'art. 223-6 et au droit du travail. Employeur doit m√™me encourager formation secours.",
                        keyword: "Assistance = jamais interdite",
                        tip: "Employeur doit faciliter et organiser, pas emp√™cher."
                    },
                    {
                        type: "qcm",
                        question: "Quelle formation de secours est sp√©cifiquement adapt√©e au <span class='highlight'>milieu professionnel</span> ?",
                        options: [
                            "PSC1 - Pr√©vention Secours Civique",
                            "SST - Sauveteur Secouriste du Travail", 
                            "PSE1 - Premiers Secours √âquipe",
                            "AFPS - Attestation Premiers Secours"
                        ],
                        answer: 1,
                        explanation: "SST = formation sp√©cialement adapt√©e aux risques de l'entreprise + pr√©vention. Int√®gre sp√©cificit√©s du milieu professionnel.",
                        keyword: "Milieu pro = formation SST",
                        tip: "SST = secours + pr√©vention + sp√©cificit√© entreprise."
                    },
                    {
                        type: "keyword",
                        question: "Combien de temps a un salari√© pour d√©clarer un <span class='highlight'>accident du travail</span> ?",
                        answer: "24 heures",
                        hint: "_ _ heures",
                        explanation: "24 heures = d√©lai pour d√©clarer AT √† l'employeur (sauf cas de force majeure). Employeur a ensuite 48h pour CARSAT.",
                        keyword: "D√©claration AT salari√© = 24h",
                        tip: "D√©lai court = protection droits + enqu√™te rapide sur causes."
                    },
                    {
                        type: "vf",
                        question: "Porter secours lors d'un accident du travail peut engager la <span class='highlight'>responsabilit√©</span> du secouriste.",
                        answer: false,
                        explanation: "FAUX ! Protection l√©gale du bon samaritain. Aucune responsabilit√© si intervention de bonne foi dans ses comp√©tences.",
                        keyword: "Secours = protection l√©gale",
                        tip: "Loi prot√®ge ceux qui portent assistance, m√™me avec erreurs."
                    }
                ]
            },
            5: { // Quiz final expert
                title: "Niveau 5 : Quiz Final Expert",
                competence: "C4",
                cards: [
                    {
                        type: "qcm",
                        question: "Situation d'URGENCE VITALE : personne inconsciente qui ne respire pas. Quelle est la PRIORIT√â absolue ?",
                        options: [
                            "Appeler le 15-SAMU imm√©diatement",
                            "Commencer massage cardiaque + appeler aide", 
                            "V√©rifier le pouls avant toute action",
                            "Mettre en position lat√©rale de s√©curit√©"
                        ],
                        answer: 1,
                        explanation: "MASSAGE CARDIAQUE + APPELER AIDE = les 2 actions simultan√©es vitales. Chaque seconde sans circulation = dommages c√©r√©braux irr√©versibles.",
                        keyword: "Arr√™t cardiaque = massage + alerte",
                        tip: "Arr√™t cardiaque = 3 min max avant s√©quelles c√©r√©brales."
                    },
                    {
                        type: "keyword",
                        question: "SYNTH√àSE : r√©citez la structure compl√®te du message d'alerte en 5 mots.",
                        answer: "qui o√π quoi combien √©tat",
                        hint: "La m√©thode universelle en 5 √©l√©ments",
                        explanation: "QUI-O√ô-QUOI-COMBIEN-√âTAT = structure universelle efficace pour tous types d'urgence, reconnue par tous les services de secours.",
                        keyword: "Message universel = 5 √©l√©ments",
                        tip: "Ma√Ætrise parfaite obligatoire = peut sauver des vies !"
                    },
                    {
                        type: "vf",
                        question: "EXPERTISE : Un responsable peut demander √† un salari√© de ne PAS porter secours pour √©viter les probl√®mes juridiques.",
                        answer: false,
                        explanation: "FAUX ! Demande ill√©gale contraire au Code p√©nal art. 223-6. Responsable risque complicit√© de non-assistance √† personne en danger.",
                        keyword: "Assistance = obligation absolue",
                        tip: "Aucune hi√©rarchie ne peut suspendre l'obligation l√©gale d'assistance."
                    },
                    {
                        type: "qcm",
                        question: "MA√éTRISE EXPERT : Accident avec fuite de gaz + victime inconsciente. Ordre correct des actions ?",
                        options: [
                            "Secours victime ‚Üí Couper gaz ‚Üí Alerter",
                            "Alerter ‚Üí Couper gaz ‚Üí Secours victime", 
                            "Couper gaz ‚Üí Alerter ‚Üí Secours victime",
                            "√âvacuer ‚Üí Alerter ‚Üí Attendre secours"
                        ],
                        answer: 2,
                        explanation: "COUPER GAZ ‚Üí ALERTER ‚Üí SECOURS = P.A.S. appliqu√©. Prot√©ger (arr√™ter fuite) prioritaire sinon explosion/intoxication = victimes suppl√©mentaires.",
                        keyword: "Gaz = couper AVANT secours",
                        tip: "Toujours √©liminer source de danger AVANT intervention."
                    },
                    {
                        type: "keyword",
                        question: "EXPERT R√âGLEMENTATION : Sanctions maximales pour non-assistance (2 √©l√©ments) ?",
                        answer: "5 ans 75000 euros",
                        hint: "_ ans et _ _ _ _ _ euros",
                        explanation: "5 ANS prison + 75 000‚Ç¨ amende = sanctions maximales art. 223-6. Montrent gravit√© que le l√©gislateur accorde √† l'assistance.",
                        keyword: "Maximum = 5 ans + 75000‚Ç¨",
                        tip: "7 ans + 100000‚Ç¨ si victime moins de 15 ans."
                    },
                    {
                        type: "vf",
                        question: "EXPERT TECHNIQUE : Un d√©fibrillateur peut √™tre utilis√© par toute personne, m√™me non form√©e.",
                        answer: true,
                        explanation: "VRAI ! DAE = D√©fibrillateur Automatis√© Externe con√ßu pour usage grand public. Guidage vocal automatique + analyse automatique du rythme cardiaque.",
                        keyword: "DAE = utilisation grand public",
                        tip: "DAE ne choque QUE si rythme choquable d√©tect√© automatiquement."
                    },
                    {
                        type: "qcm",
                        question: "SYNTH√àSE NUM√âROS : Incendie avec personnes prisonni√®res + 1 bless√© grave. Qui appeler EN PREMIER ?",
                        options: [
                            "15-SAMU pour le bless√© grave",
                            "18-Pompiers pour l'incendie et secours", 
                            "112 num√©ro europ√©en",
                            "Les deux en m√™me temps 15 + 18"
                        ],
                        answer: 1,
                        explanation: "18-POMPIERS = comp√©tence incendie + secours personnes. Service unique pour situation complexe = plus efficace que multiplication appels.",
                        keyword: "Incendie + secours = 18 Pompiers",
                        tip: "Pompiers = formation m√©dicale + mat√©riel d√©sincarc√©ration."
                    },
                    {
                        type: "keyword",
                        question: "EXPERT SST : Fr√©quence du recyclage obligatoire formation SST ?",
                        answer: "2 ans",
                        hint: "Tous les _ ans",
                        explanation: "2 ANS = recyclage obligatoire SST (7h de formation). Maintient comp√©tences √† jour et int√®gre √©volutions techniques/r√©glementaires.",
                        keyword: "Recyclage SST = 2 ans",
                        tip: "Formation initiale 14h + recyclage 7h tous les 2 ans."
                    },
                    {
                        type: "vf",
                        question: "MA√éTRISE GLOBALE : L'obligation d'assistance s'applique aussi pendant les pauses et trajets domicile-travail.",
                        answer: true,
                        explanation: "VRAI ! Obligation d'assistance = universelle, 24h/24. Pas de suspension dans temps/lieux professionnels ou personnels.",
                        keyword: "Assistance = universelle toujours",
                        tip: "Citoyen = obligation permanente assistance √† personne en danger."
                    },
                    {
                        type: "qcm",
                        question: "EXPERT FINAL : Quelle est la PRIORIT√â dans l'organisation des secours en entreprise ?",
                        options: [
                            "Former le maximum de SST",
                            "Avoir mat√©riel m√©dical performant", 
                            "Organiser proc√©dures efficaces et connues",
                            "Installer d√©fibrillateurs partout"
                        ],
                        answer: 2,
                        explanation: "PROC√âDURES EFFICACES + CONNUES = base de tout syst√®me secours. Mat√©riel inutile sans organisation, formation inutile sans proc√©dures claires.",
                        keyword: "Priorit√© = proc√©dures efficaces connues",
                        tip: "Organisation > mat√©riel > formation = hi√©rarchie efficacit√©."
                    }
                ]
            }
        };

        // Fonction pour d√©marrer un niveau
        function startLevel(level) {
            currentLevel = level;
            currentCardIndex = 0;
            levelCorrect = 0;
            levelPoints = 0;
            levelErrors = [];
            hintUsed = false;

            document.getElementById('homeScreen').classList.remove('active');
            document.getElementById('gameScreen').classList.add('active');
            
            document.getElementById('levelTitle').textContent = levels[level].title;
            document.getElementById('currentCard').textContent = '1';
            document.getElementById('totalCards').textContent = levels[level].cards.length;
            document.getElementById('gameProgress').style.width = '0%';
            
            showCard();
        }

        function showCard() {
            const card = levels[currentLevel].cards[currentCardIndex];
            const competenceBadge = document.getElementById('cardCompetence');
            const cardType = document.getElementById('cardType');
            const questionSection = document.getElementById('questionSection');
            
            // R√©initialiser l'indice
            hintUsed = false;
            document.getElementById('hintText').style.display = 'none';
            
            // Mettre √† jour la comp√©tence
            competenceBadge.textContent = levels[currentLevel].competence;
            competenceBadge.className = `card-competence comp-badge ${levels[currentLevel].competence.toLowerCase()}`;
            
            // Mettre √† jour le type de carte
            cardType.textContent = card.type === 'keyword' ? 'MOT-CL√â' : card.type === 'qcm' ? 'QCM' : 'VRAI/FAUX';
            
            // Mettre √† jour le compteur et la progression
            document.getElementById('currentCard').textContent = currentCardIndex + 1;
            const progress = ((currentCardIndex) / levels[currentLevel].cards.length) * 100;
            document.getElementById('gameProgress').style.width = progress + '%';
            
            // Afficher la question selon le type
            if (card.type === 'keyword') {
                questionSection.innerHTML = `
                    <p class="question-text">${card.question}</p>
                    <input type="text" class="keyword-input" id="keywordAnswer" placeholder="Votre r√©ponse..." autocomplete="off">
                `;
                
                // Focus sur l'input
                setTimeout(() => {
                    document.getElementById('keywordAnswer').focus();
                }, 100);
                
                // Validation avec Entr√©e
                document.getElementById('keywordAnswer').addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        validateAnswer();
                    }
                });
            }
            else if (card.type === 'qcm') {
                let optionsHTML = card.options.map((opt, i) => `
                    <button class="option-btn" data-index="${i}" onclick="selectOption(this)">
                        <span class="option-letter">${String.fromCharCode(65 + i)}</span>
                        <span>${opt}</span>
                    </button>
                `).join('');
                
                questionSection.innerHTML = `
                    <p class="question-text">${card.question}</p>
                    <div class="options-container">${optionsHTML}</div>
                `;
            }
            else if (card.type === 'vf') {
                questionSection.innerHTML = `
                    <p class="question-text">${card.question}</p>
                    <div class="vf-container">
                        <button class="vf-btn vrai" onclick="selectVF(this, true)">‚úì VRAI</button>
                        <button class="vf-btn faux" onclick="selectVF(this, false)">‚úó FAUX</button>
                    </div>
                `;
            }
        }

        function selectOption(btn) {
            document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
        }

        function selectVF(btn, value) {
            document.querySelectorAll('.vf-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            btn.dataset.value = value;
        }

        function showHint() {
            const card = levels[currentLevel].cards[currentCardIndex];
            if (card.hint) {
                document.getElementById('hintText').innerHTML = `üí° <strong>Indice :</strong> ${card.hint}`;
                document.getElementById('hintText').style.display = 'block';
                hintUsed = true;
            }
        }

        function validateAnswer() {
            const card = levels[currentLevel].cards[currentCardIndex];
            let isCorrect = false;
            let userAnswer = '';

            if (card.type === 'keyword') {
                userAnswer = document.getElementById('keywordAnswer').value.trim().toLowerCase();
                // Normaliser (accents, etc.)
                const normalize = str => str.normalize('NFD').replace(/[\u0300-\u036f]/g, '').toLowerCase();
                isCorrect = normalize(userAnswer) === normalize(card.answer) || 
                            userAnswer.includes(normalize(card.answer)) ||
                            normalize(card.answer).includes(userAnswer);
            }
            else if (card.type === 'qcm') {
                const selected = document.querySelector('.option-btn.selected');
                if (!selected) { alert('S√©lectionne une r√©ponse'); return; }
                userAnswer = parseInt(selected.dataset.index);
                isCorrect = userAnswer === card.answer;
            }
            else if (card.type === 'vf') {
                const selected = document.querySelector('.vf-btn.selected');
                if (!selected) { alert('S√©lectionne VRAI ou FAUX'); return; }
                userAnswer = selected.dataset.value === 'true';
                isCorrect = userAnswer === card.answer;
            }

            showFeedback(isCorrect, card);
        }

        function showFeedback(isCorrect, card) {
            const overlay = document.getElementById('feedbackOverlay');
            const feedbackCard = document.getElementById('feedbackCard');

            let points = 0;
            if (isCorrect) {
                points = hintUsed ? 5 : 10;
                levelCorrect++;
                currentStreak++;
                if (currentStreak > bestStreak) bestStreak = currentStreak;

                // Streak bonus
                if (currentStreak === 3) showStreakPopup('üî• 3 de suite !');
                else if (currentStreak === 5) showStreakPopup('üî•üî• 5 de suite !');
                else if (currentStreak === 10) showStreakPopup('üî•üî•üî• INCROYABLE !');
            } else {
                currentStreak = 0;
                levelErrors.push(card.keyword || card.question.replace(/<[^>]*>/g, '').substring(0, 50) + '...');
            }

            levelPoints += points;
            totalPoints += points;
            updateScoreDisplay();

            feedbackCard.className = 'feedback-card ' + (isCorrect ? 'correct' : 'incorrect');
            document.getElementById('feedbackIcon').textContent = isCorrect ? '‚úÖ' : '‚ùå';
            document.getElementById('feedbackTitle').textContent = isCorrect ? 
                (currentStreak >= 3 ? 'Excellent ! üî•' : 'Bravo !') : 'Pas tout √† fait...';
            document.getElementById('feedbackPoints').textContent = isCorrect ? `+${points} points` : '0 point';
            document.getElementById('feedbackPoints').style.display = isCorrect ? 'block' : 'none';

            document.getElementById('feedbackExplanation').innerHTML = `
                <h4>üìö Explication</h4>
                <p>${card.explanation}</p>
                <div class="keyword-box">üîë <span>${card.keyword}</span></div>
                ${card.tip ? `<div class="tip-box"><h5>üí° Astuce BAC</h5><p>${card.tip}</p></div>` : ''}
            `;

            overlay.classList.add('visible');
        }

        function showStreakPopup(text) {
            const popup = document.getElementById('streakPopup');
            popup.textContent = text;
            popup.style.display = 'block';
            setTimeout(() => { popup.style.display = 'none'; }, 1500);
        }

        function nextCard() {
            document.getElementById('feedbackOverlay').classList.remove('visible');
            currentCardIndex++;

            if (currentCardIndex >= levels[currentLevel].cards.length) {
                showResults();
            } else {
                showCard();
            }
        }

        function showResults() {
            const total = levels[currentLevel].cards.length;
            const percent = Math.round((levelCorrect / total) * 100);

            levelProgress[currentLevel] = Math.max(levelProgress[currentLevel], percent);

            document.getElementById('gameScreen').classList.remove('active');
            document.getElementById('resultsScreen').classList.add('active');

            document.getElementById('resultsIcon').textContent = percent >= 80 ? 'üéâ' : percent >= 50 ? 'üëç' : 'üí™';
            document.getElementById('resultsTitle').textContent = percent >= 80 ? 'Niveau r√©ussi !' : percent >= 50 ? 'Pas mal !' : 'Continue !';
            document.getElementById('resultsScore').textContent = percent + '%';
            document.getElementById('correctCount').textContent = levelCorrect + '/' + total;
            document.getElementById('pointsEarned').textContent = '+' + levelPoints;
            document.getElementById('bestStreak').textContent = bestStreak;

            // Erreurs
            const errorsRecap = document.getElementById('errorsRecap');
            if (levelErrors.length > 0) {
                errorsRecap.style.display = 'block';
                document.getElementById('errorsList').innerHTML = levelErrors.map(e => `<li>${e}</li>`).join('');
            } else {
                errorsRecap.style.display = 'none';
            }

            // Confettis si r√©ussi
            if (percent >= 80) {
                createConfetti();
            }

            // Bouton niveau suivant
            document.getElementById('nextLevelBtn').style.display = (currentLevel < 5 && percent >= 60) ? 'flex' : 'none';

            updateHomeProgress();
        }

        function createConfetti() {
            const colors = ['#ff6b6b', '#feca57', '#48dbfb', '#ff9ff3', '#54a0ff', '#5f27cd'];
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 2 + 's';
                confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                document.body.appendChild(confetti);
                setTimeout(() => confetti.remove(), 3000);
            }
        }

        function goHome() {
            document.getElementById('resultsScreen').classList.remove('active');
            document.getElementById('gameScreen').classList.remove('active');
            document.getElementById('homeScreen').classList.add('active');
            updateHomeProgress();
        }

        function nextLevel() {
            if (currentLevel < 5) {
                startLevel(currentLevel + 1);
                document.getElementById('resultsScreen').classList.remove('active');
            }
        }

        function updateScoreDisplay() {
            document.getElementById('totalPoints').textContent = totalPoints;
            document.getElementById('currentStreak').textContent = currentStreak;
        }

        function updateHomeProgress() {
            for (let i = 1; i <= 5; i++) {
                document.getElementById(`level${i}Percent`).textContent = levelProgress[i] + '%';
                document.getElementById(`level${i}Bar`).style.width = levelProgress[i] + '%';
            }
        }

        // Init
        updateScoreDisplay();
        updateHomeProgress();
    </script>
</body>
</html>