<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Objectif Budget CCF - √âtape 3 : Le Cr√©dit</title>
    <style>
        :root { --primary: #6366f1; --success: #10b981; --warning: #f59e0b; --error: #ef4444; --helped: #8b5cf6; --text: #1e293b; --text-light: #64748b; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 15px; padding-bottom: 100px; line-height: 1.6; }
        .container { max-width: 800px; margin: 0 auto; }
        .parcours-header { background: rgba(255,255,255,0.95); border-radius: 20px; padding: 20px; margin-bottom: 15px; text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.2); }
        .parcours-badge { display: inline-block; background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 8px 20px; border-radius: 30px; font-weight: 700; font-size: 0.85rem; margin-bottom: 10px; }
        .parcours-title { font-size: 1.8rem; font-weight: 800; color: var(--text); margin-bottom: 5px; }
        .parcours-subtitle { color: var(--text-light); }
        .etapes-nav { display: flex; justify-content: center; gap: 8px; margin: 20px 0; }
        .etape-dot { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 0.9rem; }
        .etape-dot.done { background: var(--success); color: white; }
        .etape-dot.active { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .etape-dot.locked { background: #e2e8f0; color: #94a3b8; }
        .main-card { background: white; border-radius: 20px; padding: 25px; margin-bottom: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
        .objectifs-box { background: linear-gradient(135deg, #eff6ff, #dbeafe); border: 2px solid #3b82f6; border-radius: 15px; padding: 20px; margin-bottom: 20px; }
        .objectifs-box h2 { color: #1d4ed8; font-size: 1.1rem; margin-bottom: 12px; }
        .objectifs-list { list-style: none; }
        .objectifs-list li { padding: 6px 0 6px 20px; position: relative; font-size: 0.95rem; }
        .objectifs-list li::before { content: "‚úì"; position: absolute; left: 0; color: #3b82f6; font-weight: bold; }
        .objectifs-list .verbe { color: #dc2626; font-weight: 700; text-decoration: underline; }
        .competences-tags { display: flex; gap: 8px; margin-top: 12px; }
        .comp-tag { background: #3b82f6; color: white; padding: 4px 12px; border-radius: 15px; font-size: 0.8rem; font-weight: 700; }
        .progress-section { background: #f8fafc; border-radius: 12px; padding: 15px; margin-bottom: 20px; }
        .progress-header { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.9rem; }
        .progress-bar { background: #e2e8f0; height: 10px; border-radius: 10px; overflow: hidden; }
        .progress-fill { background: linear-gradient(90deg, var(--success), #34d399); height: 100%; transition: width 0.5s; }
        .legend { display: flex; gap: 15px; margin-top: 10px; font-size: 0.8rem; flex-wrap: wrap; }
        .legend-item { display: flex; align-items: center; gap: 5px; }
        .legend-dot { width: 12px; height: 12px; border-radius: 50%; }
        .legend-dot.success { background: var(--success); }
        .legend-dot.helped { background: var(--helped); }
        .exercice { display: none; animation: fadeIn 0.4s; }
        .exercice.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; } }
        .exercice-header { display: flex; align-items: center; gap: 12px; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #e2e8f0; }
        .exercice-num { background: linear-gradient(135deg, #667eea, #764ba2); color: white; width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 1.2rem; }
        .exercice-title h3 { font-size: 1.15rem; color: var(--text); margin-bottom: 3px; }
        .exercice-title p { color: var(--text-light); font-size: 0.85rem; }
        .situation-box { background: linear-gradient(135deg, #fef3c7, #fde68a); border-left: 4px solid #f59e0b; padding: 15px; border-radius: 0 12px 12px 0; margin: 15px 0; }
        .situation-box strong { color: #92400e; }
        .rappel-box { background: linear-gradient(135deg, #f0fdf4, #dcfce7); border: 2px solid var(--success); border-radius: 12px; padding: 15px; margin: 15px 0; }
        .rappel-box h4 { color: #166534; font-size: 0.95rem; margin-bottom: 10px; }
        .rappel-box ul { margin-left: 18px; }
        .rappel-box li { margin-bottom: 5px; font-size: 0.9rem; }
        .credit-table { width: 100%; border-collapse: collapse; margin: 15px 0; font-size: 0.8rem; }
        .credit-table th { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 10px 6px; text-align: center; }
        .credit-table td { padding: 10px 6px; border-bottom: 1px solid #e2e8f0; text-align: center; }
        .credit-table tr:hover { background: #f8fafc; }
        .credit-table .highlight { background: #fef3c7; font-weight: 700; }
        .schema-credit { background: #f8fafc; border-radius: 12px; padding: 20px; margin: 15px 0; text-align: center; }
        .schema-credit .arrow { font-size: 2rem; color: var(--primary); }
        .question { background: #f8fafc; padding: 15px; border-radius: 12px; margin: 15px 0; border-left: 4px solid var(--primary); }
        .question-label { font-weight: 700; margin-bottom: 12px; font-size: 0.95rem; }
        .question label { display: flex; align-items: center; padding: 10px 12px; margin: 6px 0; background: white; border-radius: 8px; cursor: pointer; border: 2px solid transparent; font-size: 0.9rem; }
        .question label:hover { border-color: var(--primary); }
        .question label.correct-answer { border-color: var(--success); background: #f0fdf4; }
        .question label.wrong-answer { border-color: var(--error); background: #fef2f2; }
        .question input[type="radio"] { margin-right: 10px; width: 18px; height: 18px; }
        .question input[type="text"] { width: 100%; max-width: 200px; padding: 10px 12px; margin: 8px 0; border: 2px solid #cbd5e1; border-radius: 8px; font-size: 1rem; font-weight: 700; }
        .question input[type="text"]:focus { outline: none; border-color: var(--primary); }
        .question input[type="text"].correct { border-color: var(--success); background: #f0fdf4; }
        .question input[type="text"].wrong { border-color: var(--error); background: #fef2f2; }
        .feedback { display: none; padding: 15px; margin: 15px 0; border-radius: 12px; }
        .feedback.success { background: #f0fdf4; border: 2px solid var(--success); color: #166534; }
        .feedback.error { background: #fef2f2; border: 2px solid var(--error); color: #991b1b; }
        .feedback.helped { background: #f5f3ff; border: 2px solid var(--helped); color: #5b21b6; }
        .feedback .title { font-weight: 800; font-size: 1.05rem; margin-bottom: 10px; }
        .explication { background: rgba(255,255,255,0.6); padding: 12px; border-radius: 8px; margin-top: 10px; font-size: 0.9rem; line-height: 1.7; }
        .retenir { background: #fef3c7; border: 2px solid #f59e0b; border-radius: 8px; padding: 12px; margin-top: 10px; font-size: 0.9rem; }
        .retenir strong { color: #92400e; }
        .error-detail { background: #fee2e2; padding: 8px 12px; border-radius: 6px; margin: 5px 0; font-size: 0.85rem; }
        .btn-group { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 20px; }
        .btn { padding: 12px 24px; border: none; border-radius: 10px; font-weight: 700; font-size: 0.95rem; cursor: pointer; transition: all 0.2s; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .btn-primary { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .btn-success { background: linear-gradient(135deg, #10b981, #059669); color: white; }
        .btn-secondary { background: #94a3b8; color: white; }
        .btn-help { background: #fef3c7; color: #92400e; border: 2px solid #f59e0b; }
        .btn-continue { background: linear-gradient(135deg, #10b981, #059669); color: white; display: none; }
        .btn-continue.show { display: inline-flex; }
        .final-result { display: none; text-align: center; padding: 30px 20px; }
        .final-result.show { display: block; }
        .celebration { font-size: 3rem; margin-bottom: 15px; }
        .score-display { font-size: 3rem; font-weight: 900; background: linear-gradient(135deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 15px 0; }
        .result-details { background: #f8fafc; border-radius: 12px; padding: 15px; margin: 20px 0; text-align: left; }
        .result-details h4 { margin-bottom: 10px; }
        .result-item { display: flex; align-items: center; gap: 10px; padding: 8px 0; border-bottom: 1px solid #e2e8f0; }
        .result-item:last-child { border-bottom: none; }
        .result-icon { width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; color: white; }
        .result-icon.success { background: var(--success); }
        .result-icon.helped { background: var(--helped); }
        .next-step { background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 15px 30px; border-radius: 15px; font-size: 1.1rem; font-weight: 800; border: none; cursor: pointer; }
        .next-step:hover { transform: translateY(-3px); }
        .calc-toggle { position: fixed; bottom: 20px; left: 20px; z-index: 1000; background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white; border: none; width: 55px; height: 55px; border-radius: 50%; font-size: 1.6rem; cursor: pointer; }
        .calculator { position: fixed; bottom: 85px; left: 20px; z-index: 999; background: #1e293b; border: 3px solid #8b5cf6; border-radius: 20px; padding: 15px; display: none; width: 260px; }
        .calculator.visible { display: block; }
        .calc-header { display: flex; justify-content: space-between; margin-bottom: 12px; }
        .calc-header h4 { color: #a78bfa; margin: 0; }
        .calc-close { background: transparent; border: none; color: #94a3b8; font-size: 1.4rem; cursor: pointer; }
        .calc-display { background: #0f172a; color: #4ade80; font-family: monospace; padding: 12px; border-radius: 10px; font-size: 1.5rem; text-align: right; margin-bottom: 12px; }
        .calc-display.error { color: #ef4444; }
        .calc-buttons { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; }
        .calc-btn { background: #334155; color: #e2e8f0; border: none; padding: 12px; border-radius: 8px; font-size: 1.1rem; font-weight: 700; cursor: pointer; }
        .calc-btn.op { background: #3b82f6; }
        .calc-btn.eq { background: #10b981; grid-column: span 2; }
        .calc-btn.clr { background: #ef4444; }
        .calc-btn.zero { grid-column: span 2; }
        @media (max-width: 500px) {
            body { padding: 10px; padding-bottom: 100px; }
            .parcours-title { font-size: 1.4rem; }
            .main-card { padding: 18px; }
            .credit-table { font-size: 0.7rem; }
            .calc-toggle { width: 50px; height: 50px; bottom: 15px; left: 15px; }
            .calculator { width: 240px; left: 10px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="parcours-header">
            <div class="parcours-badge">üéØ PARCOURS CCF</div>
            <h1 class="parcours-title">Objectif Budget</h1>
            <p class="parcours-subtitle">Pr√©pare-toi pour r√©ussir ton CCF !</p>
            <div class="etapes-nav">
                <div class="etape-dot done">‚úì</div>
                <div class="etape-dot done">‚úì</div>
                <div class="etape-dot active">3</div>
                <div class="etape-dot locked">4</div>
                <div class="etape-dot locked">5</div>
            </div>
        </div>

        <div class="main-card">
            <h2 style="text-align: center; color: var(--primary); margin-bottom: 20px; font-size: 1.4rem;">
                üè¶ √âtape 3/5 : Le Cr√©dit √† la Consommation
            </h2>

            <div class="objectifs-box">
                <h2>üéØ Objectifs</h2>
                <ul class="objectifs-list">
                    <li><span class="verbe">Indiquer</span> le principe du cr√©dit √† la consommation</li>
                    <li><span class="verbe">Comparer</span> deux offres de cr√©dit</li>
                    <li><span class="verbe">Calculer</span> le co√ªt total d'un cr√©dit</li>
                    <li><span class="verbe">Identifier</span> les avantages et inconv√©nients</li>
                </ul>
                <div class="competences-tags">
                    <span class="comp-tag">C2</span>
                    <span class="comp-tag">C3</span>
                </div>
            </div>

            <div class="progress-section">
                <div class="progress-header">
                    <strong>üìä Progression</strong>
                    <span id="progress-text">Exercice 0/4</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill" style="width: 0%;"></div>
                </div>
                <div class="legend">
                    <div class="legend-item"><div class="legend-dot success"></div> R√©ussi seul</div>
                    <div class="legend-item"><div class="legend-dot helped"></div> Avec aide</div>
                </div>
            </div>

            <!-- EXERCICE 1 -->
            <div class="exercice active" id="ex1">
                <div class="exercice-header">
                    <div class="exercice-num">1</div>
                    <div class="exercice-title">
                        <h3>Le Principe du Cr√©dit</h3>
                        <p>Comprendre comment fonctionne un cr√©dit</p>
                    </div>
                </div>

                <div class="rappel-box">
                    <h4>üìö D√©finition</h4>
                    <p>Le <strong>cr√©dit √† la consommation</strong> permet d'emprunter de l'argent √† une banque pour acheter un bien et de rembourser en plusieurs mensualit√©s avec des <strong>int√©r√™ts</strong>.</p>
                </div>

                <div class="schema-credit">
                    <div style="display: flex; justify-content: space-around; align-items: center; flex-wrap: wrap; gap: 15px;">
                        <div style="text-align: center;"><div style="font-size: 2.5rem;">üè¶</div><strong>Banque</strong></div>
                        <div><div class="arrow">‚Üí</div><small>Verse l'argent</small></div>
                        <div style="text-align: center;"><div style="font-size: 2.5rem;">üë§</div><strong>Emprunteur</strong></div>
                        <div><div class="arrow">‚Üí</div><small>Rembourse + int√©r√™ts</small></div>
                        <div style="text-align: center;"><div style="font-size: 2.5rem;">üè¶</div><strong>Banque</strong></div>
                    </div>
                </div>

                <div class="question">
                    <div class="question-label">1. Que doit rembourser l'emprunteur ?</div>
                    <label><input type="radio" name="q1a" value="a"><span>Seulement la somme emprunt√©e</span></label>
                    <label><input type="radio" name="q1a" value="b"><span>La somme emprunt√©e + les int√©r√™ts</span></label>
                    <label><input type="radio" name="q1a" value="c"><span>Seulement les int√©r√™ts</span></label>
                </div>

                <div class="question">
                    <div class="question-label">2. De combien de jours dispose l'emprunteur pour se r√©tracter apr√®s signature ?</div>
                    <label><input type="radio" name="q1b" value="a"><span>7 jours</span></label>
                    <label><input type="radio" name="q1b" value="b"><span>14 jours</span></label>
                    <label><input type="radio" name="q1b" value="c"><span>30 jours</span></label>
                </div>

                <div class="feedback" id="fb1"></div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="verifier(1)">‚úÖ V√©rifier</button>
                    <button class="btn btn-help" onclick="voirCorrection(1)">üí° Correction</button>
                    <button class="btn btn-continue" id="btn-cont1" onclick="goTo(2)">Continuer ‚Üí</button>
                </div>
            </div>

            <!-- EXERCICE 2 -->
            <div class="exercice" id="ex2">
                <div class="exercice-header">
                    <div class="exercice-num">2</div>
                    <div class="exercice-title">
                        <h3>Comparer Deux Cr√©dits</h3>
                        <p>Identifier le cr√©dit le moins cher</p>
                    </div>
                </div>

                <div class="situation-box">
                    <strong>üë§ Situation :</strong> Ana√Øs veut emprunter <strong>487,50 ‚Ç¨</strong>. Sa banque lui propose 2 offres :
                </div>

                <table class="credit-table">
                    <thead><tr><th></th><th>Cr√©dit A</th><th>Cr√©dit B</th></tr></thead>
                    <tbody>
                        <tr><td><strong>Montant emprunt√©</strong></td><td>487,50 ‚Ç¨</td><td>487,50 ‚Ç¨</td></tr>
                        <tr><td><strong>Mensualit√©</strong></td><td>43,78 ‚Ç¨</td><td>30,72 ‚Ç¨</td></tr>
                        <tr><td><strong>Dur√©e</strong></td><td>12 mois</td><td>18 mois</td></tr>
                        <tr class="highlight"><td><strong>Montant total d√ª</strong></td><td>525,36 ‚Ç¨</td><td>552,96 ‚Ç¨</td></tr>
                        <tr><td><strong>TAEG</strong></td><td>15,20%</td><td>17,85%</td></tr>
                        <tr><td><strong>Int√©r√™ts</strong></td><td>37,86 ‚Ç¨</td><td>65,46 ‚Ç¨</td></tr>
                    </tbody>
                </table>

                <div class="rappel-box">
                    <h4>üìö Rappel</h4>
                    <ul>
                        <li><strong>TAEG</strong> = Taux Annuel Effectif Global (co√ªt total du cr√©dit)</li>
                        <li><strong>Plus le TAEG est bas</strong>, moins le cr√©dit co√ªte cher</li>
                    </ul>
                </div>

                <div class="question">
                    <div class="question-label">1. Quel cr√©dit est le MOINS CHER au total ?</div>
                    <label><input type="radio" name="q2a" value="a"><span>Cr√©dit A (525,36 ‚Ç¨)</span></label>
                    <label><input type="radio" name="q2a" value="b"><span>Cr√©dit B (552,96 ‚Ç¨)</span></label>
                </div>

                <div class="question">
                    <div class="question-label">2. Quel cr√©dit a le TAEG le plus avantageux ?</div>
                    <label><input type="radio" name="q2b" value="a"><span>Cr√©dit A (15,20%)</span></label>
                    <label><input type="radio" name="q2b" value="b"><span>Cr√©dit B (17,85%)</span></label>
                </div>

                <div class="feedback" id="fb2"></div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="goTo(1)">‚Üê Pr√©c√©dent</button>
                    <button class="btn btn-primary" onclick="verifier(2)">‚úÖ V√©rifier</button>
                    <button class="btn btn-help" onclick="voirCorrection(2)">üí° Correction</button>
                    <button class="btn btn-continue" id="btn-cont2" onclick="goTo(3)">Continuer ‚Üí</button>
                </div>
            </div>

            <!-- EXERCICE 3 -->
            <div class="exercice" id="ex3">
                <div class="exercice-header">
                    <div class="exercice-num">3</div>
                    <div class="exercice-title">
                        <h3>Calculer le Co√ªt Total</h3>
                        <p>Combien co√ªte vraiment un achat √† cr√©dit ?</p>
                    </div>
                </div>

                <div class="situation-box">
                    <strong>üë§ Situation :</strong> Tom ach√®te un scooter √† <strong>1 287,35 ‚Ç¨</strong>.<br>
                    Il a un apport de <strong>487,35 ‚Ç¨</strong> et emprunte <strong>800 ‚Ç¨</strong>.<br>
                    Il rembourse <strong>73,45 ‚Ç¨ par mois pendant 12 mois</strong>.
                </div>

                <div class="rappel-box">
                    <h4>üìö Formule</h4>
                    <p style="text-align: center; padding: 10px; background: white; border-radius: 8px;">
                        <strong>Co√ªt total √† cr√©dit = Apport + (Mensualit√© √ó Nombre de mois)</strong>
                    </p>
                </div>

                <div class="question">
                    <div class="question-label">1. Calcule le co√ªt total si Tom ach√®te √† cr√©dit :</div>
                    <p style="font-size: 0.85rem; color: var(--text-light);">Calcul : 487,35 + (73,45 √ó 12) = ?</p>
                    <input type="text" inputmode="decimal" id="cout-credit" placeholder="Ex : 1368,75" autocomplete="off">
                    <span style="font-weight: 700;"> ‚Ç¨</span>
                </div>

                <div class="question">
                    <div class="question-label">2. Combien co√ªte le scooter EN PLUS si achet√© √† cr√©dit ?</div>
                    <p style="font-size: 0.85rem; color: var(--text-light);">Diff√©rence = Co√ªt √† cr√©dit ‚àí Prix comptant (1 287,35 ‚Ç¨)</p>
                    <input type="text" inputmode="decimal" id="difference" placeholder="Ex : 81,40" autocomplete="off">
                    <span style="font-weight: 700;"> ‚Ç¨</span>
                </div>

                <div class="feedback" id="fb3"></div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="goTo(2)">‚Üê Pr√©c√©dent</button>
                    <button class="btn btn-primary" onclick="verifier(3)">‚úÖ V√©rifier</button>
                    <button class="btn btn-help" onclick="voirCorrection(3)">üí° Correction</button>
                    <button class="btn btn-continue" id="btn-cont3" onclick="goTo(4)">Continuer ‚Üí</button>
                </div>
            </div>

            <!-- EXERCICE 4 -->
            <div class="exercice" id="ex4">
                <div class="exercice-header">
                    <div class="exercice-num">4</div>
                    <div class="exercice-title">
                        <h3>Avantages et Inconv√©nients</h3>
                        <p>Comprendre les risques du cr√©dit</p>
                    </div>
                </div>

                <div class="rappel-box">
                    <h4>üìö Le cr√©dit : avantages et risques</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px;">
                        <div style="background: #f0fdf4; padding: 12px; border-radius: 8px;">
                            <strong style="color: #166534;">‚úÖ Avantages</strong>
                            <ul style="margin: 8px 0 0 15px; font-size: 0.85rem;">
                                <li>Financer un projet imm√©diatement</li>
                                <li>Rembourser en plusieurs fois</li>
                            </ul>
                        </div>
                        <div style="background: #fef2f2; padding: 12px; border-radius: 8px;">
                            <strong style="color: #991b1b;">‚ùå Inconv√©nients</strong>
                            <ul style="margin: 8px 0 0 15px; font-size: 0.85rem;">
                                <li>Co√ªte plus cher qu'un achat comptant</li>
                                <li>Risque de surendettement</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="question">
                    <div class="question-label">1. "Acheter √† cr√©dit co√ªte plus cher qu'acheter comptant"</div>
                    <label><input type="radio" name="q4a" value="vrai"><span>VRAI</span></label>
                    <label><input type="radio" name="q4a" value="faux"><span>FAUX</span></label>
                </div>

                <div class="question">
                    <div class="question-label">2. "Le surendettement, c'est quand on ne peut plus rembourser ses dettes"</div>
                    <label><input type="radio" name="q4b" value="vrai"><span>VRAI</span></label>
                    <label><input type="radio" name="q4b" value="faux"><span>FAUX</span></label>
                </div>

                <div class="question">
                    <div class="question-label">3. "Pour √©viter le surendettement, le taux d'endettement doit rester sous..."</div>
                    <label><input type="radio" name="q4c" value="a"><span>25%</span></label>
                    <label><input type="radio" name="q4c" value="b"><span>35%</span></label>
                    <label><input type="radio" name="q4c" value="c"><span>50%</span></label>
                </div>

                <div class="feedback" id="fb4"></div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="goTo(3)">‚Üê Pr√©c√©dent</button>
                    <button class="btn btn-success" onclick="verifier(4)">‚úÖ Terminer l'√©tape</button>
                    <button class="btn btn-help" onclick="voirCorrection(4)">üí° Correction</button>
                    <button class="btn btn-continue" id="btn-cont4" onclick="afficherFinal()">Voir mon bilan ‚Üí</button>
                </div>
            </div>

            <!-- R√âSULTAT FINAL -->
            <div class="final-result" id="final-result">
                <div class="celebration">üéâüè¶üéâ</div>
                <h2 style="color: var(--text); margin-bottom: 10px;">√âTAPE 3 TERMIN√âE !</h2>
                <div class="score-display" id="score-display">4/4</div>
                <p style="font-size: 1.2rem; margin-bottom: 20px;" id="encouragement">Tu comprends maintenant le fonctionnement du cr√©dit !</p>

                <div class="result-details">
                    <h4>üìã D√©tail de tes r√©sultats :</h4>
                    <div id="result-list"></div>
                </div>

                <div style="background: #f0fdf4; border: 2px solid #10b981; border-radius: 12px; padding: 15px; margin: 20px 0; text-align: left;">
                    <strong style="color: #166534;">‚úÖ Ce que tu sais maintenant :</strong>
                    <ul style="margin: 10px 0 0 20px; color: #166534;">
                        <li>Le principe du cr√©dit et le d√©lai de r√©tractation (14 jours)</li>
                        <li>Comparer deux cr√©dits (TAEG, co√ªt total)</li>
                        <li>Calculer le surco√ªt d'un achat √† cr√©dit</li>
                        <li>Les risques : surendettement si taux > 35%</li>
                    </ul>
                </div>

                <button class="next-step" onclick="allerEtape4()">
                    Continuer vers l'√âtape 4 : Le Taux d'Endettement ‚Üí
                </button>
            </div>
        </div>
    </div>

    <button class="calc-toggle" id="calc-toggle">üßÆ</button>
    <div class="calculator" id="calculator">
        <div class="calc-header">
            <h4>üßÆ Calculatrice</h4>
            <button class="calc-close" id="calc-close">√ó</button>
        </div>
        <div class="calc-display" id="calc-display">0</div>
        <div class="calc-buttons">
            <button class="calc-btn clr" data-action="clear">C</button>
            <button class="calc-btn op" data-action="backspace">‚Üê</button>
            <button class="calc-btn op" data-action="divide">√∑</button>
            <button class="calc-btn op" data-action="multiply">√ó</button>
            <button class="calc-btn" data-num="7">7</button>
            <button class="calc-btn" data-num="8">8</button>
            <button class="calc-btn" data-num="9">9</button>
            <button class="calc-btn op" data-action="subtract">‚àí</button>
            <button class="calc-btn" data-num="4">4</button>
            <button class="calc-btn" data-num="5">5</button>
            <button class="calc-btn" data-num="6">6</button>
            <button class="calc-btn op" data-action="add">+</button>
            <button class="calc-btn" data-num="1">1</button>
            <button class="calc-btn" data-num="2">2</button>
            <button class="calc-btn" data-num="3">3</button>
            <button class="calc-btn eq" data-action="equals">=</button>
            <button class="calc-btn zero" data-num="0">0</button>
            <button class="calc-btn" data-action="decimal">,</button>
        </div>
    </div>

    <script>
        // 487,35 + (73,45 √ó 12) = 487,35 + 881,40 = 1368,75
        // 1368,75 - 1287,35 = 81,40
        const COUT_CREDIT = 1368.75;
        const DIFFERENCE = 81.40;

        let results = { 1: null, 2: null, 3: null, 4: null };

        function parseNombre(str) {
            if (!str) return null;
            let s = String(str).replace(/\s/g, "").replace(/‚Ç¨/g, "").replace(/,/g, ".");
            const n = parseFloat(s);
            return Number.isFinite(n) ? n : null;
        }

        function goTo(n) {
            document.querySelectorAll(".exercice").forEach(e => e.classList.remove("active"));
            document.getElementById(`ex${n}`).classList.add("active");
            window.scrollTo({ top: 0, behavior: "smooth" });
        }

        function updateProgress() {
            const done = Object.values(results).filter(v => v !== null).length;
            document.getElementById("progress-fill").style.width = (done / 4) * 100 + "%";
            document.getElementById("progress-text").textContent = `Exercice ${done}/4`;
        }

        function colorAnswers(container, correctValues) {
            document.querySelectorAll(`#${container} label`).forEach(l => {
                const input = l.querySelector('input');
                const isCorrect = correctValues[input.name] === input.value;
                if (isCorrect) l.classList.add("correct-answer");
                else if (input.checked) l.classList.add("wrong-answer");
            });
        }

        function verifier(n) {
            const fb = document.getElementById(`fb${n}`);
            fb.style.display = "none";

            if (n === 1) {
                const q1a = document.querySelector('input[name="q1a"]:checked')?.value;
                const q1b = document.querySelector('input[name="q1b"]:checked')?.value;
                if (!q1a || !q1b) { fb.className = "feedback error"; fb.innerHTML = `<div class="title">‚ö†Ô∏è R√©ponds aux 2 questions</div>`; fb.style.display = "block"; return; }

                colorAnswers("ex1", { q1a: "b", q1b: "b" });

                if (q1a === "b" && q1b === "b") {
                    fb.className = "feedback success";
                    fb.innerHTML = `<div class="title">‚úÖ Correct !</div>
                        <div class="explication">L'emprunteur rembourse la somme + les int√©r√™ts.<br>Il a <strong>14 jours</strong> pour se r√©tracter.</div>`;
                    results[1] = 'success'; updateProgress();
                    document.getElementById("btn-cont1").classList.add("show");
                } else {
                    fb.className = "feedback error";
                    let msg = `<div class="title">‚ùå V√©rifie tes r√©ponses</div>`;
                    if (q1a !== "b") msg += `<div class="error-detail">Q1 : On rembourse la somme + les int√©r√™ts</div>`;
                    if (q1b !== "b") msg += `<div class="error-detail">Q2 : Le d√©lai de r√©tractation est de 14 jours</div>`;
                    fb.innerHTML = msg;
                }
                fb.style.display = "block";
            }

            else if (n === 2) {
                const q2a = document.querySelector('input[name="q2a"]:checked')?.value;
                const q2b = document.querySelector('input[name="q2b"]:checked')?.value;
                if (!q2a || !q2b) { fb.className = "feedback error"; fb.innerHTML = `<div class="title">‚ö†Ô∏è R√©ponds aux 2 questions</div>`; fb.style.display = "block"; return; }

                colorAnswers("ex2", { q2a: "a", q2b: "a" });

                if (q2a === "a" && q2b === "a") {
                    fb.className = "feedback success";
                    fb.innerHTML = `<div class="title">‚úÖ Bravo !</div>
                        <div class="explication">
                            <strong>Cr√©dit A</strong> est le moins cher (525,36 ‚Ç¨ < 552,96 ‚Ç¨)<br>
                            <strong>Cr√©dit A</strong> a le meilleur TAEG (15,20% < 17,85%)
                        </div>
                        <div class="retenir">üí° <strong>Attention :</strong> Une mensualit√© plus basse ne veut pas dire cr√©dit moins cher ! Le Cr√©dit B dure plus longtemps donc co√ªte plus au total.</div>`;
                    results[2] = 'success'; updateProgress();
                    document.getElementById("btn-cont2").classList.add("show");
                } else {
                    fb.className = "feedback error";
                    let msg = `<div class="title">‚ùå Compare bien les chiffres</div>`;
                    if (q2a !== "a") msg += `<div class="error-detail">Q1 : Compare les montants totaux : 525,36 ‚Ç¨ vs 552,96 ‚Ç¨</div>`;
                    if (q2b !== "a") msg += `<div class="error-detail">Q2 : Compare les TAEG : 15,20% vs 17,85%</div>`;
                    fb.innerHTML = msg;
                }
                fb.style.display = "block";
            }

            else if (n === 3) {
                const coutCredit = parseNombre(document.getElementById("cout-credit").value);
                const diff = parseNombre(document.getElementById("difference").value);

                const inputCout = document.getElementById("cout-credit");
                const inputDiff = document.getElementById("difference");

                const coutOk = coutCredit !== null && Math.abs(coutCredit - COUT_CREDIT) < 1;
                const diffOk = diff !== null && Math.abs(diff - DIFFERENCE) < 1;

                inputCout.classList.toggle("correct", coutOk);
                inputCout.classList.toggle("wrong", !coutOk && coutCredit !== null);
                inputDiff.classList.toggle("correct", diffOk);
                inputDiff.classList.toggle("wrong", !diffOk && diff !== null);

                if (coutOk && diffOk) {
                    fb.className = "feedback success";
                    fb.innerHTML = `<div class="title">‚úÖ Parfait !</div>
                        <div class="explication">
                            Co√ªt √† cr√©dit = 487,35 + (73,45 √ó 12) = <strong>1 368,75 ‚Ç¨</strong><br>
                            Surco√ªt = 1 368,75 ‚àí 1 287,35 = <strong>81,40 ‚Ç¨</strong>
                        </div>
                        <div class="retenir">üí° Tom paie 81,40 ‚Ç¨ de plus en achetant √† cr√©dit. C'est le prix de la facilit√© de paiement !</div>`;
                    results[3] = 'success'; updateProgress();
                    document.getElementById("btn-cont3").classList.add("show");
                } else {
                    fb.className = "feedback error";
                    let msg = `<div class="title">‚ùå V√©rifie tes calculs</div>`;
                    if (!coutOk) msg += `<div class="error-detail">Co√ªt cr√©dit = 487,35 + (73,45 √ó 12) = 1 368,75 ‚Ç¨ (tu as mis ${coutCredit?.toFixed(2).replace(".",",") || "rien"})</div>`;
                    if (!diffOk) msg += `<div class="error-detail">Surco√ªt = 1 368,75 ‚àí 1 287,35 = 81,40 ‚Ç¨ (tu as mis ${diff?.toFixed(2).replace(".",",") || "rien"})</div>`;
                    fb.innerHTML = msg;
                }
                fb.style.display = "block";
            }

            else if (n === 4) {
                const q4a = document.querySelector('input[name="q4a"]:checked')?.value;
                const q4b = document.querySelector('input[name="q4b"]:checked')?.value;
                const q4c = document.querySelector('input[name="q4c"]:checked')?.value;
                if (!q4a || !q4b || !q4c) { fb.className = "feedback error"; fb.innerHTML = `<div class="title">‚ö†Ô∏è R√©ponds aux 3 questions</div>`; fb.style.display = "block"; return; }

                colorAnswers("ex4", { q4a: "vrai", q4b: "vrai", q4c: "b" });

                if (q4a === "vrai" && q4b === "vrai" && q4c === "b") {
                    fb.className = "feedback success";
                    fb.innerHTML = `<div class="title">‚úÖ Excellent !</div>
                        <div class="explication">
                            ‚úÖ VRAI : acheter √† cr√©dit co√ªte plus cher (on paie des int√©r√™ts)<br>
                            ‚úÖ VRAI : le surendettement = impossibilit√© de rembourser<br>
                            ‚úÖ Seuil de surendettement : <strong>35%</strong> des revenus
                        </div>`;
                    results[4] = 'success'; updateProgress();
                    document.getElementById("btn-cont4").classList.add("show");
                } else {
                    fb.className = "feedback error";
                    let msg = `<div class="title">‚ùå Pas tout √† fait</div>`;
                    if (q4a !== "vrai") msg += `<div class="error-detail">Q1 : VRAI - on paie des int√©r√™ts en plus</div>`;
                    if (q4b !== "vrai") msg += `<div class="error-detail">Q2 : VRAI - surendettement = ne plus pouvoir rembourser</div>`;
                    if (q4c !== "b") msg += `<div class="error-detail">Q3 : Le seuil est 35%</div>`;
                    fb.innerHTML = msg;
                }
                fb.style.display = "block";
            }
        }

        function voirCorrection(n) {
            const fb = document.getElementById(`fb${n}`);
            if (n === 1) {
                document.querySelector('input[name="q1a"][value="b"]').checked = true;
                document.querySelector('input[name="q1b"][value="b"]').checked = true;
                colorAnswers("ex1", { q1a: "b", q1b: "b" });
                fb.className = "feedback helped";
                fb.innerHTML = `<div class="title">üí° R√©ponses</div><div class="explication">Somme + int√©r√™ts / 14 jours de r√©tractation</div>`;
                if (results[1] === null) results[1] = 'helped';
                document.getElementById("btn-cont1").classList.add("show");
            } else if (n === 2) {
                document.querySelector('input[name="q2a"][value="a"]').checked = true;
                document.querySelector('input[name="q2b"][value="a"]').checked = true;
                colorAnswers("ex2", { q2a: "a", q2b: "a" });
                fb.className = "feedback helped";
                fb.innerHTML = `<div class="title">üí° R√©ponses</div><div class="explication">Cr√©dit A moins cher et meilleur TAEG</div>`;
                if (results[2] === null) results[2] = 'helped';
                document.getElementById("btn-cont2").classList.add("show");
            } else if (n === 3) {
                document.getElementById("cout-credit").value = "1368,75";
                document.getElementById("difference").value = "81,40";
                document.getElementById("cout-credit").classList.add("correct");
                document.getElementById("difference").classList.add("correct");
                fb.className = "feedback helped";
                fb.innerHTML = `<div class="title">üí° R√©ponses</div><div class="explication">Co√ªt cr√©dit = 1 368,75 ‚Ç¨ / Surco√ªt = 81,40 ‚Ç¨</div>`;
                if (results[3] === null) results[3] = 'helped';
                document.getElementById("btn-cont3").classList.add("show");
            } else if (n === 4) {
                document.querySelector('input[name="q4a"][value="vrai"]').checked = true;
                document.querySelector('input[name="q4b"][value="vrai"]').checked = true;
                document.querySelector('input[name="q4c"][value="b"]').checked = true;
                colorAnswers("ex4", { q4a: "vrai", q4b: "vrai", q4c: "b" });
                fb.className = "feedback helped";
                fb.innerHTML = `<div class="title">üí° R√©ponses</div><div class="explication">VRAI / VRAI / 35%</div>`;
                if (results[4] === null) results[4] = 'helped';
                document.getElementById("btn-cont4").classList.add("show");
            }
            fb.style.display = "block";
            updateProgress();
        }

        function afficherFinal() {
            document.querySelectorAll(".exercice").forEach(e => e.classList.remove("active"));
            document.getElementById("final-result").classList.add("show");

            const successCount = Object.values(results).filter(v => v === 'success').length;
            const total = Object.values(results).filter(v => v !== null).length;
            document.getElementById("score-display").textContent = `${total}/4`;

            const msg = successCount === 4 ? "Excellent ! Tout r√©ussi seul(e) ! üåü" :
                        successCount >= 2 ? "Bien jou√© ! Continue √† t'entra√Æner." : "Tu as termin√© l'√©tape. R√©vise bien !";
            document.getElementById("encouragement").textContent = msg;

            const resultList = document.getElementById("result-list");
            const exNames = ["Principe du cr√©dit", "Comparaison cr√©dits", "Calcul co√ªt total", "Avantages/Inconv√©nients"];
            resultList.innerHTML = "";
            for (let i = 1; i <= 4; i++) {
                const status = results[i];
                const div = document.createElement("div");
                div.className = "result-item";
                div.innerHTML = `
                    <div class="result-icon ${status}">${status === 'success' ? '‚úì' : '?'}</div>
                    <span>${exNames[i-1]}</span>
                    <span style="margin-left: auto; font-size: 0.85rem; color: ${status === 'success' ? '#10b981' : '#8b5cf6'}">
                        ${status === 'success' ? 'R√©ussi seul' : 'Avec aide'}
                    </span>
                `;
                resultList.appendChild(div);
            }

            window.scrollTo({ top: 0, behavior: "smooth" });
        }

        function allerEtape4() { window.location.href = "PSE_CCF_04_Endettement.html"; }

        // Calculatrice
        const calcToggle = document.getElementById("calc-toggle");
        const calculator = document.getElementById("calculator");
        const calcClose = document.getElementById("calc-close");
        const calcDisplay = document.getElementById("calc-display");
        let calcVal = "0", calcOp = null, calcPrev = null, calcWait = false, calcError = false;

        function updateCalc() { calcDisplay.textContent = calcVal.replace(".", ","); calcDisplay.classList.toggle("error", calcError); }
        function calcClear() { calcVal = "0"; calcOp = null; calcPrev = null; calcWait = false; calcError = false; updateCalc(); }
        function calcNum(n) { if (calcError) calcClear(); calcVal = calcWait ? String(n) : (calcVal === "0" ? String(n) : calcVal + n); calcWait = false; updateCalc(); }
        function calcDec() { if (calcError) calcClear(); if (calcWait) { calcVal = "0."; calcWait = false; } else if (!calcVal.includes(".")) calcVal += "."; updateCalc(); }
        function calcDoOp(op) { if (calcError) return; const v = parseFloat(calcVal); if (calcPrev === null) calcPrev = v; else if (calcOp) { const r = calcCompute(calcPrev, v, calcOp); if (r === "Erreur") { calcError = true; calcVal = "Erreur"; updateCalc(); return; } calcVal = String(r); calcPrev = parseFloat(calcVal); } calcWait = true; calcOp = op; updateCalc(); }
        function calcCompute(a, b, o) { switch(o) { case "+": return a+b; case "-": return a-b; case "*": return a*b; case "/": return b === 0 ? "Erreur" : a/b; } return b; }
        function calcEq() { if (calcError) return; if (calcPrev !== null && calcOp) { const r = calcCompute(calcPrev, parseFloat(calcVal), calcOp); if (r === "Erreur") { calcError = true; calcVal = "Erreur"; updateCalc(); return; } calcVal = String(Math.round(r * 100) / 100); calcOp = null; calcPrev = null; calcWait = true; updateCalc(); } }

        calcToggle.onclick = () => calculator.classList.toggle("visible");
        calcClose.onclick = () => calculator.classList.remove("visible");
        document.querySelectorAll(".calc-btn").forEach(btn => {
            btn.onclick = () => {
                const a = btn.dataset.action, n = btn.dataset.num;
                if (n !== undefined) calcNum(n);
                else if (a === "clear") calcClear();
                else if (a === "backspace") { if (calcError) calcClear(); else { calcVal = calcVal.length > 1 ? calcVal.slice(0,-1) : "0"; updateCalc(); } }
                else if (a === "decimal") calcDec();
                else if (a === "add") calcDoOp("+");
                else if (a === "subtract") calcDoOp("-");
                else if (a === "multiply") calcDoOp("*");
                else if (a === "divide") calcDoOp("/");
                else if (a === "equals") calcEq();
            };
        });

        updateProgress();
    </script>
</body>
</html>
