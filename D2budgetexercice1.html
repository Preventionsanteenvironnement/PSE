<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√©rer son Budget - CAP</title>
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #1e40af;
            --success: #16a34a;
            --error: #dc2626;
            --background: #f1f5f9;
            --card-bg: #ffffff;
            --text: #1e293b;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--background);
            color: var(--text);
            line-height: 1.6;
            margin: 0;
            padding: 10px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding-bottom: 50px;
        }

        /* En-t√™te */
        header {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border-left: 6px solid var(--primary);
        }

        h1 {
            color: var(--primary);
            margin-top: 0;
            font-size: 1.5rem;
        }

        .objectifs {
            background-color: #e0f2fe;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 0.95rem;
        }

        /* Identification */
        .auth-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 25px;
            border: 2px solid #cbd5e1;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }

        input[type="text"], select, input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #94a3b8;
            border-radius: 8px;
            font-size: 1rem;
            box-sizing: border-box;
        }

        .help-text {
            font-size: 0.8rem;
            color: #64748b;
            margin-top: 4px;
        }

        /* Exercices */
        .exercise-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        h2 {
            color: var(--secondary);
            font-size: 1.25rem;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
            margin-top: 0;
        }

        .question {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px dashed #cbd5e1;
        }

        .question:last-child {
            border-bottom: none;
        }

        .question-title {
            font-weight: 600;
            margin-bottom: 10px;
            display: block;
        }

        /* Options */
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .option-label {
            display: flex;
            align-items: center;
            background: #f8fafc;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            cursor: pointer;
            transition: background 0.2s;
        }

        .option-label:hover {
            background: #f1f5f9;
        }

        input[type="radio"] {
            margin-right: 12px;
            transform: scale(1.2);
        }

        /* Bouton Action */
        .action-container {
            text-align: center;
            margin-top: 30px;
        }

        #btn-result {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 4px 6px rgba(37, 99, 235, 0.3);
            transition: transform 0.2s, background-color 0.2s;
        }

        #btn-result:hover {
            background-color: var(--secondary);
            transform: translateY(-2px);
        }

        #error-msg {
            color: var(--error);
            font-weight: bold;
            margin-bottom: 10px;
            display: none;
        }

        /* R√©sultat et Feedback */
        #result-zone {
            display: none;
            margin-top: 30px;
            background: #0f172a;
            color: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
        }

        .score-display {
            font-size: 2.5rem;
            font-weight: 800;
            color: #facc15;
            margin-bottom: 10px;
        }

        .feedback-detail {
            margin-top: 10px;
            padding: 12px;
            border-radius: 8px;
            background: #f0fdf4;
            border-left: 4px solid var(--success);
            color: #14532d;
            font-size: 0.95rem;
            text-align: left;
            display: none; /* Cach√© par d√©faut */
        }

        .feedback-error {
            background: #fef2f2;
            border-left-color: var(--error);
            color: #7f1d1d;
        }

        .correction-title {
            font-weight: bold;
            text-decoration: underline;
        }
        
        @media (min-width: 768px) {
            .options-container {
                flex-direction: row;
                flex-wrap: wrap;
            }
            .option-label {
                flex: 1;
                min-width: 45%;
            }
        }
    </style>
</head>
<body>

<div class="container">

    <header>
        <h1>G√©rer son Budget - CAP</h1>
        <div class="objectifs">
            <strong>Objectif de la s√©ance :</strong>
            <ul>
                <li>Identifier les diff√©rents types de revenus (travail vs social).</li>
                <li>Classer les d√©penses (fixes, courantes, occasionnelles).</li>
                <li>Calculer un solde et d√©terminer l'√©tat du budget (C4).</li>
            </ul>
        </div>
    </header>

    <section class="auth-card">
        <div class="form-group">
            <label for="eleve-id">Identifiant √©l√®ve *</label>
            <input type="text" id="eleve-id" placeholder="Ex. M03">
            <div class="help-text">Code remis par le prof</div>
        </div>
        <div class="form-group">
            <label for="eleve-classe">Classe *</label>
            <select id="eleve-classe">
                <option value="">-- Choisir la classe --</option>
                <option value="2BACPRO_GATL1">2BACPRO_GATL1</option>
                <option value="2BACPRO_GATL2">2BACPRO_GATL2</option>
                <option value="1BACPRO_AGO1">1BACPRO_AGO1</option>
                <option value="1BACPRO_AGO2">1BACPRO_AGO2</option>
                <option value="TBACPRO_AGO1">TBACPRO_AGO1</option>
                <option value="TBACPRO_AGO2">TBACPRO_AGO2</option>
                <option value="2_MELEC">2_MELEC</option>
                <option value="1_MELEC">1_MELEC</option>
                <option value="T_MELEC">T_MELEC</option>
                <option value="CAP_PSR1">CAP_PSR1</option>
                <option value="CAP_PSR2">CAP_PSR2</option>
                <option value="CAP_VAN1">CAP_VAN1</option>
                <option value="CAP_VAN2">CAP_VAN2</option>
                <option value="CAP_CAN1">CAP_CAN1</option>
                <option value="CAP_CAN2">CAP_CAN2</option>
                <option value="CAP_HORT1">CAP_HORT1</option>
                <option value="CAP_HORT2">CAP_HORT2</option>
                <option value="CAP_JP1">CAP_JP1</option>
                <option value="CAP_JP2">CAP_JP2</option>
                <option value="Autre">Autre</option>
            </select>
        </div>
    </section>

    <section class="exercise-card">
        <h2>Exercice 1 : Identifier la nature des revenus</h2>
        <p>Pour chaque situation, indique s'il s'agit d'un revenu li√© au travail ou d'un revenu social (aide de l'√âtat).</p>

        <div class="question" id="q1">
            <span class="question-title">1. Karim re√ßoit son salaire de boulanger.</span>
            <div class="options-container">
                <label class="option-label"><input type="radio" name="q1" value="travail"> Revenu li√© au travail</label>
                <label class="option-label"><input type="radio" name="q1" value="social"> Revenu social</label>
            </div>
            <div class="feedback-detail" id="fb-q1"></div>
        </div>

        <div class="question" id="q2">
            <span class="question-title">2. Julie re√ßoit des allocations familiales pour ses 3 enfants.</span>
            <div class="options-container">
                <label class="option-label"><input type="radio" name="q2" value="travail"> Revenu li√© au travail</label>
                <label class="option-label"><input type="radio" name="q2" value="social"> Revenu social</label>
            </div>
            <div class="feedback-detail" id="fb-q2"></div>
        </div>

        <div class="question" id="q3">
            <span class="question-title">3. Marc per√ßoit le RSA (Revenu de Solidarit√© Active).</span>
            <div class="options-container">
                <label class="option-label"><input type="radio" name="q3" value="travail"> Revenu li√© au travail</label>
                <label class="option-label"><input type="radio" name="q3" value="social"> Revenu social</label>
            </div>
            <div class="feedback-detail" id="fb-q3"></div>
        </div>
    </section>

    <section class="exercise-card">
        <h2>Exercice 2 : Classer les d√©penses</h2>
        <p>Classe chaque d√©pense dans la bonne cat√©gorie : Fixe (incompressible), Courante (compressible) ou Occasionnelle (exceptionnelle).</p>

        <div class="question" id="q4">
            <span class="question-title">4. Le loyer de l'appartement.</span>
            <select id="input-q4">
                <option value="">-- Choisir --</option>
                <option value="fixe">D√©pense Fixe</option>
                <option value="courante">D√©pense Courante</option>
                <option value="occasionnelle">D√©pense Occasionnelle</option>
            </select>
            <div class="feedback-detail" id="fb-q4"></div>
        </div>

        <div class="question" id="q5">
            <span class="question-title">5. Les courses alimentaires au supermarch√©.</span>
            <select id="input-q5">
                <option value="">-- Choisir --</option>
                <option value="fixe">D√©pense Fixe</option>
                <option value="courante">D√©pense Courante</option>
                <option value="occasionnelle">D√©pense Occasionnelle</option>
            </select>
            <div class="feedback-detail" id="fb-q5"></div>
        </div>

        <div class="question" id="q6">
            <span class="question-title">6. L'achat d'un cadeau d'anniversaire pour un ami.</span>
            <select id="input-q6">
                <option value="">-- Choisir --</option>
                <option value="fixe">D√©pense Fixe</option>
                <option value="courante">D√©pense Courante</option>
                <option value="occasionnelle">D√©pense Occasionnelle</option>
            </select>
            <div class="feedback-detail" id="fb-q6"></div>
        </div>

        <div class="question" id="q7">
            <span class="question-title">7. L'abonnement internet et t√©l√©phone.</span>
            <select id="input-q7">
                <option value="">-- Choisir --</option>
                <option value="fixe">D√©pense Fixe</option>
                <option value="courante">D√©pense Courante</option>
                <option value="occasionnelle">D√©pense Occasionnelle</option>
            </select>
            <div class="feedback-detail" id="fb-q7"></div>
        </div>
    </section>

    <section class="exercise-card">
        <h2>Exercice 3 : Calculer et analyser un budget</h2>
        <p>Voici le budget mensuel de L√©o :</p>
        <ul style="background: #f8fafc; padding: 15px; border-radius: 8px; list-style: none;">
            <li>üí∞ <strong>Total des Recettes :</strong> 1 450 ‚Ç¨</li>
            <li>üí∏ <strong>Total des D√©penses :</strong> 1 300 ‚Ç¨</li>
        </ul>

        <div class="question" id="q8">
            <span class="question-title">8. Calcule le solde du budget de L√©o.</span>
            <input type="number" id="input-q8" placeholder="Inscris le montant (chiffre uniquement)">
            <div class="help-text">Rappel : Solde = Recettes - D√©penses</div>
            <div class="feedback-detail" id="fb-q8"></div>
        </div>

        <div class="question" id="q9">
            <span class="question-title">9. Comment qualifie-t-on le budget de L√©o ?</span>
            <div class="options-container">
                <label class="option-label"><input type="radio" name="q9" value="excedentaire"> Budget Exc√©dentaire</label>
                <label class="option-label"><input type="radio" name="q9" value="equilibre"> Budget √âquilibr√©</label>
                <label class="option-label"><input type="radio" name="q9" value="deficitaire"> Budget D√©ficitaire</label>
            </div>
            <div class="feedback-detail" id="fb-q9"></div>
        </div>

        <div class="question" id="q10">
            <span class="question-title">10. Que signifie un budget "D√©ficitaire" ?</span>
            <div class="options-container">
                <label class="option-label"><input type="radio" name="q10" value="ok"> Les recettes sont sup√©rieures aux d√©penses.</label>
                <label class="option-label"><input type="radio" name="q10" value="ko"> Les d√©penses sont sup√©rieures aux recettes.</label>
            </div>
            <div class="feedback-detail" id="fb-q10"></div>
        </div>
    </section>

    <div class="action-container">
        <div id="error-msg">‚ö†Ô∏è Veuillez remplir l'identifiant et la classe.</div>
        <button id="btn-result">Voir mon r√©sultat</button>
    </div>

    <div id="result-zone">
        <div class="score-display" id="final-score">--/20</div>
        <div id="final-appreciation"></div>
        <p>Les corrections d√©taill√©es sont affich√©es sous chaque question ci-dessus.</p>
        <div style="margin-top: 20px; font-size: 0.9rem; color: #cbd5e1;">
            R√©sultat transmis au professeur. Tu peux refaire l'exercice pour t'am√©liorer.
        </div>
    </div>

</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // Configuration Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyAWdCMvOiAJln3eT9LIAQD3RWJUD0lQcLI",
        authDomain: "devoirs-pse.firebaseapp.com",
        projectId: "devoirs-pse",
        storageBucket: "devoirs-pse.firebasestorage.app",
        messagingSenderId: "614730413904",
        appId: "1:614730413904:web:a5dd478af5de30f6bede55"
    };

    // Initialisation Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const btnResult = document.getElementById('btn-result');
    const errorMsg = document.getElementById('error-msg');
    const resultZone = document.getElementById('result-zone');

    btnResult.addEventListener('click', async () => {
        const eleveId = document.getElementById('eleve-id').value.trim();
        const eleveClasse = document.getElementById('eleve-classe').value;

        // Validation ID/Classe
        if (!eleveId || !eleveClasse) {
            errorMsg.style.display = 'block';
            return;
        }
        errorMsg.style.display = 'none';

        // Calcul du score et Feedback
        let score = 0;
        const totalPoints = 20;

        // --- EXERCICE 1 ---
        // Q1
        const q1Val = document.querySelector('input[name="q1"]:checked')?.value;
        showFeedback('fb-q1', q1Val === 'travail', 
            "Bonne r√©ponse ! Le salaire est la contrepartie d'un travail.", 
            "Dommage. Le salaire est un revenu direct du travail, pas une aide sociale."
        );
        if(q1Val === 'travail') score += 2;

        // Q2
        const q2Val = document.querySelector('input[name="q2"]:checked')?.value;
        showFeedback('fb-q2', q2Val === 'social', 
            "Exact ! Les allocations familiales sont une aide de l'√âtat (revenu de transfert).", 
            "Non. Les allocations sont vers√©es par la CAF, c'est une aide sociale, pas un salaire."
        );
        if(q2Val === 'social') score += 2;

        // Q3
        const q3Val = document.querySelector('input[name="q3"]:checked')?.value;
        showFeedback('fb-q3', q3Val === 'social', 
            "Bravo. Le RSA est une aide sociale pour ceux qui ont peu de ressources.", 
            "Attention, le RSA est une prestation sociale vers√©e par l'√âtat, ce n'est pas un salaire."
        );
        if(q3Val === 'social') score += 2;

        // --- EXERCICE 2 ---
        // Q4
        const q4Val = document.getElementById('input-q4').value;
        showFeedback('fb-q4', q4Val === 'fixe', 
            "Correct ! Le loyer est une charge fixe et obligatoire chaque mois.", 
            "Erreur. Le loyer est une d√©pense fixe : on doit le payer tous les mois et le montant est stable."
        );
        if(q4Val === 'fixe') score += 2;

        // Q5
        const q5Val = document.getElementById('input-q5').value;
        showFeedback('fb-q5', q5Val === 'courante', 
            "Bien jou√©. Les courses sont n√©cessaires mais le montant varie (on peut acheter moins cher).", 
            "Non. Les courses sont une d√©pense courante : c'est indispensable, mais on peut faire varier le montant."
        );
        if(q5Val === 'courante') score += 2;

        // Q6
        const q6Val = document.getElementById('input-q6').value;
        showFeedback('fb-q6', q6Val === 'occasionnelle', 
            "C'est √ßa. Un cadeau est un plaisir, on peut le supprimer ou le remettre √† plus tard.", 
            "Pas tout √† fait. Un cadeau n'est pas vital. C'est une d√©pense occasionnelle (exceptionnelle)."
        );
        if(q6Val === 'occasionnelle') score += 2;

        // Q7
        const q7Val = document.getElementById('input-q7').value;
        showFeedback('fb-q7', q7Val === 'fixe', 
            "Oui, les abonnements sont des pr√©l√®vements fixes r√©guliers.", 
            "Non, un abonnement est une d√©pense fixe car le montant est pr√©vu √† l'avance et tombe tous les mois."
        );
        if(q7Val === 'fixe') score += 2;

        // --- EXERCICE 3 ---
        // Q8
        const q8Val = parseFloat(document.getElementById('input-q8').value);
        showFeedback('fb-q8', q8Val === 150, 
            "Excellent calcul ! 1450 - 1300 = 150 ‚Ç¨.", 
            "Erreur de calcul. Pour trouver le solde : Recettes (1450) - D√©penses (1300) = 150."
        );
        if(q8Val === 150) score += 2;

        // Q9
        const q9Val = document.querySelector('input[name="q9"]:checked')?.value;
        showFeedback('fb-q9', q9Val === 'excedentaire', 
            "Tout √† fait. Le solde est positif (+150‚Ç¨), il reste de l'argent.", 
            "Non. Comme il reste de l'argent (le solde est positif), le budget est exc√©dentaire."
        );
        if(q9Val === 'excedentaire') score += 2;

        // Q10
        const q10Val = document.querySelector('input[name="q10"]:checked')?.value;
        showFeedback('fb-q10', q10Val === 'ko', 
            "Bonne d√©finition. D√©ficitaire = D√©penses plus grandes que les Recettes (danger !).", 
            "Attention ! Un d√©ficit, c'est quand on d√©pense PLUS que ce qu'on gagne."
        );
        if(q10Val === 'ko') score += 2;


        // Affichage final
        resultZone.style.display = 'block';
        document.getElementById('final-score').innerText = score + " / " + totalPoints;
        
        let appreciation = "";
        if(score >= 16) appreciation = "Excellent travail ! Tu es pr√™t pour l'√©valuation. üèÜ";
        else if(score >= 10) appreciation = "Bon travail, mais relis bien les corrections pour les erreurs. üìà";
        else appreciation = "Attention, revois bien la diff√©rence entre les d√©penses fixes et courantes. Courage ! üí™";
        
        document.getElementById('final-appreciation').innerText = appreciation;
        
        // Scroll vers le r√©sultat
        resultZone.scrollIntoView({ behavior: 'smooth' });

        // Envoi Firebase
        try {
            await addDoc(collection(db, "exercices"), {
                meta: {
                    createdAt: new Date().toISOString(),
                    nom: eleveId,
                    prenom: eleveId, 
                    classe: eleveClasse,
                    type: "exercice",
                    support: "Gestion_Budget_CAP"
                },
                resultat: {
                    score: score + " / " + totalPoints + " points",
                    url: location.href,
                    titre: document.title
                }
            });
            console.log("R√©sultat envoy√© avec succ√®s");
        } catch (e) {
            console.error("Erreur d'envoi Firebase", e);
        }
    });

    function showFeedback(elementId, isCorrect, successMsg, errorMsg) {
        const el = document.getElementById(elementId);
        el.style.display = 'block';
        if (isCorrect) {
            el.className = 'feedback-detail'; // Reset class
            el.innerHTML = "‚úÖ " + successMsg;
        } else {
            el.className = 'feedback-detail feedback-error';
            el.innerHTML = "‚ùå " + errorMsg;
        }
    }
</script>

</body>
</html>
