<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Objectif Budget CCF - √âtape 5 : Auto-√©valuation finale</title>
    <style>
        :root { --primary: #6366f1; --success: #10b981; --warning: #f59e0b; --error: #ef4444; --helped: #8b5cf6; --text: #1e293b; --text-light: #64748b; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 15px; padding-bottom: 80px; line-height: 1.6; }
        .container { max-width: 800px; margin: 0 auto; }
        .parcours-header { background: rgba(255,255,255,0.95); border-radius: 20px; padding: 20px; margin-bottom: 15px; text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.2); }
        .parcours-badge { display: inline-block; background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 8px 20px; border-radius: 30px; font-weight: 700; font-size: 0.85rem; margin-bottom: 10px; }
        .parcours-title { font-size: 1.8rem; font-weight: 800; color: var(--text); margin-bottom: 5px; }
        .etapes-nav { display: flex; justify-content: center; gap: 8px; margin: 20px 0; }
        .etape-dot { width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 1rem; text-decoration: none; }
        .etape-dot.done { background: var(--success); color: white; }
        .etape-dot.active { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .main-card { background: white; border-radius: 20px; padding: 25px; margin-bottom: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
        .quiz-container { }
        .quiz-question { display: none; animation: fadeIn 0.4s; }
        .quiz-question.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; } }
        .q-header { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; }
        .q-num { background: linear-gradient(135deg, #667eea, #764ba2); color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 1.3rem; }
        .q-progress { flex: 1; }
        .q-progress-bar { background: #e2e8f0; height: 8px; border-radius: 8px; overflow: hidden; }
        .q-progress-fill { background: linear-gradient(90deg, var(--success), #34d399); height: 100%; transition: width 0.3s; }
        .q-text { font-size: 1.1rem; font-weight: 700; color: var(--text); margin-bottom: 20px; padding: 15px; background: #f8fafc; border-radius: 12px; border-left: 4px solid var(--primary); }
        .q-options { display: flex; flex-direction: column; gap: 10px; }
        .q-option { padding: 15px; background: white; border: 2px solid #e2e8f0; border-radius: 12px; cursor: pointer; font-weight: 600; transition: all 0.2s; display: flex; align-items: center; gap: 12px; }
        .q-option:hover { border-color: var(--primary); background: #f8fafc; }
        .q-option.selected { border-color: var(--primary); background: #eef2ff; }
        .q-option.correct { border-color: var(--success); background: #f0fdf4; }
        .q-option.wrong { border-color: var(--error); background: #fef2f2; }
        .q-option-letter { width: 35px; height: 35px; border-radius: 50%; background: #e2e8f0; display: flex; align-items: center; justify-content: center; font-weight: 800; }
        .q-input-group { display: flex; align-items: center; gap: 10px; margin: 15px 0; }
        .q-input { padding: 12px 15px; border: 2px solid #cbd5e1; border-radius: 10px; font-size: 1.1rem; font-weight: 700; width: 150px; }
        .q-input:focus { outline: none; border-color: var(--primary); }
        .q-input.correct { border-color: var(--success); background: #f0fdf4; }
        .q-input.wrong { border-color: var(--error); background: #fef2f2; }
        .q-feedback { padding: 15px; border-radius: 12px; margin-top: 15px; display: none; }
        .q-feedback.show { display: block; animation: fadeIn 0.3s; }
        .q-feedback.success { background: #f0fdf4; border: 2px solid var(--success); color: #166534; }
        .q-feedback.error { background: #fef2f2; border: 2px solid var(--error); color: #991b1b; }
        .btn { padding: 12px 24px; border: none; border-radius: 10px; font-weight: 700; font-size: 0.95rem; cursor: pointer; transition: all 0.2s; }
        .btn:hover { transform: translateY(-2px); }
        .btn-primary { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .btn-success { background: linear-gradient(135deg, #10b981, #059669); color: white; }
        .btn-group { display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
        .btn-continue { display: none; }
        .btn-continue.show { display: inline-flex; }
        .final-result { display: none; text-align: center; padding: 30px 20px; }
        .final-result.show { display: block; animation: fadeIn 0.5s; }
        .celebration { font-size: 4rem; margin-bottom: 15px; }
        .score-display { font-size: 4rem; font-weight: 900; background: linear-gradient(135deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 15px 0; }
        .note-display { font-size: 2rem; font-weight: 700; color: var(--text); margin: 10px 0; }
        .encouragement { font-size: 1.3rem; color: var(--text); margin-bottom: 20px; }
        .checklist { background: #f8fafc; border-radius: 12px; padding: 20px; margin: 20px 0; text-align: left; }
        .checklist h4 { margin-bottom: 15px; color: var(--text); }
        .checklist-item { display: flex; align-items: center; gap: 10px; padding: 10px 0; border-bottom: 1px solid #e2e8f0; }
        .checklist-item:last-child { border-bottom: none; }
        .checklist-icon { font-size: 1.2rem; }
        .btn-restart { background: #94a3b8; color: white; padding: 12px 24px; border-radius: 10px; font-weight: 700; border: none; cursor: pointer; margin: 10px 5px; }
        .calc-toggle { position: fixed; bottom: 20px; right: 20px; z-index: 1000; background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white; border: none; width: 55px; height: 55px; border-radius: 50%; font-size: 1.6rem; cursor: pointer; }
        .calculator { position: fixed; bottom: 85px; right: 20px; z-index: 999; background: #1e293b; border: 3px solid #8b5cf6; border-radius: 20px; padding: 15px; display: none; width: 260px; }
        .calculator.visible { display: block; }
        .calc-header { display: flex; justify-content: space-between; margin-bottom: 12px; }
        .calc-header h4 { color: #a78bfa; margin: 0; }
        .calc-close { background: transparent; border: none; color: #94a3b8; font-size: 1.4rem; cursor: pointer; }
        .calc-display { background: #0f172a; color: #4ade80; font-family: monospace; padding: 12px; border-radius: 10px; font-size: 1.5rem; text-align: right; margin-bottom: 12px; }
        .calc-display.error { color: #ef4444; }
        .calc-buttons { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; }
        .calc-btn { background: #334155; color: #e2e8f0; border: none; padding: 12px; border-radius: 8px; font-size: 1.1rem; font-weight: 700; cursor: pointer; }
        .calc-btn.op { background: #3b82f6; }
        .calc-btn.eq { background: #10b981; grid-column: span 2; }
        .calc-btn.clr { background: #ef4444; }
        .calc-btn.zero { grid-column: span 2; }
        @media (max-width: 500px) { .parcours-title { font-size: 1.4rem; } .main-card { padding: 18px; } .q-num { width: 40px; height: 40px; font-size: 1.1rem; } .calc-toggle { width: 50px; height: 50px; } .calculator { width: 240px; right: 10px; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="parcours-header">
            <div class="parcours-badge">üéØ PARCOURS CCF</div>
            <h1 class="parcours-title">Objectif Budget</h1>
            <div class="etapes-nav">
                <a href="PSE_CCF_01_Budget.html" class="etape-dot done">‚úì</a>
                <a href="PSE_CCF_02_Epargne.html" class="etape-dot done">‚úì</a>
                <a href="PSE_CCF_03_Credit.html" class="etape-dot done">‚úì</a>
                <a href="PSE_CCF_04_Endettement.html" class="etape-dot done">‚úì</a>
                <div class="etape-dot active">5</div>
            </div>
        </div>

        <div class="main-card">
            <h2 style="text-align: center; color: var(--primary); margin-bottom: 20px;">üèÜ √âtape 5/5 : Auto-√©valuation finale</h2>
            <p style="text-align: center; color: var(--text-light); margin-bottom: 25px;">10 questions pour v√©rifier tes connaissances</p>

            <div class="quiz-container" id="quiz-container"></div>

            <div class="final-result" id="final-result">
                <div class="celebration" id="celebration">üéâ</div>
                <h2 style="color: var(--text);">PARCOURS TERMIN√â !</h2>
                <div class="score-display" id="score-display">10/10</div>
                <div class="note-display" id="note-display">Note : 20/20</div>
                <p class="encouragement" id="encouragement">F√©licitations !</p>

                <div class="checklist" id="checklist">
                    <h4>üìã Bilan de tes comp√©tences :</h4>
                    <div id="checklist-items"></div>
                </div>

                <button class="btn-restart" onclick="location.reload()">üîÑ Refaire le quiz</button>
                <button class="btn-restart" onclick="location.href='PSE_CCF_01_Budget.html'">üìò Revoir les √©tapes</button>
            </div>
        </div>
    </div>

    <button class="calc-toggle" id="calc-toggle">üßÆ</button>
    <div class="calculator" id="calculator">
        <div class="calc-header"><h4>üßÆ Calculatrice</h4><button class="calc-close" id="calc-close">√ó</button></div>
        <div class="calc-display" id="calc-display">0</div>
        <div class="calc-buttons">
            <button class="calc-btn clr" data-action="clear">C</button>
            <button class="calc-btn op" data-action="backspace">‚Üê</button>
            <button class="calc-btn op" data-action="divide">√∑</button>
            <button class="calc-btn op" data-action="multiply">√ó</button>
            <button class="calc-btn" data-num="7">7</button>
            <button class="calc-btn" data-num="8">8</button>
            <button class="calc-btn" data-num="9">9</button>
            <button class="calc-btn op" data-action="subtract">‚àí</button>
            <button class="calc-btn" data-num="4">4</button>
            <button class="calc-btn" data-num="5">5</button>
            <button class="calc-btn" data-num="6">6</button>
            <button class="calc-btn op" data-action="add">+</button>
            <button class="calc-btn" data-num="1">1</button>
            <button class="calc-btn" data-num="2">2</button>
            <button class="calc-btn" data-num="3">3</button>
            <button class="calc-btn eq" data-action="equals">=</button>
            <button class="calc-btn zero" data-num="0">0</button>
            <button class="calc-btn" data-action="decimal">,</button>
        </div>
    </div>

    <script>
        const QUESTIONS = [
            { q: "Les recettes sont...", options: ["L'argent qui sort", "L'argent qui entre", "Les d√©penses fixes"], correct: 1, comp: "Budget" },
            { q: "Le loyer est une d√©pense...", options: ["Occasionnelle", "Courante", "Fixe"], correct: 2, comp: "Budget" },
            { q: "Les courses alimentaires sont une d√©pense...", options: ["Fixe", "Courante", "Occasionnelle"], correct: 1, comp: "Budget" },
            { q: "Un budget d√©ficitaire signifie...", options: ["Solde positif", "Solde nul", "Solde n√©gatif"], correct: 2, comp: "Budget" },
            { q: "Le Livret Jeune est r√©serv√© aux...", options: ["Moins de 18 ans", "12-25 ans", "Plus de 30 ans"], correct: 1, comp: "√âpargne" },
            { q: "Pour comparer des cr√©dits, on regarde...", options: ["La couleur du contrat", "Le TAEG et le co√ªt total", "Le nom de la banque"], correct: 1, comp: "Cr√©dit" },
            { q: "Le d√©lai de r√©tractation pour un cr√©dit est de...", options: ["7 jours", "14 jours", "30 jours"], correct: 1, comp: "Cr√©dit" },
            { q: "Le taux d'endettement max recommand√© est...", options: ["25%", "35%", "50%"], correct: 1, comp: "Endettement" },
            { q: "Solde = 1 487,50 ‚àí 1 213,75 = ?", type: "input", correct: 273.75, tolerance: 1, comp: "Calcul" },
            { q: "Taux = (562,40 √∑ 1 598,50) √ó 100 = ?", type: "input", correct: 35.18, tolerance: 1, comp: "Calcul" }
        ];

        let currentQ = 0, score = 0, answers = [];
        const container = document.getElementById("quiz-container");

        function renderQuestion(idx) {
            const q = QUESTIONS[idx];
            const isInput = q.type === "input";
            let html = `
                <div class="quiz-question active" id="q${idx}">
                    <div class="q-header">
                        <div class="q-num">${idx + 1}</div>
                        <div class="q-progress">
                            <div style="font-size: 0.85rem; margin-bottom: 5px;">Question ${idx + 1}/10</div>
                            <div class="q-progress-bar"><div class="q-progress-fill" style="width: ${(idx/10)*100}%"></div></div>
                        </div>
                    </div>
                    <div class="q-text">${q.q}</div>
            `;

            if (isInput) {
                html += `<div class="q-input-group"><input type="text" inputmode="decimal" class="q-input" id="input${idx}" placeholder="Ta r√©ponse" autocomplete="off"><span style="font-weight: 700;">${q.q.includes("%") ? " %" : " ‚Ç¨"}</span></div>`;
            } else {
                html += `<div class="q-options">`;
                q.options.forEach((opt, i) => {
                    html += `<div class="q-option" data-idx="${i}" onclick="selectOption(${idx}, ${i})"><span class="q-option-letter">${String.fromCharCode(65+i)}</span><span>${opt}</span></div>`;
                });
                html += `</div>`;
            }

            html += `
                <div class="q-feedback" id="fb${idx}"></div>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="verifyQuestion(${idx})">‚úÖ Valider</button>
                    <button class="btn btn-success btn-continue" id="cont${idx}" onclick="nextQuestion(${idx})">Continuer ‚Üí</button>
                </div>
            </div>`;
            container.innerHTML = html;
        }

        function selectOption(qIdx, optIdx) {
            document.querySelectorAll(`#q${qIdx} .q-option`).forEach((o, i) => {
                o.classList.toggle("selected", i === optIdx);
            });
        }

        function parseNombre(s) { if (!s) return null; let n = parseFloat(String(s).replace(/\s/g,"").replace(/[‚Ç¨%]/g,"").replace(",",".")); return isFinite(n) ? n : null; }

        function verifyQuestion(idx) {
            const q = QUESTIONS[idx];
            const fb = document.getElementById(`fb${idx}`);
            let isCorrect = false;

            if (q.type === "input") {
                const val = parseNombre(document.getElementById(`input${idx}`).value);
                const inp = document.getElementById(`input${idx}`);
                isCorrect = val !== null && Math.abs(val - q.correct) <= q.tolerance;
                inp.classList.add(isCorrect ? "correct" : "wrong");
                fb.innerHTML = isCorrect ? `<strong>‚úÖ Correct !</strong> La r√©ponse est ${q.correct.toString().replace(".",",")}` : `<strong>‚ùå</strong> La bonne r√©ponse √©tait ${q.correct.toString().replace(".",",")}`;
            } else {
                const selected = document.querySelector(`#q${idx} .q-option.selected`);
                if (!selected) { fb.innerHTML = "‚ö†Ô∏è Choisis une r√©ponse"; fb.className = "q-feedback error show"; return; }
                const selIdx = parseInt(selected.dataset.idx);
                isCorrect = selIdx === q.correct;
                document.querySelectorAll(`#q${idx} .q-option`).forEach((o, i) => {
                    if (i === q.correct) o.classList.add("correct");
                    else if (i === selIdx) o.classList.add("wrong");
                });
                fb.innerHTML = isCorrect ? `<strong>‚úÖ Correct !</strong>` : `<strong>‚ùå</strong> La bonne r√©ponse √©tait : ${q.options[q.correct]}`;
            }

            fb.className = `q-feedback ${isCorrect ? "success" : "error"} show`;
            if (isCorrect) score++;
            answers[idx] = { correct: isCorrect, comp: q.comp };
            document.getElementById(`cont${idx}`).classList.add("show");
        }

        function nextQuestion(idx) {
            if (idx < QUESTIONS.length - 1) {
                currentQ = idx + 1;
                renderQuestion(currentQ);
                scrollTo({top: 0, behavior: "smooth"});
            } else {
                showFinalResult();
            }
        }

        function showFinalResult() {
            container.style.display = "none";
            document.getElementById("final-result").classList.add("show");
            document.getElementById("score-display").textContent = `${score}/10`;
            document.getElementById("note-display").textContent = `Note : ${score * 2}/20`;

            let emoji = "üéâ", msg = "Excellent travail !";
            if (score < 5) { emoji = "üí™"; msg = "Continue √† r√©viser, tu vas y arriver !"; }
            else if (score < 8) { emoji = "üëç"; msg = "Bien ! Encore un peu d'entra√Ænement."; }
            else if (score < 10) { emoji = "üåü"; msg = "Tr√®s bien ! Tu es presque pr√™t(e) !"; }
            document.getElementById("celebration").textContent = emoji;
            document.getElementById("encouragement").textContent = msg;

            // Checklist
            const comps = { "Budget": [], "√âpargne": [], "Cr√©dit": [], "Endettement": [], "Calcul": [] };
            answers.forEach(a => { if (a) comps[a.comp].push(a.correct); });
            let checkHtml = "";
            for (const [comp, res] of Object.entries(comps)) {
                const ok = res.length > 0 && res.every(r => r);
                checkHtml += `<div class="checklist-item"><span class="checklist-icon">${ok ? "‚úÖ" : "‚ùå"}</span><span>${comp} : ${ok ? "Ma√Ætris√©" : "√Ä revoir"}</span></div>`;
            }
            document.getElementById("checklist-items").innerHTML = checkHtml;
            scrollTo({top: 0, behavior: "smooth"});
        }

        // Calculatrice
        const calcToggle = document.getElementById("calc-toggle"), calculator = document.getElementById("calculator"), calcClose = document.getElementById("calc-close"), calcDisplay = document.getElementById("calc-display");
        let calcVal = "0", calcOp = null, calcPrev = null, calcWait = false, calcError = false;
        function updateCalc() { calcDisplay.textContent = calcVal.replace(".",","); calcDisplay.classList.toggle("error", calcError); }
        function calcClear() { calcVal = "0"; calcOp = null; calcPrev = null; calcWait = false; calcError = false; updateCalc(); }
        function calcNum(n) { if (calcError) calcClear(); calcVal = calcWait ? String(n) : (calcVal==="0" ? String(n) : calcVal+n); calcWait = false; updateCalc(); }
        function calcDec() { if (calcError) calcClear(); if (calcWait) { calcVal = "0."; calcWait = false; } else if (!calcVal.includes(".")) calcVal += "."; updateCalc(); }
        function calcDoOp(op) { if (calcError) return; const v = parseFloat(calcVal); if (calcPrev === null) calcPrev = v; else if (calcOp) { const r = calcCompute(calcPrev, v, calcOp); if (r === "Erreur") { calcError = true; calcVal = "Erreur"; updateCalc(); return; } calcVal = String(r); calcPrev = parseFloat(calcVal); } calcWait = true; calcOp = op; updateCalc(); }
        function calcCompute(a, b, o) { if (o === "+") return a+b; if (o === "-") return a-b; if (o === "*") return a*b; if (o === "/") return b === 0 ? "Erreur" : a/b; return b; }
        function calcEq() { if (calcError) return; if (calcPrev !== null && calcOp) { const r = calcCompute(calcPrev, parseFloat(calcVal), calcOp); if (r === "Erreur") { calcError = true; calcVal = "Erreur"; updateCalc(); return; } calcVal = String(Math.round(r*100)/100); calcOp = null; calcPrev = null; calcWait = true; updateCalc(); } }
        calcToggle.onclick = () => calculator.classList.toggle("visible");
        calcClose.onclick = () => calculator.classList.remove("visible");
        document.querySelectorAll(".calc-btn").forEach(btn => {
            btn.onclick = () => {
                const a = btn.dataset.action, n = btn.dataset.num;
                if (n !== undefined) calcNum(n);
                else if (a === "clear") calcClear();
                else if (a === "backspace") { if (calcError) calcClear(); else { calcVal = calcVal.length > 1 ? calcVal.slice(0,-1) : "0"; updateCalc(); } }
                else if (a === "decimal") calcDec();
                else if (a === "add") calcDoOp("+");
                else if (a === "subtract") calcDoOp("-");
                else if (a === "multiply") calcDoOp("*");
                else if (a === "divide") calcDoOp("/");
                else if (a === "equals") calcEq();
            };
        });

        // Init
        renderQuestion(0);
    </script>
</body>
</html>
