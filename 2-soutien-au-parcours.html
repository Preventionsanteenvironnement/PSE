<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>S√©ance 2 : Mon Stage et Mes Atouts ‚Äì Seconde Bac Pro AGOrA</title>
  <style>
    /* * Styles CSS r√©utilis√©s de la s√©ance 1 pour maintenir la coh√©rence visuelle. 
    * Quelques ajustements mineurs pour les nouvelles sections.
    */
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f4f6fb;
      color: #222;
    }
    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 24px 16px 40px;
    }
    header {
      background: linear-gradient(135deg, #a32454, #d93c83); /* Nouvelle couleur pour S√©ance 2 */
      color: #fff;
      padding: 20px 24px;
      border-radius: 14px;
      margin-bottom: 20px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.15);
    }
    header h1 {
      margin: 0 0 6px;
      font-size: 1.5rem;
    }
    header h2 {
      margin: 0;
      font-weight: 400;
      font-size: 1.05rem;
      opacity: 0.95;
    }
    .badge {
      display: inline-block;
      margin-top: 10px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.15);
      font-size: 0.8rem;
    }

    .info-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      background: #ffffff;
      border-radius: 12px;
      padding: 12px 16px;
      margin-bottom: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
    .info-field {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.9rem;
    }
    .info-field label {
      font-weight: 600;
    }
    .info-field input[type="text"],
    .info-field input[type="date"] {
      padding: 4px 6px;
      border-radius: 6px;
      border: 1px solid #c3c8d8;
      font-size: 0.9rem;
      min-width: 120px;
    }
    .scale-help {
      background: #ffffff;
      border-radius: 12px;
      padding: 8px 14px;
      margin-bottom: 18px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.04);
      font-size: 0.8rem;
      color: #555;
    }
    .scale-help strong {
      color: #a32454;
    }

    .section {
      background: #ffffff;
      border-radius: 16px;
      padding: 18px 20px 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      border: 1px solid #f0e0e4;
    }
    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 10px;
    }
    .section-title {
      font-size: 1.1rem;
      font-weight: 650;
      color: #a32454; /* Couleur de la section */
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .section-title span.icon {
      font-size: 1.4rem;
    }
    .section-subtitle {
      font-size: 0.85rem;
      color: #555;
      margin-bottom: 8px;
    }
    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 12px;
    }
    .chip {
      padding: 4px 10px;
      border-radius: 999px;
      background: #ffeef2; /* Couleur des chips */
      font-size: 0.78rem;
      color: #a52c4a;
      border: 1px solid #ffd4dd;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      cursor: pointer;
      transition: background 0.1s;
    }
    .chip span {
      font-size: 1rem;
    }
    .chip.active {
      background: #ffc9d4;
    }

    .field-block {
      margin-bottom: 18px;
    }
    .field-block label {
      display: block;
      font-weight: 600;
      font-size: 0.9rem;
      margin-bottom: 4px;
    }
    .field-block small {
      display: block;
      font-size: 0.78rem;
      color: #666;
      margin-bottom: 3px;
    }
    textarea {
      width: 100%;
      min-height: 60px;
      resize: none;
      padding: 8px 9px;
      border-radius: 8px;
      border: 1px solid #c7cedf;
      font-size: 0.9rem;
      line-height: 1.35;
      transition: border-color 0.15s, box-shadow 0.15s;
      background: #fafbff;
      overflow-y: hidden;
    }
    textarea:focus {
      outline: none;
      border-color: #d93c83;
      box-shadow: 0 0 0 2px rgba(217,60,131,0.18);
      background: #ffffff;
    }
    input[type="range"] {
      width: 180px;
    }
    .range-label {
      font-size: 0.85rem;
      margin-left: 8px;
      font-weight: 600;
      color: #a32454;
    }

    .aide-toggle {
      border: none;
      background: #fff0f3;
      color: #a32454;
      font-size: 0.78rem;
      padding: 3px 8px;
      border-radius: 999px;
      cursor: pointer;
    }
    .aide-toggle:hover {
      background: #f2e0e6;
    }
    .aide-box {
      margin-top: 6px;
      padding: 6px 8px;
      background: #fff8f9;
      border-radius: 10px;
      border: 1px dashed #dfc7cf;
      font-size: 0.78rem;
      color: #555;
      display: none;
    }

    .checklist-item {
      display: flex;
      align-items: center;
      margin-bottom: 6px;
      font-size: 0.9rem;
    }
    .checklist-item input {
      margin-right: 8px;
    }

    /* Styles DND pour CPS */
    .dnd-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 6px;
      font-size: 0.82rem;
    }
    .dnd-pool,
    .dnd-dropzone {
      flex: 1 1 280px;
      min-height: 100px;
      border-radius: 10px;
      border: 1px dashed #e5c6d0;
      padding: 6px 8px;
      background: #fff9fa;
    }
    .dnd-title {
      font-weight: 600;
      margin-bottom: 4px;
      font-size: 0.8rem;
      color: #a32454;
    }
    .dnd-item {
      background: #f2e8ff; /* Couleur diff√©rente pour les items CPS */
      border-radius: 999px;
      padding: 3px 9px;
      display: inline-block;
      margin: 2px 3px;
      cursor: move;
      user-select: none;
      border: 1px solid #dbc7e5;
    }
    .dnd-dropzone.over {
      background: #ffe0e7;
      border-style: solid;
    }


    .actions-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 24px;
    }
    .btn {
      border-radius: 999px;
      padding: 8px 14px;
      font-size: 0.88rem;
      font-weight: 600;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      transition: transform 0.1s, box-shadow 0.1s, background 0.2s;
    }
    .btn:active {
      transform: translateY(1px);
      box-shadow: 0 1px 3px rgba(0,0,0,0.12);
    }
    .btn-save {
      background: #1e88e5; /* Couleur de sauvegarde */
      color: #fff;
    }
    .btn-save:hover {
      background: #1565c0;
    }
    .btn-print {
      background: #7cb342; /* Couleur d'impression PFMP */
      color: #fff;
    }
    .btn-print:hover {
      background: #5b8a2e;
    }

    footer {
      text-align: center;
      margin-top: 24px;
      font-size: 0.78rem;
      color: #666;
    }

    .page-break {
      margin-top: 20px;
      border-top: 1px dashed #d0d5e5;
      padding-top: 16px;
    }

    @media print {
      body {
        background: #ffffff;
      }
      .actions-bar, .aide-toggle, .chip-row {
        display: none !important;
      }
      header {
        box-shadow: none;
      }
      .section {
        box-shadow: none;
        border-radius: 0;
      }
      .page-break {
        page-break-before: always;
        border: none;
        padding-top: 0;
      }
      .dnd-dropzone, .dnd-pool {
        border: 1px solid #ccc; /* Rendre le contenu des zones visible √† l'impression */
        min-height: 50px;
      }
    }
  </style>
</head>
<body>
  <div class="container">

    <header>
      <h1>S√©ance 2 : Mon Stage et Mes Atouts</h1>
      <h2>Pr√©paration de la PFMP et Exploration des Comp√©tences</h2>
      <div class="badge">Classe : Seconde Bac Pro AGOrA</div>
    </header>

    <div class="info-bar">
      <div class="info-field">
        <label for="prenomEleve">Surnom :</label>
        <input type="text" id="prenomEleve" placeholder="Ton surnom" />
      </div>
      <div class="info-field">
        <label for="dateTravail">Date :</label>
        <input type="date" id="dateTravail" />
      </div>
      <div class="info-field">
        <span>Motivation pour le stage :</span>
        <input type="range" id="motivationStage" min="0" max="10" value="7" />
        <span class="range-label" id="valeurMotivation">7 / 10</span>
      </div>
    </div>

    <div class="scale-help">
      <strong>Motivation pour le stage :</strong> 0 = Je n‚Äôai aucune envie de faire un stage ¬∑ 10 = Je suis tr√®s motiv√©(e) et pr√™t(e).
    </div>

    <section class="section" id="partiePFMP">
      <div class="section-header">
        <div class="section-title">
          <span class="icon">üè≠</span>
          Partie 1 ‚Äì Mon Stage Professionnel (PFMP)
        </div>
      </div>
      <div class="section-subtitle">
        Pr√©paration concr√®te : logistique, objectifs et exigences du monde du travail.
      </div>

      <div class="field-block">
        <label for="rechercheEntreprise">1. Ma recherche d'entreprise</label>
        <small>O√π en es-tu dans la recherche de ton lieu de stage ?</small>
        <div class="chip-row">
          <div class="chip" data-input="statutRecherche" data-value="J'ai le nom de l'entreprise."><span>üè¢</span>J'ai le nom</div>
          <div class="chip" data-input="statutRecherche" data-value="J'ai envoy√© des e-mails/courriers."><span>üìß</span>J'ai fait les d√©marches</div>
          <div class="chip" data-input="statutRecherche" data-value="Mon CV et ma lettre sont pr√™ts."><span>üìÑ</span>CV et Lettre OK</div>
          <div class="chip" data-input="statutRecherche" data-value="J'ai un rendez-vous (entretien)."><span>üóìÔ∏è</span>J'ai rendez-vous</div>
          <div class="chip" data-input="statutRecherche" data-value="Je n'ai rien encore trouv√©."><span>‚ùå</span>Je n'ai rien encore</div>
        </div>
        <input type="hidden" id="statutRecherche" value="" />
        <textarea id="rechercheEntreprise" placeholder="Dans quel type de structure souhaites-tu aller (Mairie, petite PME, grande entreprise, association...) et pourquoi ?"></textarea>
      </div>

      <div class="field-block">
        <label for="attentesPFMP">2. Mes attentes concr√®tes du stage</label>
        <small>Quelles t√¢ches aimerais-tu vraiment apprendre ou pratiquer ?</small>
        <textarea id="attentesPFMP" placeholder="Exemples : utiliser un logiciel sp√©cifique, faire des t√¢ches d'accueil client, classer des documents, faire des devis..."></textarea>
        <div class="chip-row">
          <div class="chip" onclick="addSuggestion('attentesPFMP','Apprendre √† r√©diger des documents professionnels.')"><span>‚úçÔ∏è</span>R√©daction pro</div>
          <div class="chip" onclick="addSuggestion('attentesPFMP','Utiliser un logiciel de gestion.')"><span>üíª</span>Logiciel gestion</div>
          <div class="chip" onclick="addSuggestion('attentesPFMP','G√©rer l‚Äôaccueil physique ou t√©l√©phonique.')"><span>üìû</span>Accueil/Standard</div>
        </div>
      </div>

      <div class="field-block">
        <label>3. Les contraintes du monde du travail</label>
        <small>√âvalue √† quel point ces contraintes te pr√©occupent.</small>
        <div class="info-field" style="margin-bottom: 8px;">
          <span>Avoir peur d'arriver en retard :</span>
          <input type="range" id="peurRetard" min="0" max="10" value="5" />
          <span class="range-label" id="valeurRetard">5 / 10</span>
        </div>
        <div class="info-field" style="margin-bottom: 8px;">
          <span>Avoir peur de ne pas comprendre les consignes :</span>
          <input type="range" id="peurConsignes" min="0" max="10" value="5" />
          <span class="range-label" id="valeurConsignes">5 / 10</span>
        </div>
        <div class="info-field">
          <span>Avoir peur de parler aux coll√®gues ou aux clients :</span>
          <input type="range" id="peurCommunication" min="0" max="10" value="5" />
          <span class="range-label" id="valeurCommunication">5 / 10</span>
        </div>
      </div>

      <div class="field-block">
        <label for="questionsTuteur">4. Mes questions pratiques pour l'entreprise</label>
        <small>Liste les questions que tu devras poser √† ton tuteur ou lors de l'entretien (hors t√¢ches).</small>
        <textarea id="questionsTuteur" placeholder="Exemples : les horaires exacts, le code vestimentaire, le lieu de d√©jeuner, qui contacter en cas de probl√®me..."></textarea>
        <button class="aide-toggle" type="button" onclick="toggleAide('aideQuestions')">
          üí° Aide : Que demander au tuteur ?
        </button>
        <div class="aide-box" id="aideQuestions">
          Tu peux demander : "Qui dois-je contacter le premier jour ?", "Y a-t-il un code vestimentaire ?", "O√π puis-je laisser mes affaires ?", "Y a-t-il des r√®gles importantes √† conna√Ætre sur le lieu de travail ?".
        </div>
      </div>

      <div class="field-block">
        <label>5. Mes documents et mon mat√©riel</label>
        <small>Coche ce qui est d√©j√† pr√™t pour le stage.</small>
        <div class="checklist-item"><input type="checkbox" id="checkCV" /><label for="checkCV">Mon CV et ma lettre sont finaux.</label></div>
        <div class="checklist-item"><input type="checkbox" id="checkConvention" /><label for="checkConvention">La convention de stage est sign√©e par l'√©cole et l'entreprise.</label></div>
        <div class="checklist-item"><input type="checkbox" id="checkItineraire" /><label for="checkItineraire">Je connais l'itin√©raire et le temps de trajet.</label></div>
        <div class="checklist-item"><input type="checkbox" id="checkMatos" /><label for="checkMatos">J'ai de quoi noter (carnet, stylos) et une tenue correcte.</label></div>
      </div>
    </section>

    <div class="page-break"></div>

    <section class="section" id="partieCPS">
      <div class="section-header">
        <div class="section-title">
          <span class="icon">üß†</span>
          Partie 2 ‚Äì Mes Comp√©tences Psychosociales (CPS)
        </div>
      </div>
      <div class="section-subtitle">
        Mon savoir-√™tre : comment je g√®re mes √©motions et interagis avec les autres.
      </div>

      <div class="field-block">
        <label>6. L'Auto-√©valuation des Savoir-√ätre</label>
        <small>√âvalue-toi de 0 (Tr√®s difficile) √† 10 (Tr√®s facile) sur ces qualit√©s professionnelles.</small>
        <div class="info-field" style="margin-bottom: 8px;">
          <span>J'arrive √† prendre des initiatives :</span>
          <input type="range" id="autoInitiative" min="0" max="10" value="5" />
          <span class="range-label" id="valeurInitiative">5 / 10</span>
        </div>
        <div class="info-field" style="margin-bottom: 8px;">
          <span>Je g√®re bien mon stress avant un √©v√©nement important :</span>
          <input type="range" id="autoStress" min="0" max="10" value="5" />
          <span class="range-label" id="valeurStress">5 / 10</span>
        </div>
        <div class="info-field" style="margin-bottom: 8px;">
          <span>Je m'adapte facilement √† un nouvel environnement ou √† une nouvelle t√¢che :</span>
          <input type="range" id="autoAdaptation" min="0" max="10" value="5" />
          <span class="range-label" id="valeurAdaptation">5 / 10</span>
        </div>
        <div class="info-field">
          <span>Je travaille efficacement en √©quipe (sans me laisser distraire) :</span>
          <input type="range" id="autoEquipe" min="0" max="10" value="5" />
          <span class="range-label" id="valeurEquipe">5 / 10</span>
        </div>
      </div>
      
      <div class="field-block">
        <label>7. Ma gestion du temps et de l'effort</label>
        <small>D√©place les √©tiquettes dans la colonne qui te correspond le mieux en ce moment.</small>
        <div class="dnd-container">
          <div class="dnd-pool" id="dndPoolOrganisation">
            <div class="dnd-title">√Ä placer</div>
            <div class="dnd-item" draggable="true">Je me fixe des objectifs clairs.</div>
            <div class="dnd-item" draggable="true">J'ai du mal √† finir ce que j'ai commenc√©.</div>
            <div class="dnd-item" draggable="true">Je me laisse souvent distraire (par mon t√©l√©phone, le bruit).</div>
            <div class="dnd-item" draggable="true">Je v√©rifie toujours mon travail avant de le rendre.</div>
            <div class="dnd-item" draggable="true">Je reporte souvent les t√¢ches importantes au dernier moment.</div>
          </div>
          <div class="dnd-dropzone" data-zone="habitudePositive">
            <div class="dnd-title">Mes habitudes positives</div>
          </div>
          <div class="dnd-dropzone" data-zone="pointAmeliorer">
            <div class="dnd-title">Mes points √† am√©liorer</div>
          </div>
        </div>
      </div>

      <div class="field-block">
        <label for="scenarioCommunication">8. La Communication en Situation Professionnelle</label>
        <small>Que ferais-tu si tu faisais une erreur en stage ? Choisis la r√©ponse qui te ressemble le plus.</small>
        <textarea id="scenarioCommunication" placeholder="R√©ponds ici en fonction des propositions ci-dessous."></textarea>
        <div class="chip-row">
          <div class="chip" onclick="addSuggestion('scenarioCommunication','Je n‚Äôose pas le dire et j‚Äôessaie de la corriger seul(e).')"><span>üôà</span> Corriger seul(e)</div>
          <div class="chip" onclick="addSuggestion('scenarioCommunication','J‚Äôattends la fin de la journ√©e pour en parler √† mon tuteur.')"><span>‚è±Ô∏è</span> Attendre la fin</div>
          <div class="chip" onclick="addSuggestion('scenarioCommunication','J‚Äôen parle imm√©diatement √† mon tuteur pour qu‚Äôil m‚Äôaide √† la r√©parer.')"><span>üó£Ô∏è</span> En parler tout de suite</div>
        </div>
      </div>

      <div class="field-block">
        <label for="objectifCPS">9. Mon objectif CPS pour le stage</label>
        <small>Choisis une seule comp√©tence psychosociale (ex : gestion du stress, initiative, organisation) que tu veux VRAIMENT travailler et explique comment.</small>
        <textarea id="objectifCPS" placeholder="J'aimerais am√©liorer ma..., pour cela, je vais essayer de..."></textarea>
      </div>
    </section>

    <div class="actions-bar">
      <button class="btn btn-print" type="button" onclick="imprimerFeuilleRoute()">
        üñ®Ô∏è Imprimer ma feuille de route PFMP
      </button>
      <button class="btn btn-save" type="button" onclick="enregistrerMonTravail()">
        üíæ Enregistrer mon travail
      </button>
    </div>

    <footer>
      S√©ance 2 : Pr√©paration PFMP & Comp√©tences ‚Äì Seconde Bac Pro AGOrA
    </footer>
  </div>

  <script>
    // --- Gestion des Curseurs (Range Sliders) ---
    function updateRangeLabel(sliderId, labelId) {
      const slider = document.getElementById(sliderId);
      const label = document.getElementById(labelId);
      if (slider && label) {
        slider.addEventListener('input', function () {
          label.textContent = this.value + ' / 10';
        });
      }
    }

    updateRangeLabel('motivationStage', 'valeurMotivation');
    updateRangeLabel('peurRetard', 'valeurRetard');
    updateRangeLabel('peurConsignes', 'valeurConsignes');
    updateRangeLabel('peurCommunication', 'valeurCommunication');
    updateRangeLabel('autoInitiative', 'valeurInitiative');
    updateRangeLabel('autoStress', 'valeurStress');
    updateRangeLabel('autoAdaptation', 'valeurAdaptation');
    updateRangeLabel('autoEquipe', 'valeurEquipe');

    // --- Auto-Redimensionnement des Textareas ---
    function autoResizeTextarea(el) {
      el.style.height = 'auto';
      el.style.height = (el.scrollHeight + 2) + 'px';
    }

    document.querySelectorAll('textarea').forEach(function (ta) {
      autoResizeTextarea(ta);
      ta.addEventListener('input', function () {
        autoResizeTextarea(ta);
      });
    });

    // --- Aide Contextuelle ---
    function toggleAide(id) {
      const box = document.getElementById(id);
      if (!box) return;
      box.style.display = box.style.display === 'block' ? 'none' : 'block';
    }

    // --- Ajout de Suggestion (Chips) ---
    function addSuggestion(textareaId, text) {
      const ta = document.getElementById(textareaId);
      if (!ta) return;
      let currentValue = ta.value.trim();
      
      // Ajoute une ligne si le champ n'est pas vide ou ne se termine pas par un saut de ligne
      if (currentValue && !currentValue.endsWith('\n')) {
          ta.value += '\n';
      }
      
      // Si la suggestion est d√©j√† l√†, on ne la met pas
      if (!ta.value.includes(text)) {
          ta.value += '‚Ä¢ ' + text.trim() + '\n';
      }
      
      autoResizeTextarea(ta);
      ta.focus();
    }

    // --- Gestion des Chips de Statut de Recherche ---
    document.querySelectorAll('.chip[data-input="statutRecherche"]').forEach(chip => {
      chip.addEventListener('click', function() {
        const inputId = this.getAttribute('data-input');
        const value = this.getAttribute('data-value');
        const inputHidden = document.getElementById(inputId);
        
        // Toggle l'√©tat du chip
        this.classList.toggle('active');

        // Mise √† jour de la valeur cach√©e (s√©par√©e par des virgules)
        let currentValues = inputHidden.value.split(',').map(v => v.trim()).filter(v => v);
        const index = currentValues.indexOf(value);

        if (index > -1) {
          // Supprimer
          currentValues.splice(index, 1);
        } else {
          // Ajouter
          currentValues.push(value);
        }

        inputHidden.value = currentValues.join(', ');
      });
    });


    // --- Fonctionnalit√© Glisser-D√©poser (Drag and Drop) ---
    let draggedItem = null;

    function initDragAndDrop() {
      document.querySelectorAll('.dnd-item').forEach(function (item) {
        item.addEventListener('dragstart', function (e) {
          draggedItem = item;
          e.dataTransfer.effectAllowed = 'move';
          item.style.opacity = '0.4';
        });
        item.addEventListener('dragend', function () {
          item.style.opacity = '1';
          draggedItem = null;
        });
      });

      document.querySelectorAll('.dnd-dropzone, .dnd-pool').forEach(function (zone) {
        zone.addEventListener('dragover', function (e) {
          e.preventDefault();
          const isDropzone = zone.classList.contains('dnd-dropzone') || zone.classList.contains('dnd-pool');
          if (isDropzone) {
            zone.classList.add('over');
          }
        });
        zone.addEventListener('dragleave', function () {
          zone.classList.remove('over');
        });
        zone.addEventListener('drop', function (e) {
          e.preventDefault();
          if (draggedItem) {
             // Assurer que le dnd-title n'est pas remplac√©
             const dropZone = zone.closest('.dnd-dropzone') || zone.closest('.dnd-pool');
             
             // Si l'√©l√©ment est drop√© sur le titre, le mettre apr√®s le titre
             if (e.target.classList.contains('dnd-title')) {
                dropZone.insertBefore(draggedItem, e.target.nextSibling);
             } else {
                dropZone.appendChild(draggedItem);
             }
          }
          zone.classList.remove('over');
        });
      });
    }

    document.addEventListener('DOMContentLoaded', initDragAndDrop);

    // --- Fonction d'√âchappement HTML pour l'Impression ---
    function escapeHtml(text) {
      return (text || '')
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/\n/g, "<br>");
    }

    // --- üíæ Fonction d'Enregistrement (S√âCURIS√âE) ---
    function enregistrerMonTravail() {
      const prenom = (document.getElementById('prenomEleve')?.value || '').trim();
      if (!prenom) {
        alert("Merci de renseigner ton pr√©nom avant d‚Äôenregistrer ton travail. C'est n√©cessaire pour le nom du fichier !");
        return;
      }

      const NOM_BASE = 'seance2_pfmp_cps_AGOrA';
      
      // 1. Mise √† jour des valeurs des inputs et textareas
      document.querySelectorAll('input[type="text"], input[type="date"], input[type="range"], input[type="hidden"]').forEach(function (input) {
        input.setAttribute('value', input.value);
      });
      document.querySelectorAll('input[type="checkbox"]').forEach(function (input) {
        if (input.checked) {
          input.setAttribute('checked', 'checked');
        } else {
          input.removeAttribute('checked');
        }
      });
      document.querySelectorAll('textarea').forEach(function (ta) {
        ta.textContent = ta.value; // Important pour conserver le contenu dans le fichier HTML
      });
      document.querySelectorAll('.chip[data-input="statutRecherche"]').forEach(chip => {
        if (chip.classList.contains('active')) {
          chip.setAttribute('data-active', 'true');
        } else {
          chip.removeAttribute('data-active');
        }
      });

      // 2. Sauvegarde des positions Drag & Drop (CPS)
      document.querySelectorAll('.dnd-dropzone, .dnd-pool').forEach(zone => {
          let content = '';
          zone.querySelectorAll('.dnd-item').forEach(item => {
              // On cr√©e un attribut temporaire pour stocker le texte de l'item dans la zone
              content += item.textContent.trim() + '|||'; 
          });
          zone.setAttribute('data-content-saved', content);
      });

      // 3. Cr√©ation et T√©l√©chargement du fichier
      const htmlComplet = '<!DOCTYPE html>\n' + document.documentElement.outerHTML;
      const blob = new Blob([htmlComplet], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = NOM_BASE + '_' + prenom + '.html';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      alert("Ton travail a √©t√© enregistr√© dans le fichier : " + NOM_BASE + '_' + prenom + '.html. Conserve bien ce fichier pour le rouvrir plus tard !');

      // Nettoyage apr√®s l'enregistrement (pour √©viter la pollution du DOM)
      document.querySelectorAll('.dnd-dropzone, .dnd-pool').forEach(zone => {
          zone.removeAttribute('data-content-saved');
      });
    }

    // --- Fonction de Chargement (pour la r√©ouverture du fichier) ---
    function chargerTravail() {
      // 1. R√©cup√©ration des valeurs des inputs, textareas et checkboxes (fait automatiquement par le navigateur gr√¢ce aux attributs value/checked)
      
      // 2. R√©activation des chips
      document.querySelectorAll('.chip[data-input="statutRecherche"]').forEach(chip => {
        if (chip.hasAttribute('data-active')) {
          chip.classList.add('active');
        }
      });

      // 3. Restauration des curseurs (range sliders)
      document.querySelectorAll('input[type="range"]').forEach(slider => {
          const value = slider.value;
          const labelId = 'valeur' + slider.id.substring(4); // Ex: motivationStage -> Motivation
          const label = document.getElementById(labelId);
          if (label) {
              label.textContent = value + ' / 10';
          }
      });

      // 4. Restauration du Drag & Drop (CPS)
      document.querySelectorAll('.dnd-dropzone, .dnd-pool').forEach(zone => {
          const savedContent = zone.getAttribute('data-content-saved');
          if (savedContent) {
              // Vider la zone (sauf le titre)
              const items = Array.from(zone.querySelectorAll('.dnd-item'));
              items.forEach(item => item.remove());

              const itemTexts = savedContent.split('|||').map(t => t.trim()).filter(t => t);
              const pool = document.getElementById('dndPoolOrganisation'); // R√©f√©rence √† la pool initiale (qui contient les items non plac√©s)
              
              itemTexts.forEach(text => {
                  let itemFound = null;
                  // Chercher l'item original dans le pool pour s'assurer qu'il est bien un .dnd-item
                  const allItemsInPool = pool.querySelectorAll('.dnd-item');
                  // On parcourt TOUS les items du DOM pour trouver celui qui correspond au texte sauvegard√©
                  document.querySelectorAll('.dnd-item').forEach(item => {
                       if (item.textContent.trim() === text) {
                            itemFound = item;
                       }
                  });

                  if (itemFound) {
                      zone.appendChild(itemFound); // D√©place l'item vers la zone sauvegard√©e
                  } else {
                      // Optionnel : recr√©er l'item s'il n'est pas trouv√© (si le pool initial n'a pas √©t√© bien nettoy√©, par exemple)
                  }
              });
          }
      });


      // 5. Auto-resize des textareas au chargement
      document.querySelectorAll('textarea').forEach(ta => autoResizeTextarea(ta));

      // R√©initialiser le DND apr√®s avoir d√©plac√© les √©l√©ments pour s'assurer que les listeners sont actifs
      initDragAndDrop();
    }

    document.addEventListener('DOMContentLoaded', chargerTravail);


    // --- üñ®Ô∏è Fonction d'Impression de la Feuille de Route PFMP ---
    function imprimerFeuilleRoute() {
      const prenom = (document.getElementById('prenomEleve')?.value || '').trim();
      const nom = (document.getElementById('nomEleve')?.value || '').trim();
      const date = (document.getElementById('dateTravail')?.value || '');
      
      const statutRecherche = (document.getElementById('statutRecherche')?.value || 'Non renseign√©');
      const rechercheEntreprise = document.getElementById('rechercheEntreprise')?.value || '';
      const attentesPFMP = document.getElementById('attentesPFMP')?.value || '';
      const questionsTuteur = document.getElementById('questionsTuteur')?.value || '';
      
      const checklist = [];
      document.querySelectorAll('#partiePFMP .checklist-item input[type="checkbox"]').forEach(input => {
        const label = input.nextElementSibling.textContent;
        const statut = input.checked ? '‚úÖ Pr√™t' : '‚ùå Non pr√™t';
        checklist.push(`- ${statut} : ${label}`);
      });
      
      const fenetre = window.open('', '_blank');
      fenetre.document.write(
        '<!DOCTYPE html><html lang="fr"><head><meta charset="UTF-8" />' +
        '<title>Feuille de Route PFMP</title>' +
        '<style>' +
        'body{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;margin:20px;color:#222;}' +
        'h1{font-size:1.4rem;margin-bottom:8px;color:#a32454;}' +
        'h2{font-size:1.1rem;margin-top:16px;margin-bottom:4px;color:#333;border-bottom: 2px solid #a32454; padding-bottom: 4px;}' +
        'p.meta{font-size:0.9rem;margin-bottom:20px;}' +
        'p{font-size:0.9rem;white-space: pre-wrap;}' +
        'ul{list-style: none; padding: 0;}' +
        'li{margin-bottom: 5px;}' +
        '</style></head><body>' +
        '<h1>Ma Feuille de Route pour le Stage (PFMP)</h1>' +
        '<p class="meta"><strong>Pr√©nom :</strong> ' + escapeHtml(prenom) +
        ' &nbsp; <strong>Nom :</strong> ' + escapeHtml(nom) +
        ' &nbsp; <strong>Date du travail :</strong> ' + escapeHtml(date) + '</p>'
      );

      // Statut de la recherche
      fenetre.document.write('<h2>1. Ma recherche d\'entreprise (Statut)</h2>');
      fenetre.document.write('<p><strong>Statut principal :</strong> ' + escapeHtml(statutRecherche) + '</p>');
      if (rechercheEntreprise.trim()) {
        fenetre.document.write('<p><strong>Type d\'entreprise :</strong> ' + escapeHtml(rechercheEntreprise) + '</p>');
      }

      // Attentes
      if (attentesPFMP.trim()) {
        fenetre.document.write('<h2>2. Mes attentes concr√®tes du stage</h2><p>' + escapeHtml(attentesPFMP) + '</p>');
      }
      
      // Questions
      if (questionsTuteur.trim()) {
        fenetre.document.write('<h2>4. Mes questions pratiques pour l\'entreprise</h2><p>' + escapeHtml(questionsTuteur) + '</p>');
      }
      
      // Checklist
      if (checklist.length > 0) {
        fenetre.document.write('<h2>5. Documents et Mat√©riel</h2><ul>');
        checklist.forEach(item => {
          fenetre.document.write(`<li>${item}</li>`);
        });
        fenetre.document.write('</ul>');
      }

      fenetre.document.write('</body></html>');
      fenetre.document.close();
      fenetre.focus();
      fenetre.print();
    }
  </script>
</body>
</html>
