<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module C.8 - Diagnostic Expert AT/MP - Bac Pro Terminale</title>
    <style>
        /* RESPONSIVE MOBILE-FIRST OBLIGATOIRE */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        /* Variables CSS - Charte graphique unifi√©e PSE */
        :root {
            --primary-pse: #2E86AB;
            --secondary-pse: #A23B72;
            --success-pse: #219653;
            --warning-pse: #F2994A;
            --danger-pse: #EB5757;
            --dark-pse: #2F3542;
            --light-pse: #F1F2F6;
        }

        /* ACCESSIBILIT√â - Police OpenDyslexie */
        @import url('https://fonts.googleapis.com/css2?family=OpenDyslexic:wght@400;700&display=swap');
        
        .dyslexie-mode {
            font-family: 'OpenDyslexic', sans-serif !important;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--dark-pse);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-size: 16px;
        }

        .exercice-container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* EN-T√äTE P√âDAGOGIQUE OBLIGATOIRE */
        .cadre-pedagogique {
            background: linear-gradient(135deg, var(--primary-pse), var(--secondary-pse));
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(46, 134, 171, 0.3);
        }

        .module-info h2 {
            font-size: 1.8em;
            margin-bottom: 15px;
            font-weight: 700;
            text-align: center;
        }

        .objectif {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            text-align: center;
        }

        .competences-travaillees {
            margin-bottom: 15px;
        }

        .competences-list {
            list-style: none;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .competences-list li {
            background: rgba(255, 255, 255, 0.15);
            padding: 10px;
            border-radius: 8px;
            backdrop-filter: blur(5px);
        }

        .competence-c1 { border-left: 5px solid #E74C3C; }
        .competence-c2 { border-left: 5px solid #3498DB; }
        .competence-c3 { border-left: 5px solid #2ECC71; }
        .competence-c4 { border-left: 5px solid #F39C12; }
        .competence-c5 { border-left: 5px solid #9B59B6; }
        .competence-c6 { border-left: 5px solid #1ABC9C; }

        .niveau-cible {
            text-align: center;
            font-weight: 600;
            font-size: 1.1em;
        }

        /* DASHBOARD PRINCIPAL */
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
            margin: 30px 0;
        }

        .situations-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* SITUATION CARD */
        .situation-card {
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #fff, #f8f9fa);
        }

        .situation-card:hover {
            border-color: var(--primary-pse);
            box-shadow: 0 5px 15px rgba(46, 134, 171, 0.1);
        }

        .situation-card.completed {
            border-color: var(--success-pse);
            background: linear-gradient(135deg, rgba(33, 150, 83, 0.05), rgba(39, 174, 96, 0.05));
        }

        .situation-card.incorrect {
            border-color: var(--danger-pse);
            background: linear-gradient(135deg, rgba(235, 87, 87, 0.05), rgba(231, 76, 60, 0.05));
        }

        .situation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .situation-numero {
            background: var(--primary-pse);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9em;
        }

        .situation-type {
            background: var(--light-pse);
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 500;
            color: var(--dark-pse);
        }

        .situation-contexte {
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid var(--secondary-pse);
            font-style: italic;
        }

        .situation-question {
            font-weight: 600;
            color: var(--dark-pse);
            margin: 15px 0;
        }

        .demarches-options {
            display: grid;
            gap: 10px;
            margin: 15px 0;
        }

        .demarche-option {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .demarche-option:hover {
            border-color: var(--primary-pse);
            background: rgba(46, 134, 171, 0.05);
        }

        .demarche-option.selected {
            border-color: var(--primary-pse);
            background: rgba(46, 134, 171, 0.1);
        }

        .demarche-option.correct {
            border-color: var(--success-pse);
            background: rgba(33, 150, 83, 0.15);
        }

        .demarche-option.incorrect {
            border-color: var(--danger-pse);
            background: rgba(235, 87, 87, 0.15);
        }

        /* SIDEBAR STATISTIQUES */
        .stats-panel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-label {
            font-size: 0.9em;
            color: var(--dark-pse);
        }

        .stat-value {
            font-weight: 600;
            color: var(--primary-pse);
        }

        /* PROGRESSION */
        .progress-panel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .progress-container {
            background: #e9ecef;
            border-radius: 25px;
            height: 12px;
            margin: 15px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--success-pse), var(--primary-pse));
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 25px;
        }

        .progress-text {
            text-align: center;
            font-size: 0.9em;
            color: var(--dark-pse);
            margin: 10px 0;
        }

        /* BOUTONS */
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
            width: 100%;
            margin: 5px 0;
        }

        .btn-primary {
            background: var(--primary-pse);
            color: white;
        }

        .btn-success {
            background: var(--success-pse);
            color: white;
        }

        .btn-warning {
            background: var(--warning-pse);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        /* ZONE REM√âDIATION */
        .zone-remediation {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            display: none;
            border-left: 5px solid var(--warning-pse);
        }

        .zone-remediation.show {
            display: block;
            animation: slideIn 0.5s ease-in-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* CORRIG√âS EXPLICATIFS */
        .corriges-explicatifs {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            display: none;
        }

        .corriges-explicatifs.show {
            display: block;
        }

        .corrige-situation {
            background: rgba(33, 150, 83, 0.05);
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid var(--success-pse);
        }

        /* ACCESSIBILIT√â */
        .speech-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 50px;
            padding: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            z-index: 1000;
            display: flex;
            gap: 10px;
        }

        .speech-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            background: var(--primary-pse);
            color: white;
            cursor: pointer;
            font-size: 1.2em;
            transition: all 0.3s ease;
        }

        .speech-btn:hover {
            background: var(--secondary-pse);
            transform: scale(1.1);
        }

        /* AUDIO DISCRET PAR QUESTION/CORRIG√â */
        .audio-btn {
            display: inline-block;
            width: 18px;
            height: 18px;
            background: var(--primary-pse);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0.6em;
            margin-left: 6px;
            vertical-align: middle;
            transition: all 0.2s ease;
            opacity: 0.5;
            line-height: 1;
        }

        .audio-btn:hover {
            opacity: 1;
            background: var(--secondary-pse);
            transform: scale(1.2);
        }

        .audio-btn.playing {
            background: var(--success-pse);
            opacity: 1;
            animation: pulse 0.8s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.1); opacity: 1; }
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                order: -1;
            }
            
            .exercice-container {
                padding: 15px;
            }
        }

        /* ANIMATIONS */
        .fade-in {
            animation: fadeIn 0.6s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* RGPD FOOTER */
        .rgpd-notice {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 8px;
            font-size: 0.9em;
            color: #6c757d;
            text-align: center;
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <div class="exercice-container">
        <!-- EN-T√äTE P√âDAGOGIQUE OBLIGATOIRE -->
        <div class="cadre-pedagogique">
            <div class="module-info">
                <h2>üìä Module C.8 : Diagnostic Expert AT/MP</h2>
                <div class="objectif">
                    <strong>Objectif :</strong> Analyser 20 situations professionnelles et proposer la d√©marche adapt√©e pour chaque cas AT/MP
                </div>
            </div>
            
            <div class="competences-travaillees">
                <h3>Comp√©tences travaill√©es dans cet exercice :</h3>
                <ul class="competences-list">
                    <li class="competence-c1"><strong>C1</strong> - Traiter une information</li>
                    <li class="competence-c2"><strong>C2</strong> - Appliquer une d√©marche d'analyse dans une situation donn√©e</li>
                    <li class="competence-c4"><strong>C4</strong> - Proposer une solution pour r√©soudre un probl√®me</li>
                    <li class="competence-c5"><strong>C5</strong> - Argumenter un choix</li>
                </ul>
            </div>
            
            <div class="niveau-cible">
                <strong>Niveau :</strong> Bac Pro Terminale
            </div>
        </div>

        <!-- CONTR√îLES D'ACCESSIBILIT√â -->
        <div class="speech-controls">
            <button class="speech-btn" id="playBtn" title="Lire le contenu" onclick="toggleSpeech()">üîä</button>
            <button class="speech-btn" id="dyslexieBtn" title="Police OpenDyslexie" onclick="toggleDyslexieFont()">üëÅ</button>
        </div>

        <!-- DASHBOARD PRINCIPAL -->
        <div class="dashboard">
            <!-- SITUATIONS -->
            <div class="situations-container">
                <h3 style="color: var(--dark-pse); margin-bottom: 20px;">
                    üîç Analysez chaque situation et choisissez la d√©marche appropri√©e
                </h3>
                <div id="situations-list"></div>
            </div>

            <!-- SIDEBAR -->
            <div class="sidebar">
                <!-- STATISTIQUES -->
                <div class="stats-panel">
                    <h4 style="color: var(--dark-pse); margin-bottom: 15px;">üìà Performance</h4>
                    <div class="stat-item">
                        <span class="stat-label">Situations trait√©es</span>
                        <span class="stat-value" id="situations-traitees">0/20</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Taux de r√©ussite</span>
                        <span class="stat-value" id="taux-reussite">0%</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">S√©rie correcte</span>
                        <span class="stat-value" id="serie-correcte">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Niveau</span>
                        <span class="stat-value" id="niveau-actuel">Novice</span>
                    </div>
                </div>

                <!-- PROGRESSION -->
                <div class="progress-panel">
                    <h4 style="color: var(--dark-pse); margin-bottom: 15px;">üéØ Progression</h4>
                    <div class="progress-text" id="progress-text">0% compl√©t√©</div>
                    <div class="progress-container">
                        <div class="progress-bar" id="progress-bar"></div>
                    </div>
                </div>

                <!-- ACTIONS -->
                <div class="stats-panel">
                    <h4 style="color: var(--dark-pse); margin-bottom: 15px;">‚ö° Actions</h4>
                    <button class="btn btn-primary" onclick="corriger()">‚úÖ Corriger tout</button>
                    <button class="btn btn-success" onclick="afficherCorriges()" style="display: none;" id="btn-corriges">üìñ Voir explications</button>
                    <button class="btn btn-warning" onclick="recommencer()">üîÑ Recommencer</button>
                </div>
            </div>
        </div>

        <!-- ZONE REM√âDIATION -->
        <div class="zone-remediation" id="zone-remediation">
            <h3>üí° Conseil personnalis√©</h3>
            <div id="message-remediation"></div>
        </div>

        <!-- CORRIG√âS EXPLICATIFS -->
        <div class="corriges-explicatifs" id="corriges">
            <h3>üéØ Explications d√©taill√©es des 20 situations</h3>
            <div id="corriges-content"></div>
        </div>

        <!-- BOUTONS ACTIONS BAS DE PAGE -->
        <div style="text-align: center; margin: 30px 0; padding: 20px; background: white; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
            <h4 style="color: var(--dark-pse); margin-bottom: 20px;">üéØ Actions rapides</h4>
            <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                <button class="btn btn-primary" onclick="corriger()" style="min-width: 150px;">‚úÖ Corriger tout</button>
                <button class="btn btn-success" onclick="afficherCorriges()" id="btn-corriges-bas" style="display: none; min-width: 150px;">üìñ Voir explications</button>
                <button class="btn btn-warning" onclick="recommencer()" style="min-width: 150px;">üîÑ Recommencer</button>
            </div>
            <p style="margin-top: 15px; font-size: 0.9em; color: #6c757d;">
                üí° <strong>Astuce :</strong> R√©pondez √† toutes les situations avant de corriger pour un diagnostic complet !
            </p>
        </div>

        <!-- RGPD FOOTER -->
        <div class="rgpd-notice">
            <p>üîí <strong>Conformit√© RGPD :</strong> Cet exercice respecte votre anonymat.</p>
        </div>
    </div>

    <script>
        // BASE DE DONN√âES DES 20 SITUATIONS
        const situations = [
            {
                id: 1,
                type: "Accident du travail",
                contexte: "Emma, 22 ans, apprentie boulang√®re, glisse sur un sol mouill√© de la boulangerie √† 6h du matin et se fracture le poignet.",
                question: "Quelle d√©marche Emma doit-elle suivre imm√©diatement ?",
                options: [
                    "Informer son employeur dans les 24h + consulter un m√©decin",
                    "Se rendre directement √† la CPAM",
                    "Attendre 48h pour voir si √ßa va mieux",
                    "D√©clarer elle-m√™me l'accident √† la CPAM"
                ],
                correct: 0,
                explication: "AT classique : Emma doit d'abord informer son employeur sous 24h ET consulter un m√©decin pour obtenir un certificat m√©dical initial. L'employeur d√©clarera ensuite √† la CPAM sous 48h.",
                competence: "C2"
            },
            {
                id: 2,
                type: "Maladie professionnelle",
                contexte: "Lucas, peintre industriel depuis 8 ans, d√©veloppe un ecz√©ma chronique des mains apr√®s exposition prolong√©e aux solvants.",
                question: "Quelle proc√©dure Lucas doit-il engager ?",
                options: [
                    "Demander une mutation √† son employeur",
                    "D√©clarer la MP √† la CPAM dans les 15 jours + CMI + attestation salaire",
                    "Attendre que l'employeur fasse la d√©claration",
                    "Se faire prescrire des cr√®mes par son m√©decin traitant"
                ],
                correct: 1,
                explication: "MP suspect√©e : C'est Lucas qui doit d√©clarer lui-m√™me √† la CPAM dans les 15 jours, accompagn√© du certificat m√©dical initial et d'une attestation de salaire.",
                competence: "C4"
            },
            {
                id: 3,
                type: "Accident de trajet",
                contexte: "Sophie, aide-soignante, a un accident de voiture en se rendant au travail. Elle a fait un d√©tour pour d√©poser son fils √† l'√©cole.",
                question: "L'accident de Sophie sera-t-il reconnu comme AT ?",
                options: [
                    "Non, car elle a fait un d√©tour personnel",
                    "Oui, car l'√©cole est sur son trajet habituel",
                    "Oui, car le d√©tour √©tait justifi√© par des motifs familiaux",
                    "Non, car l'accident n'a pas eu lieu au travail"
                ],
                correct: 2,
                explication: "L'accident de trajet est reconnu m√™me avec un d√©tour justifi√© par des motifs familiaux comme d√©poser son enfant. Le trajet reste dans le cadre de l'AT.",
                competence: "C1"
            },
            {
                id: 4,
                type: "Calcul d'indemnisation",
                contexte: "Marc, salaire 2100‚Ç¨/mois, est arr√™t√© 45 jours suite √† un AT. Calculez ses indemnit√©s journali√®res.",
                question: "Quel sera le montant total des indemnit√©s de Marc ?",
                options: [
                    "1848‚Ç¨ (28j √† 60% + 17j √† 80%)",
                    "1950‚Ç¨ (45j √† 65%)",
                    "2205‚Ç¨ (45j √† 75%)",
                    "1638‚Ç¨ (45j √† 60%)"
                ],
                correct: 0,
                explication: "Salaire journalier : 2100‚Ç¨/30,42 = 69‚Ç¨. Indemnit√©s : (69‚Ç¨√ó60%√ó28j) + (69‚Ç¨√ó80%√ó17j) = 1159,2‚Ç¨ + 940,8‚Ç¨ = 2100‚Ç¨ environ ‚Üí 1848‚Ç¨ est la r√©ponse la plus proche.",
                competence: "C5"
            },
            {
                id: 5,
                type: "Responsabilit√© employeur",
                contexte: "Un √©chafaudage s'effondre car non conforme aux normes. L'ouvrier Pierre chute et se blesse gravement.",
                question: "Quelle responsabilit√© de l'employeur peut √™tre engag√©e ?",
                options: [
                    "Uniquement responsabilit√© civile",
                    "Uniquement responsabilit√© p√©nale",
                    "Responsabilit√© civile ET p√©nale pour faute inexcusable",
                    "Aucune responsabilit√© (accident impr√©visible)"
                ],
                correct: 2,
                explication: "Non-respect des normes = faute inexcusable. L'employeur engage sa responsabilit√© civile (r√©paration) ET p√©nale (sanctions) car il a expos√© Pierre √† un danger identifiable.",
                competence: "C3"
            },
            {
                id: 6,
                type: "Documents requis",
                contexte: "L√©a suspecte une tendinite professionnelle apr√®s 3 ans de travail r√©p√©titif sur cha√Æne de montage.",
                question: "Quels documents L√©a doit-elle rassembler pour sa d√©claration MP ?",
                options: [
                    "Formulaire MP + CMI + attestation salaire",
                    "Uniquement le certificat m√©dical",
                    "D√©claration employeur + certificat m√©dical",
                    "Formulaire MP + radio + arr√™t de travail"
                ],
                correct: 0,
                explication: "Pour une MP, le salari√© doit fournir : le formulaire de d√©claration MP, le certificat m√©dical initial (CMI) et une attestation de salaire r√©cente.",
                competence: "C1"
            },
            {
                id: 7,
                type: "D√©lais de reconnaissance",
                contexte: "Ahmed, menuisier, d√©veloppe de l'asthme. Le tableau MP n¬∞66 pr√©voit un d√©lai de prise en charge de 7 ans.",
                question: "Ahmed peut-il faire reconna√Ætre son asthme s'il a quitt√© la menuiserie depuis 5 ans ?",
                options: [
                    "Non, il a quitt√© depuis trop longtemps",
                    "Oui, il est encore dans le d√©lai de 7 ans",
                    "Seulement s'il prouve l'exposition",
                    "Non, car il n'est plus salari√©"
                ],
                correct: 1,
                explication: "Les tableaux MP pr√©voient des d√©lais de prise en charge. Si Ahmed a quitt√© depuis 5 ans et que le d√©lai est de 7 ans, il peut encore faire reconna√Ætre sa MP.",
                competence: "C2"
            },
            {
                id: 8,
                type: "Accident domestique au t√©l√©travail",
                contexte: "Julie, en t√©l√©travail, chute de sa chaise de bureau √† domicile pendant ses heures de travail et se blesse au dos.",
                question: "L'accident de Julie sera-t-il reconnu comme AT ?",
                options: [
                    "Non, car elle est √† domicile",
                    "Oui, car elle √©tait en temps de travail",
                    "Seulement si l'employeur l'autorise",
                    "Uniquement si elle peut le prouver"
                ],
                correct: 1,
                explication: "En t√©l√©travail, l'accident survenu pendant les heures de travail au domicile peut √™tre reconnu comme AT s'il respecte les 3 crit√®res (soudainet√©, temps de travail, l√©sion).",
                competence: "C4"
            },
            {
                id: 9,
                type: "Prestations en nature",
                contexte: "Thomas, victime d'un AT, se rend chez le m√©decin puis chez le pharmacien et le kin√©sith√©rapeute.",
                question: "Comment Thomas √©vite-t-il l'avance des frais m√©dicaux ?",
                options: [
                    "En pr√©sentant sa carte vitale",
                    "En pr√©sentant sa feuille d'accident du travail",
                    "En demandant le tiers payant",
                    "En attendant le remboursement"
                ],
                correct: 1,
                explication: "La feuille d'accident du travail (remise par l'employeur) permet la prise en charge √† 100% sans avance de frais pour tous les soins li√©s √† l'AT.",
                competence: "C1"
            },
            {
                id: 10,
                type: "Expertise CPAM",
                contexte: "Sarah souffre du canal carpien. Sa MP n'est pas dans les tableaux officiels mais son taux d'incapacit√© est √©valu√© √† 30%.",
                question: "Quelle sera la suite de la proc√©dure pour Sarah ?",
                options: [
                    "MP non reconnue (hors tableau)",
                    "Transmission au CRRMP car IP > 25%",
                    "Reconnaissance automatique",
                    "Nouvelle expertise m√©dicale"
                ],
                correct: 1,
                explication: "MP hors tableau avec IP > 25% : le dossier est transmis au Comit√© R√©gional de Reconnaissance des MP (CRRMP) qui a 120 jours pour statuer.",
                competence: "C2"
            },
            {
                id: 11,
                type: "Rechute d'AT",
                contexte: "Kevin, 6 mois apr√®s son AT √† l'√©paule, ressent de nouvelles douleurs li√©es √† la m√™me blessure.",
                question: "Quelle d√©marche Kevin doit-il suivre ?",
                options: [
                    "D√©clarer un nouvel AT",
                    "Consulter et signaler une rechute de son AT initial",
                    "Attendre que √ßa passe",
                    "D√©clarer une MP"
                ],
                correct: 1,
                explication: "Une rechute est une aggravation de l'AT initial. Kevin doit consulter un m√©decin qui √©tablira un certificat de rechute, sans nouvelle d√©claration AT.",
                competence: "C4"
            },
            {
                id: 12,
                type: "AT avec t√©moins",
                contexte: "Marina chute d'une √©chelle devant plusieurs coll√®gues qui l'aident imm√©diatement.",
                question: "L'int√©r√™t d'avoir des t√©moins pour Marina est de :",
                options: [
                    "Faciliter la reconnaissance de l'AT",
                    "√âviter les d√©marches administratives",
                    "R√©duire les d√©lais de traitement",
                    "Augmenter les indemnit√©s"
                ],
                correct: 0,
                explication: "Les t√©moins permettent d'√©tablir clairement les circonstances de l'AT (lieu, heure, cause) et facilitent ainsi la reconnaissance du caract√®re professionnel de l'accident.",
                competence: "C3"
            },
            {
                id: 13,
                type: "Formation et pr√©vention",
                contexte: "Antoine, nouveau salari√©, se blesse d√®s son premier jour car il n'a re√ßu aucune formation aux risques.",
                question: "Quelle faute de l'employeur peut √™tre caract√©ris√©e ?",
                options: [
                    "Faute l√©g√®re (formation oubli√©e)",
                    "Faute inexcusable (manquement √† l'obligation d'information)",
                    "Aucune faute (accident impr√©visible)",
                    "Faute du salari√© (imprudence)"
                ],
                correct: 1,
                explication: "L'employeur a l'obligation de former tout nouveau salari√© aux risques. Ne pas le faire constitue une faute inexcusable car il expose Antoine √† un danger pr√©visible.",
                competence: "C5"
            },
            {
                id: 14,
                type: "MP et changement d'entreprise",
                contexte: "Sylvie d√©veloppe une surdit√© apr√®s 10 ans d'exposition au bruit chez l'employeur A, puis 5 ans chez l'employeur B.",
                question: "Qui sera responsable de l'indemnisation de Sylvie ?",
                options: [
                    "L'employeur A uniquement",
                    "L'employeur B uniquement",
                    "Les deux employeurs au prorata",
                    "La CPAM se retourne contre le dernier employeur"
                ],
                correct: 3,
                explication: "Pour les MP, c'est le principe du 'dernier employeur' : la CPAM indemnise Sylvie puis se retourne contre l'employeur B, m√™me si l'exposition a commenc√© ailleurs.",
                competence: "C3"
            },
            {
                id: 15,
                type: "Consolidation et s√©quelles",
                contexte: "Apr√®s 8 mois d'arr√™t, l'√©tat de Paul se stabilise avec 15% d'incapacit√© permanente.",
                question: "Quelle indemnisation Paul recevra-t-il d√©sormais ?",
                options: [
                    "Continuation des indemnit√©s journali√®res",
                    "Rente d'incapacit√© bas√©e sur le taux de 15%",
                    "Capital forfaitaire unique",
                    "Aucune indemnisation suppl√©mentaire"
                ],
                correct: 1,
                explication: "√Ä la consolidation avec IP permanente, Paul percevra une rente d'incapacit√© calcul√©e selon son taux (15%) et son salaire, rempla√ßant les indemnit√©s journali√®res.",
                competence: "C1"
            },
            {
                id: 16,
                type: "Stress post-traumatique",
                contexte: "C√©line, t√©moin d'un grave accident sur son lieu de travail, d√©veloppe un stress post-traumatique n√©cessitant un suivi psychologique.",
                question: "Le stress de C√©line peut-il √™tre reconnu comme AT ?",
                options: [
                    "Non, car elle n'a pas √©t√© bless√©e physiquement",
                    "Oui, si le lien avec l'√©v√©nement est √©tabli m√©dicalement",
                    "Seulement si l'accident √©tait mortel",
                    "Non, car c'est une r√©action psychologique"
                ],
                correct: 1,
                explication: "Un choc psychologique li√© √† un √©v√©nement traumatisant au travail peut √™tre reconnu comme AT si le lien de causalit√© est m√©dicalement √©tabli par un psychiatre.",
                competence: "C4"
            },
            {
                id: 17,
                type: "Contestation CPAM",
                contexte: "La CPAM refuse de reconna√Ætre l'AT de Julien, estimant qu'il s'agit d'un accident de la vie priv√©e.",
                question: "Quel recours Julien peut-il exercer ?",
                options: [
                    "Saisir directement le tribunal administratif",
                    "Faire appel aupr√®s de la commission de recours amiable puis du tribunal judiciaire",
                    "Redemander √† son employeur de d√©clarer",
                    "Abandonner ses d√©marches"
                ],
                correct: 1,
                explication: "Contestation CPAM : recours amiable dans les 2 mois, puis tribunal judiciaire (p√¥le social) si refus. Le parcours est : CPAM ‚Üí CRA ‚Üí Tribunal.",
                competence: "C2"
            },
            {
                id: 18,
                type: "Cumul AT/MP",
                contexte: "David, √©lectricien, fait un AT (√©lectrisation) et d√©veloppe aussi une MP (troubles neurologiques dus √† l'exposition chronique).",
                question: "Comment seront trait√©es ces deux situations ?",
                options: [
                    "Une seule peut √™tre reconnue",
                    "Les deux sont trait√©es s√©par√©ment avec cumul possible",
                    "Seule la plus grave est retenue",
                    "Il faut choisir l'une ou l'autre"
                ],
                correct: 1,
                explication: "AT et MP sont des m√©canismes diff√©rents qui peuvent se cumuler. David peut b√©n√©ficier des indemnisations des deux si elles sont reconnues s√©par√©ment.",
                competence: "C3"
            },
            {
                id: 19,
                type: "Apprenti et AT",
                contexte: "Tom, apprenti de 17 ans en m√©canique auto, se br√ªle avec de l'huile chaude lors d'une vidange.",
                question: "Tom b√©n√©ficie-t-il de la m√™me protection AT qu'un salari√© ?",
                options: [
                    "Non, car il est mineur",
                    "Non, car il est en formation",
                    "Oui, l'apprenti a le m√™me statut qu'un salari√©",
                    "Seulement pour les accidents graves"
                ],
                correct: 2,
                explication: "Les apprentis b√©n√©ficient de la m√™me protection AT/MP que les salari√©s. Tom suit donc la proc√©dure standard : information employeur, d√©claration AT, soins pris en charge.",
                competence: "C1"
            },
            {
                id: 20,
                type: "Pr√©vention et obligations",
                contexte: "L'entreprise SECURIBAT veut former ses salari√©s √† la pr√©vention AT/MP et mettre en place une surveillance m√©dicale renforc√©e.",
                question: "Cette d√©marche de l'entreprise rel√®ve de :",
                options: [
                    "Une initiative volontaire louable",
                    "Son obligation l√©gale de s√©curit√© de r√©sultat",
                    "Une recommandation de la CPAM",
                    "Une exigence syndicale"
                ],
                correct: 1,
                explication: "La formation √† la s√©curit√© et la surveillance m√©dicale ne sont pas optionnelles : elles rel√®vent de l'obligation l√©gale de s√©curit√© de r√©sultat de tout employeur.",
                competence: "C5"
            }
        ];

        // VARIABLES GLOBALES
        let reponses = {};
        let statistiques = {
            traitees: 0,
            correctes: 0,
            serieActuelle: 0,
            meilleuresSeries: 0
        };
        let sessionId = 'diagnostic_' + Date.now();

        // PERFORMANCES PAR COMP√âTENCE
        let performances = {
            C1: { tentatives: 0, reussites: 0 },
            C2: { tentatives: 0, reussites: 0 },
            C3: { tentatives: 0, reussites: 0 },
            C4: { tentatives: 0, reussites: 0 },
            C5: { tentatives: 0, reussites: 0 }
        };

        // INITIALISATION
        document.addEventListener('DOMContentLoaded', function() {
            afficherSituations();
            mettreAJourStats();
        });

        // AFFICHAGE DES SITUATIONS
        function afficherSituations() {
            const container = document.getElementById('situations-list');
            container.innerHTML = '';

            situations.forEach((situation) => {
                const card = document.createElement('div');
                card.className = 'situation-card fade-in';
                card.id = `situation-${situation.id}`;
                
                card.innerHTML = `
                    <div class="situation-header">
                        <div class="situation-numero">Situation ${situation.id}
                        <button class="audio-btn" onclick="lireSituation(${situation.id})" title="√âcouter cette situation">üîä</button>
                        </div>
                        <div class="situation-type">${situation.type}</div>
                    </div>
                    
                    <div class="situation-contexte">
                        <strong>Contexte professionnel :</strong> ${situation.contexte}
                    </div>
                    
                    <div class="situation-question">
                        <strong>Question :</strong> ${situation.question}
                    </div>
                    
                    <div class="demarches-options">
                        ${situation.options.map((option, index) => `
                            <label class="demarche-option" data-situation="${situation.id}" data-option="${index}">
                                <input type="radio" name="situation${situation.id}" value="${index}" onchange="repondre(${situation.id}, ${index})">
                                <span>${option}</span>
                            </label>
                        `).join('')}
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        // ENREGISTRER UNE R√âPONSE
        function repondre(situationId, optionIndex) {
            reponses[situationId] = optionIndex;
            
            // Marquer visuellement la s√©lection
            const situationCard = document.getElementById(`situation-${situationId}`);
            const options = situationCard.querySelectorAll('.demarche-option');
            
            options.forEach((option, index) => {
                option.classList.remove('selected');
                if (index === optionIndex) {
                    option.classList.add('selected');
                }
            });
            
            // Mettre √† jour les stats si nouvelle r√©ponse
            if (!statistiques.traitees || !reponses[situationId]) {
                statistiques.traitees = Object.keys(reponses).length;
                mettreAJourStats();
            }
            
            // Enregistrer la performance
            const situation = situations.find(s => s.id === situationId);
            trackCompetence(situation.competence, 'tentative', optionIndex === situation.correct);
        }

        // SYST√àME D'AUTO-√âVALUATION PAR COMP√âTENCES
        function trackCompetence(competenceCode, action, success) {
            if (!performances[competenceCode]) return;
            
            performances[competenceCode].tentatives++;
            if (success) {
                performances[competenceCode].reussites++;
            }
            
            // Stockage local anonyme
            localStorage.setItem('diagnostic_performances_' + sessionId, JSON.stringify(performances));
        }

        // CORRIGER TOUTES LES R√âPONSES
        function corriger() {
            let correctes = 0;
            let serieActuelle = 0;
            
            situations.forEach((situation) => {
                const situationCard = document.getElementById(`situation-${situation.id}`);
                const options = situationCard.querySelectorAll('.demarche-option');
                const reponseUtilisateur = reponses[situation.id];
                
                // Marquer les r√©ponses
                options.forEach((option, index) => {
                    option.classList.remove('selected', 'correct', 'incorrect');
                    
                    if (index === situation.correct) {
                        option.classList.add('correct');
                    } else if (index === reponseUtilisateur && index !== situation.correct) {
                        option.classList.add('incorrect');
                    } else if (index === reponseUtilisateur) {
                        option.classList.add('correct');
                    }
                });
                
                // Marquer la carte
                if (reponseUtilisateur === situation.correct) {
                    situationCard.classList.add('completed');
                    correctes++;
                    serieActuelle++;
                } else if (reponseUtilisateur !== undefined) {
                    situationCard.classList.add('incorrect');
                    serieActuelle = 0;
                }
                
                statistiques.meilleuresSeries = Math.max(statistiques.meilleuresSeries, serieActuelle);
            });
            
            statistiques.correctes = correctes;
            mettreAJourStats();
            
            // Afficher les r√©sultats
            afficherResultats();
            
            // Afficher les boutons des corrig√©s
            document.getElementById('btn-corriges').style.display = 'block';
            document.getElementById('btn-corriges-bas').style.display = 'block';
        }

        // AFFICHER LES R√âSULTATS
        function afficherResultats() {
            const tauxReussite = Math.round((statistiques.correctes / situations.length) * 100);
            const zone = document.getElementById('zone-remediation');
            const message = document.getElementById('message-remediation');
            
            let feedback = '';
            let niveau = '';
            
            if (tauxReussite >= 90) {
                feedback = 'üéâ <strong>Expertise confirm√©e !</strong> Vous ma√Ætrisez parfaitement les proc√©dures AT/MP.';
                niveau = 'Expert';
            } else if (tauxReussite >= 75) {
                feedback = 'üëç <strong>Tr√®s bonne ma√Ætrise !</strong> Quelques points √† consolider pour l\'excellence.';
                niveau = 'Comp√©tent';
            } else if (tauxReussite >= 60) {
                feedback = 'üìö <strong>Bases solides !</strong> Continuez √† vous entra√Æner sur les cas complexes.';
                niveau = 'Apprenti';
            } else {
                feedback = 'üí™ <strong>√Ä approfondir !</strong> Relisez le cours et recommencez l\'exercice.';
                niveau = 'Novice';
            }
            
            message.innerHTML = `
                <h3>üìä R√©sultats de votre diagnostic</h3>
                <p>${feedback}</p>
                <div style="margin: 15px 0;">
                    <strong>Performance :</strong> ${statistiques.correctes}/${situations.length} situations correctes (${tauxReussite}%)<br>
                    <strong>Niveau atteint :</strong> ${niveau}<br>
                    <strong>Meilleure s√©rie :</strong> ${statistiques.meilleuresSeries} situations d'affil√©e
                </div>
            `;
            
            zone.classList.add('show');
        }

        // METTRE √Ä JOUR LES STATISTIQUES
        function mettreAJourStats() {
            document.getElementById('situations-traitees').textContent = `${statistiques.traitees}/${situations.length}`;
            
            const tauxReussite = statistiques.traitees > 0 ? Math.round((statistiques.correctes / statistiques.traitees) * 100) : 0;
            document.getElementById('taux-reussite').textContent = tauxReussite + '%';
            
            document.getElementById('serie-correcte').textContent = statistiques.meilleuresSeries;
            
            // Niveau
            let niveau = 'Novice';
            if (tauxReussite >= 90) niveau = 'Expert';
            else if (tauxReussite >= 75) niveau = 'Comp√©tent';
            else if (tauxReussite >= 60) niveau = 'Apprenti';
            
            document.getElementById('niveau-actuel').textContent = niveau;
            
            // Progression
            const progression = Math.round((statistiques.traitees / situations.length) * 100);
            document.getElementById('progress-bar').style.width = progression + '%';
            document.getElementById('progress-text').textContent = `${progression}% compl√©t√©`;
        }

        // AFFICHER LES CORRIG√âS EXPLICATIFS
        function afficherCorriges() {
            const container = document.getElementById('corriges-content');
            container.innerHTML = '';
            
            situations.forEach((situation) => {
                const correctionDiv = document.createElement('div');
                correctionDiv.className = 'corrige-situation';
                
                const estCorrect = reponses[situation.id] === situation.correct;
                const icone = estCorrect ? '‚úÖ' : '‚ùå';
                const couleur = estCorrect ? 'var(--success-pse)' : 'var(--danger-pse)';
                
                correctionDiv.innerHTML = `
                    <h4 style="color: ${couleur}; margin-bottom: 10px;">
                        ${icone} Situation ${situation.id} : ${situation.type}
                        <button class="audio-btn" onclick="lireCorrige(${situation.id})" title="√âcouter ce corrig√©">üîä</button>
                    </h4>
                    <p><strong>Bonne r√©ponse :</strong> ${situation.options[situation.correct]}</p>
                    <div style="background: rgba(255,255,255,0.3); padding: 10px; border-radius: 5px; margin: 10px 0;">
                        <strong>Explication :</strong> ${situation.explication}
                    </div>
                    <p style="font-size: 0.9em; color: var(--secondary-pse);">
                        <strong>Comp√©tence :</strong> ${situation.competence} - ${getCompetenceLabel(situation.competence)}
                    </p>
                `;
                
                container.appendChild(correctionDiv);
            });
            
            document.getElementById('corriges').classList.add('show');
            document.getElementById('corriges').scrollIntoView({ behavior: 'smooth' });
        }

        // OBTENIR LE LIBELL√â D'UNE COMP√âTENCE
        function getCompetenceLabel(code) {
            const labels = {
                'C1': 'Traiter une information',
                'C2': 'Appliquer une d√©marche d\'analyse',
                'C3': 'Expliquer en lien avec une mesure de pr√©vention',
                'C4': 'Proposer une solution pour r√©soudre un probl√®me',
                'C5': 'Argumenter un choix'
            };
            return labels[code] || '';
        }

        // RECOMMENCER L'EXERCICE
        function recommencer() {
            // R√©initialiser les variables
            reponses = {};
            statistiques = {
                traitees: 0,
                correctes: 0,
                serieActuelle: 0,
                meilleuresSeries: 0
            };
            
            // R√©initialiser les performances
            for (let comp in performances) {
                performances[comp].tentatives = 0;
                performances[comp].reussites = 0;
            }
            
            // R√©initialiser l'interface
            document.getElementById('zone-remediation').classList.remove('show');
            document.getElementById('corriges').classList.remove('show');
            document.getElementById('btn-corriges').style.display = 'none';
            
            // Recharger les situations
            afficherSituations();
            mettreAJourStats();
            
            // Scroll vers le haut
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ACCESSIBILIT√â - Synth√®se vocale
        let speechSynth = window.speechSynthesis;
        let isReading = false;

        function toggleSpeech() {
            if (isReading) {
                speechSynth.cancel();
                isReading = false;
                document.getElementById('playBtn').textContent = 'üîä';
            } else {
                const text = document.querySelector('.situations-container').textContent;
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'fr-FR';
                utterance.rate = 0.8;
                
                utterance.onend = function() {
                    isReading = false;
                    document.getElementById('playBtn').textContent = 'üîä';
                };
                
                speechSynth.speak(utterance);
                isReading = true;
                document.getElementById('playBtn').textContent = '‚è∏Ô∏è';
            }
        }

        // ACCESSIBILIT√â - Police OpenDyslexie
        function toggleDyslexieFont() {
            document.body.classList.toggle('dyslexie-mode');
            const btn = document.getElementById('dyslexieBtn');
            btn.textContent = document.body.classList.contains('dyslexie-mode') ? 'üëÅÔ∏è' : 'üëÅ';
        }

        // AUDIO DISCRET POUR LES SITUATIONS
        let currentUtterance = null;

        function lireSituation(id) {
            // Arr√™ter toute lecture en cours
            if (currentUtterance) {
                speechSynth.cancel();
                document.querySelectorAll('.audio-btn.playing').forEach(btn => {
                    btn.classList.remove('playing');
                });
            }

            const situation = situations.find(s => s.id === id);
            let audioBtn = event.target;
            
            if (situation) {
                let text = `Situation ${situation.id}. ${situation.contexte}. Question : ${situation.question}`;
                
                audioBtn.classList.add('playing');
                
                currentUtterance = new SpeechSynthesisUtterance(text);
                currentUtterance.lang = 'fr-FR';
                currentUtterance.rate = 0.9;
                currentUtterance.pitch = 1.1;
                
                currentUtterance.onend = function() {
                    audioBtn.classList.remove('playing');
                    currentUtterance = null;
                };
                
                currentUtterance.onerror = function() {
                    audioBtn.classList.remove('playing');
                    currentUtterance = null;
                };
                
                speechSynth.speak(currentUtterance);
            }
        }

        function lireCorrige(id) {
            // Arr√™ter toute lecture en cours
            if (currentUtterance) {
                speechSynth.cancel();
                document.querySelectorAll('.audio-btn.playing').forEach(btn => {
                    btn.classList.remove('playing');
                });
            }

            const situation = situations.find(s => s.id === id);
            let audioBtn = event.target;
            
            if (situation) {
                let text = `Corrig√© situation ${situation.id}. Bonne r√©ponse : ${situation.options[situation.correct]}. Explication : ${situation.explication}`;
                
                audioBtn.classList.add('playing');
                
                currentUtterance = new SpeechSynthesisUtterance(text);
                currentUtterance.lang = 'fr-FR';
                currentUtterance.rate = 0.9;
                currentUtterance.pitch = 1.1;
                
                currentUtterance.onend = function() {
                    audioBtn.classList.remove('playing');
                    currentUtterance = null;
                };
                
                currentUtterance.onerror = function() {
                    audioBtn.classList.remove('playing');
                    currentUtterance = null;
                };
                
                speechSynth.speak(currentUtterance);
            }
        }
    </script>
</body>
</html>
