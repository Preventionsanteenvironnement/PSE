<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R√©vision C.10 - Risques Activit√© Physique - Bac Pro Terminale</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-tertiary: #0f3460;
            --text-primary: white;
            --border-color: rgba(255,255,255,0.2);
            --accent-orange: #ff9a56;
            --accent-blue: #667eea;
            --accent-purple: #764ba2;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 50%, var(--bg-tertiary) 100%);
            min-height: 100vh;
            color: var(--text-primary);
            overflow-x: hidden;
            transition: all 0.3s ease;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }
        
        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .btn-back {
            background: rgba(255,255,255,0.1);
            color: var(--text-primary);
            padding: 10px 20px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            border: 2px solid var(--border-color);
            cursor: pointer;
        }
        
        .btn-back:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }
        
        .score-bar {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 50px;
        }
        
        .score-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .score-item .icon {
            font-size: 18px;
        }
        
        /* √âcrans */
        .screen {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .screen.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* √âcran d'accueil */
        .welcome-screen {
            text-align: center;
            padding: 30px 0;
        }
        
        .welcome-title {
            font-size: 42px;
            font-weight: 900;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--accent-orange), #fecfef, #fecfef);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .welcome-subtitle {
            font-size: 18px;
            color: rgba(255,255,255,0.7);
            margin-bottom: 30px;
        }
        
        /* Objectifs */
        .objectifs-card {
            background: linear-gradient(135deg, rgba(255, 154, 86, 0.3), rgba(254, 207, 239, 0.3));
            border: 2px solid rgba(255, 154, 86, 0.5);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            text-align: left;
        }
        
        .objectifs-card h3 {
            font-size: 18px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .objectif-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            font-size: 14px;
            line-height: 1.5;
        }
        
        .objectif-item:last-child {
            border-bottom: none;
        }
        
        .objectif-item .check {
            color: #4CAF50;
            font-size: 18px;
            flex-shrink: 0;
        }
        
        .competences-row {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .comp-badge {
            background: rgba(255,255,255,0.15);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
        }
        
        .comp-badge.c1 { background: rgba(16, 185, 129, 0.3); border: 1px solid #10b981; }
        .comp-badge.c2 { background: rgba(102, 126, 234, 0.3); border: 1px solid #667eea; }
        .comp-badge.c3 { background: rgba(245, 158, 11, 0.3); border: 1px solid #f59e0b; }
        .comp-badge.c4 { background: rgba(239, 68, 68, 0.3); border: 1px solid #ef4444; }
        .comp-badge.c5 { background: rgba(168, 85, 247, 0.3); border: 1px solid #a855f7; }
        .comp-badge.c6 { background: rgba(34, 197, 94, 0.3); border: 1px solid #22c55e; }
        
        /* Niveaux */
        .niveaux-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 25px;
        }
        
        .niveau-card {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .niveau-card:hover:not(.locked) {
            background: rgba(255,255,255,0.1);
            transform: translateX(5px);
            border-color: rgba(255, 154, 86, 0.5);
        }
        
        .niveau-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .niveau-card.completed {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }
        
        .niveau-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 900;
            flex-shrink: 0;
            color: white;
        }
        
        .niveau-1 { background: linear-gradient(135deg, #84fab0, #8fd3f4); }
        .niveau-2 { background: linear-gradient(135deg, #ff9a9e, #fecfef); }
        .niveau-3 { background: linear-gradient(135deg, #a8edea, #fed6e3); }
        .niveau-4 { background: linear-gradient(135deg, #ffecd2, #fcb69f); }
        .niveau-5 { background: linear-gradient(135deg, #667eea, #764ba2); }
        
        .niveau-content {
            flex: 1;
        }
        
        .niveau-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .niveau-desc {
            font-size: 14px;
            color: rgba(255,255,255,0.7);
            margin-bottom: 8px;
        }
        
        .niveau-progress {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .progress-bar {
            flex: 1;
            height: 6px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: #4CAF50;
            transition: width 0.5s ease;
            width: 0%;
        }
        
        .progress-text {
            font-size: 12px;
            font-weight: 600;
        }
        
        /* √âcran de jeu */
        .game-screen {
            padding: 20px 0;
        }
        
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .level-badge {
            background: rgba(255,255,255,0.15);
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
        }
        
        .progress-info {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .card-container {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .card-keyword {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .keyword-text {
            font-size: 32px;
            font-weight: 900;
            background: linear-gradient(135deg, var(--accent-orange), #fecfef);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        
        .keyword-category {
            background: rgba(255,255,255,0.2);
            display: inline-block;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .question-section {
            margin-bottom: 25px;
        }
        
        .question-text {
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 20px;
            text-align: center;
        }
        
        /* Input keyword */
        .keyword-input {
            width: 100%;
            padding: 15px 20px;
            font-size: 18px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 25px;
            background: rgba(255,255,255,0.1);
            color: white;
            text-align: center;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .keyword-input::placeholder {
            color: rgba(255,255,255,0.6);
        }
        
        .keyword-input:focus {
            outline: none;
            border-color: var(--accent-orange);
            background: rgba(255,255,255,0.15);
        }
        
        /* Options QCM */
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .option-btn {
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 15px;
            padding: 15px 20px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
            text-align: left;
        }
        
        .option-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: translateX(5px);
        }
        
        .option-btn.selected {
            background: rgba(255, 154, 86, 0.3);
            border-color: var(--accent-orange);
        }
        
        .option-letter {
            width: 30px;
            height: 30px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            flex-shrink: 0;
        }
        
        /* Vrai/Faux */
        .vf-container {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .vf-btn {
            flex: 1;
            max-width: 200px;
            padding: 20px;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 15px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .vf-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-3px);
        }
        
        .vf-btn.selected {
            background: rgba(255, 154, 86, 0.3);
            border-color: var(--accent-orange);
        }
        
        .vf-btn.vrai { color: #4CAF50; }
        .vf-btn.faux { color: #f44336; }
        
        /* Actions */
        .card-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 25px;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--accent-orange), #fecfef);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 154, 86, 0.3);
        }
        
        .btn-secondary {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        .btn-secondary:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .hint-section {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 15px;
            font-size: 14px;
            line-height: 1.5;
        }
        
        /* Feedback */
        .feedback-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            padding: 20px;
        }
        
        .feedback-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        
        .feedback-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(255,255,255,0.8));
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            text-align: center;
            color: #333;
            transform: scale(0.8);
            transition: transform 0.3s ease;
        }
        
        .feedback-overlay.visible .feedback-card {
            transform: scale(1);
        }
        
        .feedback-card.correct {
            border: 3px solid #4CAF50;
        }
        
        .feedback-card.incorrect {
            border: 3px solid #f44336;
        }
        
        .feedback-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .feedback-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .feedback-points {
            background: #4CAF50;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 20px;
        }
        
        .feedback-explanation {
            text-align: left;
            margin-bottom: 25px;
        }
        
        .feedback-explanation h4 {
            color: #333;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .keyword-box {
            background: linear-gradient(135deg, var(--accent-orange), #fecfef);
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: 600;
            text-align: center;
        }
        
        .tip-box {
            background: #e3f2fd;
            border: 1px solid #2196F3;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .tip-box h5 {
            color: #1976D2;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Results */
        .results-screen {
            text-align: center;
            padding: 30px 0;
        }
        
        .results-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }
        
        .results-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 15px;
        }
        
        .results-score {
            font-size: 48px;
            font-weight: 900;
            background: linear-gradient(135deg, var(--accent-orange), #fecfef);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
        }
        
        .results-stats {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 20px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            display: block;
        }
        
        .stat-label {
            font-size: 12px;
            color: rgba(255,255,255,0.7);
            text-transform: uppercase;
        }
        
        .errors-recap {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            text-align: left;
        }
        
        .errors-recap h4 {
            color: #FFC107;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .errors-list {
            list-style: none;
            padding: 0;
        }
        
        .errors-list li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            font-size: 14px;
        }
        
        .errors-list li:last-child {
            border-bottom: none;
        }
        
        .results-actions {
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center;
        }
        
        /* Confetti */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            animation: confetti-fall 3s linear forwards;
            pointer-events: none;
            z-index: 1001;
        }
        
        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* Streak popup */
        .streak-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, var(--accent-orange), #fecfef);
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            font-size: 18px;
            font-weight: 700;
            z-index: 1002;
            display: none;
            animation: bounce 0.5s ease;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translate(-50%, -50%) translateY(0);
            }
            40% {
                transform: translate(-50%, -50%) translateY(-10px);
            }
            60% {
                transform: translate(-50%, -50%) translateY(-5px);
            }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .welcome-title {
                font-size: 32px;
            }
            
            .card-container {
                padding: 20px;
            }
            
            .keyword-text {
                font-size: 24px;
            }
            
            .question-text {
                font-size: 16px;
            }
            
            .options-container {
                gap: 10px;
            }
            
            .option-btn {
                padding: 12px 15px;
                font-size: 14px;
            }
            
            .vf-container {
                flex-direction: column;
            }
            
            .results-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <a href="#" class="btn-back" onclick="goHome()">‚Üê Retour</a>
            <div class="score-bar">
                <div class="score-item">
                    <span class="icon">üèÜ</span>
                    <span id="totalPoints">0</span>
                </div>
                <div class="score-item">
                    <span class="icon">üî•</span>
                    <span id="currentStreak">0</span>
                </div>
            </div>
        </div>

        <!-- √âcran d'accueil -->
        <div class="screen active" id="homeScreen">
            <div class="welcome-screen">
                <div class="welcome-title">C.10 Flashcards</div>
                <div class="welcome-subtitle">Les risques li√©s √† l'activit√© physique</div>
                
                <div class="objectifs-card">
                    <h3>üéØ Objectifs de r√©vision</h3>
                    <div class="objectif-item">
                        <span class="check">‚úì</span>
                        <span>Ma√Ætriser les facteurs de risques li√©s √† l'activit√© physique professionnelle</span>
                    </div>
                    <div class="objectif-item">
                        <span class="check">‚úì</span>
                        <span>Identifier les m√©canismes physiopathologiques des TMS</span>
                    </div>
                    <div class="objectif-item">
                        <span class="check">‚úì</span>
                        <span>Comprendre l'anatomie et les pathologies de la colonne vert√©brale</span>
                    </div>
                    <div class="objectif-item">
                        <span class="check">‚úì</span>
                        <span>Appliquer la hi√©rarchie des mesures de pr√©vention</span>
                    </div>
                    <div class="objectif-item">
                        <span class="check">‚úì</span>
                        <span>Utiliser les outils d'analyse des risques (ITAMaMi)</span>
                    </div>
                    
                    <div class="competences-row">
                        <span class="comp-badge c1">C1 - Traiter info</span>
                        <span class="comp-badge c2">C2 - Analyser</span>
                        <span class="comp-badge c3">C3 - Expliquer</span>
                        <span class="comp-badge c4">C4 - Proposer</span>
                        <span class="comp-badge c5">C5 - Argumenter</span>
                        <span class="comp-badge c6">C6 - Communiquer</span>
                    </div>
                </div>
                
                <div class="niveaux-grid">
                    <div class="niveau-card" onclick="startLevel(1)">
                        <div class="niveau-icon niveau-1">1</div>
                        <div class="niveau-content">
                            <div class="niveau-title">Facteurs de risques</div>
                            <div class="niveau-desc">Activit√© statique/dynamique, facteurs physiques</div>
                            <div class="niveau-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="level1Bar"></div>
                                </div>
                                <div class="progress-text" id="level1Percent">0%</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="niveau-card" onclick="startLevel(2)">
                        <div class="niveau-icon niveau-2">2</div>
                        <div class="niveau-content">
                            <div class="niveau-title">TMS & Pathologies</div>
                            <div class="niveau-desc">Troubles musculo-squelettiques, traumatismes</div>
                            <div class="niveau-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="level2Bar"></div>
                                </div>
                                <div class="progress-text" id="level2Percent">0%</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="niveau-card" onclick="startLevel(3)">
                        <div class="niveau-icon niveau-3">3</div>
                        <div class="niveau-content">
                            <div class="niveau-title">Colonne vert√©brale</div>
                            <div class="niveau-desc">Anatomie, disques, accidents discaux</div>
                            <div class="niveau-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="level3Bar"></div>
                                </div>
                                <div class="progress-text" id="level3Percent">0%</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="niveau-card" onclick="startLevel(4)">
                        <div class="niveau-icon niveau-4">4</div>
                        <div class="niveau-content">
                            <div class="niveau-title">Pr√©vention & Solutions</div>
                            <div class="niveau-desc">Mesures hi√©rarchis√©es, PRAP, ergonomie</div>
                            <div class="niveau-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="level4Bar"></div>
                                </div>
                                <div class="progress-text" id="level4Percent">0%</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="niveau-card" onclick="startLevel(5)">
                        <div class="niveau-icon niveau-5">5</div>
                        <div class="niveau-content">
                            <div class="niveau-title">Expertise compl√®te</div>
                            <div class="niveau-desc">Analyse complexe, r√©glementation, argumentation</div>
                            <div class="niveau-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="level5Bar"></div>
                                </div>
                                <div class="progress-text" id="level5Percent">0%</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- √âcran de jeu -->
        <div class="screen" id="gameScreen">
            <div class="game-screen">
                <div class="game-header">
                    <div class="level-badge" id="levelBadge">Niveau 1</div>
                    <div class="progress-info">
                        <span>Carte <span id="currentCard">1</span>/<span id="totalCards">10</span></span>
                        <span>|</span>
                        <span><span id="correctAnswers">0</span> bonnes</span>
                    </div>
                </div>
                
                <div class="card-container">
                    <div class="card-keyword" id="cardKeyword" style="display: none;">
                        <div class="keyword-text" id="keywordText"></div>
                        <div class="keyword-category" id="keywordCategory"></div>
                    </div>
                    
                    <div class="question-section" id="questionSection">
                        <!-- Contenu dynamique -->
                    </div>
                    
                    <div class="hint-section" id="hintSection" style="display: none;">
                        <div id="hintText"></div>
                    </div>
                    
                    <div class="card-actions">
                        <button class="btn btn-secondary" onclick="showHint()">üí° Indice</button>
                        <button class="btn btn-primary" onclick="validateAnswer()">Valider</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- √âcran de r√©sultats -->
        <div class="screen" id="resultsScreen">
            <div class="results-screen">
                <div class="results-icon" id="resultsIcon"></div>
                <div class="results-title" id="resultsTitle"></div>
                <div class="results-score" id="resultsScore"></div>
                
                <div class="results-stats">
                    <div class="stat-item">
                        <span class="stat-value" id="correctCount">0/0</span>
                        <span class="stat-label">Bonnes r√©ponses</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="pointsEarned">+0</span>
                        <span class="stat-label">Points gagn√©s</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="bestStreak">0</span>
                        <span class="stat-label">Meilleure s√©rie</span>
                    </div>
                </div>
                
                <div class="errors-recap" id="errorsRecap" style="display: none;">
                    <h4>üìù Points √† revoir</h4>
                    <ul class="errors-list" id="errorsList"></ul>
                </div>
                
                <div class="results-actions">
                    <button class="btn btn-primary" id="nextLevelBtn" onclick="nextLevel()" style="display: none;">
                        Niveau suivant ‚Üí
                    </button>
                    <button class="btn btn-secondary" onclick="goHome()">Retour accueil</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Overlays -->
    <div class="feedback-overlay" id="feedbackOverlay">
        <div class="feedback-card" id="feedbackCard">
            <div class="feedback-icon" id="feedbackIcon"></div>
            <div class="feedback-title" id="feedbackTitle"></div>
            <div class="feedback-points" id="feedbackPoints"></div>
            <div class="feedback-explanation" id="feedbackExplanation"></div>
            <button class="btn btn-primary" onclick="nextCard()">Continuer</button>
        </div>
    </div>

    <div class="streak-popup" id="streakPopup"></div>

    <script>
        // Configuration des niveaux
        const levels = {
            1: {
                name: "Facteurs de risques",
                cards: [
                    {
                        type: "keyword",
                        keyword: "Activit√© dynamique",
                        category: "Type d'activit√©",
                        question: "Compl√©tez : Activit√© physique caract√©ris√©e par une succession de contractions et rel√¢chements musculaires",
                        answer: "activit√© dynamique",
                        hint: "Pensez au mouvement, aux d√©placements...",
                        explanation: "L'activit√© dynamique implique des mouvements r√©p√©t√©s avec alternance contraction/rel√¢chement musculaire.",
                        tip: "Se d√©placer, porter, soulever = dynamique vs maintenir une posture = statique"
                    },
                    {
                        type: "qcm",
                        question: "Quel est le seuil de p√©nibilit√© pour les vibrations transmises aux membres sup√©rieurs ?",
                        options: [
                            "5 heures par semaine",
                            "10 heures par semaine",
                            "15 heures par semaine", 
                            "20 heures par semaine"
                        ],
                        answer: 1,
                        keyword: "Vibrations",
                        hint: "C'est moins que pour la manutention manuelle...",
                        explanation: "Les vibrations sont dangereuses : 10h/semaine est le seuil de p√©nibilit√© pour les membres sup√©rieurs.",
                        tip: "Vibrations = 10h, Manutention = 20h, Contraintes posturales = 2h"
                    },
                    {
                        type: "vf",
                        question: "L'activit√© statique g√©n√®re plus de fatigue musculaire que l'activit√© dynamique.",
                        answer: true,
                        keyword: "Activit√© statique",
                        hint: "Pensez aux muscles qui restent contract√©s...",
                        explanation: "VRAI. En statique, les muscles restent contract√©s, les d√©chets s'accumulent (acide lactique) et l'oxyg√©nation est r√©duite.",
                        tip: "Station debout prolong√©e = plus fatigant que marcher"
                    },
                    {
                        type: "keyword",
                        keyword: "ITAMaMi",
                        category: "Outil d'analyse",
                        question: "Quel outil d'analyse permet d'√©tudier : Individu, T√¢che, Activit√©, Mat√©riel, Milieu ?",
                        answer: "ITAMaMi",
                        hint: "C'est un acronyme de 6 lettres...",
                        explanation: "ITAMaMi : Individu, T√¢che, Activit√©, Mat√©riel, Milieu. Outil fondamental d'analyse des situations de travail.",
                        tip: "I-T-A-Ma-Mi : m√©thode incontournable pour l'√©preuve PSE"
                    },
                    {
                        type: "qcm",
                        question: "Parmi ces facteurs, lequel N'EST PAS un facteur de risque d'activit√© physique ?",
                        options: [
                            "Port de charges de 15kg",
                            "Gestes r√©p√©titifs 8h/jour",
                            "Temp√©rature ambiante de 22¬∞C",
                            "Station debout 6h/jour"
                        ],
                        answer: 2,
                        keyword: "Facteurs de risque",
                        hint: "L'un de ces √©l√©ments est normal et sans danger...",
                        explanation: "22¬∞C est une temp√©rature normale de confort, contrairement aux autres facteurs qui sont p√©nibles.",
                        tip: "Distinguer les conditions normales des contraintes p√©nibles"
                    },
                    {
                        type: "vf",
                        question: "Les contraintes posturales deviennent p√©nibles √† partir de 2 heures par semaine.",
                        answer: true,
                        keyword: "Contraintes posturales",
                        hint: "C'est le seuil le plus bas de tous les facteurs...",
                        explanation: "VRAI. 2h/semaine pour les contraintes posturales (genoux, bras en l'air, torsions) - seuil le plus strict.",
                        tip: "Contraintes posturales = seuil le plus bas (2h) car tr√®s agressives"
                    },
                    {
                        type: "keyword",
                        keyword: "Manutention manuelle",
                        category: "Facteur de risque",
                        question: "Quel terme d√©signe le transport ou soul√®vement de charges par la force humaine seule ?",
                        answer: "manutention manuelle",
                        hint: "Oppos√© √† la manutention m√©canique...",
                        explanation: "La manutention manuelle utilise la seule force humaine, contrairement aux aides m√©caniques (transpalettes, etc.).",
                        tip: "Manuel = humain vs M√©canique = machines/outils"
                    },
                    {
                        type: "qcm",
                        question: "Pour un homme de moins de 18 ans, quelle est la charge maximale autoris√©e ?",
                        options: [
                            "15 kg",
                            "20 kg", 
                            "25 kg",
                            "30 kg"
                        ],
                        answer: 1,
                        keyword: "R√©glementation",
                        hint: "C'est moins que pour un adulte (55kg)...",
                        explanation: "20kg maximum pour un homme mineur (16-17 ans). Protection renforc√©e des jeunes travailleurs.",
                        tip: "Jeunes = 20kg max (hommes), 10kg max (femmes). Adultes = 55kg/25kg"
                    }
                ]
            },
            2: {
                name: "TMS & Pathologies", 
                cards: [
                    {
                        type: "keyword",
                        keyword: "TMS",
                        category: "Pathologie",
                        question: "Sigles d√©signant les atteintes des tissus mous autour des articulations (3 lettres)",
                        answer: "TMS",
                        hint: "Troubles... Musculo... Squelettiques...",
                        explanation: "TMS = Troubles Musculo-Squelettiques. 87% des maladies professionnelles d√©clar√©es.",
                        tip: "TMS = 1√®re cause de maladie professionnelle en France"
                    },
                    {
                        type: "qcm",
                        question: "Le syndrome du canal carpien affecte principalement :",
                        options: [
                            "Les genoux",
                            "Les poignets et mains", 
                            "Le dos et lombaires",
                            "Les √©paules"
                        ],
                        answer: 1,
                        keyword: "Canal carpien",
                        hint: "Pensez aux vibrations, au clavier...",
                        explanation: "Le canal carpien comprime le nerf m√©dian au niveau du poignet, causant fourmillements et douleurs dans la main.",
                        tip: "Canal carpien = poignet/main. Souvent li√© aux vibrations et gestes r√©p√©titifs"
                    },
                    {
                        type: "vf",
                        question: "Les TMS sont toujours reconnus comme maladies professionnelles.",
                        answer: false,
                        keyword: "Maladie professionnelle",
                        hint: "Il faut des conditions particuli√®res...",
                        explanation: "FAUX. Seuls CERTAINS TMS sont reconnus MP selon des tableaux pr√©cis (dur√©e d'exposition, d√©lai, etc.).",
                        tip: "MP = conditions strictes dans les tableaux officiels"
                    },
                    {
                        type: "keyword",
                        keyword: "Lombalgie",
                        category: "TMS vert√©bral",
                        question: "Douleur localis√©e dans le bas du dos, au niveau des vert√®bres lombaires",
                        answer: "lombalgie",
                        hint: "Lombaire + algie (douleur)...",
                        explanation: "Lombalgie = douleur lombaire. Tr√®s fr√©quente chez les travailleurs (port de charges, postures).",
                        tip: "Lombalgie = bas du dos. Cervicalgie = cou. Dorsalgie = milieu du dos"
                    },
                    {
                        type: "qcm",
                        question: "Quelle pathologie est caract√©ristique des vibrations prolong√©es ?",
                        options: [
                            "Hygroma du genou",
                            "Syndrome du canal carpien",
                            "Sciatique", 
                            "Tendinite d'Achille"
                        ],
                        answer: 1,
                        keyword: "Vibrations",
                        hint: "Pensez aux outils qui vibrent dans les mains...",
                        explanation: "Les vibrations (marteau-piqueur, cl√© √† chocs) compriment le nerf m√©dian ‚Üí canal carpien.",
                        tip: "Vibrations = mains/poignets = canal carpien (m√©caniciens, ouvriers BTP)"
                    },
                    {
                        type: "vf", 
                        question: "L'hygroma est une inflammation de la bourse s√©reuse du genou.",
                        answer: true,
                        keyword: "Hygroma",
                        hint: "Pensez aux travailleurs √† genoux...",
                        explanation: "VRAI. L'hygroma (ou bursite) est l'inflammation de la bourse s√©reuse, fr√©quent chez ceux qui travaillent √† genoux.",
                        tip: "Hygroma = genou. Fr√©quent chez carreleurs, jardiniers, etc."
                    },
                    {
                        type: "keyword",
                        keyword: "Tendinite",
                        category: "TMS",
                        question: "Inflammation des tendons souvent caus√©e par des mouvements r√©p√©titifs",
                        answer: "tendinite", 
                        hint: "Tendon + ite (inflammation)...",
                        explanation: "Tendinite = inflammation des tendons. Caus√©e par sur-sollicitation (gestes r√©p√©titifs, efforts).",
                        tip: "Tendinite = tendons enflamm√©s. Coiffe des rotateurs (√©paule) tr√®s fr√©quente"
                    },
                    {
                        type: "qcm",
                        question: "Les troubles circulatoires li√©s au travail concernent principalement :",
                        options: [
                            "Les art√®res coronaires",
                            "Les veines des jambes",
                            "Les capillaires pulmonaires",
                            "La circulation c√©r√©brale"
                        ],
                        answer: 1,
                        keyword: "Troubles circulatoires",
                        hint: "Pensez √† la station debout prolong√©e...",
                        explanation: "Station debout statique ‚Üí stagnation veineuse dans les jambes ‚Üí varices, jambes lourdes.",
                        tip: "Station debout = probl√®mes veineux jambes (varices, ≈ìd√®mes)"
                    }
                ]
            },
            3: {
                name: "Colonne vert√©brale",
                cards: [
                    {
                        type: "keyword",
                        keyword: "Disque intervert√©bral", 
                        category: "Anatomie",
                        question: "Structure situ√©e entre chaque vert√®bre, constitu√©e d'un noyau g√©latineux et d'anneaux fibreux",
                        answer: "disque intervert√©bral",
                        hint: "Il permet l'amortissement et la mobilit√©...",
                        explanation: "Le disque intervert√©bral amortit les chocs et permet la mobilit√© vert√©brale. 90% d'eau.",
                        tip: "Disque = amortisseur + articulation de la colonne"
                    },
                    {
                        type: "qcm",
                        question: "Lors de la flexion du tronc, le noyau g√©latineux :",
                        options: [
                            "Reste au centre",
                            "Est chass√© vers l'avant", 
                            "Est chass√© vers l'arri√®re",
                            "Dispara√Æt temporairement"
                        ],
                        answer: 2,
                        keyword: "Biom√©canique discale",
                        hint: "Les vert√®bres se rapprochent √† l'avant...",
                        explanation: "En flexion, le noyau est chass√© vers l'arri√®re par la pression. M√©canisme des accidents discaux.",
                        tip: "Flexion = pench√© en avant = noyau pouss√© vers l'arri√®re"
                    },
                    {
                        type: "vf",
                        question: "Les vert√®bres lombaires sont les plus volumineuses car elles portent tout le poids du corps.",
                        answer: true,
                        keyword: "Vert√®bres lombaires",
                        hint: "Pensez √† la charge qui s'accumule vers le bas...",
                        explanation: "VRAI. Les lombaires (L1 √† L5) supportent le poids de la t√™te, tronc et membres sup√©rieurs.",
                        tip: "Plus on descend, plus les vert√®bres sont grosses (charge croissante)"
                    },
                    {
                        type: "keyword",
                        keyword: "Lumbago",
                        category: "Accident discal",
                        question: "Blocage douloureux caus√© par un noyau coinc√© dans les anneaux fissur√©s",
                        answer: "lumbago",
                        hint: "'Tour de reins' en langage populaire...",
                        explanation: "Lumbago = noyau g√©latineux coinc√© dans des anneaux fibreux fissur√©s, touchant les nerfs sensitifs.",
                        tip: "Lumbago = blocage aigu. Noyau coinc√© mais pas sorti"
                    },
                    {
                        type: "qcm",
                        question: "La hernie discale se caract√©rise par :",
                        options: [
                            "Un noyau coinc√© dans les anneaux",
                            "Un noyau sorti de l'enveloppe du disque",
                            "Un noyau dispers√© dans les anneaux", 
                            "Un disque compl√®tement d√©truit"
                        ],
                        answer: 1,
                        keyword: "Hernie discale",
                        hint: "Plus grave que le lumbago...",
                        explanation: "Hernie discale = noyau sorti de l'enveloppe discale, pouvant comprimer nerfs et moelle √©pini√®re.",
                        tip: "Hernie = sortie du noyau (rupture enveloppe). Plus grave que lumbago"
                    },
                    {
                        type: "vf",
                        question: "Le nerf sciatique part de la 4√®me vert√®bre lombaire et innerve les jambes.",
                        answer: true,
                        keyword: "Nerf sciatique",
                        hint: "C'est le plus gros nerf du corps...",
                        explanation: "VRAI. Le sciatique na√Æt en L4-L5, descend dans la fesse et la jambe. Compression = sciatique.",
                        tip: "Sciatique = L4-L5 vers jambe. Douleur trajet nerf"
                    },
                    {
                        type: "keyword",
                        keyword: "Tassement discal",
                        category: "Accident discal",
                        question: "Accident o√π le noyau √©clate et se disperse dans les anneaux, causant un rapprochement des vert√®bres",
                        answer: "tassement discal",
                        hint: "Le disque perd sa hauteur...",
                        explanation: "Tassement = destruction du noyau dispers√© dans les anneaux ‚Üí perte hauteur discale ‚Üí vert√®bres se rapprochent.",
                        tip: "Tassement = disque aplati/√©cras√©. Souvent li√© au vieillissement"
                    },
                    {
                        type: "qcm",
                        question: "Les courbures naturelles de la colonne vert√©brale (lordoses/cyphoses) servent √† :",
                        options: [
                            "Am√©liorer l'esth√©tique",
                            "Augmenter la r√©sistance m√©canique",
                            "Faciliter la circulation sanguine",
                            "R√©duire la taille"
                        ],
                        answer: 1,
                        keyword: "Courbures vert√©brales",
                        hint: "Pensez √† la solidit√©...",
                        explanation: "Les courbures (S vert√©bral) rendent la colonne plus solide qu'une tige droite. R√©partition des contraintes.",
                        tip: "Courbures = solidit√©. Colonne droite = plus fragile"
                    }
                ]
            },
            4: {
                name: "Pr√©vention & Solutions",
                cards: [
                    {
                        type: "keyword",
                        keyword: "PRAP",
                        category: "Formation",
                        question: "Formation aux techniques gestuelles et postures (4 lettres)",
                        answer: "PRAP",
                        hint: "Pr√©vention des Risques li√©s √† l'Activit√©...",
                        explanation: "PRAP = Pr√©vention des Risques li√©s √† l'Activit√© Physique. Formation obligatoire gestes et postures.",
                        tip: "PRAP = formation gestes/postures. PRAP IBC (industrie) et PRAP 2S (sanitaire/social)"
                    },
                    {
                        type: "qcm",
                        question: "Selon les principes g√©n√©raux de pr√©vention, quelle mesure est PRIORITAIRE ?",
                        options: [
                            "Formation aux gestes et postures",
                            "Port d'√©quipements de protection",
                            "Suppression/r√©duction du risque √† la source", 
                            "Surveillance m√©dicale renforc√©e"
                        ],
                        answer: 2,
                        keyword: "Hi√©rarchie pr√©vention",
                        hint: "Il faut √©liminer le danger plut√¥t que s'en prot√©ger...",
                        explanation: "1er principe : supprimer/r√©duire le risque. Puis protection collective, puis individuelle, puis formation.",
                        tip: "Hi√©rarchie : 1)Suppression 2)Collectif 3)Individuel 4)Formation"
                    },
                    {
                        type: "vf",
                        question: "Il est recommand√© de privil√©gier la manutention m√©canique √† la manutention manuelle.",
                        answer: true,
                        keyword: "Manutention m√©canique",
                        hint: "Le Code du travail est clair l√†-dessus...",
                        explanation: "VRAI. Code du travail : privil√©gier les aides m√©caniques (transpalettes, ponts roulants, etc.).",
                        tip: "M√©canique > Manuel. Loi impose de r√©duire l'effort humain"
                    },
                    {
                        type: "keyword",
                        keyword: "Transpalette",
                        category: "Aide m√©canique",
                        question: "√âquipement de manutention sur roues permettant de d√©placer des palettes",
                        answer: "transpalette",
                        hint: "Trans-porter des palettes...",
                        explanation: "Le transpalette √©limine le port manuel des charges lourdes. Existe en version manuelle ou √©lectrique.",
                        tip: "Transpalette = solution n¬∞1 pour √©liminer le port de charges"
                    },
                    {
                        type: "qcm",
                        question: "L'am√©nagement ergonomique d'un poste de travail debout n√©cessite :",
                        options: [
                            "Une hauteur de plan fixe",
                            "Une hauteur ajustable selon les t√¢ches",
                            "Le port de chaussures √† talons",
                            "Une position statique parfaite"
                        ],
                        answer: 1,
                        keyword: "Ergonomie",
                        hint: "Travail de pr√©cision ‚â† travail de force...",
                        explanation: "Hauteur ajustable : haute pour pr√©cision (proche des yeux), basse pour efforts (force des bras).",
                        tip: "Ergonomie = adaptation du travail √† l'homme, pas l'inverse"
                    },
                    {
                        type: "vf",
                        question: "La formation PRAP peut remplacer l'achat d'√©quipements de manutention.",
                        answer: false,
                        keyword: "Limites formation",
                        hint: "Pensez √† la hi√©rarchie des mesures...",
                        explanation: "FAUX. La formation ne peut pas remplacer la suppression du risque. PRAP = compl√©ment, pas substitut.",
                        tip: "Formation seule = insuffisante. Il faut d'abord supprimer/r√©duire le risque"
                    },
                    {
                        type: "keyword",
                        keyword: "L√®ve-malade",
                        category: "Aide technique",
                        question: "√âquipement permettant de transf√©rer les personnes √† mobilit√© r√©duite",
                        answer: "l√®ve-malade",
                        hint: "√âvite la manutention manuelle des patients...",
                        explanation: "Le l√®ve-malade √©limine les transferts manuels de patients, pr√©venant les TMS des soignants.",
                        tip: "L√®ve-malade = indispensable secteur sanitaire/social (PRAP 2S)"
                    },
                    {
                        type: "qcm",
                        question: "Pour soulever une charge, la technique recommand√©e est :",
                        options: [
                            "Dos rond, jambes tendues",
                            "Dos droit, jambes fl√©chies",
                            "Dos en arri√®re, bras tendus",
                            "Dos pench√©, genoux bloqu√©s"
                        ],
                        answer: 1,
                        keyword: "Technique de soul√®vement",
                        hint: "Utiliser la force des jambes, pas du dos...",
                        explanation: "Dos droit pour pr√©server la colonne, jambes fl√©chies pour utiliser la force des cuisses (muscles les plus puissants).",
                        tip: "Dos droit + jambes fl√©chies = technique de base PRAP"
                    }
                ]
            },
            5: {
                name: "Expertise compl√®te",
                cards: [
                    {
                        type: "qcm",
                        question: "Une entreprise h√©site entre formation PRAP (500‚Ç¨) et achat transpalettes (3000‚Ç¨). L'argument d√©cisif pour les transpalettes ?",
                        options: [
                            "Le co√ªt sera rentabilis√© en 2 ans",
                            "La suppression du risque prime sur la protection",
                            "Les salari√©s pr√©f√®rent les √©quipements",
                            "C'est plus moderne et technologique"
                        ],
                        answer: 1,
                        keyword: "Argumentation pr√©vention",
                        hint: "Principe fondamental des mesures de pr√©vention...",
                        explanation: "Argument l√©gal : les principes g√©n√©raux imposent de supprimer le risque avant de former √† le g√©rer.",
                        tip: "Argumentation PSE = s'appuyer sur les principes r√©glementaires"
                    },
                    {
                        type: "keyword",
                        keyword: "Troubles psychosociaux",
                        category: "Facteur aggravant",
                        question: "Risques li√©s au stress, harc√®lement, qui peuvent aggraver les TMS",
                        answer: "troubles psychosociaux",
                        hint: "RPS en abr√©g√©...",
                        explanation: "Les RPS (stress, harc√®lement) augmentent les tensions musculaires et aggravent les TMS.",
                        tip: "Approche globale TMS : facteurs physiques + organisationnels + psychosociaux"
                    },
                    {
                        type: "vf",
                        question: "Un taux de TMS de 40/100 salari√©s dans un secteur n√©cessite une intervention prioritaire.",
                        answer: true,
                        keyword: "√âvaluation du risque",
                        hint: "La moyenne nationale est autour de 10/100...",
                        explanation: "VRAI. 40/100 = 4 fois la moyenne nationale (10%). Situation critique n√©cessitant action imm√©diate.",
                        tip: "Analyse par taux relatif plus pertinente que valeurs absolues"
                    },
                    {
                        type: "qcm",
                        question: "Dans l'outil ITAMaMi, un salari√© de 45 ans avec mal de dos correspond √† quel √©l√©ment ?",
                        options: [
                            "T√¢che",
                            "Activit√©", 
                            "Individu",
                            "Milieu"
                        ],
                        answer: 2,
                        keyword: "ITAMaMi expert",
                        hint: "Caract√©ristiques personnelles du travailleur...",
                        explanation: "I = Individu (√¢ge, exp√©rience, √©tat de sant√©). Le mal de dos est une caract√©ristique de la personne.",
                        tip: "ITAMaMi : I=personne, T=mission, A=gestes, Ma=outils, Mi=environnement"
                    },
                    {
                        type: "vf",
                        question: "Les accidents discaux sont irr√©versibles chez l'adulte car le disque n'est plus vascularis√©.",
                        answer: true,
                        keyword: "Physiopathologie discale",
                        hint: "√Ä la fin de la croissance...",
                        explanation: "VRAI. Apr√®s la croissance, le disque n'est plus aliment√© par le sang ‚Üí l√©sions irr√©versibles.",
                        tip: "Disque adulte = pas de r√©paration possible. D'o√π importance pr√©vention"
                    },
                    {
                        type: "keyword",
                        keyword: "M√©thode d'analyse",
                        category: "Comp√©tence CAP",
                        question: "En CAP, C2 demande d'appliquer une ... (vs d√©marche en Bac Pro)",
                        answer: "m√©thode d'analyse",
                        hint: "CAP plus guid√© que Bac Pro...",
                        explanation: "CAP C2 = m√©thode (guid√©e), Bac Pro C2 = d√©marche (autonome). Progression p√©dagogique.",
                        tip: "CAP = m√©thode guid√©e. Bac Pro = d√©marche autonome"
                    },
                    {
                        type: "qcm",
                        question: "Pour un diagnostic TMS d'entreprise, quelle donn√©e est la plus pertinente ?",
                        options: [
                            "Le nombre total de TMS d√©clar√©s", 
                            "Le taux de TMS par secteur d'activit√©",
                            "L'anciennet√© moyenne des salari√©s",
                            "Le chiffre d'affaires de l'entreprise"
                        ],
                        answer: 1,
                        keyword: "Diagnostic expert TMS",
                        hint: "Il faut pond√©rer par les effectifs...",
                        explanation: "Le taux (TMS/effectif) permet de comparer les secteurs et identifier les priorit√©s d'action.",
                        tip: "Diagnostic expert = analyser les taux relatifs, pas les valeurs absolues"
                    },
                    {
                        type: "keyword",
                        keyword: "Expliquer",
                        category: "Comp√©tence Bac Pro",
                        question: "Comp√©tence C3 Bac Pro : ... un ph√©nom√®ne (vs 'mettre en relation' en CAP)",
                        answer: "expliquer",
                        hint: "Plus d'autonomie et d'abstraction qu'en CAP...",
                        explanation: "Bac Pro C3 = expliquer (comprendre et justifier), CAP C3 = mettre en relation (plus simple).",
                        tip: "Bac Pro = expliquer les m√©canismes. CAP = faire des liens"
                    }
                ]
            }
        };

        // Variables globales
        let currentLevel = 1;
        let currentCardIndex = 0;
        let levelCorrect = 0;
        let levelPoints = 0; 
        let totalPoints = parseInt(localStorage.getItem('pse-c10-points') || '0');
        let currentStreak = 0;
        let bestStreak = 0;
        let hintUsed = false;
        let levelErrors = [];
        let levelProgress = {
            1: parseInt(localStorage.getItem('pse-c10-level1') || '0'),
            2: parseInt(localStorage.getItem('pse-c10-level2') || '0'), 
            3: parseInt(localStorage.getItem('pse-c10-level3') || '0'),
            4: parseInt(localStorage.getItem('pse-c10-level4') || '0'),
            5: parseInt(localStorage.getItem('pse-c10-level5') || '0')
        };

        function startLevel(level) {
            currentLevel = level;
            currentCardIndex = 0;
            levelCorrect = 0;
            levelPoints = 0;
            levelErrors = [];
            
            document.getElementById('homeScreen').classList.remove('active');
            document.getElementById('gameScreen').classList.add('active');
            
            document.getElementById('levelBadge').textContent = `Niveau ${level} - ${levels[level].name}`;
            document.getElementById('totalCards').textContent = levels[level].cards.length;
            document.getElementById('currentCard').textContent = '1';
            document.getElementById('correctAnswers').textContent = '0';
            
            showCard();
        }
        
        function showCard() {
            const card = levels[currentLevel].cards[currentCardIndex];
            hintUsed = false;
            document.getElementById('hintSection').style.display = 'none';
            
            document.getElementById('currentCard').textContent = currentCardIndex + 1;
            
            const keywordSection = document.getElementById('cardKeyword');
            const questionSection = document.getElementById('questionSection');
            
            if (card.type === 'keyword') {
                keywordSection.style.display = 'block';
                document.getElementById('keywordText').textContent = card.keyword;
                document.getElementById('keywordCategory').textContent = card.category;
                
                questionSection.innerHTML = `
                    <p class="question-text">${card.question}</p>
                    <input type="text" class="keyword-input" id="keywordAnswer" placeholder="Tapez votre r√©ponse...">
                `;
            }
            else {
                keywordSection.style.display = 'none';
            }
            
            if (card.type === 'qcm') {
                let optionsHTML = card.options.map((opt, i) => `
                    <button class="option-btn" data-index="${i}" onclick="selectOption(this)">
                        <span class="option-letter">${String.fromCharCode(65 + i)}</span>
                        <span>${opt}</span>
                    </button>
                `).join('');
                
                questionSection.innerHTML = `
                    <p class="question-text">${card.question}</p>
                    <div class="options-container">${optionsHTML}</div>
                `;
            }
            else if (card.type === 'vf') {
                questionSection.innerHTML = `
                    <p class="question-text">${card.question}</p>
                    <div class="vf-container">
                        <button class="vf-btn vrai" onclick="selectVF(this, true)">‚úì VRAI</button>
                        <button class="vf-btn faux" onclick="selectVF(this, false)">‚úó FAUX</button>
                    </div>
                `;
            }
        }
        
        function selectOption(btn) {
            document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
        }
        
        function selectVF(btn, value) {
            document.querySelectorAll('.vf-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            btn.dataset.value = value;
        }
        
        function showHint() {
            const card = levels[currentLevel].cards[currentCardIndex];
            if (card.hint) {
                document.getElementById('hintText').innerHTML = `üí° <strong>Indice :</strong> ${card.hint}`;
                document.getElementById('hintSection').style.display = 'block';
                hintUsed = true;
            }
        }
        
        function validateAnswer() {
            const card = levels[currentLevel].cards[currentCardIndex];
            let isCorrect = false;
            let userAnswer = '';
            
            if (card.type === 'keyword') {
                userAnswer = document.getElementById('keywordAnswer').value.trim().toLowerCase();
                // Normaliser (accents, etc.)
                const normalize = str => str.normalize('NFD').replace(/[\u0300-\u036f]/g, '').toLowerCase();
                isCorrect = normalize(userAnswer) === normalize(card.answer) || 
                            userAnswer.includes(normalize(card.answer)) ||
                            normalize(card.answer).includes(userAnswer);
            }
            else if (card.type === 'qcm') {
                const selected = document.querySelector('.option-btn.selected');
                if (!selected) { alert('S√©lectionne une r√©ponse'); return; }
                userAnswer = parseInt(selected.dataset.index);
                isCorrect = userAnswer === card.answer;
            }
            else if (card.type === 'vf') {
                const selected = document.querySelector('.vf-btn.selected');
                if (!selected) { alert('S√©lectionne VRAI ou FAUX'); return; }
                userAnswer = selected.dataset.value === 'true';
                isCorrect = userAnswer === card.answer;
            }
            
            showFeedback(isCorrect, card);
        }
        
        function showFeedback(isCorrect, card) {
            const overlay = document.getElementById('feedbackOverlay');
            const feedbackCard = document.getElementById('feedbackCard');
            
            let points = 0;
            if (isCorrect) {
                points = hintUsed ? 5 : 10;
                levelCorrect++;
                currentStreak++;
                if (currentStreak > bestStreak) bestStreak = currentStreak;
                
                // Streak bonus
                if (currentStreak === 3) showStreakPopup('üî• 3 de suite !');
                else if (currentStreak === 5) showStreakPopup('üî•üî• 5 de suite !');
                else if (currentStreak === 10) showStreakPopup('üî•üî•üî• INCROYABLE !');
            } else {
                currentStreak = 0;
                levelErrors.push(card.keyword || card.question.replace(/<[^>]*>/g, '').substring(0, 50) + '...');
            }
            
            levelPoints += points;
            totalPoints += points;
            updateScoreDisplay();
            
            feedbackCard.className = 'feedback-card ' + (isCorrect ? 'correct' : 'incorrect');
            document.getElementById('feedbackIcon').textContent = isCorrect ? '‚úÖ' : '‚ùå';
            document.getElementById('feedbackTitle').textContent = isCorrect ? 
                (currentStreak >= 3 ? 'Excellent ! üî•' : 'Bravo !') : 'Pas tout √† fait...';
            document.getElementById('feedbackPoints').textContent = isCorrect ? `+${points} points` : '0 point';
            document.getElementById('feedbackPoints').style.display = isCorrect ? 'block' : 'none';
            
            document.getElementById('feedbackExplanation').innerHTML = `
                <h4>üìö Explication</h4>
                <p>${card.explanation}</p>
                <div class="keyword-box">üîë <span>${card.keyword}</span></div>
                ${card.tip ? `<div class="tip-box"><h5>üí° Astuce BAC</h5><p>${card.tip}</p></div>` : ''}
            `;
            
            overlay.classList.add('visible');
        }
        
        function showStreakPopup(text) {
            const popup = document.getElementById('streakPopup');
            popup.textContent = text;
            popup.style.display = 'block';
            setTimeout(() => { popup.style.display = 'none'; }, 1500);
        }
        
        function nextCard() {
            document.getElementById('feedbackOverlay').classList.remove('visible');
            currentCardIndex++;
            
            if (currentCardIndex >= levels[currentLevel].cards.length) {
                showResults();
            } else {
                showCard();
            }
        }
        
        function showResults() {
            const total = levels[currentLevel].cards.length;
            const percent = Math.round((levelCorrect / total) * 100);
            
            levelProgress[currentLevel] = Math.max(levelProgress[currentLevel], percent);
            localStorage.setItem(`pse-c10-level${currentLevel}`, levelProgress[currentLevel]);
            localStorage.setItem('pse-c10-points', totalPoints);
            
            document.getElementById('gameScreen').classList.remove('active');
            document.getElementById('resultsScreen').classList.add('active');
            
            document.getElementById('resultsIcon').textContent = percent >= 80 ? 'üéâ' : percent >= 50 ? 'üëç' : 'üí™';
            document.getElementById('resultsTitle').textContent = percent >= 80 ? 'Niveau r√©ussi !' : percent >= 50 ? 'Pas mal !' : 'Continue !';
            document.getElementById('resultsScore').textContent = percent + '%';
            document.getElementById('correctCount').textContent = levelCorrect + '/' + total;
            document.getElementById('pointsEarned').textContent = '+' + levelPoints;
            document.getElementById('bestStreak').textContent = bestStreak;
            
            // Erreurs
            const errorsRecap = document.getElementById('errorsRecap');
            if (levelErrors.length > 0) {
                errorsRecap.style.display = 'block';
                document.getElementById('errorsList').innerHTML = levelErrors.map(e => `<li>${e}</li>`).join('');
            } else {
                errorsRecap.style.display = 'none';
            }
            
            // Confettis si r√©ussi
            if (percent >= 80) {
                createConfetti();
            }
            
            // Bouton niveau suivant
            document.getElementById('nextLevelBtn').style.display = (currentLevel < 5 && percent >= 60) ? 'flex' : 'none';
            
            updateHomeProgress();
        }
        
        function createConfetti() {
            const colors = ['#ff9a56', '#fecfef', '#ffd1ff', '#84fab0', '#8fd3f4', '#FFD700'];
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 2 + 's';
                confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                document.body.appendChild(confetti);
                setTimeout(() => confetti.remove(), 3000);
            }
        }
        
        function goHome() {
            document.getElementById('resultsScreen').classList.remove('active');
            document.getElementById('gameScreen').classList.remove('active');
            document.getElementById('homeScreen').classList.add('active');
            updateHomeProgress();
        }
        
        function nextLevel() {
            if (currentLevel < 5) {
                startLevel(currentLevel + 1);
                document.getElementById('resultsScreen').classList.remove('active');
            }
        }
        
        function updateScoreDisplay() {
            document.getElementById('totalPoints').textContent = totalPoints;
            document.getElementById('currentStreak').textContent = currentStreak;
            document.getElementById('correctAnswers').textContent = levelCorrect;
        }
        
        function updateHomeProgress() {
            for (let i = 1; i <= 5; i++) {
                document.getElementById(`level${i}Percent`).textContent = levelProgress[i] + '%';
                document.getElementById(`level${i}Bar`).style.width = levelProgress[i] + '%';
            }
        }
        
        // Init
        updateScoreDisplay();
        updateHomeProgress();
    </script>
</body>
</html>