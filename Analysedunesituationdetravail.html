<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"/>
<title>Module 1 : Ergonomie ‚Äì Analyse d‚Äôune situation de travail</title>

<style>
  :root{
    --bg:#0f172a; --text:#f1f5f9;
    --accent:#6366f1;
    --success:#10b981;
    --warn:#f59e0b;
    --card-bg: rgba(30, 41, 59, 0.98);
    --slot-bg: rgba(99, 102, 241, 0.2);

    --op-color: #3b82f6;
    --ent-color: #a3e635;

    --font-ui: system-ui, -apple-system, sans-serif;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:var(--font-ui); color:var(--text);
    background:var(--bg); padding:10px; padding-bottom:80px;
    background-image: radial-gradient(circle at 50% 0%, #1e293b 0%, #020617 80%);
    background-attachment: fixed;
    user-select: none;
    overflow-x: hidden;
  }

  .wrap{max-width:800px; margin:0 auto; min-height: 90vh; display:flex; flex-direction:column;}

  .header-zone{
    display:flex; align-items:center; gap:15px;
    background: var(--card-bg); padding: 15px; border-radius: 16px;
    border: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px;
    position: relative; z-index: 10;
  }
  .avatar-circle{
    width: 60px; height: 60px; border-radius: 50%;
    border: 3px solid var(--accent); object-fit: cover;
    background: #0f172a; flex-shrink: 0;
  }
  .coach-bubble{ font-size: 0.95rem; color: #e2e8f0; line-height: 1.4; }

  .page-section{ display:none; animation: fadeIn 0.5s; }
  .page-section.active{ display:block; }

  .login-box{ text-align:center; padding: 40px 20px; }

  .doc-container{
    background: white; color: #334155; padding: 20px; border-radius: 12px;
    line-height: 1.6; font-size: 0.95rem; text-align: justify;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2); margin-bottom: 20px;
    border-left: 5px solid var(--accent);
  }
  .doc-title{ font-weight: 900; color: var(--accent); text-transform: uppercase; margin-bottom: 10px; display:block; }

  .clickable-text{ font-size: 0.9rem; line-height: 1.8; color: #334155; }
  .word-target{
    border-bottom: 2px solid #cbd5e1; cursor: pointer; padding: 0 2px;
    transition: 0.2s; background: rgba(0,0,0,0.05); border-radius: 3px;
    font-weight: 600; color: #1e293b;
  }
  .word-target.active-selection{
    background: #6366f1; color: white; border-bottom: 2px solid white;
    box-shadow: 0 0 10px rgba(99, 102, 241, 0.5);
    transform: scale(1.1); display:inline-block;
  }
  .word-target.found{
    background: transparent; color: #94a3b8; border-color: transparent;
    pointer-events: none; text-decoration: line-through;
  }

  .results-grid{ display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-top:20px; }
  .res-col{
    background:#f8fafc; border-radius:10px; padding:10px;
    border:2px dashed #cbd5e1; min-height:150px; cursor:pointer;
    transition:0.2s; position:relative;
  }
  .res-col:active{ transform:scale(0.98); }
  .res-header{
    text-align:center; font-weight:900; text-transform:uppercase; font-size:0.8rem;
    padding-bottom:8px; margin-bottom:8px; border-bottom:2px solid;
    pointer-events:none;
  }
  .res-list{ list-style:none; padding:0; margin:0; font-size:0.8rem; color:#334155; }
  .res-item{ padding:4px 0; border-bottom:1px dashed #cbd5e1; animation: popIn 0.3s; font-weight:bold; }

  .quiz-row{
    background:white; padding:12px; border-radius:8px; margin-bottom:10px;
    display:flex; flex-direction:column; gap:8px;
    border:1px solid #e2e8f0; box-shadow:0 2px 4px rgba(0,0,0,0.05);
  }
  .quiz-header-obs{ font-size:0.7rem; text-transform:uppercase; color:#94a3b8; font-weight:bold; margin-bottom:-5px; }
  .quiz-question{ font-weight:700; color:#1e293b !important; font-size:1rem; }
  .quiz-options{ display:flex; gap:10px; }
  .quiz-btn{
    flex:1; padding:10px; border:2px solid #cbd5e1; border-radius:6px;
    background:#f8fafc; color:#64748b; font-weight:bold;
    cursor:pointer; text-align:center; transition:0.2s;
  }
  .quiz-btn.correct{ background: var(--success); border-color: var(--success); color:white; }
  .quiz-btn.wrong{ background:#ef4444; border-color:#ef4444; color:white; }

  .schema-container{
    position:relative; background:#f8fafc; padding:10px; border-radius:12px;
    min-height:400px; display:flex; flex-direction:column; justify-content:space-between;
  }
  .schema-level{ display:flex; justify-content:space-around; position:relative; z-index:2; gap:10px; }
  .s-box{
    background:white; border:2px solid #cbd5e1; border-radius:8px; padding:8px;
    width:48%; text-align:center; font-size:0.75rem; cursor:pointer; transition:0.3s;
    box-shadow:0 4px 6px rgba(0,0,0,0.1);
    display:flex; flex-direction:column; justify-content:center; color:#334155; min-height:60px;
  }
  .s-box strong{ display:block; font-size:0.6rem; text-transform:uppercase; color:#64748b; margin-bottom:4px; }
  .s-box.active-step{ border-color:#ec4899; box-shadow:0 0 15px rgba(236, 72, 153, 0.4); transform:scale(1.02); }
  .s-box.validated{ background:#fce7f3; border-color:#db2777; color:#831843; }
  .s-box.disabled{ opacity:0.5; pointer-events:none; }
  .arrows-svg{ position:absolute; top:0; left:0; width:100%; height:100%; z-index:1; pointer-events:none; }
  .arrow-path{ fill:none; stroke:#db2777; stroke-width:3; opacity:0; transition:opacity 0.5s; marker-end:url(#arrowhead); }
  .arrow-path.visible{ opacity:1; }

  .prev-table{ display:grid; gap:10px; }
  .prev-row{ background:white; padding:10px; border-radius:8px; display:flex; flex-direction:column; gap:5px; }
  .prev-label{ font-weight:bold; font-size:0.8rem; text-transform:uppercase; color:#334155; }
  .prev-drop-zone{
    background:#f1f5f9; border:2px dashed #cbd5e1; border-radius:6px;
    min-height:50px; display:flex; align-items:center; justify-content:center;
    padding:5px; font-size:0.8rem; text-align:center; color:#94a3b8;
  }
  .prev-drop-zone.filled{ background:#dcfce7; border-color:#16a34a; color:#166534; border-style:solid; font-weight:bold; }
  .prev-option{
    background:#3b82f6; color:white; padding:8px; border-radius:6px;
    font-size:0.8rem; margin:5px; cursor:pointer; text-align:center;
    box-shadow:0 2px 4px rgba(0,0,0,0.2);
  }
  .prev-option.selected{ transform:scale(1.05); background:#2563eb; ring:2px solid white; }

  .final-quiz-card{
    background: var(--card-bg); padding:20px; border-radius:12px;
    border:1px solid rgba(255,255,255,0.1); margin-bottom:15px;
  }
  .final-q-text{ font-size:1.1rem; font-weight:bold; margin-bottom:15px; color:white; }
  .final-opt-btn{
    display:block; width:100%; padding:12px; margin-bottom:10px;
    background:#334155; border:2px solid transparent; border-radius:8px;
    color:#f1f5f9; text-align:left; cursor:pointer; transition:0.2s;
  }
  .final-opt-btn.correct{ background: var(--success); border-color:#065f46; }
  .final-opt-btn.wrong{ background:#ef4444; border-color:#991b1b; opacity:0.7; }

  .memo-card{
    background:#ecfccb; color:#365314; padding:20px; border-radius:12px;
    border:2px solid #84cc16; margin-top:20px; display:none; animation: popIn 0.5s;
  }
  .btn-nav{
    padding:10px 15px; background:#334155; color:white; border:none; border-radius:8px;
    cursor:pointer; font-size:0.9rem; font-weight:bold;
  }
  .btn-next{ background: var(--success); flex-grow:1; display:none; }
  .btn-reset{ background:#f59e0b; color:#fff; }
  .action-bar{ display:flex; gap:10px; margin-top:20px; justify-content:space-between; }

  .slot{
    display:inline-block; min-width:80px; border-bottom:2px solid var(--accent);
    background: var(--slot-bg); margin:0 4px; cursor:pointer; color:var(--accent);
    font-weight:bold; padding:0 5px;
  }
  .slot.filled{ border-bottom:2px solid var(--success); color:#1e293b; background:#dcfce7; }
  .dock{
    display:flex; flex-wrap:wrap; gap:10px; justify-content:center;
    background: rgba(30,41,59,0.95); padding:15px; border-radius:12px; margin-top:auto;
  }
  .tag{ background:#475569; color:white; padding:10px 15px; border-radius:8px; cursor:pointer; }
  .tag.selected{ background: var(--accent); transform:scale(1.05); }
  .tag.hidden{ display:none; }

  .footer{
    text-align:center; color:#64748b; font-size:0.8rem; margin-top:20px; font-style: italic;
  }

  .confetti{ position:fixed; width:10px; height:10px; background-color:#f00; animation: fall linear forwards; z-index:9999; top:-10px; }
  @keyframes fall{ to{ transform: translateY(100vh) rotate(720deg);} }
  @keyframes popIn{ from{ transform: scale(0.8); opacity:0;} to{ transform: scale(1); opacity:1;} }
  @keyframes fadeIn{ from{ opacity:0;} to{ opacity:1;} }
</style>
</head>

<body>
<div class="wrap">

  <div class="header-zone">
    <img src="avatar-neutral.png" class="avatar-circle" id="coachImg" onerror="this.src='https://placehold.co/60?text=Prof'">
    <div class="coach-bubble" id="coachText">Bonjour ! Pr√™t pour la PSE ?</div>
  </div>

  <!-- PAGE 0 : Accueil RGPD -->
  <div id="page0" class="page-section active">
    <div class="login-box">
      <h1 style="color:white; margin-bottom:8px;">Ergonomie ‚Äì Analyse d‚Äôune situation de travail</h1>

      <div style="max-width:620px; margin:0 auto; text-align:left; background:rgba(99,102,241,0.12); border:1px solid rgba(99,102,241,0.35); padding:14px; border-radius:12px;">
        <div style="font-weight:900; color:#e2e8f0; margin-bottom:6px;">Avant de commencer</div>
        <div style="color:#cbd5e1; line-height:1.5; font-size:0.95rem;">
          Identifie-toi uniquement avec ton code √©l√®ve.
          Aucune donn√©e personnelle n‚Äôest demand√©e ni enregistr√©e sur cette page.
        </div>
      </div>

      <button class="btn-nav btn-next" style="display:block; width:100%; margin:16px auto 0;" onclick="startModule()">
        Commencer
      </button>
    </div>

    <div class="footer">√âdition Foucher</div>
  </div>

  <!-- PAGE 1 : Objectif (√™tre capable de) -->
  <div id="page1" class="page-section">
    <div style="background:linear-gradient(135deg, rgba(30,41,59,0.9), rgba(15,23,42,0.95)); padding:30px; border-radius:20px; text-align:center; border:1px solid var(--accent);">
      <h1 style="color:white; margin-bottom:10px;">L‚Äôanalyse d‚Äôune situation de travail</h1>
      <div style="font-size:3rem; margin:20px 0;">‚öôÔ∏èüõ°Ô∏è</div>
      <div style="background:rgba(99,102,241,0.1); border-left:4px solid var(--accent); padding:20px; text-align:left; border-radius:8px;">
        <strong style="color:var(--accent); display:block; margin-bottom:6px;">OBJECTIF</strong>
        <p style="color:#e2e8f0; font-weight:600; margin:0;">
          √ätre capable d‚Äôanalyser une situation de travail comportant une activit√© physique afin de proposer des mesures de pr√©vention.
        </p>
      </div>
      <button class="btn-nav btn-next" style="display:block; width:100%; margin-top:14px;" onclick="goToPage(2)">Commencer</button>
    </div>
    <div class="footer">√âdition Foucher</div>
  </div>

  <div id="page2" class="page-section">
    <div class="doc-container">
      <span class="doc-title">DOC. L‚Äôergonomie et ses applications</span>
      <p>L‚Äôergonomie est une <span class="slot" data-ans="1" onclick="handleSlot(this)">...</span> qui analyse le <span class="slot" data-ans="2" onclick="handleSlot(this)">...</span> en activit√© professionnelle.</p>
      <p>La notion d‚Äô<span class="slot" data-ans="3" onclick="handleSlot(this)">...</span> concerne <span class="slot" data-ans="4" onclick="handleSlot(this)">...</span> qui agit pour am√©liorer une situation de travail.</p>
    </div>

    <div id="memoErgo" class="memo-card">
      <span style="font-weight:900; text-transform:uppercase;">üí° Ce qu‚Äôil faut retenir</span>
      <p style="margin:5px 0;">L‚Äôergonomie est centr√©e sur <strong>l‚Äôactivit√© de travail de l‚Äôop√©rateur</strong>.<br>Elle vise √† am√©liorer les conditions de travail (s√©curit√©, rendement, qualit√©).</p>
    </div>

    <div class="dock" id="dock2"></div>

    <div class="action-bar">
      <button class="btn-nav" onclick="goToPage(1)">‚¨Ö Retour</button>
      <button class="btn-nav btn-reset" onclick="initPage2()">üîÑ Recommencer</button>
      <button class="btn-nav btn-next" id="btnPage2" onclick="goToPage(3)">Suivant ‚û°</button>
    </div>
  </div>

  <div id="page3" class="page-section">
    <h3 style="color:white; border-bottom:2px solid var(--accent); padding-bottom:10px;">La situation de Cl√©ment</h3>
    <div class="doc-container" style="max-height:60vh; overflow-y:auto;">
      <p>Embauch√© depuis quatre ans dans l‚Äôentreprise G., Cl√©ment, 43 ans, 1,65 m, droitier, est au poste de poin√ßonnage depuis huit mois. Chaque jour, pendant 7 heures, il doit poin√ßonner des plaques m√©talliques de dimensions diff√©rentes, dont la superficie est comprise entre 1 m¬≤ et 1,5 m¬≤, soit 8 √† 10 kg la plaque.</p>
      <p>Tout d‚Äôabord, √† l‚Äôaide des deux mains, il saisit une plaque situ√©e sur une palette, bras et jambes tendus, dos courb√©, puis il se redresse, pivote en exer√ßant une torsion du buste et se d√©place de 5 m en portant la plaque bras tendus et lev√©s au-dessus des √©paules.</p>
      <p>Il d√©pose la plaque √† l‚Äôhorizontale sur la table de la poin√ßonneuse, bras tendus et lev√©s au-dessus des √©paules, puis il se penche, dos courb√©, vers l‚Äôavant.</p>
      <p>√Ä l‚Äôaide de la p√©dale, il exerce une pression du pied pour desserrer la plaque pr√©c√©dente qui a √©t√© poin√ßonn√©e, la tire puis la soul√®ve, bras tendus et lev√©s au-dessus des √©paules, dos courb√© vers l‚Äôarri√®re, pivote en exer√ßant une torsion du buste et se d√©place de 5 m pour d√©poser la plaque poin√ßonn√©e sur une palette, bras et jambes tendus.</p>
      <p>Il marche sans charge et revient vers la plaque √† poin√ßonner qu‚Äôil pousse √† l‚Äôaide des deux mains, bras tendus, buste allong√© sur la table afin qu‚Äôelle atteigne la but√©e. Il serre la plaque √† l‚Äôaide de la p√©dale en exer√ßant une pression du pied, puis se d√©place vers la commande. √Ä l‚Äôaide de la main droite, il active le programme de poin√ßonnage √† l‚Äôorigine de sons impulsionnels.</p>
      <p>√Ä la fin de la journ√©e, il ressent parfois des douleurs aux √©paules et au dos, ainsi que des bourdonnements d‚Äôoreilles. Il reconna√Æt ne pas toujours porter ses bouchons d‚Äôoreilles ou le casque anti-bruit que l‚Äôentreprise met √† sa disposition. L‚Äôentreprise met √©galement √† disposition des gants, des v√™tements de travail et des chaussures de s√©curit√©. Elle est en effet soucieuse de prot√©ger la sant√© de ses salari√©s et de diminuer le nombre d‚Äôaccidents du travail.</p>
      <p>Cl√©ment est satisfait de son travail. Il souhaite √©voluer dans l‚Äôentreprise et se former √† un autre poste plus complexe.</p>
    </div>
    <div class="action-bar">
      <button class="btn-nav" onclick="goToPage(2)">‚¨Ö Retour</button>
      <button class="btn-nav btn-next" style="display:block" onclick="goToPage(4)">J‚Äôai lu, je passe √† l‚Äôanalyse ‚û°</button>
    </div>
  </div>

  <div id="page4" class="page-section">
    <h3 style="color:white; font-size:1rem; margin:0 0 10px 0;">Rep√©rer les d√©terminants</h3>
    <div class="doc-container clickable-text" id="interactiveTextZone"></div>

    <div class="results-grid">
      <div class="res-col" style="border-color:var(--op-color)" onclick="verifyPlacement(4, 'op')">
        <div class="res-header" style="color:#3b82f6; border-color:#3b82f6">OP√âRATEUR</div>
        <div style="text-align:center; font-size:0.7rem; color:#94a3b8;">D√©pose ici</div>
        <ul class="res-list" id="listOp4"></ul>
      </div>
      <div class="res-col" style="border-color:var(--ent-color)" onclick="verifyPlacement(4, 'ent')">
        <div class="res-header" style="color:#a3e635; border-color:#a3e635">ENTREPRISE</div>
        <div style="text-align:center; font-size:0.7rem; color:#94a3b8;">D√©pose ici</div>
        <ul class="res-list" id="listEnt4"></ul>
      </div>
    </div>

    <div id="memoDet" class="memo-card">
      <span style="font-weight:900; text-transform:uppercase;">üí° Ce qu‚Äôil faut retenir</span>
      <ul style="margin:5px 0 0 15px; padding:0;">
        <li><strong>D√©terminants op√©rateur :</strong> ce qui le caract√©rise (√¢ge, taille, qualification‚Ä¶).</li>
        <li><strong>D√©terminants entreprise :</strong> ce qui est mis √† disposition (machines, horaires, EPI‚Ä¶).</li>
      </ul>
    </div>

    <div class="action-bar">
      <button class="btn-nav" onclick="goToPage(3)">‚¨Ö Retour</button>
      <button class="btn-nav btn-reset" onclick="initPage4()">üîÑ Recommencer</button>
      <button class="btn-nav btn-next" id="btnPage4" onclick="goToPage(5)">Valider l‚Äô√©tape ‚û°</button>
    </div>
  </div>

  <div id="page5" class="page-section">
    <h3 style="color:white; margin:0 0 10px 0;">Travail prescrit vs travail r√©el</h3>

    <div class="doc-container" id="defZone5">
      <span class="doc-title">DOC. C : D√©finitions</span>
      <p>Le travail <span class="slot" data-ans="1" onclick="handleSlotP5(this)">...</span> correspond √† ce que l‚Äôentreprise demande.</p>
      <p>Le travail <span class="slot" data-ans="2" onclick="handleSlotP5(this)">...</span> est l‚Äôensemble des t√¢ches r√©elles et des activit√©s r√©elles.</p>
      <p>La <span class="slot" data-ans="3" onclick="handleSlotP5(this)">...</span> correspond √† <strong>ce que fait</strong> l‚Äôop√©rateur.</p>
      <p>L‚Äô<span class="slot" data-ans="4" onclick="handleSlotP5(this)">...</span> d√©signe <strong>comment</strong> l‚Äôop√©rateur accomplit la t√¢che.</p>
    </div>

    <div class="dock" id="dock5"></div>

    <div id="quizZone5" style="display:none; margin-top:20px;">
      <h3 style="color:var(--accent); font-size:1rem; margin-bottom:10px;">T√¢che ou activit√©</h3>
      <div id="quizContainer"></div>
    </div>

    <div id="memoTravail" class="memo-card">
      <span style="font-weight:900; text-transform:uppercase;">üí° Ce qu‚Äôil faut retenir</span>
      <ul style="margin:5px 0 0 15px; padding:0;">
        <li><strong>Travail prescrit :</strong> la demande (quoi).</li>
        <li><strong>Travail r√©el :</strong> ce qui est r√©alis√© (t√¢ches + activit√©s).</li>
      </ul>
    </div>

    <div class="action-bar">
      <button class="btn-nav" onclick="goToPage(4)">‚¨Ö Retour</button>
      <button class="btn-nav btn-reset" onclick="initPage5()">üîÑ Recommencer</button>
      <button class="btn-nav btn-next" id="btnPage5" onclick="goToPage(6)">Valider l‚Äô√©tape ‚û°</button>
    </div>
  </div>

  <div id="page6" class="page-section">
    <h3 style="color:white; font-size:1rem; margin:0 0 10px 0;">Identifier les effets</h3>

    <div class="doc-container clickable-text" id="interactiveTextZone6"></div>

    <div class="results-grid">
      <div class="res-col" style="border-color:var(--op-color)" onclick="verifyPlacement(6, 'op')">
        <div class="res-header" style="color:#3b82f6; border-color:#3b82f6">EFFETS OP√âRATEUR</div>
        <div style="text-align:center; font-size:0.7rem; color:#94a3b8;">Sant√©, s√©curit√©, motivation</div>
        <ul class="res-list" id="listOp6"></ul>
      </div>
      <div class="res-col" style="border-color:var(--ent-color)" onclick="verifyPlacement(6, 'ent')">
        <div class="res-header" style="color:#a3e635; border-color:#a3e635">EFFETS ENTREPRISE</div>
        <div style="text-align:center; font-size:0.7rem; color:#94a3b8;">Productivit√©, qualit√©</div>
        <ul class="res-list" id="listEnt6"></ul>
      </div>
    </div>

    <div id="memoEffets" class="memo-card">
      <span style="font-weight:900; text-transform:uppercase;">üí° Ce qu‚Äôil faut retenir</span>
      <ul style="margin:5px 0 0 15px; padding:0;">
        <li style="margin-bottom:5px"><strong>Effets sur l‚Äôop√©rateur :</strong> cons√©quences sur la sant√©, la s√©curit√©, les comp√©tences, la motivation (positif ou n√©gatif).</li>
        <li><strong>Effets sur l‚Äôentreprise :</strong> cons√©quences sur la qualit√©, la productivit√©, les b√©n√©fices.</li>
      </ul>
    </div>

    <div class="action-bar">
      <button class="btn-nav" onclick="goToPage(5)">‚¨Ö Retour</button>
      <button class="btn-nav btn-reset" onclick="initPage6()">üîÑ Recommencer</button>
      <button class="btn-nav btn-next" id="btnPage6" onclick="goToPage(8)">Suite ‚û°</button>
    </div>
  </div>

  <div id="page8" class="page-section">
    <h3 style="color:white; margin:0 0 10px 0;">L‚Äôenqu√™te ergonomique</h3>

    <div class="doc-container" style="font-size:0.85rem; padding:10px;">
      <strong>M√âTHODE</strong><br>
      1. Partir de l‚Äôeffet (le probl√®me).<br>
      2. Chercher la cause imm√©diate dans le travail r√©el (gestes, postures).<br>
      3. Chercher la cause racine dans les d√©terminants (ce qui est impos√©).
    </div>

    <div class="schema-container">
      <svg class="arrows-svg" id="arrowLayer">
        <defs>
          <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#db2777" />
          </marker>
        </defs>
        <path id="link1" class="arrow-path" />
        <path id="link2" class="arrow-path" />
        <path id="link3" class="arrow-path" />
      </svg>

      <div class="schema-level">
        <div class="s-box disabled" id="box-det-op" onclick="checkStep(3, this)">
          <strong>D√©t. op√©rateur</strong>
          1,65 m (taille)
        </div>
        <div class="s-box disabled" id="box-det-ent" onclick="checkStep(3, this)">
          <strong>D√©t. entreprise</strong>
          Plaques 10 kg
        </div>
      </div>

      <div class="schema-level" style="margin:20px 0;">
        <div class="s-box disabled" id="box-act" onclick="checkStep(2, this)" style="width:80%;">
          <strong>Activit√© r√©elle</strong>
          Bras tendus et lev√©s au-dessus des √©paules
        </div>
      </div>

      <div class="schema-level">
        <div class="s-box active-step" id="box-eff" onclick="checkStep(1, this)" style="border-color:#3b82f6;">
          <strong>Effet constat√©</strong>
          Douleurs aux √©paules
        </div>
      </div>
    </div>

    <div id="memoCausalite" class="memo-card" style="display:none;">
      <span style="font-weight:900; text-transform:uppercase;">üí° Ce qu‚Äôil faut retenir</span>
      <p style="margin:5px 0;">√Ä partir du sch√©ma renseign√©, √©tablir les liens de causalit√© entre l‚Äôeffet et les d√©terminants via le travail r√©el. Les causes peuvent √™tre multifactorielles.</p>
    </div>

    <div class="action-bar">
      <button class="btn-nav" onclick="goToPage(6)">‚¨Ö Retour</button>
      <button class="btn-nav btn-reset" onclick="initPage8()">üîÑ Recommencer</button>
      <button class="btn-nav btn-next" id="btnPage8" onclick="goToPage(9)">Vers la pr√©vention ‚û°</button>
    </div>
  </div>

  <div id="page9" class="page-section">
    <h3 style="color:white; margin:0 0 10px 0;">Proposer des solutions</h3>

    <div class="doc-container" style="background:#ecfccb; color:#365314; border-color:#84cc16; font-size:0.8rem; padding:10px;">
      <strong>EXEMPLE : pour le d√©ficit auditif</strong><br>
      Supprimer : remplacer la machine.<br>
      Protection : casque anti-bruit.<br>
      Formation : sensibilisation au bruit.
    </div>

    <p style="color:white; margin:10px 0 5px;">Aider Cl√©ment pour ses <strong>douleurs aux √©paules</strong></p>

    <div class="dock" id="prevDock" style="background:transparent; padding:0; justify-content:flex-start; margin-bottom:15px;"></div>

    <div class="prev-table">
      <div class="prev-row">
        <div class="prev-label" style="color:#ef4444;">1. Supprimer le risque</div>
        <div class="prev-drop-zone" id="drop-suppr" onclick="handlePrevClick(this)" data-ans="auto">...</div>
      </div>
      <div class="prev-row">
        <div class="prev-label" style="color:#f97316;">2. R√©duire le risque</div>
        <div class="prev-drop-zone" id="drop-red" onclick="handlePrevClick(this)" data-ans="orga">...</div>
      </div>
      <div class="prev-row">
        <div class="prev-label" style="color:#eab308;">3. Protection collective</div>
        <div class="prev-drop-zone" id="drop-coll" onclick="handlePrevClick(this)" data-ans="ventouse">...</div>
      </div>
      <div class="prev-row">
        <div class="prev-label" style="color:#3b82f6;">4. Protection individuelle</div>
        <div class="prev-drop-zone" id="drop-indiv" onclick="handlePrevClick(this)" data-ans="gants">...</div>
      </div>
      <div class="prev-row">
        <div class="prev-label" style="color:#a855f7;">5. Formation</div>
        <div class="prev-drop-zone" id="drop-form" onclick="handlePrevClick(this)" data-ans="prap">...</div>
      </div>
    </div>

    <div class="action-bar">
      <button class="btn-nav" onclick="goToPage(8)">‚¨Ö Retour</button>
      <button class="btn-nav btn-reset" onclick="initPage9()">üîÑ Recommencer</button>
      <button class="btn-nav btn-next" id="btnPage9" onclick="goToPage(7)">Aller au bilan final ‚û°</button>
    </div>
  </div>

  <div id="page7" class="page-section">
    <h3 style="color:white; text-align:center;">Bilan et auto-√©valuation</h3>

    <div class="doc-container" style="border-left-color:var(--success); font-size:0.85rem;">
      <h4 style="color:var(--success); margin-top:0;">Ce qu‚Äôil faut retenir</h4>

      <p><strong>L‚Äôergonomie</strong> est centr√©e sur l‚Äôactivit√© de travail de l‚Äôop√©rateur. Elle vise √† am√©liorer les conditions de travail : diminuer la p√©nibilit√©, am√©liorer la s√©curit√©, le rendement et la qualit√©.</p>

      <p>Pour d√©crire une situation de travail, recueillir des informations avec un outil d‚Äôanalyse (ITAMAMI, QQOQCP) afin d‚Äôidentifier :</p>

      <ul style="padding-left:15px; margin-top:10px;">
        <li><strong>D√©terminants op√©rateur</strong></li>
        <li><strong>D√©terminants entreprise</strong></li>
        <li><strong>Travail prescrit</strong></li>
        <li><strong>Travail r√©el : t√¢ches et activit√©s</strong></li>
        <li><strong>Effets sur l‚Äôop√©rateur</strong></li>
        <li><strong>Effets sur l‚Äôentreprise</strong></li>
      </ul>

      <p><strong>Relation de causalit√©</strong> : relier l‚Äôeffet, le travail r√©el, puis les d√©terminants. Les causes peuvent √™tre multiples.</p>

      <p><strong>Pr√©vention</strong> : proposer des solutions selon les principes g√©n√©raux (supprimer, r√©duire, protections collective/individuelle, formation).</p>
    </div>

    <div id="finalQuizContainer">
      <h4 style="color:white; text-align:center; margin:20px 0 10px;">Auto-√©valuation (8 questions)</h4>
    </div>

    <div id="finalScoreBoard" style="display:none; text-align:center; margin-top:20px;">
      <div style="font-size:3rem;">üéâ</div>
      <h3 style="color:white;">Module termin√©</h3>
      <p style="color:#cbd5e1;">Bases de l‚Äôanalyse ergonomique valid√©es</p>
      <button class="btn-nav btn-reset" onclick="location.reload()">Recommencer tout le module</button>
    </div>

    <div class="action-bar" id="navBar7">
      <button class="btn-nav" onclick="goToPage(9)">‚¨Ö Retour</button>
    </div>

    <div class="footer">√âdition Foucher</div>
  </div>

</div>

<script>
/* --- VARIABLES --- */
let studentName = "√âl√®ve";

/* S√©lections */
let selectionText = null;
let selectionTag = null;
let selectionPrev = null;

/* Compteurs */
let slotsFilled = 0;
let determinantsFound = 0;
let effectsFound = 0;

let finalQuizIndex = 0;
let currentStep8 = 1;
let prevFound = 0;

/* --- DATA --- */
const ITEMS_P2 = [
  { id: 1, txt: "discipline scientifique" },
  { id: 2, txt: "fonctionnement de l'homme" },
  { id: 3, txt: "acteur ergonomique" },
  { id: 4, txt: "toute personne" }
];

const RAW_TEXT_4 = `Embauch√© depuis <span class="word-target" data-cat="op">quatre ans dans l‚Äôentreprise G.</span>, <span class="word-target" data-cat="op">Cl√©ment</span>, <span class="word-target" data-cat="op">43 ans</span>, <span class="word-target" data-cat="op">1,65 m</span>, <span class="word-target" data-cat="op">droitier</span>, est au poste de poin√ßonnage depuis <span class="word-target" data-cat="op">huit mois</span>. Chaque jour, <span class="word-target" data-cat="ent">pendant 7 heures</span>, il doit poin√ßonner des plaques m√©talliques de dimensions diff√©rentes, dont la superficie est comprise entre <span class="word-target" data-cat="ent">1 m¬≤ et 1,5 m¬≤</span>, soit <span class="word-target" data-cat="ent">8 √† 10 kg</span> la plaque... Il d√©pose la plaque sur la table de la <span class="word-target" data-cat="ent">poin√ßonneuse</span>... Il active le programme √† l'origine de <span class="word-target" data-cat="ent">sons impulsionnels</span>. ...L‚Äôentreprise met √† disposition des <span class="word-target" data-cat="ent">gants, v√™tements, chaussures</span>...`;

const TOTAL_DETERMINANTS = 11;

const ITEMS_P5 = [
  { id: 1, txt: "prescrit" },
  { id: 2, txt: "r√©el" },
  { id: 3, txt: "t√¢che" },
  { id: 4, txt: "activit√©" }
];

const QUIZ_P5 = [
  { txt: "Fanny nettoie les plans de travail.", type: "tache" },
  { txt: "Victor est couch√© sous la voiture, les deux bras en hauteur.", type: "activite" },
  { txt: "Marwa a le bras au-dessus de la t√™te.", type: "activite" },
  { txt: "Martin charge le camion de sacs de ciment.", type: "tache" },
  { txt: "Chlo√© effectue des mouvements circulaires avec son poignet.", type: "activite" },
  { txt: "Hassan tourne la t√™te, regarde le client et sourit.", type: "activite" }
];

const RAW_TEXT_6 = `√Ä la fin de la journ√©e, il ressent parfois des <span class="word-target" data-cat="op">douleurs aux √©paules</span> et <span class="word-target" data-cat="op">au dos</span>, ainsi que des <span class="word-target" data-cat="op">bourdonnements d‚Äôoreilles</span>. Cl√©ment est <span class="word-target" data-cat="op">satisfait de son travail</span>. Il <span class="word-target" data-cat="op">souhaite √©voluer</span> dans l‚Äôentreprise.<br><br>‚ö†Ô∏è Cette situation difficile entra√Æne un <span class="word-target" data-cat="ent">risque d‚Äôaugmentation des arr√™ts de travail</span> et une <span class="word-target" data-cat="ent">baisse du rendement</span>.`;

const TOTAL_EFFECTS = 7;

const PREV_OPTS = [
  {id:"auto", txt:"Automatisation du port de plaques"},
  {id:"orga", txt:"Rotation des postes / Limiter d√©placements"},
  {id:"ventouse", txt:"Aide √† la manutention (Ventouse)"},
  {id:"gants", txt:"Gants adapt√©s"},
  {id:"prap", txt:"Formation PRAP"}
];

const FINAL_QUIZ = [
  { q: "Quel est l'objectif principal de l'ergonomie ?", opts: [{ txt: "Adapter l'homme au travail.", correct: false, feed: "Non" }, { txt: "Adapter le travail √† l'homme.", correct: true, feed: "Exact" }] },
  { q: "Le bruit et l'√©clairage font partie des", opts: [{ txt: "D√©terminants op√©rateur", correct: false, feed: "Non" }, { txt: "D√©terminants entreprise", correct: true, feed: "Oui" }] },
  { q: "La consigne Peindre le mur correspond au", opts: [{ txt: "Travail prescrit", correct: true, feed: "Oui" }, { txt: "Travail r√©el", correct: false, feed: "Non" }] },
  { q: "Il travaille les bras en l'air d√©crit", opts: [{ txt: "Une t√¢che", correct: false, feed: "Non" }, { txt: "Une activit√©", correct: true, feed: "Oui" }] },
  { q: "La baisse de qualit√© est un effet sur", opts: [{ txt: "L'op√©rateur", correct: false, feed: "Non" }, { txt: "L'entreprise", correct: true, feed: "Oui" }] },
  { q: "L'anciennet√© est un d√©terminant", opts: [{ txt: "Op√©rateur", correct: true, feed: "Oui" }, { txt: "Entreprise", correct: false, feed: "Non" }] },
  { q: "Pour pr√©venir, le plus efficace est de", opts: [{ txt: "Supprimer le risque", correct: true, feed: "Oui" }, { txt: "Mettre des EPI", correct: false, feed: "Non" }] },
  { q: "Quelle m√©thode d'analyse recueille les infos", opts: [{ txt: "Le QQOQCP", correct: true, feed: "Oui" }, { txt: "Le PUNCH", correct: false, feed: "Non" }] }
];

/* --- NAVIGATION --- */
function startModule() {
  studentName = "√âl√®ve";
  goToPage(1);
  setCoach("Bonjour ! Pr√™t √† commencer ?", "happy");
}

function goToPage(pageNum) {
  document.querySelectorAll('.page-section').forEach(p => p.classList.remove('active'));
  document.getElementById('page' + pageNum).classList.add('active');
  window.scrollTo(0,0);

  if(pageNum===2) initPage2();
  if(pageNum===4) initPage4();
  if(pageNum===5) initPage5();
  if(pageNum===6) initPage6();
  if(pageNum===8) initPage8();
  if(pageNum===9) initPage9();
  if(pageNum===7) initPage7();
}

function setCoach(msg, mood) {
  document.getElementById('coachText').innerHTML = msg;
  let img = "avatar-neutral.png";
  if(mood==='happy') img="avatar-bravo.png";
  if(mood==='warn') img="avatar-attention.png";
  document.getElementById('coachImg').src = img;
}

/* --- PAGE 2 --- */
function initPage2() {
  slotsFilled = 0;
  selectionTag = null;

  document.getElementById('btnPage2').style.display='none';
  document.getElementById('memoErgo').style.display='none';

  const dock = document.getElementById('dock2');
  dock.innerHTML = "";
  dock.style.display='flex';

  document.querySelectorAll('#page2 .slot').forEach(s => {
    s.innerText = "...";
    s.classList.remove('filled', 'active');
  });

  ITEMS_P2.sort(()=>Math.random()-0.5).forEach(i=>{
    let b=document.createElement('div');
    b.className='tag';
    b.innerText=i.txt;
    b.dataset.id=i.id;
    b.onclick=()=>selectTag(b);
    dock.appendChild(b);
  });

  setCoach("Compl√©ter les d√©finitions", "neutral");
}

function selectTag(btn) {
  if(selectionTag) selectionTag.classList.remove('selected');
  selectionTag=btn;
  btn.classList.add('selected');
  document.querySelectorAll('.slot:not(.filled)').forEach(s=>s.classList.add('active'));
}

function handleSlot(slot) {
  if(!selectionTag || slot.classList.contains('filled')) return;

  if(selectionTag.dataset.id===slot.dataset.ans){
    slot.innerText=selectionTag.innerText;
    slot.classList.add('filled');
    slot.classList.remove('active');
    selectionTag.classList.add('hidden');
    selectionTag=null;
    slotsFilled++;

    document.querySelectorAll('.slot').forEach(s=>s.classList.remove('active'));

    if(slotsFilled===ITEMS_P2.length){
      setCoach("Bravo ! Lire le m√©mo vert", "happy");
      document.getElementById('memoErgo').style.display='block';
      document.getElementById('dock2').style.display='none';
      document.getElementById('btnPage2').style.display='block';
    }
  } else {
    setCoach("Non, essaie encore", "warn");
  }
}

/* --- Pages 4 et 6 --- */
function initInteractivePage(cid, txt, inst){
  selectionText=null;
  if(cid==='interactiveTextZone') determinantsFound=0;
  if(cid==='interactiveTextZone6') effectsFound=0;

  document.getElementById(cid).innerHTML=txt;
  document.getElementById(cid).querySelectorAll('.word-target').forEach(s=>s.onclick=()=>selectWordInText(s));
  setCoach(inst,"neutral");
}

function initPage4(){
  document.getElementById('listOp4').innerHTML="";
  document.getElementById('listEnt4').innerHTML="";
  document.getElementById('memoDet').style.display='none';
  document.getElementById('btnPage4').style.display='none';
  initInteractivePage('interactiveTextZone', RAW_TEXT_4, "Cliquer sur un mot gris, puis sur la bonne colonne");
}

function initPage6(){
  document.getElementById('listOp6').innerHTML="";
  document.getElementById('listEnt6').innerHTML="";
  document.getElementById('memoEffets').style.display='none';
  document.getElementById('btnPage6').style.display='none';
  initInteractivePage('interactiveTextZone6', RAW_TEXT_6, "Rep√©rer les effets positifs et n√©gatifs");
}

function selectWordInText(el){
  if(el.classList.contains('found')) return;
  if(selectionText && selectionText.el!==el) selectionText.el.classList.remove('active-selection');
  el.classList.add('active-selection');
  selectionText={el:el, cat:el.dataset.cat, txt:el.innerText};
  setCoach("Cliquer sur la colonne", "neutral");
}

function verifyPlacement(p, cat){
  if(!selectionText){ setCoach("S√©lectionner d'abord un mot", "warn"); return; }

  if(selectionText.cat===cat){
    selectionText.el.classList.remove('active-selection');
    selectionText.el.classList.add('found');

    let li=document.createElement('li');
    li.className="res-item";
    li.innerText=selectionText.txt;

    const targetId = (p===4)
      ? (cat==='op' ? 'listOp4' : 'listEnt4')
      : (cat==='op' ? 'listOp6' : 'listEnt6');

    document.getElementById(targetId).appendChild(li);
    selectionText=null;

    if(p===4){
      determinantsFound++;
      if(determinantsFound===TOTAL_DETERMINANTS){
        setCoach("Parfait !", "happy");
        document.getElementById('memoDet').style.display='block';
        document.getElementById('btnPage4').style.display='block';
      }
    } else {
      effectsFound++;
      if(effectsFound===TOTAL_EFFECTS){
        setCoach("Termin√© !", "happy");
        document.getElementById('memoEffets').style.display='block';
        document.getElementById('btnPage6').style.display='block';
      }
    }
  } else {
    setCoach("Non, r√©fl√©chir √† la cat√©gorie", "warn");
  }
}

/* --- PAGE 5 --- */
function initPage5(){
  slotsFilled=0;
  document.getElementById('dock5').innerHTML="";
  document.querySelectorAll('#defZone5 .slot').forEach(s=>{ s.innerText="..."; s.classList.remove('filled'); });

  document.getElementById('quizZone5').style.display='none';
  document.getElementById('memoTravail').style.display='none';
  document.getElementById('btnPage5').style.display='none';

  document.getElementById('dock5').style.display='flex';

  ITEMS_P5.sort(()=>Math.random()-0.5).forEach(i=>{
    let b=document.createElement('div');
    b.className='tag';
    b.innerText=i.txt;
    b.dataset.id=i.id;
    b.onclick=()=>selectTag(b);
    document.getElementById('dock5').appendChild(b);
  });

  setCoach("Compl√©ter les d√©finitions", "neutral");
}

const originalHandleSlot = handleSlot;
handleSlotP5 = function(slot){
  if(document.getElementById('page5').classList.contains('active')){
    if(!selectionTag || slot.classList.contains('filled')) return;

    if(selectionTag.dataset.id===slot.dataset.ans){
      slot.innerText=selectionTag.innerText;
      slot.classList.add('filled');
      slot.classList.remove('active');
      selectionTag.classList.add('hidden');
      selectionTag=null;
      slotsFilled++;

      document.querySelectorAll('.slot').forEach(s=>s.classList.remove('active'));

      if(slotsFilled===4){
        setCoach("Quiz", "happy");
        document.getElementById('dock5').style.display='none';
        startQuizP5();
      }
    } else {
      setCoach("Non", "warn");
    }
  } else {
    originalHandleSlot(slot);
  }
}

function startQuizP5(){
  document.getElementById('quizZone5').style.display='block';
  const c=document.getElementById('quizContainer');
  c.innerHTML="";

  QUIZ_P5.forEach(q=>{
    c.innerHTML += `
      <div class="quiz-row">
        <div class="quiz-header-obs">Situation</div>
        <div class="quiz-question">${q.txt}</div>
        <div class="quiz-options">
          <div class="quiz-btn" onclick="checkQuiz(this,'${q.type}','tache')">T√¢che</div>
          <div class="quiz-btn" onclick="checkQuiz(this,'${q.type}','activite')">Activit√©</div>
        </div>
      </div>
    `;
  });
}

function checkQuiz(b, correctType, userType){
  if(b.parentElement.classList.contains('done')) return;

  if(correctType===userType){
    b.classList.add('correct');
    setCoach("Exact", "happy");
  } else {
    b.classList.add('wrong');
    setCoach("Faux", "warn");
  }

  b.parentElement.classList.add('done');

  if(document.querySelectorAll('.quiz-row .done').length===QUIZ_P5.length){
    document.getElementById('memoTravail').style.display='block';
    document.getElementById('btnPage5').style.display='block';
  }
}

/* --- PAGE 8 --- */
function initPage8(){
  currentStep8=1;
  document.getElementById('btnPage8').style.display='none';
  document.getElementById('memoCausalite').style.display='none';

  document.querySelectorAll('.arrow-path').forEach(p=>p.classList.remove('visible'));
  document.querySelectorAll('.s-box').forEach(b=>{
    b.classList.remove('active-step','validated','disabled');
    b.classList.add('disabled');
  });

  const eff = document.getElementById('box-eff');
  eff.classList.remove('disabled');
  eff.classList.add('active-step');

  setCoach("Cliquer sur l‚Äôeffet", "neutral");

  window.removeEventListener('resize', drawArrows);
  window.addEventListener('resize', drawArrows, {passive:true});
  setTimeout(drawArrows, 120);
}

function drawArrows() {
  const container = document.querySelector('.schema-container');
  const rectC = container.getBoundingClientRect();

  function getCenter(id) {
    const el = document.getElementById(id);
    const r = el.getBoundingClientRect();
    return {
      x: r.left + r.width/2 - rectC.left,
      y: r.top + r.height/2 - rectC.top,
      top: r.top - rectC.top,
      bot: r.bottom - rectC.top
    };
  }

  const eff = getCenter('box-eff');
  const act = getCenter('box-act');
  const op = getCenter('box-det-op');
  const ent = getCenter('box-det-ent');

  document.getElementById('link1').setAttribute('d', `M ${eff.x} ${eff.top} L ${act.x} ${act.bot}`);
  document.getElementById('link2').setAttribute('d', `M ${act.x} ${act.top} L ${op.x} ${op.bot}`);
  document.getElementById('link3').setAttribute('d', `M ${act.x} ${act.top} L ${ent.x} ${ent.bot}`);
}

function checkStep(step, el){
  if(currentStep8!==step) return;

  if(step===1){
    el.classList.remove('active-step');
    el.classList.add('validated');
    document.getElementById('link1').classList.add('visible');

    const n=document.getElementById('box-act');
    n.classList.remove('disabled');
    n.classList.add('active-step');

    currentStep8=2;
    setCoach("Trouver l‚Äôactivit√©", "happy");
  }
  else if(step===2){
    el.classList.remove('active-step');
    el.classList.add('validated');
    document.getElementById('link2').classList.add('visible');
    document.getElementById('link3').classList.add('visible');

    const n1=document.getElementById('box-det-op');
    const n2=document.getElementById('box-det-ent');
    n1.classList.remove('disabled'); n2.classList.remove('disabled');
    n1.classList.add('active-step'); n2.classList.add('active-step');

    currentStep8=3;
    setCoach("Trouver les d√©terminants", "happy");
  }
  else if(step===3){
    el.classList.remove('active-step');
    el.classList.add('validated');

    if(document.getElementById('box-det-op').classList.contains('validated') &&
       document.getElementById('box-det-ent').classList.contains('validated')){
      setCoach("Enqu√™te r√©solue", "happy");
      document.getElementById('memoCausalite').style.display='block';
      document.getElementById('btnPage8').style.display='block';
    }
  }
}

/* --- PAGE 9 --- */
function initPage9(){
  prevFound=0;
  selectionPrev=null;
  document.getElementById('btnPage9').style.display='none';

  const d=document.getElementById('prevDock');
  d.innerHTML="";

  document.querySelectorAll('.prev-drop-zone').forEach(z=>{
    z.innerText="...";
    z.classList.remove('filled');
    z.style.borderColor = "#cbd5e1";
  });

  PREV_OPTS.sort(()=>Math.random()-0.5).forEach(o=>{
    let b=document.createElement('div');
    b.className='prev-option';
    b.innerText=o.txt;
    b.dataset.id=o.id;
    b.onclick=()=>selectPrevOption(b);
    d.appendChild(b);
  });

  setCoach("S√©lectionner une mesure puis cliquer sur la bonne case", "neutral");
}

function selectPrevOption(b){
  if(selectionPrev) selectionPrev.classList.remove('selected');
  selectionPrev=b;
  b.classList.add('selected');
}

function handlePrevClick(z){
  if(!selectionPrev || z.classList.contains('filled')) return;

  if(selectionPrev.dataset.id===z.dataset.ans){
    z.innerText=selectionPrev.innerText;
    z.classList.add('filled');
    selectionPrev.style.display='none';
    selectionPrev=null;
    prevFound++;

    setCoach("Correct", "happy");

    if(prevFound===PREV_OPTS.length){
      setCoach("Excellent", "happy");
      document.getElementById('btnPage9').style.display='block';
    }
  } else {
    setCoach("Non, ce n‚Äôest pas le bon type", "warn");
    z.style.borderColor="red";
    setTimeout(()=>z.style.borderColor="#cbd5e1", 500);
  }
}

/* --- PAGE 7 --- */
function initPage7(){
  finalQuizIndex=0;
  document.getElementById('finalQuizContainer').innerHTML = '<h4 style="color:white; text-align:center; margin:20px 0 10px;">Auto-√©valuation (8 questions)</h4>';
  document.getElementById('finalScoreBoard').style.display="none";
  document.getElementById('navBar7').style.display="block";
  setCoach("Bilan", "neutral");
  showFinalQuestion();
}

function showFinalQuestion(){
  const c=document.getElementById('finalQuizContainer');

  if(finalQuizIndex>=FINAL_QUIZ.length){
    c.innerHTML="";
    document.getElementById('finalScoreBoard').style.display="block";
    document.getElementById('navBar7').style.display="none";
    setCoach("Bravo", "happy");
    triggerConfetti();
    return;
  }

  let q=FINAL_QUIZ[finalQuizIndex];
  c.innerHTML = `
    <div class="final-quiz-card">
      <div class="final-q-text">${finalQuizIndex+1}. ${q.q}</div>
      <div id="finalOpts"></div>
    </div>
  `;

  q.opts.forEach(o=>{
    let b=document.createElement('div');
    b.className='final-opt-btn';
    b.innerText=o.txt;
    b.onclick=()=>checkFinalAnswer(b,o);
    document.getElementById('finalOpts').appendChild(b);
  });
}

function checkFinalAnswer(btn, opt){
  document.querySelectorAll('.final-opt-btn').forEach(b=>b.onclick=null);

  if(opt.correct){
    btn.classList.add('correct');
    setCoach(opt.feed, "happy");
    setTimeout(()=>{ finalQuizIndex++; showFinalQuestion(); }, 1200);
  } else {
    btn.classList.add('wrong');
    setCoach(opt.feed, "warn");
    setTimeout(()=>{ finalQuizIndex++; showFinalQuestion(); }, 1400);
  }
}

function triggerConfetti() {
  for(let i=0; i<50; i++) {
    let conf = document.createElement('div');
    conf.className = 'confetti';
    conf.style.left = Math.random() * 100 + 'vw';
    conf.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
    conf.style.animationDuration = (Math.random() * 3 + 2) + 's';
    document.body.appendChild(conf);
    setTimeout(()=>conf.remove(), 6000);
  }
}
</script>
</body>
</html>
