<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Devoir PSE ‚Äì Envoi vers Firebase</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f4f4f5;
      margin: 0;
      padding: 0;
    }
    .page {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px 16px 60px;
    }
    h1 {
      font-size: 1.6rem;
      margin-bottom: 0.25rem;
    }
    h2 {
      font-size: 1.2rem;
      margin-top: 1.8rem;
      margin-bottom: 0.75rem;
    }
    .card {
      background: #ffffff;
      border-radius: 10px;
      padding: 16px 18px;
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.08);
      margin-top: 14px;
    }
    .identite-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
      margin-top: 8px;
    }
    label {
      font-size: 0.9rem;
      font-weight: 500;
      display: block;
      margin-bottom: 4px;
    }
    input[type="text"],
    input[type="number"],
    textarea,
    select {
      width: 100%;
      padding: 7px 9px;
      border-radius: 7px;
      border: 1px solid #e5e7eb;
      font-size: 0.95rem;
      box-sizing: border-box;
    }
    textarea {
      min-height: 70px;
      resize: vertical;
    }
    .question {
      margin-bottom: 18px;
      border-bottom: 1px dashed #e5e7eb;
      padding-bottom: 10px;
    }
    .question:last-of-type {
      border-bottom: none;
    }
    .question-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
      margin-bottom: 4px;
    }
    .question-num {
      font-weight: 600;
      color: #111827;
    }
    .question-type {
      font-size: 0.8rem;
      color: #6b7280;
    }
    .options {
      margin-top: 6px;
    }
    .option {
      margin-bottom: 4px;
    }
    .small-input {
      width: 90px;
    }
    .btn-main {
      inline-size: auto;
      padding: 10px 18px;
      border-radius: 999px;
      border: none;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      background: #2563eb;
      color: #ffffff;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .btn-main:disabled {
      opacity: 0.6;
      cursor: wait;
    }
    .status {
      margin-top: 10px;
      font-size: 0.9rem;
    }
    .status.ok {
      color: #16a34a;
    }
    .status.err {
      color: #dc2626;
    }
    .note-prof {
      font-size: 0.8rem;
      color: #6b7280;
      margin-top: 12px;
      font-style: italic;
    }
  </style>
</head>

<body>
  <div class="page">
    <h1>Devoir PSE ‚Äì Envoi automatique</h1>
    <p>Compl√®te le devoir puis clique sur ¬´ Envoyer le devoir ¬ª pour transmettre ta copie.</p>

    <form id="devoir-form" class="card">
      <h2>Identit√© de l‚Äô√©l√®ve</h2>
      <div class="identite-grid">
        <div>
          <label for="nom">Nom</label>
          <input type="text" id="nom" autocomplete="family-name" />
        </div>
        <div>
          <label for="prenomEleve">Pr√©nom</label>
          <input type="text" id="prenomEleve" autocomplete="given-name" />
        </div>
        <div>
          <label for="classe">Classe</label>
          <input type="text" id="classe" placeholder="ex : 1√®re Bac Pro MELEC" />
        </div>
      </div>

      <h2>Questions</h2>

      <!-- Q1 - ouverte courte -->
      <div class="question" data-qnum="1">
        <div class="question-header">
          <span class="question-num">Question 1</span>
          <span class="question-type">r√©ponse ouverte courte</span>
        </div>
        <p>Explique en une ou deux phrases ce qu‚Äôest un risque professionnel.</p>
        <textarea id="q1"></textarea>
      </div>

      <!-- Q2 - QCM simple -->
      <div class="question" data-qnum="2">
        <div class="question-header">
          <span class="question-num">Question 2</span>
          <span class="question-type">QCM (une seule r√©ponse)</span>
        </div>
        <p>Parmi ces situations, laquelle correspond le mieux √† un <strong>danger</strong> ?</p>
        <div class="options">
          <label class="option">
            <input type="radio" name="q2" value="A" />
            A. Un sol propre et sec
          </label>
          <label class="option">
            <input type="radio" name="q2" value="B" />
            B. Un sol mouill√© et glissant sans panneau
          </label>
          <label class="option">
            <input type="radio" name="q2" value="C" />
            C. Des chaussures de s√©curit√© neuves
          </label>
          <label class="option">
            <input type="radio" name="q2" value="D" />
            D. Une pause de 15 minutes
          </label>
        </div>
      </div>

      <!-- Q3 - vrai / faux -->
      <div class="question" data-qnum="3">
        <div class="question-header">
          <span class="question-num">Question 3</span>
          <span class="question-type">Vrai / Faux</span>
        </div>
        <p>Coche la bonne r√©ponse : ¬´ Le risque est toujours totalement supprim√© quand on porte un EPI. ¬ª</p>
        <div class="options">
          <label class="option">
            <input type="radio" name="q3" value="Vrai" />
            Vrai
          </label>
          <label class="option">
            <input type="radio" name="q3" value="Faux" />
            Faux
          </label>
        </div>
      </div>

      <!-- Q4 - texte √† trous simple (on concat√®ne) -->
      <div class="question" data-qnum="4">
        <div class="question-header">
          <span class="question-num">Question 4</span>
          <span class="question-type">texte √† trous</span>
        </div>
        <p>Compl√®te : Pour r√©duire le risque, on peut <em>(action)</em> l‚Äôorganisation du travail et utiliser des <em>(quoi ?)</em> adapt√©s.</p>
        <div class="options">
          <label class="option">
            Action :
            <input type="text" id="q4_trou1" />
          </label>
          <label class="option">
            Second trou :
            <input type="text" id="q4_trou2" />
          </label>
        </div>
      </div>

      <!-- Q5 - ouverte longue -->
      <div class="question" data-qnum="5">
        <div class="question-header">
          <span class="question-num">Question 5</span>
          <span class="question-type">r√©ponse r√©dig√©e</span>
        </div>
        <p>D√©cris une situation de travail o√π le manque de sommeil peut augmenter le risque d‚Äôaccident.</p>
        <textarea id="q5"></textarea>
      </div>

      <!-- Q6 - QCM multi-choix -->
      <div class="question" data-qnum="6">
        <div class="question-header">
          <span class="question-num">Question 6</span>
          <span class="question-type">QCM (plusieurs r√©ponses possibles)</span>
        </div>
        <p>Quelles sont des mesures de pr√©vention possibles pour limiter les troubles musculo-squelettiques ?</p>
        <div class="options">
          <label class="option">
            <input type="checkbox" id="q6_a" value="Former aux bons gestes et postures" />
            Former aux bons gestes et postures
          </label>
          <label class="option">
            <input type="checkbox" id="q6_b" value="Alterner les postes de travail" />
            Alterner les postes de travail
          </label>
          <label class="option">
            <input type="checkbox" id="q6_c" value="Porter des charges toujours seul" />
            Porter des charges toujours seul
          </label>
          <label class="option">
            <input type="checkbox" id="q6_d" value="Utiliser des aides √† la manutention" />
            Utiliser des aides √† la manutention
          </label>
        </div>
      </div>

      <!-- Q7 - classement -->
      <div class="question" data-qnum="7">
        <div class="question-header">
          <span class="question-num">Question 7</span>
          <span class="question-type">classement / analyse</span>
        </div>
        <p>Classe ces trois risques du plus grave au moins grave (1 = le plus grave) : <br>
          a) coupure l√©g√®re, b) chute de hauteur, c) br√ªlure chimique.</p>
        <div class="options">
          <label class="option">
            Ordre choisi :
            <input type="text" id="q7" placeholder="ex : 2 &gt; 3 &gt; 1" />
          </label>
        </div>
      </div>

      <!-- Q8 - question chiffr√©e -->
      <div class="question" data-qnum="8">
        <div class="question-header">
          <span class="question-num">Question 8</span>
          <span class="question-type">question chiffr√©e</span>
        </div>
        <p>Un salari√© travaille 8 h par jour. Il passe 2 h en port de charges lourdes. Quel pourcentage de sa journ√©e cela repr√©sente-t-il ?</p>
        <input type="number" id="q8" class="small-input" /> %
      </div>

      <!-- Q9 - QCM situation -->
      <div class="question" data-qnum="9">
        <div class="question-header">
          <span class="question-num">Question 9</span>
          <span class="question-type">QCM</span>
        </div>
        <p>Quel document sert de r√©f√©rence pour l‚Äô√©valuation des risques dans une entreprise ?</p>
        <div class="options">
          <label class="option">
            <input type="radio" name="q9" value="R√®glement int√©rieur" />
            Le r√®glement int√©rieur
          </label>
          <label class="option">
            <input type="radio" name="q9" value="Document unique d‚Äô√©valuation des risques" />
            Le document unique d‚Äô√©valuation des risques
          </label>
          <label class="option">
            <input type="radio" name="q9" value="Planning des cong√©s" />
            Le planning des cong√©s
          </label>
        </div>
      </div>

      <!-- Q10 - question r√©flexive -->
      <div class="question" data-qnum="10">
        <div class="question-header">
          <span class="question-num">Question 10</span>
          <span class="question-type">r√©flexion personnelle</span>
        </div>
        <p>√Ä ton avis, pourquoi est-il important d‚Äôassocier les salari√©s √† la pr√©vention des risques dans l‚Äôentreprise ?</p>
        <textarea id="q10"></textarea>
      </div>

      <button type="submit" class="btn-main" id="send-btn">
        üì§ Envoyer le devoir
      </button>

      <div id="status" class="status"></div>
      <div class="note-prof">
        Note prof : ce devoir envoie un JSON vers Firestore dans la collection <code>bacpro</code> avec les cl√©s "1" √† "10".
        Tu pourras ensuite l‚Äôimporter dans la grille via ¬´ Importer sujet (JSON) ¬ª.
      </div>
    </form>
  </div>

  <!-- Script Firebase + envoi Firestore -->
  <script type="module">
    // Import Firebase (CDN) ‚Äì tu peux ajuster la version si besoin
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // Configuration de TON projet (celle de la console Firebase)
    const firebaseConfig = {
      apiKey: "AIzaSyAWdCMv0iAJJn3eT9LIAQD3RWJUD8LQcLI",
      authDomain: "devoirs-pse.firebaseapp.com",
      projectId: "devoirs-pse",
      storageBucket: "devoirs-pse.firebasestorage.app",
      messagingSenderId: "614730413904",
      appId: "1:614730413904:web:a5dd478af5de30f6bede55",
      measurementId: "G-7R9N0JL6GG"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const form = document.getElementById("devoir-form");
    const statusEl = document.getElementById("status");
    const sendBtn = document.getElementById("send-btn");

    function getRadioValue(name) {
      const checked = document.querySelector(`input[name="${name}"]:checked`);
      return checked ? checked.value : "";
    }

    function getCheckboxValues(ids) {
      const res = [];
      ids.forEach(id => {
        const el = document.getElementById(id);
        if (el && el.checked) res.push(el.value);
      });
      return res.join(" | ");
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      statusEl.textContent = "";
      statusEl.className = "status";

      const nom = document.getElementById("nom").value.trim();
      const prenom = document.getElementById("prenomEleve").value.trim();
      const classe = document.getElementById("classe").value.trim();

      if (!nom || !prenom || !classe) {
        statusEl.textContent = "Merci de remplir au minimum nom, pr√©nom et classe.";
        statusEl.classList.add("err");
        return;
      }

      // Construire les r√©ponses pour compatibilit√© avec la grille (cl√©s : "1", "2", ..., "10")
      const reponses = {
        "1": document.getElementById("q1").value.trim(),
        "2": getRadioValue("q2"),
        "3": getRadioValue("q3"),
        "4": (document.getElementById("q4_trou1").value.trim() + " /// " +
              document.getElementById("q4_trou2").value.trim()).trim(),
        "5": document.getElementById("q5").value.trim(),
        "6": getCheckboxValues(["q6_a", "q6_b", "q6_c", "q6_d"]),
        "7": document.getElementById("q7").value.trim(),
        "8": document.getElementById("q8").value !== "" ? document.getElementById("q8").value + " %" : "",
        "9": getRadioValue("q9"),
        "10": document.getElementById("q10").value.trim()
      };

      const payload = {
        type: "copie_eleve_pse",
        nom,
        prenom,
        classe,
        reponses,
        meta: {
          createdAt: new Date().toISOString(),
          source: "devoirs-pse-github"
        }
      };

      try {
        sendBtn.disabled = true;
        await addDoc(collection(db, "bacpro"), payload);
        statusEl.textContent = "Devoir envoy√© avec succ√®s. Tu peux pr√©venir ton professeur.";
        statusEl.classList.add("ok");
        form.reset();
      } catch (err) {
        console.error(err);
        statusEl.textContent = "Erreur lors de l‚Äôenvoi. Merci de pr√©venir ton professeur.";
        statusEl.classList.add("err");
      } finally {
        sendBtn.disabled = false;
      }
    });
  </script>
</body>
</html>