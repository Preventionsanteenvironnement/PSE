<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>PSE ‚Äì ITaMaMi (C2) ‚Äì AGOrA</title>
<style>
  :root{
    --bg:#0b1220;
    --card:rgba(16,31,61,.92);
    --text:#eaf0ff;
    --muted:#b7c3e6;
    --accent:#7dd3fc;
    --accent2:#a78bfa;
    --success:#34d399;
    --error:#fb7185;
    --warning:#fbbf24;
    --border:rgba(255,255,255,.12);
    --shadow:0 10px 30px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    color:var(--text);
    background:
      radial-gradient(1200px 600px at 15% -10%, rgba(125,211,252,.14), transparent 55%),
      radial-gradient(900px 520px at 100% 0%, rgba(167,139,250,.12), transparent 52%),
      var(--bg);
    min-height:100vh;
  }
  .wrap{max-width:980px;margin:0 auto;padding:14px 14px 90px}
  .top{
    position:sticky;top:0;z-index:50;
    padding:12px 0 10px;
    background:linear-gradient(to bottom, rgba(11,18,32,.95), rgba(11,18,32,.55), transparent);
    backdrop-filter: blur(10px);
  }
  .head{
    display:flex;align-items:center;gap:12px;
    border:1px solid var(--border);
    border-radius:16px;
    background:rgba(11,18,32,.86);
    box-shadow:var(--shadow);
    padding:12px;
  }
  .badge{
    flex:0 0 auto;
    padding:8px 10px;border-radius:12px;
    background:linear-gradient(135deg, rgba(125,211,252,.18), rgba(167,139,250,.18));
    border:1px solid rgba(125,211,252,.22);
    font-weight:900;
    line-height:1.1;
  }
  .badge small{display:block;color:var(--muted);font-weight:800;margin-top:2px}
  .title{flex:1}
  .title h1{margin:0;font-size:1.05rem;letter-spacing:.2px}
  .title p{margin:2px 0 0;color:var(--muted);font-size:.88rem}
  .progress{display:flex;gap:8px;align-items:center;flex:0 0 auto}
  .dot{width:10px;height:10px;border-radius:999px;border:1px solid rgba(255,255,255,.25);background:rgba(255,255,255,.06)}
  .dot.on{background:linear-gradient(135deg, var(--accent2), var(--accent));border-color:transparent}

  .card{
    background:var(--card);
    border:1px solid var(--border);
    border-radius:16px;
    box-shadow:var(--shadow);
    padding:16px;
    margin-top:14px;
  }
  .card h2{
    margin:0 0 10px;
    font-size:1.05rem;
    color:var(--accent);
    display:flex;align-items:center;gap:10px;
  }
  .card p{margin:10px 0;line-height:1.5}
  .muted{color:var(--muted)}
  .pill{
    display:inline-flex;align-items:center;gap:8px;
    padding:8px 10px;border-radius:999px;
    border:1px solid rgba(255,255,255,.14);
    background:rgba(0,0,0,.18);
    color:var(--muted);
    font-size:.88rem;
    margin:6px 6px 0 0;
  }
  .pill b{color:var(--text)}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  @media (max-width:720px){.grid2{grid-template-columns:1fr}}

  .callout{
    border-left:4px solid var(--warning);
    background:rgba(251,191,36,.08);
    border-radius:12px;
    padding:12px;
    margin-top:10px;
  }
  .callout b{color:var(--warning)}
  .page{display:none}
  .page.active{display:block;animation:fade .28s ease}
  @keyframes fade{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

  .method{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:10px}
  @media(max-width:820px){.method{grid-template-columns:1fr}}
  .box{
    background:rgba(0,0,0,.18);
    border:1px dashed rgba(255,255,255,.20);
    border-radius:14px;
    padding:12px;
  }
  .box h3{margin:0 0 6px;font-size:.95rem;color:var(--accent2)}
  .box ul{margin:0 0 0 18px;color:var(--muted)}
  .box li{margin:6px 0}

  .q{
    margin-top:12px;
    padding:12px;
    background:rgba(0,0,0,.16);
    border-radius:12px;
    border:1px solid rgba(255,255,255,.10);
  }
  .q p{margin:0 0 10px}
  .choices{display:grid;gap:10px}
  .choice{
    display:flex;gap:10px;align-items:flex-start;
    padding:12px;border-radius:12px;
    border:1px solid transparent;
    background:rgba(255,255,255,.05);
    cursor:pointer;
  }
  .choice input{margin-top:2px;transform:scale(1.15);accent-color:var(--accent)}
  .choice.correct{border-color:rgba(52,211,153,.7);background:rgba(52,211,153,.10)}
  .choice.wrong{border-color:rgba(251,113,133,.7);background:rgba(251,113,133,.10)}

  .select{
    width:100%;
    padding:12px 14px;
    border-radius:12px;
    border:1px solid rgba(255,255,255,.20);
    background:rgba(15,23,42,.7);
    color:var(--text);
    font-size:1rem;
    outline:none;
  }
  .select:focus{border-color:rgba(125,211,252,.6)}
  .mini{font-size:.9rem;color:var(--muted)}

  .bank{
    display:flex;flex-wrap:wrap;gap:10px;
    padding:12px;border-radius:14px;
    background:rgba(0,0,0,.22);
    border:1px solid rgba(255,255,255,.10);
    min-height:68px;
  }
  .chip{
    padding:10px 14px;border-radius:999px;
    background:rgba(167,139,250,.16);
    border:1px solid rgba(167,139,250,.35);
    color:var(--text);
    font-weight:900;
    font-size:.9rem;
    cursor:pointer;
    user-select:none;
  }
  .chip.selected{background:var(--accent);color:#0b1220;border-color:rgba(125,211,252,.9);box-shadow:0 0 18px rgba(125,211,252,.25)}
  .chip.valid{background:rgba(52,211,153,.92);border-color:rgba(52,211,153,.95);color:#072016}
  .chip.invalid{background:rgba(251,113,133,.92);border-color:rgba(251,113,133,.95);color:#2a0710}

  .zones{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}
  @media(max-width:720px){.zones{grid-template-columns:1fr}}
  .zone{
    border-radius:16px;
    border:2px dashed rgba(255,255,255,.20);
    background:rgba(255,255,255,.03);
    padding:12px;
    min-height:120px;
  }
  .zone h4{
    margin:0 0 8px;
    font-size:.92rem;
    color:var(--accent);
    text-transform:uppercase;
    letter-spacing:.08em;
    display:flex;justify-content:space-between;align-items:center;
  }
  .zone small{color:var(--muted);text-transform:none;letter-spacing:0}
  .zone .slot{display:flex;flex-wrap:wrap;gap:8px}

  .result{
    text-align:center;
    padding:18px;
    border-radius:18px;
    background:linear-gradient(135deg, rgba(125,211,252,.10), rgba(167,139,250,.10));
    border:1px solid rgba(255,255,255,.14);
  }
  .score{
    font-size:3rem;font-weight:1000;
    background:linear-gradient(135deg, var(--accent), var(--accent2));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    margin:0;
  }
  .feedback{margin-top:10px;color:var(--muted)}
  .corr{
    margin-top:12px;
    display:none;
    padding:12px;border-radius:14px;
    border-left:4px solid var(--success);
    background:rgba(52,211,153,.10);
  }
  .corr.show{display:block}
  .corr b{color:var(--success)}

  .footerbar{
    position:fixed;left:0;right:0;bottom:0;z-index:60;
    padding:10px 14px;
    background:rgba(11,18,32,.92);
    border-top:1px solid rgba(255,255,255,.10);
    backdrop-filter:blur(10px);
  }
  .footerbar .inner{max-width:980px;margin:0 auto;display:flex;gap:10px}
  .btn{
    border:none;cursor:pointer;
    border-radius:12px;
    padding:14px 16px;
    font-weight:1000;
    font-size:1rem;
    min-height:48px;
    width:100%;
    display:inline-flex;align-items:center;justify-content:center;gap:10px;
  }
  .btn.primary{
    background:linear-gradient(135deg, var(--accent2), var(--accent));
    color:#0b1220;
    box-shadow:0 8px 22px rgba(125,211,252,.22);
  }
  .btn.ghost{
    background:transparent;
    border:2px solid rgba(255,255,255,.18);
    color:var(--text);
    box-shadow:none;
  }
</style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="head">
        <div class="badge">PSE <small>C2</small></div>
        <div class="title">
          <h1>ITaMaMi ‚Äì AGOrA</h1>
          <p>AGOrA = Assistance √† la Gestion des Organisations et de leurs Activit√©s ‚Ä¢ C2 = appliquer une d√©marche d‚Äôanalyse</p>
        </div>
        <div class="progress" aria-label="Progression">
          <span class="dot" id="dot0"></span>
          <span class="dot" id="dot1"></span>
          <span class="dot" id="dot2"></span>
          <span class="dot" id="dot3"></span>
          <span class="dot" id="dot4"></span>
        </div>
      </div>
    </div>

    <section class="page active" id="page0">
      <div class="card">
        <h2>üéØ Comp√©tence & Objectif</h2>
        <p><b>Comp√©tence C2</b> : Appliquer une d√©marche d'analyse dans une situation de la vie professionnelle.</p>
        <p><b>√ätre capable de :</b></p>
        <ul style="margin:8px 0 0 20px;color:var(--muted)">
          <li>Identifier les composantes d'une situation de travail (ITaMaMi)</li>
          <li>Distinguer la t√¢che (quoi faire ?) de l'activit√© (comment faire ?)</li>
          <li>Classer des √©l√©ments dans les cat√©gories appropri√©es</li>
        </ul>
        <div class="pill"><b>Capacit√©s</b> : Analyser ‚Ä¢ Identifier ‚Ä¢ Classer</div>
        <div class="pill"><b>Bar√®me</b> : 20 points</div>
      </div>

      <div class="card">
        <h2>üß∑ Sigles expliqu√©s</h2>
        <p><b>ITaMaMi</b> = <b>I</b>ndividu, <b>T</b>√¢che, <b>A</b>ctivit√©, <b>Ma</b>t√©riel, <b>Mi</b>lieu.</p>
        <p><b>RGPD</b> = R√®glement G√©n√©ral sur la Protection des Donn√©es (prot√©ger les infos personnelles).</p>
        <p><b>PDF</b> = format de document (fichier) souvent utilis√© pour envoyer une pi√®ce jointe.</p>
        <p><b>ENT</b> = Espace Num√©rique de Travail (plateforme de l‚Äô√©tablissement).</p>
      </div>

      <div class="card">
        <h2>üìç Situation support</h2>
        <p><b>Lina</b> est stagiaire en secr√©tariat dans un lyc√©e. Son tuteur lui demande de <b>pr√©parer et envoyer une convocation</b> aux parents pour une r√©union.</p>
        <p class="muted">Donn√©es disponibles : liste des destinataires, mod√®le de convocation, date/heure, salle, consignes RGPD.</p>

        <div class="callout">
          <b>Diff√©rence importante</b><br>
          <b>T√¢che</b> = ce qui est demand√© (quoi faire ?).<br>
          <b>Activit√©</b> = comment c‚Äôest r√©alis√© (gestes, √©tapes, organisation, v√©rifications).<br>
          <span class="mini">Exemple : T√¢che : envoyer la convocation. / Activit√© : v√©rifier les adresses, compl√©ter le mod√®le, exporter en PDF, joindre, v√©rifier objet, envoyer, archiver.</span>
        </div>
      </div>
    </section>

    <section class="page" id="page1">
      <div class="card">
        <h2>üß© Comment utiliser ITaMaMi ?</h2>
        <p><b>Objectif</b> : rep√©rer toutes les composantes d‚Äôune activit√© de travail et les organiser.</p>

        <div class="method">
          <div class="box">
            <h3>Individu</h3>
            <ul>
              <li>Qui r√©alise le travail ?</li>
              <li>Caract√©ristiques utiles (exp√©rience, formation, fatigue, stress, etc.)</li>
            </ul>
          </div>
          <div class="box">
            <h3>T√¢che</h3>
            <ul>
              <li>Quel travail est demand√© ?</li>
              <li>Quel r√©sultat est attendu ?</li>
            </ul>
          </div>
          <div class="box">
            <h3>Activit√©</h3>
            <ul>
              <li>Comment le travail est r√©alis√© ?</li>
              <li>√âtapes, v√©rifications, organisation, communication</li>
            </ul>
          </div>
          <div class="box">
            <h3>Mat√©riel / Milieu</h3>
            <ul>
              <li>Avec quoi ? (ordinateur, logiciels, t√©l√©phone, imprimante)</li>
              <li>O√π ? (bureau, accueil, open space, contraintes de temps)</li>
            </ul>
          </div>
        </div>

        <div class="callout">
          <b>Astuce</b><br>
          Si tu r√©ponds √† <b>quoi faire ?</b> ‚Üí souvent <b>T√¢che</b>.<br>
          Si tu r√©ponds √† <b>comment faire ?</b> ‚Üí souvent <b>Activit√©</b>.
        </div>
      </div>
    </section>

    <section class="page" id="page2">
      <div class="card">
        <h2>‚úÖ Exercice 1 ‚Äì Distinguer t√¢che et activit√© (6 points)</h2>
        <p class="muted"><b>Consigne (C2)</b> : <b>Identifier</b> si chaque proposition d√©crit une <b>T√¢che</b> ou une <b>Activit√©</b>.</p>

        <div class="q" id="q1">
          <p><b>1.</b> Envoyer une convocation aux parents pour la r√©union.</p>
          <div class="choices">
            <label class="choice"><input type="radio" name="q1" value="T"><span>T√¢che</span></label>
            <label class="choice"><input type="radio" name="q1" value="A"><span>Activit√©</span></label>
          </div>
          <div class="corr" id="c1"><b>Correction</b> : T√¢che (travail demand√©).</div>
        </div>

        <div class="q" id="q2">
          <p><b>2.</b> V√©rifier les adresses mail, compl√©ter le mod√®le, exporter en PDF, joindre le fichier, relire, envoyer.</p>
          <div class="choices">
            <label class="choice"><input type="radio" name="q2" value="T"><span>T√¢che</span></label>
            <label class="choice"><input type="radio" name="q2" value="A"><span>Activit√©</span></label>
          </div>
          <div class="corr" id="c2"><b>Correction</b> : Activit√© (√©tapes = comment faire).</div>
        </div>

        <div class="q" id="q3">
          <p><b>3.</b> Archiver la convocation dans le dossier partag√© et noter l‚Äôenvoi dans l‚ÄôENT.</p>
          <div class="choices">
            <label class="choice"><input type="radio" name="q3" value="T"><span>T√¢che</span></label>
            <label class="choice"><input type="radio" name="q3" value="A"><span>Activit√©</span></label>
          </div>
          <div class="corr" id="c3"><b>Correction</b> : Activit√© (actions r√©alis√©es pour terminer correctement).</div>
        </div>
      </div>
    </section>

    <section class="page" id="page3">
      <div class="card">
        <h2>üîç Exercice 2 ‚Äì Compl√©ter ITaMaMi (6 points)</h2>
        <p class="muted"><b>Consigne (C2)</b> : <b>Analyser</b> la situation et <b>s√©lectionner</b> la meilleure r√©ponse pour chaque case.</p>

        <div class="grid2">
          <div class="q" id="s1">
            <p><b>Individu</b> : qui r√©alise le travail ?</p>
            <select class="select" data-answer="Lina (stagiaire en secr√©tariat)">
              <option value="">Choisir‚Ä¶</option>
              <option>Lina (stagiaire en secr√©tariat)</option>
              <option>La convocation</option>
              <option>La salle</option>
            </select>
            <div class="corr" id="cs1"><b>Correction</b> : Lina.</div>
          </div>

          <div class="q" id="s2">
            <p><b>Milieu</b> : o√π se d√©roule le travail ?</p>
            <select class="select" data-answer="Bureau administratif du lyc√©e">
              <option value="">Choisir‚Ä¶</option>
              <option>Bureau administratif du lyc√©e</option>
              <option>Terrain de sport</option>
              <option>Atelier peinture</option>
            </select>
            <div class="corr" id="cs2"><b>Correction</b> : Bureau administratif du lyc√©e.</div>
          </div>

          <div class="q" id="s3">
            <p><b>Mat√©riel</b> : avec quoi ?</p>
            <select class="select" data-answer="Ordinateur, messagerie, logiciel de traitement de texte, imprimante (si besoin)">
              <option value="">Choisir‚Ä¶</option>
              <option>Marteau et clous</option>
              <option>Ordinateur, messagerie, logiciel de traitement de texte, imprimante (si besoin)</option>
              <option>Casque de chantier</option>
            </select>
            <div class="corr" id="cs3"><b>Correction</b> : outils num√©riques de bureau.</div>
          </div>

          <div class="q" id="s4">
            <p><b>T√¢che</b> : quel travail est demand√© ?</p>
            <select class="select" data-answer="Pr√©parer et envoyer une convocation aux parents">
              <option value="">Choisir‚Ä¶</option>
              <option>D√©corer la salle</option>
              <option>Pr√©parer et envoyer une convocation aux parents</option>
              <option>R√©parer une fuite</option>
            </select>
            <div class="corr" id="cs4"><b>Correction</b> : Pr√©parer et envoyer une convocation.</div>
          </div>

          <div class="q" id="s5">
            <p><b>Activit√©</b> : comment est r√©alis√© le travail ?</p>
            <select class="select" data-answer="V√©rifier la liste, compl√©ter le mod√®le, exporter en PDF, relire, envoyer, archiver">
              <option value="">Choisir‚Ä¶</option>
              <option>Choisir une couleur</option>
              <option>V√©rifier la liste, compl√©ter le mod√®le, exporter en PDF, relire, envoyer, archiver</option>
              <option>Changer une ampoule</option>
            </select>
            <div class="corr" id="cs5"><b>Correction</b> : encha√Ænement d‚Äô√©tapes et v√©rifications.</div>
          </div>

          <div class="q" id="s6">
            <p class="mini"><b>Rappel RGPD</b> : ne pas afficher des listes de mails visibles par tous, √©viter de diffuser des donn√©es personnelles.</p>
          </div>
        </div>
      </div>
    </section>

    <section class="page" id="page4">
      <div class="card">
        <h2>üìä Exercice 3 ‚Äì Classer des √©l√©ments ITaMaMi (8 points)</h2>
        <p class="muted"><b>Consigne (C2)</b> : <b>Classer</b> chaque √©tiquette dans la bonne cat√©gorie.</p>

        <div class="callout">
          <b>Mode d‚Äôemploi</b><br>
          1) Clique une √©tiquette (elle devient bleue).<br>
          2) Clique une zone (elle se place).
        </div>

        <div class="bank" id="bank"></div>

        <div class="zones">
          <div class="zone" id="zI" data-key="I">
            <h4>Individu <small>Qui ?</small></h4>
            <div class="slot"></div>
          </div>
          <div class="zone" id="zT" data-key="T">
            <h4>T√¢che <small>Quoi faire ?</small></h4>
            <div class="slot"></div>
          </div>
          <div class="zone" id="zA" data-key="A">
            <h4>Activit√© <small>Comment ?</small></h4>
            <div class="slot"></div>
          </div>
          <div class="zone" id="zMa" data-key="Ma">
            <h4>Mat√©riel <small>Avec quoi ?</small></h4>
            <div class="slot"></div>
          </div>
          <div class="zone" id="zMi" data-key="Mi">
            <h4>Milieu <small>O√π ?</small></h4>
            <div class="slot"></div>
          </div>
        </div>

        <div class="corr" id="cEx3">
          <b>Correction attendue</b><br>
          Individu : Lina<br>
          T√¢che : pr√©parer et envoyer une convocation<br>
          Activit√© : v√©rifier la liste, compl√©ter le mod√®le, exporter en PDF, relire, envoyer, archiver<br>
          Mat√©riel : ordinateur, messagerie, traitement de texte, imprimante (si besoin)<br>
          Milieu : bureau administratif du lyc√©e
        </div>
      </div>

      <div class="card">
        <h2>üèÅ Bilan</h2>
        <p class="muted">Calcule ton score. Les corrections s‚Äôaffichent.</p>
        <button class="btn primary" id="btnScore">Calculer mon score</button>

        <div class="result" style="margin-top:12px;display:none" id="resultBox">
          <p class="score" id="scoreText">-- / 20</p>
          <p class="feedback" id="fbText"></p>
        </div>
      </div>
    </section>
  </div>

  <div class="footerbar">
    <div class="inner">
      <button class="btn ghost" id="btnPrev">‚óÄ Retour</button>
      <button class="btn primary" id="btnNext">Suivant ‚ñ∂</button>
    </div>
  </div>

<script>
  const STORE_KEY = "pse_itamami_agora_v1";
  const pages = ["page0","page1","page2","page3","page4"];
  let idx = 0;

  const answersMCQ = { q1:"T", q2:"A", q3:"A" };

  const chips = [
    {id:"ch1", text:"Lina (stagiaire)", key:"I"},
    {id:"ch2", text:"Bureau administratif du lyc√©e", key:"Mi"},
    {id:"ch3", text:"Ordinateur", key:"Ma"},
    {id:"ch4", text:"Messagerie (mail)", key:"Ma"},
    {id:"ch5", text:"Logiciel de traitement de texte", key:"Ma"},
    {id:"ch6", text:"Imprimante (si besoin)", key:"Ma"},
    {id:"ch7", text:"Pr√©parer et envoyer une convocation", key:"T"},
    {id:"ch8", text:"V√©rifier la liste des destinataires", key:"A"},
    {id:"ch9", text:"Compl√©ter le mod√®le (date, heure, salle)", key:"A"},
    {id:"ch10", text:"Exporter en PDF et relire", key:"A"},
    {id:"ch11", text:"Envoyer puis archiver", key:"A"},
    {id:"ch12", text:"Appliquer le RGPD (donn√©es personnelles)", key:"A"}
  ];

  let selectedChip = null;

  function setDots(){
    pages.forEach((_,i)=>document.getElementById("dot"+i).classList.toggle("on", i===idx));
  }

  function showPage(i){
    idx = Math.max(0, Math.min(pages.length-1, i));
    document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
    document.getElementById(pages[idx]).classList.add("active");
    setDots();
    document.getElementById("btnPrev").disabled = (idx===0);
    document.getElementById("btnNext").textContent = (idx===pages.length-1) ? "Terminer ‚ñ∂" : "Suivant ‚ñ∂";
    window.scrollTo(0,0);
    persist();
    if(idx===4) initChips();
  }

  document.getElementById("btnPrev").addEventListener("click", ()=>showPage(idx-1));
  document.getElementById("btnNext").addEventListener("click", ()=>{ if(idx<pages.length-1) showPage(idx+1); else showPage(4); });

  function initChips(){
    const bank = document.getElementById("bank");
    if(bank.dataset.inited==="1") return;
    bank.dataset.inited="1";
    const shuffled = [...chips].sort(()=>Math.random()-0.5);
    shuffled.forEach(c=>{
      const el = document.createElement("div");
      el.className = "chip";
      el.textContent = c.text;
      el.dataset.id = c.id;
      el.dataset.key = c.key;
      el.addEventListener("click",(e)=>{ e.stopPropagation(); selectChip(el); });
      bank.appendChild(el);
    });
    document.querySelectorAll(".zone").forEach(z=>z.addEventListener("click", ()=>placeInZone(z)));
    restore();
  }

  function selectChip(el){
    if(selectedChip) selectedChip.classList.remove("selected");
    selectedChip = el;
    el.classList.add("selected");
  }

  function placeInZone(zone){
    if(!selectedChip) return;
    zone.querySelector(".slot").appendChild(selectedChip);
    selectedChip.classList.remove("selected");
    selectedChip = null;
    persist();
  }

  document.getElementById("btnScore").addEventListener("click", ()=>{
    let total = 0;

    total += scoreMCQ("q1","c1");
    total += scoreMCQ("q2","c2");
    total += scoreMCQ("q3","c3");

    total += scoreSelect("s1","cs1",1);
    total += scoreSelect("s2","cs2",1);
    total += scoreSelect("s3","cs3",1);
    total += scoreSelect("s4","cs4",1);
    total += scoreSelect("s5","cs5",2);

    total += scoreChips(); // max 8

    document.getElementById("resultBox").style.display="block";
    document.getElementById("scoreText").textContent = total + " / 20";

    let fb = "";
    if(total>=17) fb = "Tr√®s solide : tu appliques ITaMaMi correctement.";
    else if(total>=13) fb = "Bon niveau : encore un peu de pr√©cision sur T√¢che / Activit√©.";
    else if(total>=9) fb = "En cours : relis la r√®gle T√¢che = quoi / Activit√© = comment, puis recommence.";
    else fb = "√Ä travailler : reprends les d√©finitions, puis refais l‚Äôentra√Ænement.";
    document.getElementById("fbText").textContent = fb;

    ["c1","c2","c3","cs1","cs2","cs3","cs4","cs5","cEx3"].forEach(id=>{
      const el = document.getElementById(id);
      if(el) el.classList.add("show");
    });

    persist();
    window.scrollTo(0, document.body.scrollHeight);
  });

  function scoreMCQ(qid, corrId){
    const expected = answersMCQ[qid];
    document.querySelectorAll(`#${qid} .choice`).forEach(l=>l.classList.remove("correct","wrong"));
    const picked = document.querySelector(`input[name="${qid}"]:checked`);
    document.getElementById(corrId).classList.add("show");
    if(!picked) return 0;
    const val = picked.value;
    document.querySelectorAll(`#${qid} .choice`).forEach(l=>{
      const inp = l.querySelector("input");
      if(!inp) return;
      if(inp.checked && val===expected) l.classList.add("correct");
      if(inp.checked && val!==expected) l.classList.add("wrong");
    });
    return (val===expected) ? 2 : 0;
  }

  function scoreSelect(blockId, corrId, pts){
    const block = document.getElementById(blockId);
    const sel = block.querySelector("select");
    const ans = sel.dataset.answer;
    const ok = sel.value === ans;
    sel.style.borderColor = ok ? "rgba(52,211,153,.75)" : "rgba(251,113,133,.75)";
    document.getElementById(corrId).classList.add("show");
    return ok ? pts : 0;
  }

  function scoreChips(){
    document.querySelectorAll(".chip").forEach(c=>c.classList.remove("valid","invalid"));
    let good = 0;
    document.querySelectorAll(".zone .chip").forEach(ch=>{
      const expectedKey = ch.dataset.key;
      const currentKey = ch.closest(".zone").dataset.key;
      if(expectedKey === currentKey){ good++; ch.classList.add("valid"); }
      else { ch.classList.add("invalid"); }
    });
    document.getElementById("cEx3").classList.add("show");
    return Math.min(good, 8); // max = 8 pts
  }

  function snapshot(){
    const state = {
      idx,
      mcq:{
        q1: (document.querySelector('input[name="q1"]:checked')||{}).value || "",
        q2: (document.querySelector('input[name="q2"]:checked')||{}).value || "",
        q3: (document.querySelector('input[name="q3"]:checked')||{}).value || ""
      },
      selects:{
        s1: getSelectValue("s1"),
        s2: getSelectValue("s2"),
        s3: getSelectValue("s3"),
        s4: getSelectValue("s4"),
        s5: getSelectValue("s5")
      },
      chips:{}
    };
    document.querySelectorAll(".chip").forEach(ch=>{
      const id = ch.dataset.id;
      const zone = ch.closest(".zone");
      state.chips[id] = zone ? zone.id : "bank";
    });
    return state;
  }

  function getSelectValue(blockId){
    const b = document.getElementById(blockId);
    if(!b) return "";
    const sel = b.querySelector("select");
    return sel ? sel.value : "";
  }

  function persist(){
    try{ localStorage.setItem(STORE_KEY, JSON.stringify(snapshot())); }catch(e){}
  }

  function restore(){
    let raw=null;
    try{ raw = localStorage.getItem(STORE_KEY); }catch(e){}
    if(!raw){ setDots(); return; }
    let state=null;
    try{ state = JSON.parse(raw); }catch(e){ return; }
    if(!state) return;

    if(typeof state.idx==="number") idx = state.idx;

    ["q1","q2","q3"].forEach(q=>{
      const val = (state.mcq||{})[q];
      if(val){
        const inp = document.querySelector(`input[name="${q}"][value="${val}"]`);
        if(inp) inp.checked = true;
      }
    });

    const selMap = state.selects || {};
    Object.keys(selMap).forEach(blockId=>{
      const block = document.getElementById(blockId);
      if(!block) return;
      const sel = block.querySelector("select");
      if(sel) sel.value = selMap[blockId] || "";
    });

    if(state.chips && document.getElementById("bank")?.dataset.inited==="1"){
      Object.entries(state.chips).forEach(([chipId,parentId])=>{
        const chip = document.querySelector(`.chip[data-id="${chipId}"]`);
        if(!chip) return;
        if(parentId==="bank"){
          document.getElementById("bank").appendChild(chip);
        }else{
          const parent = document.getElementById(parentId);
          if(parent && parent.querySelector(".slot")) parent.querySelector(".slot").appendChild(chip);
        }
      });
    }

    setDots();
    showPage(idx);
  }

  window.addEventListener("load", ()=>{
    setDots();
    let raw=null; try{raw=localStorage.getItem(STORE_KEY)}catch(e){}
    if(raw){
      let st=null; try{st=JSON.parse(raw)}catch(e){}
      if(st && typeof st.idx==="number" && st.idx===4) initChips();
    }
    restore();
  });

  document.addEventListener("change",(e)=>{ if(e.target.matches("input, select")) persist(); });
</script>
</body>
</html>