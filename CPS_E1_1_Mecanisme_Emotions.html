<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPS E1.1 - Anatomie d'une √©motion</title>
    <style>
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f0f4f8;
            color: #1e293b;
            line-height: 1.6;
            min-height: 100vh;
            padding-bottom: 40px;
        }

        .container {
            max-width: 520px;
            margin: 0 auto;
            padding: 16px;
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            color: #e11d73;
            text-decoration: none;
            font-size: 0.95rem;
            font-weight: 500;
            margin-bottom: 12px;
            transition: color 0.2s;
        }

        .back-btn:hover { color: #9d174d; }

        .header-card {
            background: linear-gradient(135deg, #be185d, #e11d73);
            border-radius: 15px;
            padding: 28px 24px;
            color: white;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(225, 29, 115, 0.3);
        }

        .header-card .emoji { font-size: 2.2rem; margin-bottom: 8px; }
        .header-card h1 { font-size: 1.6rem; margin-bottom: 8px; font-weight: 700; }
        .header-card p { font-size: 0.92rem; opacity: 0.92; line-height: 1.5; }

        .card {
            background: white;
            border-radius: 15px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            animation: fadeIn 0.4s ease;
        }

        .card-title {
            font-size: 1.15rem;
            font-weight: 700;
            color: #be185d;
            margin-bottom: 16px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes flashGreen {
            0% { background: #dcfce7; }
            50% { background: #bbf7d0; }
            100% { background: #f8fafc; }
        }

        @keyframes flashRed {
            0% { background: #fee2e2; }
            50% { background: #fecaca; }
            100% { background: #f8fafc; }
        }

        .section { display: none; }
        .section.active { display: block; }

        /* INTRO COMPONENTS */
        .comp-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 16px;
        }

        .comp-card {
            background: #fce7f3;
            border-radius: 12px;
            padding: 14px 12px;
            text-align: center;
        }

        .comp-emoji { font-size: 1.6rem; margin-bottom: 6px; }
        .comp-label { font-weight: 700; font-size: 0.85rem; color: #9d174d; margin-bottom: 4px; }
        .comp-desc { font-size: 0.78rem; color: #6b7280; line-height: 1.4; }

        .intro-text {
            font-size: 0.88rem;
            color: #475569;
            line-height: 1.6;
            margin-bottom: 16px;
        }

        .btn-primary {
            display: block;
            width: 100%;
            background: linear-gradient(135deg, #be185d, #e11d73);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 15px 24px;
            font-size: 1.05rem;
            font-weight: 700;
            cursor: pointer;
            font-family: inherit;
            margin-top: 8px;
            transition: transform 0.15s, box-shadow 0.15s;
            box-shadow: 0 3px 12px rgba(225, 29, 115, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 18px rgba(225, 29, 115, 0.35);
        }

        /* PROGRESS */
        .progress-bar {
            height: 6px;
            background: #e2e8f0;
            border-radius: 20px;
            overflow: hidden;
            margin-bottom: 6px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #be185d, #e11d73);
            border-radius: 20px;
            transition: width 0.4s ease;
        }

        .progress-text {
            font-size: 0.8rem;
            color: #94a3b8;
            text-align: right;
            margin-bottom: 16px;
        }

        /* DETECTIVE */
        .scenario-badge {
            display: inline-block;
            background: #fce7f3;
            color: #be185d;
            font-size: 0.75rem;
            font-weight: 700;
            padding: 3px 10px;
            border-radius: 20px;
            margin-bottom: 10px;
        }

        .scenario-title {
            font-size: 1.05rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 6px;
        }

        .scenario-context {
            font-size: 0.88rem;
            color: #4b5563;
            line-height: 1.5;
            margin-bottom: 16px;
            font-style: italic;
        }

        .indice-card {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 14px;
            transition: border-color 0.3s;
        }

        .indice-card.correct { animation: flashGreen 0.8s ease; border-color: #22c55e; }
        .indice-card.wrong { animation: flashRed 0.8s ease; border-color: #ef4444; }

        .indice-text {
            font-size: 0.92rem;
            color: #1e293b;
            line-height: 1.5;
            margin-bottom: 4px;
        }

        .indice-counter {
            font-size: 0.75rem;
            color: #94a3b8;
            margin-bottom: 10px;
        }

        .indice-feedback {
            font-size: 0.82rem;
            font-weight: 600;
            margin-top: 8px;
            display: none;
        }

        .indice-feedback.show { display: block; }
        .indice-feedback.ok { color: #16a34a; }
        .indice-feedback.ko { color: #dc2626; }

        .cat-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 12px;
        }

        .cat-btn {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 12px 8px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.82rem;
            font-weight: 600;
            color: #374151;
            transition: all 0.15s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .cat-btn:hover { border-color: #e11d73; background: #fce7f3; }
        .cat-btn:disabled { opacity: 0.5; cursor: default; }
        .cat-btn .cat-emoji { font-size: 1.1rem; }

        .btn-next {
            display: none;
            width: 100%;
            background: #e11d73;
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px;
            font-size: 0.92rem;
            font-weight: 600;
            cursor: pointer;
            font-family: inherit;
            margin-top: 14px;
            transition: background 0.2s;
        }

        .btn-next:hover { background: #be185d; }
        .btn-next.show { display: block; }

        /* CIRCUIT */
        .circuit-visual {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            flex-wrap: wrap;
            margin-bottom: 18px;
            padding: 14px;
            background: #fce7f3;
            border-radius: 12px;
        }

        .circuit-step {
            background: white;
            border-radius: 8px;
            padding: 8px 10px;
            font-size: 0.75rem;
            font-weight: 700;
            color: #be185d;
            text-align: center;
            box-shadow: 0 1px 4px rgba(0,0,0,0.06);
        }

        .circuit-arrow { font-size: 1rem; color: #e11d73; font-weight: 700; }

        .match-card {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 14px;
            margin-bottom: 12px;
            transition: border-color 0.3s;
        }

        .match-card.correct { animation: flashGreen 0.8s ease; border-color: #22c55e; }
        .match-card.wrong { animation: flashRed 0.8s ease; border-color: #ef4444; }

        .match-text {
            font-size: 0.88rem;
            color: #1e293b;
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .match-counter {
            font-size: 0.75rem;
            color: #94a3b8;
            margin-bottom: 10px;
        }

        .match-feedback {
            font-size: 0.82rem;
            font-weight: 600;
            margin-top: 8px;
            display: none;
        }

        .match-feedback.show { display: block; }
        .match-feedback.ok { color: #16a34a; }
        .match-feedback.ko { color: #dc2626; }

        .match-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .match-btn {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 10px 6px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.8rem;
            font-weight: 600;
            color: #374151;
            transition: all 0.15s;
        }

        .match-btn:hover { border-color: #e11d73; background: #fce7f3; }
        .match-btn:disabled { opacity: 0.5; cursor: default; }

        /* BILAN */
        .score-display { text-align: center; padding: 20px; }
        .score-number { font-size: 3rem; font-weight: 800; color: #e11d73; line-height: 1.1; }
        .score-total { font-size: 1.1rem; color: #94a3b8; font-weight: 500; }
        .score-message { margin-top: 14px; font-size: 1.1rem; font-weight: 600; color: #1e293b; line-height: 1.45; }

        .synthesis-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 12px 14px;
            background: #fce7f3;
            border-radius: 10px;
            margin-bottom: 8px;
            font-size: 0.88rem;
            color: #9d174d;
            line-height: 1.5;
        }

        .synthesis-icon { font-size: 1.2rem; flex-shrink: 0; }
    </style>
</head>
<body>

<div class="container">
    <a href="index.html" class="back-btn">‚Üê Retour</a>

    <div class="header-card">
        <div class="emoji">üî¨</div>
        <h1>L'anatomie d'une √©motion</h1>
        <p>D√©couvre les rouages cach√©s de tes √©motions</p>
    </div>

    <!-- SECTION 1 : COMPOSANTES -->
    <div id="section-intro" class="section active">
        <div class="card">
            <div class="card-title">Les composantes d'une √©motion</div>
            <div class="comp-grid">
                <div class="comp-card">
                    <div class="comp-emoji">üíó</div>
                    <div class="comp-label">Le ressenti</div>
                    <div class="comp-desc">Ce que tu ressens √† l'int√©rieur (l'√©motion et les sensations dans ton corps).</div>
                </div>
                <div class="comp-card">
                    <div class="comp-emoji">üóØÔ∏è</div>
                    <div class="comp-label">Les pens√©es</div>
                    <div class="comp-desc">Ce qui te traverse l'esprit √† ce moment-l√†.</div>
                </div>
                <div class="comp-card">
                    <div class="comp-emoji">üòÆ</div>
                    <div class="comp-label">L'expression</div>
                    <div class="comp-desc">Ce que les autres peuvent voir (visage, voix, gestes).</div>
                </div>
                <div class="comp-card">
                    <div class="comp-emoji">üèÉ</div>
                    <div class="comp-label">Le comportement</div>
                    <div class="comp-desc">Ce que tu fais en r√©action.</div>
                </div>
            </div>
            <p class="intro-text">Une √©motion, c'est comme un ensemble d'indices qui se d√©clenchent en m√™me temps. En apprenant √† les rep√©rer, tu comprends mieux ce qui se passe en toi.</p>
            <button class="btn-primary" onclick="startDetective()">üîç Enqu√™ter !</button>
        </div>
    </div>

    <!-- SECTION 2 : DETECTIVE -->
    <div id="section-detective" class="section">
        <div class="card">
            <div class="card-title">üîç D√©tective des √©motions</div>
            <div class="progress-bar"><div class="progress-fill" id="det-progress"></div></div>
            <div class="progress-text" id="det-progress-text"></div>
            <div id="det-container"></div>
        </div>
    </div>

    <!-- SECTION 3 : CIRCUIT -->
    <div id="section-circuit" class="section">
        <div class="card">
            <div class="card-title">üîÑ Le circuit √©motionnel</div>
            <p class="intro-text">Les √©motions ne surgissent pas de nulle part. Elles suivent un circuit :</p>
            <div class="circuit-visual">
                <div class="circuit-step">üéØ D√©clencheur</div>
                <span class="circuit-arrow">‚Üí</span>
                <div class="circuit-step">üíé Besoin</div>
                <span class="circuit-arrow">‚Üí</span>
                <div class="circuit-step">‚ù§Ô∏è √âmotion</div>
                <span class="circuit-arrow">‚Üí</span>
                <div class="circuit-step">‚ö° Action</div>
            </div>
            <p class="intro-text">Pour chaque situation, identifie le r√¥le de chaque √©l√©ment dans le circuit.</p>
            <div id="circuit-container"></div>
        </div>
    </div>

    <!-- SECTION 4 : BILAN -->
    <div id="section-bilan" class="section">
        <div class="card">
            <div class="score-display">
                <div class="score-number" id="final-score">0</div>
                <div class="score-total">/ 28</div>
                <div class="score-message" id="score-message"></div>
            </div>
        </div>

        <div class="card">
            <div class="card-title">√Ä retenir</div>
            <div class="synthesis-item">
                <span class="synthesis-icon">üíó</span>
                <span>Une √©motion se manifeste dans le corps (sensations, battements de c≈ìur...).</span>
            </div>
            <div class="synthesis-item">
                <span class="synthesis-icon">üóØÔ∏è</span>
                <span>Elle s'accompagne de pens√©es automatiques.</span>
            </div>
            <div class="synthesis-item">
                <span class="synthesis-icon">üòÆ</span>
                <span>Elle se voit aussi de l'ext√©rieur (visage, voix, gestes).</span>
            </div>
            <div class="synthesis-item">
                <span class="synthesis-icon">üîÑ</span>
                <span>Elle suit un circuit : d√©clencheur ‚Üí besoin ‚Üí √©motion ‚Üí action.</span>
            </div>

            <button class="btn-primary" onclick="resetAll()" style="margin-top:16px;">üîÑ Refaire l'exercice</button>
        </div>
    </div>
</div>

<footer style="text-align:center; padding:20px 16px; color:#94a3b8; font-size:0.78rem;">
    Comp√©tences psychosociales ‚Äî R√©f√©rentiel Sant√© publique France 2025
</footer>

<script>
    /* ========== DATA ========== */
    var detectiveScenarios = [
        {
            title: "La veille d'un contr√¥le important",
            context: "C'est demain le contr√¥le de maths. En y pensant ce soir :",
            indices: [
                { text: "Tu ressens une boule au ventre.", answer: "ressenti" },
                { text: "Tu te dis : ¬´ Et si je n'y arrive pas ? ¬ª", answer: "pensee" },
                { text: "Tu as les mains moites.", answer: "ressenti" },
                { text: "Tu relis tes fiches pour la troisi√®me fois.", answer: "comportement" },
                { text: "Ton visage est crisp√©.", answer: "expression" }
            ]
        },
        {
            title: "Un bon r√©sultat inattendu",
            context: "Le professeur annonce que tu as eu la meilleure note √† l'expos√© :",
            indices: [
                { text: "Tu te sens l√©ger, le c≈ìur qui acc√©l√®re.", answer: "ressenti" },
                { text: "Un grand sourire appara√Æt sur ton visage.", answer: "expression" },
                { text: "Tu penses : ¬´ Tout ce travail a pay√© ! ¬ª", answer: "pensee" },
                { text: "Tu te tournes vers ton ami pour partager la nouvelle.", answer: "comportement" },
                { text: "Ta voix monte d'un ton.", answer: "expression" }
            ]
        },
        {
            title: "Un conflit au travail de groupe",
            context: "Pendant un projet en groupe, un camarade s'attribue ton id√©e devant le professeur :",
            indices: [
                { text: "Tu sens la chaleur monter dans ton visage.", answer: "ressenti" },
                { text: "Tu serres les poings sous la table.", answer: "expression" },
                { text: "Tu penses : ¬´ C'est injuste, c'√©tait mon id√©e ! ¬ª", answer: "pensee" },
                { text: "Tu d√©cides de lever la main pour r√©tablir la v√©rit√©.", answer: "comportement" },
                { text: "Ta m√¢choire se contracte.", answer: "ressenti" }
            ]
        },
        {
            title: "Seul √† la cantine",
            context: "Tes amis habituels sont absents aujourd'hui. Tu te retrouves seul √† une table :",
            indices: [
                { text: "Tu te sens un peu vide √† l'int√©rieur.", answer: "ressenti" },
                { text: "Tu baisses les yeux vers ton plateau.", answer: "expression" },
                { text: "Tu penses : ¬´ Personne ne s'assoit avec moi. ¬ª", answer: "pensee" },
                { text: "Tu manges rapidement pour quitter la cantine plus t√¥t.", answer: "comportement" },
                { text: "Ta gorge se serre un peu.", answer: "ressenti" }
            ]
        }
    ];

    var circuitSituations = [
        {
            context: "Lors de la sortie des r√©sultats du brevet blanc...",
            items: [
                { text: "Tu d√©couvres que tu n'as pas la moyenne.", answer: "declencheur" },
                { text: "Besoin de r√©ussite et de reconnaissance.", answer: "besoin" },
                { text: "Tu ressens de la d√©ception.", answer: "emotion" },
                { text: "Tu d√©cides de demander des explications au professeur.", answer: "action" }
            ]
        },
        {
            context: "Pendant la r√©cr√©ation...",
            items: [
                { text: "Un camarade te fait un compliment sur ton dessin.", answer: "declencheur" },
                { text: "Besoin de reconnaissance et d'estime.", answer: "besoin" },
                { text: "Tu ressens de la fiert√©.", answer: "emotion" },
                { text: "Tu souris et tu le remercies.", answer: "action" }
            ]
        }
    ];

    var CATEGORIES = {
        ressenti:     { emoji: "üíó", label: "Ressenti" },
        pensee:       { emoji: "üóØÔ∏è", label: "Pens√©e" },
        expression:   { emoji: "üòÆ", label: "Expression" },
        comportement: { emoji: "üèÉ", label: "Comportement" }
    };

    var CIRCUIT_LABELS = {
        declencheur: { emoji: "üéØ", label: "D√©clencheur" },
        besoin:      { emoji: "üíé", label: "Besoin" },
        emotion:     { emoji: "‚ù§Ô∏è", label: "√âmotion" },
        action:      { emoji: "‚ö°", label: "Action" }
    };

    /* ========== STATE ========== */
    var detScore = 0;
    var cirScore = 0;

    var shuffledScenarios = [];
    var curScenario = 0;
    var shuffledIndices = [];
    var curIndice = 0;

    var shuffledSituations = [];
    var curSituation = 0;
    var shuffledItems = [];
    var curItem = 0;

    /* ========== UTILITIES ========== */
    function shuffle(arr) {
        var a = arr.slice();
        for (var i = a.length - 1; i > 0; i--) {
            var j = Math.floor(Math.random() * (i + 1));
            var tmp = a[i]; a[i] = a[j]; a[j] = tmp;
        }
        return a;
    }

    function showSection(id) {
        var sections = document.querySelectorAll('.section');
        for (var i = 0; i < sections.length; i++) sections[i].classList.remove('active');
        document.getElementById(id).classList.add('active');
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function totalIndices() {
        var t = 0;
        for (var i = 0; i < detectiveScenarios.length; i++) t += detectiveScenarios[i].indices.length;
        return t;
    }

    function totalItems() {
        var t = 0;
        for (var i = 0; i < circuitSituations.length; i++) t += circuitSituations[i].items.length;
        return t;
    }

    /* ========== DETECTIVE ========== */
    function startDetective() {
        detScore = 0;
        shuffledScenarios = shuffle(detectiveScenarios);
        curScenario = 0;
        showSection('section-detective');
        loadScenario();
    }

    function updateDetProgress() {
        var done = 0;
        for (var i = 0; i < curScenario; i++) done += shuffledScenarios[i].indices.length;
        done += curIndice;
        var pct = (done / totalIndices()) * 100;
        document.getElementById('det-progress').style.width = pct + '%';
        document.getElementById('det-progress-text').textContent = 'Sc√©nario ' + (curScenario + 1) + ' / ' + shuffledScenarios.length;
    }

    function loadScenario() {
        var sc = shuffledScenarios[curScenario];
        shuffledIndices = shuffle(sc.indices);
        curIndice = 0;
        updateDetProgress();
        renderIndice();
    }

    function renderIndice() {
        var sc = shuffledScenarios[curScenario];
        var ind = shuffledIndices[curIndice];

        var html = '';
        html += '<div class="scenario-badge">Sc√©nario ' + (curScenario + 1) + ' / ' + shuffledScenarios.length + '</div>';
        html += '<div class="scenario-title">' + sc.title + '</div>';
        html += '<div class="scenario-context">' + sc.context + '</div>';

        html += '<div class="indice-card" id="indice-card">';
        html += '<div class="indice-counter">Indice ' + (curIndice + 1) + ' / ' + shuffledIndices.length + '</div>';
        html += '<div class="indice-text">¬´ ' + ind.text + ' ¬ª</div>';
        html += '<div class="indice-feedback" id="indice-fb"></div>';
        html += '</div>';

        html += '<div class="cat-buttons" id="cat-btns">';
        html += '<button class="cat-btn" onclick="checkIndice(\'ressenti\')"><span class="cat-emoji">üíó</span> Ressenti</button>';
        html += '<button class="cat-btn" onclick="checkIndice(\'pensee\')"><span class="cat-emoji">üóØÔ∏è</span> Pens√©e</button>';
        html += '<button class="cat-btn" onclick="checkIndice(\'expression\')"><span class="cat-emoji">üòÆ</span> Expression</button>';
        html += '<button class="cat-btn" onclick="checkIndice(\'comportement\')"><span class="cat-emoji">üèÉ</span> Comportement</button>';
        html += '</div>';

        html += '<button class="btn-next" id="btn-next-ind" onclick="nextIndice()">Indice suivant ‚Üí</button>';

        document.getElementById('det-container').innerHTML = html;
    }

    function checkIndice(choice) {
        var ind = shuffledIndices[curIndice];
        var correct = choice === ind.answer;
        var cat = CATEGORIES[ind.answer];

        var btns = document.querySelectorAll('#cat-btns .cat-btn');
        for (var i = 0; i < btns.length; i++) btns[i].disabled = true;

        var card = document.getElementById('indice-card');
        var fb = document.getElementById('indice-fb');

        if (correct) {
            detScore++;
            card.classList.add('correct');
            fb.className = 'indice-feedback show ok';
            fb.textContent = '‚úì Bien vu ! C\'est bien ' + cat.emoji + ' ' + cat.label + '.';
        } else {
            card.classList.add('wrong');
            fb.className = 'indice-feedback show ko';
            fb.textContent = '‚úó La bonne r√©ponse √©tait ' + cat.emoji + ' ' + cat.label + '.';
        }

        var btn = document.getElementById('btn-next-ind');
        var isLastInd = curIndice >= shuffledIndices.length - 1;
        var isLastSc = curScenario >= shuffledScenarios.length - 1;

        if (isLastInd && isLastSc) {
            btn.textContent = 'Passer au circuit √©motionnel ‚Üí';
            btn.onclick = function() { startCircuit(); };
        } else if (isLastInd) {
            btn.textContent = 'Sc√©nario suivant ‚Üí';
            btn.onclick = function() { nextScenario(); };
        } else {
            btn.textContent = 'Indice suivant ‚Üí';
            btn.onclick = function() { nextIndice(); };
        }
        btn.classList.add('show');
    }

    function nextIndice() {
        curIndice++;
        updateDetProgress();
        renderIndice();
    }

    function nextScenario() {
        curScenario++;
        loadScenario();
    }

    /* ========== CIRCUIT ========== */
    function startCircuit() {
        cirScore = 0;
        shuffledSituations = shuffle(circuitSituations);
        curSituation = 0;
        showSection('section-circuit');
        loadSituation();
    }

    function loadSituation() {
        var sit = shuffledSituations[curSituation];
        shuffledItems = shuffle(sit.items);
        curItem = 0;
        renderItem();
    }

    function renderItem() {
        var sit = shuffledSituations[curSituation];
        var item = shuffledItems[curItem];

        var html = '';
        html += '<div class="scenario-badge">Situation ' + (curSituation + 1) + ' / ' + shuffledSituations.length + '</div>';
        html += '<div class="scenario-context">' + sit.context + '</div>';

        html += '<div class="match-card" id="match-card">';
        html += '<div class="match-counter">√âl√©ment ' + (curItem + 1) + ' / ' + shuffledItems.length + '</div>';
        html += '<div class="match-text">¬´ ' + item.text + ' ¬ª</div>';
        html += '<div class="match-feedback" id="match-fb"></div>';
        html += '</div>';

        html += '<p style="font-size:0.82rem; color:#6b7280; margin-bottom:10px; text-align:center;">C\'est quoi dans le circuit ?</p>';

        html += '<div class="match-buttons" id="match-btns">';
        html += '<button class="match-btn" onclick="checkMatch(\'declencheur\')">üéØ D√©clencheur</button>';
        html += '<button class="match-btn" onclick="checkMatch(\'besoin\')">üíé Besoin</button>';
        html += '<button class="match-btn" onclick="checkMatch(\'emotion\')">‚ù§Ô∏è √âmotion</button>';
        html += '<button class="match-btn" onclick="checkMatch(\'action\')">‚ö° Action</button>';
        html += '</div>';

        html += '<button class="btn-next" id="btn-next-match" onclick="nextItem()">√âl√©ment suivant ‚Üí</button>';

        document.getElementById('circuit-container').innerHTML = html;
    }

    function checkMatch(choice) {
        var item = shuffledItems[curItem];
        var correct = choice === item.answer;
        var lbl = CIRCUIT_LABELS[item.answer];

        var btns = document.querySelectorAll('#match-btns .match-btn');
        for (var i = 0; i < btns.length; i++) btns[i].disabled = true;

        var card = document.getElementById('match-card');
        var fb = document.getElementById('match-fb');

        if (correct) {
            cirScore++;
            card.classList.add('correct');
            fb.className = 'match-feedback show ok';
            fb.textContent = '‚úì Exact ! C\'est bien ' + lbl.emoji + ' ' + lbl.label + '.';
        } else {
            card.classList.add('wrong');
            fb.className = 'match-feedback show ko';
            fb.textContent = '‚úó C\'√©tait ' + lbl.emoji + ' ' + lbl.label + '.';
        }

        var btn = document.getElementById('btn-next-match');
        var isLastItem = curItem >= shuffledItems.length - 1;
        var isLastSit = curSituation >= shuffledSituations.length - 1;

        if (isLastItem && isLastSit) {
            btn.textContent = 'Voir mon bilan ‚Üí';
            btn.onclick = function() { showBilan(); };
        } else if (isLastItem) {
            btn.textContent = 'Situation suivante ‚Üí';
            btn.onclick = function() { nextSituation(); };
        } else {
            btn.textContent = '√âl√©ment suivant ‚Üí';
            btn.onclick = function() { nextItem(); };
        }
        btn.classList.add('show');
    }

    function nextItem() {
        curItem++;
        renderItem();
    }

    function nextSituation() {
        curSituation++;
        loadSituation();
    }

    /* ========== BILAN ========== */
    function showBilan() {
        var total = detScore + cirScore;
        document.getElementById('final-score').textContent = total;

        var msg = '';
        if (total >= 24) msg = 'üåü Bravo ! Tu d√©codes les √©motions comme un pro !';
        else if (total >= 18) msg = 'üëè Bien jou√© ! Tu rep√®res de mieux en mieux les composantes des √©motions.';
        else msg = 'üí™ C\'est un bon d√©but ! Les √©motions sont complexes, continue √† les explorer.';

        document.getElementById('score-message').textContent = msg;
        showSection('section-bilan');
    }

    /* ========== RESET ========== */
    function resetAll() {
        detScore = 0; cirScore = 0;
        curScenario = 0; curIndice = 0;
        curSituation = 0; curItem = 0;
        showSection('section-intro');
    }
</script>

</body>
</html>
