<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPS C1.4 - D&eacute;cisions constructives</title>
    <style>
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f0f4f8;
            color: #1e293b;
            line-height: 1.6;
            min-height: 100vh;
            padding-bottom: 40px;
        }

        .container {
            max-width: 520px;
            margin: 0 auto;
            padding: 16px;
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            color: #3b82f6;
            text-decoration: none;
            font-size: 0.95rem;
            font-weight: 500;
            margin-bottom: 12px;
            transition: color 0.2s;
        }

        .back-btn:hover { color: #1d4ed8; }

        .header-card {
            background: linear-gradient(135deg, #2563eb, #3b82f6);
            border-radius: 15px;
            padding: 28px 24px;
            color: white;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
        }

        .header-card .emoji { font-size: 2.2rem; margin-bottom: 8px; }
        .header-card h1 { font-size: 1.6rem; margin-bottom: 8px; font-weight: 700; }
        .header-card p { font-size: 0.92rem; opacity: 0.92; line-height: 1.5; }

        .card {
            background: white;
            border-radius: 15px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            animation: fadeIn 0.4s ease;
        }

        .card-title {
            font-size: 1.15rem;
            font-weight: 700;
            color: #2563eb;
            margin-bottom: 16px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section { display: none; }
        .section.active { display: block; }

        .intro-text {
            font-size: 0.9rem;
            color: #475569;
            line-height: 1.6;
            margin-bottom: 16px;
        }

        .needs-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 16px 0;
        }

        .need-box {
            border-radius: 12px;
            padding: 14px 12px;
            text-align: center;
            font-size: 0.82rem;
            line-height: 1.45;
        }

        .need-box .box-icon {
            font-size: 1.4rem;
            display: block;
            margin-bottom: 6px;
        }

        .need-box .box-label {
            font-weight: 700;
            display: block;
            margin-bottom: 4px;
            font-size: 0.78rem;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .need-cognitif {
            background: #dbeafe;
            border: 2px solid #93c5fd;
            color: #1e40af;
        }

        .need-affectif {
            background: #fce7f3;
            border: 2px solid #f9a8d4;
            color: #9d174d;
        }

        .need-comportemental {
            background: #dcfce7;
            border: 2px solid #86efac;
            color: #166534;
        }

        .need-psychocorporel {
            background: #fef3c7;
            border: 2px solid #fcd34d;
            color: #92400e;
        }

        .highlight-text {
            font-size: 0.88rem;
            color: #1e293b;
            background: #f0f9ff;
            border-left: 3px solid #3b82f6;
            padding: 12px 14px;
            border-radius: 0 10px 10px 0;
            margin: 16px 0;
            line-height: 1.55;
        }

        .btn-primary {
            display: block;
            width: 100%;
            background: linear-gradient(135deg, #2563eb, #3b82f6);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 15px 24px;
            font-size: 1.05rem;
            font-weight: 700;
            cursor: pointer;
            font-family: inherit;
            margin-top: 8px;
            transition: transform 0.15s, box-shadow 0.15s;
            box-shadow: 0 3px 12px rgba(37, 99, 235, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 18px rgba(37, 99, 235, 0.35);
        }

        .progress-bar {
            height: 6px;
            background: #e2e8f0;
            border-radius: 20px;
            overflow: hidden;
            margin-bottom: 6px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2563eb, #3b82f6);
            border-radius: 20px;
            transition: width 0.4s ease;
        }

        .progress-text {
            font-size: 0.8rem;
            color: #94a3b8;
            text-align: right;
            margin-bottom: 16px;
        }

        .statement-card {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px 16px;
            margin-bottom: 16px;
            text-align: center;
        }

        .statement-text {
            font-size: 1.05rem;
            font-weight: 600;
            color: #1e293b;
            font-style: italic;
            line-height: 1.5;
        }

        .quiz-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 12px;
        }

        .quiz-btn {
            padding: 12px 8px;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
            background: white;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.82rem;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .quiz-btn.btn-cognitif { color: #1e40af; }
        .quiz-btn.btn-cognitif:hover { border-color: #3b82f6; background: #dbeafe; }
        .quiz-btn.btn-affectif { color: #9d174d; }
        .quiz-btn.btn-affectif:hover { border-color: #ec4899; background: #fce7f3; }
        .quiz-btn.btn-comportemental { color: #166534; }
        .quiz-btn.btn-comportemental:hover { border-color: #22c55e; background: #dcfce7; }
        .quiz-btn.btn-psychocorporel { color: #92400e; }
        .quiz-btn.btn-psychocorporel:hover { border-color: #f59e0b; background: #fef3c7; }
        .quiz-btn:disabled { opacity: 0.5; cursor: default; }

        .feedback-card {
            border-radius: 12px;
            padding: 14px 16px;
            margin-bottom: 12px;
            font-size: 0.88rem;
            line-height: 1.5;
            animation: fadeIn 0.3s ease;
        }

        .feedback-card.correct {
            background: #dcfce7;
            border: 2px solid #86efac;
            color: #166534;
        }

        .feedback-card.wrong {
            background: #fee2e2;
            border: 2px solid #fca5a5;
            color: #991b1b;
        }

        .feedback-icon { font-weight: 700; margin-right: 4px; }

        .btn-next {
            display: block;
            width: 100%;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px;
            font-size: 0.92rem;
            font-weight: 600;
            cursor: pointer;
            font-family: inherit;
            transition: background 0.2s;
        }

        .btn-next:hover { background: #2563eb; }

        .context-card {
            background: #dbeafe;
            border-radius: 12px;
            padding: 12px 14px;
            margin-bottom: 10px;
            font-size: 0.88rem;
            font-weight: 600;
            color: #1e40af;
        }

        .situation-text {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 14px 16px;
            margin-bottom: 14px;
            font-size: 0.92rem;
            color: #334155;
            line-height: 1.55;
        }

        .option-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 14px 16px;
            margin-bottom: 8px;
            cursor: pointer;
            font-size: 0.88rem;
            line-height: 1.5;
            transition: all 0.2s;
            animation: fadeIn 0.3s ease;
        }

        .option-card:hover { border-color: #3b82f6; background: #f0f7ff; }
        .option-card.disabled { pointer-events: none; opacity: 0.6; }
        .option-card.selected-correct { border-color: #22c55e; background: #dcfce7; opacity: 1; }
        .option-card.selected-wrong { border-color: #ef4444; background: #fee2e2; opacity: 1; }
        .option-card.reveal-correct { border-color: #22c55e; background: #dcfce7; opacity: 1; }

        .filter-reminder {
            background: #fffbeb;
            border: 2px solid #fcd34d;
            border-radius: 12px;
            padding: 12px 14px;
            margin-bottom: 14px;
            font-size: 0.82rem;
            color: #78350f;
            line-height: 1.5;
        }

        .filter-reminder strong {
            display: block;
            margin-bottom: 4px;
            font-size: 0.85rem;
        }

        .score-display {
            text-align: center;
            padding: 20px;
        }

        .score-number {
            font-size: 3rem;
            font-weight: 800;
            color: #2563eb;
            line-height: 1.1;
        }

        .score-total {
            font-size: 1.1rem;
            color: #94a3b8;
            font-weight: 500;
        }

        .score-message {
            margin-top: 14px;
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
            line-height: 1.45;
        }

        .synthesis-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 12px 14px;
            background: #dbeafe;
            border-radius: 10px;
            margin-bottom: 8px;
            font-size: 0.88rem;
            color: #1e3a5f;
            line-height: 1.5;
        }

        .synthesis-icon {
            font-size: 1.2rem;
            flex-shrink: 0;
        }
    </style>
</head>
<body>

<div class="container">
    <a href="index.html" class="back-btn">&larr; Retour</a>

    <div class="header-card">
        <div class="emoji">üß≠</div>
        <h1>Je prends les bonnes d&eacute;cisions</h1>
        <p>Identifie tes besoins psychologiques et apprends &agrave; faire des choix &eacute;clair&eacute;s</p>
    </div>

    <!-- SECTION 1 : INTRO -->
    <div id="section-intro" class="section active">
        <div class="card">
            <div class="card-title">üß© Les 12 besoins psychologiques</div>
            <p class="intro-text">Pour prendre de bonnes d&eacute;cisions, il faut d'abord conna&icirc;tre ses <strong>besoins psychologiques</strong>. Les chercheurs en ont identifi&eacute; 12, class&eacute;s en 4 familles :</p>

            <div class="needs-grid">
                <div class="need-box need-cognitif">
                    <span class="box-icon">üß†</span>
                    <span class="box-label">Cognitifs</span>
                    D&eacute;couverte, coh&eacute;rence, transcendance
                </div>
                <div class="need-box need-affectif">
                    <span class="box-icon">üíó</span>
                    <span class="box-label">Affectifs</span>
                    Amour, appartenance, reconnaissance
                </div>
                <div class="need-box need-comportemental">
                    <span class="box-icon">üéØ</span>
                    <span class="box-label">Comportementaux</span>
                    Libert&eacute;, comp&eacute;tence, r&eacute;alisation
                </div>
                <div class="need-box need-psychocorporel">
                    <span class="box-icon">üåø</span>
                    <span class="box-label">Psychocorporels</span>
                    Subsistance, stimulation, repos
                </div>
            </div>

            <div class="highlight-text">
                Un besoin est diff&eacute;rent d'une envie. Le besoin est essentiel &agrave; notre &eacute;quilibre ; l'envie est un d&eacute;sir passager. Pour bien d&eacute;cider, on utilise le <strong>filtre &agrave; besoins</strong> : Est-ce r&eacute;aliste ? Sous mon contr&ocirc;le ? Adapt&eacute; ? Y a-t-il une alternative ?
            </div>

            <button class="btn-primary" onclick="startQuiz()">üéØ Commencer le d&eacute;fi</button>
        </div>
    </div>

    <!-- SECTION 2 : QUIZ BESOINS -->
    <div id="section-quiz" class="section">
        <div class="card">
            <div class="card-title">üéØ Quelle famille de besoins ?</div>
            <p class="intro-text">Classe chaque besoin dans la bonne cat&eacute;gorie.</p>
            <div class="progress-bar"><div class="progress-fill" id="quiz-progress"></div></div>
            <div class="progress-text" id="quiz-progress-text"></div>
            <div id="quiz-container"></div>
        </div>
    </div>

    <!-- SECTION 3 : FILTRE √Ä BESOINS -->
    <div id="section-filtre" class="section">
        <div class="card">
            <div class="card-title">üîé Le filtre &agrave; besoins</div>
            <p class="intro-text">Un &eacute;l&egrave;ve identifie un besoin et choisit une strat&eacute;gie. &Agrave; toi d'&eacute;valuer si c'est le bon choix en utilisant le filtre.</p>
            <div class="filter-reminder">
                <strong>üìã Les 4 questions du filtre :</strong>
                1. Est-ce r&eacute;aliste ? &bull; 2. Est-ce sous mon contr&ocirc;le ? &bull; 3. Est-ce adapt&eacute; ? &bull; 4. Existe-t-il une meilleure alternative ?
            </div>
            <div class="progress-bar"><div class="progress-fill" id="filtre-progress"></div></div>
            <div class="progress-text" id="filtre-progress-text"></div>
            <div id="filtre-container"></div>
        </div>
    </div>

    <!-- SECTION 4 : BILAN -->
    <div id="section-bilan" class="section">
        <div class="card">
            <div class="score-display">
                <div class="score-number" id="final-score">0</div>
                <div class="score-total">/ 14</div>
                <div class="score-message" id="score-message"></div>
            </div>
        </div>

        <div class="card">
            <div class="card-title">Ce qu'il faut retenir</div>
            <div class="synthesis-item">
                <span class="synthesis-icon">üß©</span>
                <span>Nous avons 12 besoins psychologiques r&eacute;partis en 4 familles : cognitifs, affectifs, comportementaux et psychocorporels.</span>
            </div>
            <div class="synthesis-item">
                <span class="synthesis-icon">‚öñÔ∏è</span>
                <span>Un besoin est essentiel &agrave; notre &eacute;quilibre, contrairement &agrave; une simple envie passag&egrave;re.</span>
            </div>
            <div class="synthesis-item">
                <span class="synthesis-icon">üîé</span>
                <span>Le filtre &agrave; besoins aide &agrave; v&eacute;rifier nos strat&eacute;gies : r&eacute;aliste, sous contr&ocirc;le, adapt&eacute;, avec alternatives.</span>
            </div>
            <div class="synthesis-item">
                <span class="synthesis-icon">üß≠</span>
                <span>Une bonne d&eacute;cision tient compte de nos besoins et de nos valeurs, pas uniquement de la pression ext&eacute;rieure.</span>
            </div>

            <button class="btn-primary" onclick="resetAll()" style="margin-top:16px;">üîÑ Refaire l'exercice</button>
        </div>
    </div>
</div>

<footer style="text-align:center; padding:20px 16px; color:#94a3b8; font-size:0.78rem;">
    Comp&eacute;tences psychosociales ‚Äî R&eacute;f&eacute;rentiel Sant&eacute; publique France 2025
</footer>

<script>
    /* ========== DATA ========== */
    var quizItems = [
        { statement: "D\u00e9couvrir de nouvelles choses, \u00eatre curieux", answer: "cognitif", explanation: "La curiosit\u00e9 et le besoin de d\u00e9couverte font partie des besoins cognitifs." },
        { statement: "Se sentir aim\u00e9 et soutenu par ses proches", answer: "affectif", explanation: "Le besoin d'amour et d'affection est un besoin affectif fondamental." },
        { statement: "Pouvoir choisir librement ce que l'on fait", answer: "comportemental", explanation: "Le besoin de libert\u00e9 et d'autonomie est un besoin comportemental." },
        { statement: "Se reposer quand on est fatigu\u00e9", answer: "psychocorporel", explanation: "Le repos est un besoin psychocorporel essentiel \u00e0 l'\u00e9quilibre physique et mental." },
        { statement: "Faire partie d'un groupe, se sentir int\u00e9gr\u00e9", answer: "affectif", explanation: "Le besoin d'appartenance sociale est un besoin affectif et relationnel." },
        { statement: "Comprendre le monde qui nous entoure", answer: "cognitif", explanation: "Le besoin de coh\u00e9rence et de compr\u00e9hension est un besoin cognitif." },
        { statement: "Se sentir comp\u00e9tent dans ce que l'on fait", answer: "comportemental", explanation: "Le besoin de comp\u00e9tence, c'est sentir qu'on ma\u00eetrise ce qu'on entreprend. C'est comportemental." },
        { statement: "Vivre des exp\u00e9riences stimulantes et vari\u00e9es", answer: "psychocorporel", explanation: "Le besoin de stimulation (sensations, nouveaut\u00e9 physique) est psychocorporel." },
        { statement: "\u00catre reconnu pour ce que l'on est", answer: "affectif", explanation: "Le besoin de reconnaissance et de confirmation de soi est un besoin affectif." },
        { statement: "R\u00e9aliser quelque chose dont on est fier", answer: "comportemental", explanation: "Le besoin de r\u00e9alisation et d'accomplissement est un besoin comportemental." }
    ];

    var filtreItems = [
        {
            context: "\ud83d\udcdd Besoin : reconnaissance",
            situation: "Un \u00e9l\u00e8ve veut se sentir reconnu par ses camarades. Il envisage plusieurs strat\u00e9gies.",
            options: [
                { text: "Tricher \u00e0 un contr\u00f4le pour avoir la meilleure note et impressionner les autres.", correct: false, feedback: "Ce n'est pas adapt\u00e9 : tricher n'est pas r\u00e9aliste \u00e0 long terme, comporte des risques et ne r\u00e9pond pas vraiment au besoin de reconnaissance authentique." },
                { text: "Proposer son aide \u00e0 un camarade en difficult\u00e9 et partager ses comp\u00e9tences.", correct: true, feedback: "R\u00e9aliste, sous son contr\u00f4le, adapt\u00e9 au contexte scolaire. Aider les autres est un moyen durable d'obtenir de la reconnaissance." },
                { text: "Se vanter de ses r\u00e9sultats \u00e0 chaque occasion pour attirer l'attention.", correct: false, feedback: "Bien que ce soit sous son contr\u00f4le, ce n'est pas adapt\u00e9 : se vanter produit souvent l'effet inverse et \u00e9loigne les autres." }
            ]
        },
        {
            context: "\ud83d\udcdd Besoin : appartenance",
            situation: "Un \u00e9l\u00e8ve se sent isol\u00e9 au lyc\u00e9e et a besoin de se sentir int\u00e9gr\u00e9.",
            options: [
                { text: "S'inscrire \u00e0 un club ou une activit\u00e9 du lyc\u00e9e pour rencontrer d'autres \u00e9l\u00e8ves.", correct: true, feedback: "R\u00e9aliste, sous son contr\u00f4le, adapt\u00e9 au lyc\u00e9e. Les activit\u00e9s partag\u00e9es sont un excellent moyen de cr\u00e9er des liens." },
                { text: "Exiger que les autres l'int\u00e8grent dans leur groupe d'amis.", correct: false, feedback: "Ce n'est pas sous son contr\u00f4le : on ne peut pas forcer les autres. Et la m\u00e9thode n'est pas adapt\u00e9e pour cr\u00e9er de vrais liens." },
                { text: "Rester seul en se disant que c'est normal et que \u00e7a passera.", correct: false, feedback: "Ce n'est pas une strat\u00e9gie active. Le besoin d'appartenance ne se r\u00e9sout pas en l'ignorant." }
            ]
        },
        {
            context: "\ud83d\udcdd Besoin : repos",
            situation: "Un \u00e9l\u00e8ve est \u00e9puis\u00e9 par les r\u00e9visions et a besoin de r\u00e9cup\u00e9rer.",
            options: [
                { text: "Arr\u00eater compl\u00e8tement de r\u00e9viser pendant une semaine enti\u00e8re.", correct: false, feedback: "Ce n'est pas adapt\u00e9 au contexte scolaire : arr\u00eater longtemps risque de cr\u00e9er un retard difficile \u00e0 rattraper." },
                { text: "Planifier des pauses r\u00e9guli\u00e8res dans son emploi du temps de r\u00e9vision.", correct: true, feedback: "R\u00e9aliste, sous son contr\u00f4le, adapt\u00e9 au contexte. Les pauses r\u00e9guli\u00e8res favorisent la r\u00e9cup\u00e9ration et la m\u00e9morisation." },
                { text: "Boire beaucoup de caf\u00e9 pour tenir le rythme malgr\u00e9 la fatigue.", correct: false, feedback: "Ce n'est pas adapt\u00e9 : masquer la fatigue n'est pas r\u00e9pondre au besoin de repos. Il existe de meilleures alternatives." }
            ]
        },
        {
            context: "\ud83d\udcdd Besoin : libert\u00e9",
            situation: "Un \u00e9l\u00e8ve sent que ses parents contr\u00f4lent tout et a besoin de plus d'autonomie.",
            options: [
                { text: "Faire syst\u00e9matiquement le contraire de ce que ses parents demandent.", correct: false, feedback: "Ce n'est pas adapt\u00e9 : l'opposition syst\u00e9matique cr\u00e9e des conflits sans apporter de vraie libert\u00e9." },
                { text: "Proposer un dialogue pour n\u00e9gocier progressivement plus de responsabilit\u00e9s.", correct: true, feedback: "R\u00e9aliste, sous son contr\u00f4le, adapt\u00e9. N\u00e9gocier montre de la maturit\u00e9 et construit la confiance n\u00e9cessaire \u00e0 plus d'autonomie." },
                { text: "Mentir sur ses activit\u00e9s pour faire ce qu'il veut sans qu'ils le sachent.", correct: false, feedback: "Ce n'est pas adapt\u00e9 : le mensonge fragilise la confiance et peut limiter encore plus la libert\u00e9 \u00e0 long terme." }
            ]
        }
    ];

    /* ========== STATE ========== */
    var shuffledQuiz = [];
    var currentQuiz = 0;
    var quizScore = 0;

    var shuffledFiltre = [];
    var currentFiltre = 0;
    var filtreScore = 0;

    /* ========== UTILITIES ========== */
    function shuffle(arr) {
        var a = arr.slice();
        for (var i = a.length - 1; i > 0; i--) {
            var j = Math.floor(Math.random() * (i + 1));
            var tmp = a[i]; a[i] = a[j]; a[j] = tmp;
        }
        return a;
    }

    function showSection(id) {
        var sections = document.querySelectorAll('.section');
        for (var i = 0; i < sections.length; i++) sections[i].classList.remove('active');
        document.getElementById(id).classList.add('active');
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    /* ========== QUIZ BESOINS ========== */
    var catLabels = {
        cognitif: { icon: "\ud83e\udde0", label: "Cognitif" },
        affectif: { icon: "\ud83d\udc97", label: "Affectif" },
        comportemental: { icon: "\ud83c\udfaf", label: "Comportemental" },
        psychocorporel: { icon: "\ud83c\udf3f", label: "Psychocorporel" }
    };

    function startQuiz() {
        shuffledQuiz = shuffle(quizItems);
        currentQuiz = 0;
        quizScore = 0;
        showSection('section-quiz');
        renderQuiz();
    }

    function renderQuiz() {
        var item = shuffledQuiz[currentQuiz];
        var total = shuffledQuiz.length;
        var pct = (currentQuiz / total) * 100;

        document.getElementById('quiz-progress').style.width = pct + '%';
        document.getElementById('quiz-progress-text').textContent = 'Question ' + (currentQuiz + 1) + ' / ' + total;

        var html = '';
        html += '<div class="statement-card"><div class="statement-text">&laquo; ' + item.statement + ' &raquo;</div></div>';
        html += '<div class="quiz-buttons">';
        html += '<button class="quiz-btn btn-cognitif" onclick="answerQuiz(\'cognitif\')">üß† Cognitif</button>';
        html += '<button class="quiz-btn btn-affectif" onclick="answerQuiz(\'affectif\')">üíó Affectif</button>';
        html += '<button class="quiz-btn btn-comportemental" onclick="answerQuiz(\'comportemental\')">üéØ Comportemental</button>';
        html += '<button class="quiz-btn btn-psychocorporel" onclick="answerQuiz(\'psychocorporel\')">üåø Psychocorporel</button>';
        html += '</div>';
        html += '<div id="quiz-feedback"></div>';

        document.getElementById('quiz-container').innerHTML = html;
    }

    function answerQuiz(answer) {
        var item = shuffledQuiz[currentQuiz];
        var correct = answer === item.answer;
        if (correct) quizScore++;

        var btns = document.querySelectorAll('#quiz-container .quiz-btn');
        for (var i = 0; i < btns.length; i++) btns[i].disabled = true;

        var fbClass = correct ? 'correct' : 'wrong';
        var fbIcon = correct ? '\u2713' : '\u2717';
        var rightCat = catLabels[item.answer];
        var fbText = correct
            ? '<span class="feedback-icon">' + fbIcon + '</span> Bonne r\u00e9ponse ! ' + item.explanation
            : '<span class="feedback-icon">' + fbIcon + '</span> C\u2019\u00e9tait ' + rightCat.icon + ' <strong>' + rightCat.label + '</strong>. ' + item.explanation;

        var isLast = currentQuiz >= shuffledQuiz.length - 1;
        var btnLabel = isLast ? 'Passer au filtre \u00e0 besoins \u2192' : 'Suivant \u2192';
        var btnAction = isLast ? 'startFiltre()' : 'nextQuiz()';

        var html = '<div class="feedback-card ' + fbClass + '">' + fbText + '</div>';
        html += '<button class="btn-next" onclick="' + btnAction + '">' + btnLabel + '</button>';

        document.getElementById('quiz-feedback').innerHTML = html;
    }

    function nextQuiz() {
        currentQuiz++;
        renderQuiz();
    }

    /* ========== FILTRE √Ä BESOINS ========== */
    function startFiltre() {
        shuffledFiltre = shuffle(filtreItems);
        currentFiltre = 0;
        filtreScore = 0;
        showSection('section-filtre');
        renderFiltre();
    }

    function renderFiltre() {
        var item = shuffledFiltre[currentFiltre];
        var total = shuffledFiltre.length;
        var pct = (currentFiltre / total) * 100;

        document.getElementById('filtre-progress').style.width = pct + '%';
        document.getElementById('filtre-progress-text').textContent = (currentFiltre + 1) + ' / ' + total;

        var shuffledOpts = shuffle(item.options);

        var html = '';
        html += '<div class="context-card">' + item.context + '</div>';
        html += '<div class="situation-text">' + item.situation + '</div>';

        for (var i = 0; i < shuffledOpts.length; i++) {
            var o = shuffledOpts[i];
            html += '<div class="option-card" data-correct="' + o.correct + '" data-feedback="' + o.feedback.replace(/"/g, '&quot;') + '" onclick="answerFiltre(this)">' + o.text + '</div>';
        }

        html += '<div id="filtre-feedback"></div>';
        document.getElementById('filtre-container').innerHTML = html;
    }

    function answerFiltre(el) {
        var correct = el.getAttribute('data-correct') === 'true';
        var feedback = el.getAttribute('data-feedback');
        if (correct) filtreScore++;

        var cards = document.querySelectorAll('#filtre-container .option-card');
        for (var i = 0; i < cards.length; i++) cards[i].classList.add('disabled');

        if (correct) {
            el.classList.add('selected-correct');
        } else {
            el.classList.add('selected-wrong');
            for (var i = 0; i < cards.length; i++) {
                if (cards[i].getAttribute('data-correct') === 'true') cards[i].classList.add('reveal-correct');
            }
        }

        var fbClass = correct ? 'correct' : 'wrong';
        var fbIcon = correct ? '\u2713' : '\u2717';
        var isLast = currentFiltre >= shuffledFiltre.length - 1;
        var btnLabel = isLast ? 'Voir mon bilan \u2192' : 'Suite \u2192';
        var btnAction = isLast ? 'showBilan()' : 'nextFiltre()';

        var html = '<div class="feedback-card ' + fbClass + '"><span class="feedback-icon">' + fbIcon + '</span> ' + feedback + '</div>';
        html += '<button class="btn-next" onclick="' + btnAction + '">' + btnLabel + '</button>';

        document.getElementById('filtre-feedback').innerHTML = html;
    }

    function nextFiltre() {
        currentFiltre++;
        renderFiltre();
    }

    /* ========== BILAN ========== */
    function showBilan() {
        var total = quizScore + filtreScore;
        document.getElementById('final-score').textContent = total;

        var msg = '';
        if (total >= 12) msg = '\ud83c\udf1f Excellent ! Tu sais identifier tes besoins et \u00e9valuer tes strat\u00e9gies de d\u00e9cision.';
        else if (total >= 8) msg = '\ud83d\udc4f Bien jou\u00e9 ! Tu progresses dans l\u2019art de prendre des d\u00e9cisions \u00e9clair\u00e9es.';
        else msg = '\ud83d\udcaa C\u2019est un bon d\u00e9but ! Continue \u00e0 explorer tes besoins pour mieux d\u00e9cider.';

        document.getElementById('score-message').textContent = msg;
        showSection('section-bilan');
    }

    /* ========== RESET ========== */
    function resetAll() {
        currentQuiz = 0; quizScore = 0;
        currentFiltre = 0; filtreScore = 0;
        showSection('section-intro');
    }
</script>

</body>
</html>
