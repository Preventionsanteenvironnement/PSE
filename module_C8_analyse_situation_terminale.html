<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module C.8 - Analyse de Situation Professionnelle - Bac Pro Terminale</title>
    <style>
        /* RESPONSIVE MOBILE-FIRST OBLIGATOIRE */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        /* Variables CSS - Charte graphique unifi√©e PSE */
        :root {
            --primary-pse: #2E86AB;
            --secondary-pse: #A23B72;
            --success-pse: #219653;
            --warning-pse: #F2994A;
            --danger-pse: #EB5757;
            --dark-pse: #2F3542;
            --light-pse: #F1F2F6;
        }

        /* ACCESSIBILIT√â - Police OpenDyslexie */
        @import url('https://fonts.googleapis.com/css2?family=OpenDyslexic:wght@400;700&display=swap');
        
        .dyslexie-mode {
            font-family: 'OpenDyslexic', sans-serif !important;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--dark-pse);
            background: linear-gradient(135deg, var(--light-pse) 0%, #ffffff 100%);
            min-height: 100vh;
            font-size: 16px;
        }

        /* Mobile d'abord */
        .exercice-container {
            width: 100%;
            max-width: 100vw;
            padding: 15px;
            font-size: 16px;
        }

        /* EN-T√äTE P√âDAGOGIQUE OBLIGATOIRE */
        .cadre-pedagogique {
            background: linear-gradient(135deg, var(--primary-pse), var(--secondary-pse));
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(46, 134, 171, 0.2);
        }

        .module-info h2 {
            font-size: 1.8em;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .objectif {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        .competences-travaillees {
            margin-bottom: 15px;
        }

        .competences-list {
            list-style: none;
            display: grid;
            gap: 10px;
            margin-top: 10px;
        }

        .competences-list li {
            background: rgba(255, 255, 255, 0.15);
            padding: 10px;
            border-radius: 8px;
            backdrop-filter: blur(5px);
        }

        /* Codes couleur comp√©tences */
        .competence-c1 { border-left: 5px solid #E74C3C; }
        .competence-c2 { border-left: 5px solid #3498DB; }
        .competence-c3 { border-left: 5px solid #2ECC71; }
        .competence-c4 { border-left: 5px solid #F39C12; }
        .competence-c5 { border-left: 5px solid #9B59B6; }
        .competence-c6 { border-left: 5px solid #1ABC9C; }

        .niveau-cible {
            text-align: center;
            font-weight: 600;
            font-size: 1.1em;
        }

        /* EXERCICE PRINCIPAL */
        .exercice-principal {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .situation-professionnelle {
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            border-left: 6px solid var(--primary-pse);
        }

        .situation-titre {
            font-size: 1.4em;
            color: var(--primary-pse);
            margin-bottom: 15px;
            font-weight: 600;
        }

        .situation-contexte {
            font-style: italic;
            color: var(--secondary-pse);
            margin-bottom: 15px;
        }

        .question-block {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .question-block:hover {
            border-color: var(--primary-pse);
            box-shadow: 0 4px 12px rgba(46, 134, 171, 0.1);
        }

        .question-titre {
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--dark-pse);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .competence-badge {
            background: var(--primary-pse);
            color: white;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 500;
        }

        .options-container {
            display: grid;
            gap: 10px;
            margin-top: 15px;
        }

        .option {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .option:hover {
            border-color: var(--primary-pse);
            background: rgba(46, 134, 171, 0.05);
        }

        .option.selected {
            border-color: var(--success-pse);
            background: rgba(33, 150, 83, 0.1);
        }

        .option.correct {
            border-color: var(--success-pse);
            background: rgba(33, 150, 83, 0.15);
        }

        .option.incorrect {
            border-color: var(--danger-pse);
            background: rgba(235, 87, 87, 0.15);
        }

        input[type="radio"], input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
        }

        /* ZONE REM√âDIATION */
        .zone-remediation {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            display: none;
        }

        .zone-remediation.show {
            display: block;
            animation: slideIn 0.5s ease-in-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* CORRIG√âS EXPLICATIFS */
        .corriges-explicatifs {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            display: none;
        }

        .corriges-explicatifs.show {
            display: block;
        }

        .corrige-explicatif {
            border-left: 4px solid var(--success-pse);
            padding-left: 20px;
            margin-bottom: 20px;
        }

        .explication-competence {
            background: rgba(33, 150, 83, 0.05);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        /* NAVIGATION */
        .navigation-exercice {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 30px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
            min-width: 120px;
        }

        .btn-primary {
            background: var(--primary-pse);
            color: white;
        }

        .btn-primary:hover {
            background: #1e5d7a;
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success-pse);
            color: white;
        }

        .btn-warning {
            background: var(--warning-pse);
            color: white;
        }

        /* ACCESSIBILIT√â - Synth√®se vocale */
        .speech-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 50px;
            padding: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            z-index: 1000;
            display: flex;
            gap: 10px;
        }

        .speech-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            background: var(--primary-pse);
            color: white;
            cursor: pointer;
            font-size: 1.2em;
            transition: all 0.3s ease;
        }

        .speech-btn:hover {
            background: var(--secondary-pse);
        }

        /* PROGRESSION PAR PALIERS */
        .progress-container {
            background: white;
            border-radius: 25px;
            height: 8px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--success-pse), var(--primary-pse));
            width: 0%;
            transition: width 0.5s ease;
        }

        .progress-info {
            text-align: center;
            margin: 10px 0;
            font-weight: 600;
            color: var(--dark-pse);
        }

        /* RGPD FOOTER */
        .rgpd-notice {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            font-size: 0.9em;
            color: #6c757d;
            text-align: center;
            border-top: 2px solid var(--light-pse);
        }

        /* Tablette */
        @media (min-width: 768px) {
            .exercice-container {
                padding: 20px;
                font-size: 17px;
            }
            
            .competences-list {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .options-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Desktop */  
        @media (min-width: 1024px) {
            .exercice-container {
                max-width: 900px;
                margin: 0 auto;
                padding: 30px;
                font-size: 18px;
            }
            
            .competences-list {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* Animation d'apparition */
        .fade-in {
            animation: fadeIn 0.6s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="exercice-container">
        <!-- EN-T√äTE P√âDAGOGIQUE OBLIGATOIRE -->
        <div class="cadre-pedagogique">
            <div class="module-info">
                <h2>Module C.8 : D√©claration et r√©paration des accidents du travail et des maladies professionnelles</h2>
                <div class="objectif">
                    <strong>Objectif :</strong> Expliquer les d√©marches √† accomplir pour d√©clarer un accident du travail ou une maladie professionnelle
                </div>
            </div>
            
            <div class="competences-travaillees">
                <h3>Comp√©tences travaill√©es dans cet exercice :</h3>
                <ul class="competences-list">
                    <li class="competence-c2"><strong>C2</strong> - Appliquer une d√©marche d'analyse dans une situation donn√©e</li>
                    <li class="competence-c4"><strong>C4</strong> - Proposer une solution pour r√©soudre un probl√®me</li>
                    <li class="competence-c5"><strong>C5</strong> - Argumenter un choix</li>
                    <li class="competence-c6"><strong>C6</strong> - Communiquer √† l'√©crit et √† l'oral avec une syntaxe claire et un vocabulaire adapt√©</li>
                </ul>
            </div>
            
            <div class="niveau-cible">
                <strong>Niveau :</strong> Bac Pro Terminale
            </div>
        </div>

        <!-- CONTR√îLES D'ACCESSIBILIT√â -->
        <div class="speech-controls">
            <button class="speech-btn" id="playBtn" title="Lire le contenu" onclick="toggleSpeech()">üîä</button>
            <button class="speech-btn" id="dyslexieBtn" title="Police OpenDyslexie" onclick="toggleDyslexieFont()">üëÅ</button>
        </div>

        <!-- PROGRESSION PAR PALIERS -->
        <div class="progress-info">
            <span id="progressText">Progression : √âtape 1/4</span>
        </div>
        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <!-- EXERCICE PRINCIPAL -->
        <main class="exercice-principal">
            <div class="situation-professionnelle">
                <div class="situation-titre">üèóÔ∏è Situation professionnelle : Stage en entreprise de BTP</div>
                <div class="situation-contexte">
                    Vous √™tes stagiaire dans l'entreprise BATIMAC sp√©cialis√©e dans la r√©novation. 
                    En tant que futur(e) professionnel(le), vous devez ma√Ætriser les proc√©dures AT/MP.
                </div>
                <p>
                    <strong>Contexte :</strong> Thomas, ma√ßon de 25 ans, chute d'un √©chafaudage mal fix√© et se fracture le poignet. 
                    Sarah, peintre de 30 ans, d√©veloppe un ecz√©ma chronique apr√®s 5 ans d'exposition aux solvants.
                    En tant que stagiaire responsable, vous devez conseiller vos coll√®gues sur les d√©marches √† suivre.
                </p>
            </div>

            <!-- √âTAPE 1 : Analyse des situations -->
            <div class="question-block fade-in" id="etape1">
                <div class="question-titre">
                    <span class="competence-badge">C2</span>
                    √âtape 1 : Qualification des √©v√©nements
                </div>
                <p><strong>Analysez chaque situation et qualifiez l'√©v√©nement.</strong></p>
                
                <div style="margin: 20px 0;">
                    <h4>Situation de Thomas (chute d'√©chafaudage)</h4>
                    <div class="options-container">
                        <label class="option">
                            <input type="radio" name="thomas" value="at"> Accident du travail
                        </label>
                        <label class="option">
                            <input type="radio" name="thomas" value="mp"> Maladie professionnelle
                        </label>
                        <label class="option">
                            <input type="radio" name="thomas" value="trajet"> Accident de trajet
                        </label>
                        <label class="option">
                            <input type="radio" name="thomas" value="prive"> Accident de la vie priv√©e
                        </label>
                    </div>
                </div>

                <div style="margin: 20px 0;">
                    <h4>Situation de Sarah (ecz√©ma li√© aux solvants)</h4>
                    <div class="options-container">
                        <label class="option">
                            <input type="radio" name="sarah" value="at"> Accident du travail
                        </label>
                        <label class="option">
                            <input type="radio" name="sarah" value="mp"> Maladie professionnelle
                        </label>
                        <label class="option">
                            <input type="radio" name="sarah" value="trajet"> Accident de trajet
                        </label>
                        <label class="option">
                            <input type="radio" name="sarah" value="allergie"> Allergie personnelle
                        </label>
                    </div>
                </div>
            </div>

            <!-- √âTAPE 2 : Proc√©dures de d√©claration -->
            <div class="question-block" id="etape2" style="display: none;">
                <div class="question-titre">
                    <span class="competence-badge">C4</span>
                    √âtape 2 : Proc√©dures de d√©claration
                </div>
                <p><strong>Quelles d√©marches conseillez-vous pour chaque situation ?</strong></p>

                <div style="margin: 20px 0;">
                    <h4>Pour Thomas (AT confirm√©) :</h4>
                    <div class="options-container">
                        <label class="option">
                            <input type="checkbox" name="demarches_thomas" value="24h"> Informer l'employeur dans les 24h
                        </label>
                        <label class="option">
                            <input type="checkbox" name="demarches_thomas" value="medical"> Consulter un m√©decin pour certificat m√©dical
                        </label>
                        <label class="option">
                            <input type="checkbox" name="demarches_thomas" value="48h"> L'employeur d√©clare √† la CPAM sous 48h
                        </label>
                        <label class="option">
                            <input type="checkbox" name="demarches_thomas" value="feuille"> R√©cup√©rer la feuille d'accident du travail
                        </label>
                    </div>
                </div>

                <div style="margin: 20px 0;">
                    <h4>Pour Sarah (MP suspect√©e) :</h4>
                    <div class="options-container">
                        <label class="option">
                            <input type="checkbox" name="demarches_sarah" value="15j"> D√©clarer √† la CPAM dans les 15 jours
                        </label>
                        <label class="option">
                            <input type="checkbox" name="demarches_sarah" value="cmi"> Obtenir un certificat m√©dical initial (CMI)
                        </label>
                        <label class="option">
                            <input type="checkbox" name="demarches_sarah" value="tableau"> V√©rifier si l'ecz√©ma figure dans les tableaux MP
                        </label>
                        <label class="option">
                            <input type="checkbox" name="demarches_sarah" value="salaire"> Joindre une attestation de salaire
                        </label>
                    </div>
                </div>
            </div>

            <!-- √âTAPE 3 : Calcul d'indemnisation -->
            <div class="question-block" id="etape3" style="display: none;">
                <div class="question-titre">
                    <span class="competence-badge">C5</span>
                    √âtape 3 : Indemnisation
                </div>
                <p><strong>Thomas sera arr√™t√© 35 jours avec un salaire de 1800‚Ç¨/mois. Calculez son indemnisation.</strong></p>

                <div style="margin: 20px 0;">
                    <p>Salaire journalier de base : 1800‚Ç¨ √∑ 30,42 = 59,17‚Ç¨</p>
                    
                    <h4>Indemnit√©s journali√®res pour les 28 premiers jours (60% du salaire) :</h4>
                    <div class="options-container">
                        <label class="option">
                            <input type="radio" name="calcul1" value="a"> 995,64‚Ç¨
                        </label>
                        <label class="option">
                            <input type="radio" name="calcul1" value="b"> 1108,80‚Ç¨
                        </label>
                        <label class="option">
                            <input type="radio" name="calcul1" value="c"> 1327,56‚Ç¨
                        </label>
                    </div>

                    <h4>Indemnit√©s journali√®res pour les 7 derniers jours (80% du salaire) :</h4>
                    <div class="options-container">
                        <label class="option">
                            <input type="radio" name="calcul2" value="a"> 295,85‚Ç¨
                        </label>
                        <label class="option">
                            <input type="radio" name="calcul2" value="b"> 331,15‚Ç¨
                        </label>
                        <label class="option">
                            <input type="radio" name="calcul2" value="c"> 414,19‚Ç¨
                        </label>
                    </div>
                </div>
            </div>

            <!-- √âTAPE 4 : Responsabilit√©s employeur -->
            <div class="question-block" id="etape4" style="display: none;">
                <div class="question-titre">
                    <span class="competence-badge">C6</span>
                    √âtape 4 : Responsabilit√©s de l'employeur
                </div>
                <p><strong>R√©digez un rapport argument√© sur les responsabilit√©s de l'employeur dans ces deux situations.</strong></p>

                <div style="margin: 20px 0;">
                    <h4>Concernant l'√©chafaudage mal fix√© (Thomas) :</h4>
                    <textarea id="rapport_thomas" placeholder="Analysez les responsabilit√©s civile et p√©nale de l'employeur..." 
                              style="width: 100%; height: 120px; border-radius: 8px; border: 2px solid #e9ecef; padding: 15px;"></textarea>
                </div>

                <div style="margin: 20px 0;">
                    <h4>Concernant l'exposition aux solvants (Sarah) :</h4>
                    <textarea id="rapport_sarah" placeholder="Analysez les obligations de pr√©vention et les cons√©quences..." 
                              style="width: 100%; height: 120px; border-radius: 8px; border: 2px solid #e9ecef; padding: 15px;"></textarea>
                </div>
            </div>
        </main>

        <!-- ZONE REM√âDIATION -->
        <div class="zone-remediation" id="zoneremediation">
            <h3>üí° Aide personnalis√©e</h3>
            <div id="messageRemediation"></div>
        </div>

        <!-- CORRIG√âS EXPLICATIFS -->
        <div class="corriges-explicatifs" id="corriges">
            <h3>üéØ Corrig√©s explicatifs d√©taill√©s</h3>
            
            <div class="corrige-explicatif">
                <h4>√âtape 1 : Qualification des √©v√©nements</h4>
                <div class="explication-competence">
                    <strong>Comp√©tence C2 :</strong> Pour qualifier un √©v√©nement, vous devez analyser :
                    <ul style="margin: 10px 0 10px 20px;">
                        <li><strong>Thomas :</strong> Accident du travail ‚úì (√©v√©nement soudain, sur lieu de travail, pendant horaires)</li>
                        <li><strong>Sarah :</strong> Maladie professionnelle ‚úì (exposition chronique, lien avec l'activit√© professionnelle)</li>
                    </ul>
                </div>
                <div class="pour-aller-plus-loin">
                    <strong>üí° Pour progresser :</strong>
                    <p>Retenez les 3 crit√®res AT : soudainet√© + lieu/temps de travail + l√©sion. Pour les MP : exposition chronique + tableaux officiel + d√©lai de prise en charge.</p>
                </div>
            </div>

            <div class="corrige-explicatif">
                <h4>√âtape 2 : Proc√©dures de d√©claration</h4>
                <div class="explication-competence">
                    <strong>Comp√©tence C4 :</strong> D√©marches AT vs MP :
                    <ul style="margin: 10px 0 10px 20px;">
                        <li><strong>AT (Thomas) :</strong> Toutes les r√©ponses sont correctes ‚úì</li>
                        <li><strong>MP (Sarah) :</strong> Toutes les r√©ponses sont correctes ‚úì</li>
                    </ul>
                </div>
                <div class="pour-aller-plus-loin">
                    <strong>üí° Pour progresser :</strong>
                    <p>M√©morisez : AT = 24h + 48h / MP = 15j + CMI. Ces d√©lais sont cruciaux pour l'indemnisation.</p>
                </div>
            </div>

            <div class="corrige-explicatif">
                <h4>√âtape 3 : Calcul d'indemnisation</h4>
                <div class="explication-competence">
                    <strong>Comp√©tence C5 :</strong> Calculs corrects :
                    <ul style="margin: 10px 0 10px 20px;">
                        <li><strong>28 premiers jours :</strong> 59,17‚Ç¨ √ó 60% √ó 28 = 995,64‚Ç¨ ‚úì</li>
                        <li><strong>7 derniers jours :</strong> 59,17‚Ç¨ √ó 80% √ó 7 = 331,15‚Ç¨ ‚úì</li>
                        <li><strong>Total :</strong> 1326,79‚Ç¨</li>
                    </ul>
                </div>
                <div class="pour-aller-plus-loin">
                    <strong>üí° Pour progresser :</strong>
                    <p>Formule cl√© : Salaire brut / 30,42 = salaire journalier. Puis 60% (28j) et 80% (√† partir 29e j).</p>
                </div>
            </div>

            <div class="corrige-explicatif">
                <h4>√âtape 4 : Responsabilit√©s employeur</h4>
                <div class="explication-competence">
                    <strong>Comp√©tence C6 :</strong> √âl√©ments attendus dans votre rapport :
                    <ul style="margin: 10px 0 10px 20px;">
                        <li><strong>√âchafaudage :</strong> Faute inexcusable possible, responsabilit√© p√©nale (non-respect r√®gles s√©curit√©)</li>
                        <li><strong>Solvants :</strong> Obligation de pr√©vention, formation, EPI, surveillance m√©dicale</li>
                        <li><strong>Cons√©quences :</strong> Majoration rentes, dommages-int√©r√™ts, amendes</li>
                    </ul>
                </div>
                <div class="pour-aller-plus-loin">
                    <strong>üí° Pour progresser :</strong>
                    <p>L'employeur a une obligation de s√©curit√© de r√©sultat. Distinguez responsabilit√© civile (r√©paration) et p√©nale (sanction).</p>
                </div>
            </div>
        </div>

        <!-- NAVIGATION/PROGRESSION -->
        <div class="navigation-exercice">
            <button class="btn btn-primary" id="precedentBtn" onclick="precedent()" disabled>‚¨ÖÔ∏è Pr√©c√©dent</button>
            <button class="btn btn-primary" id="suivantBtn" onclick="suivant()">Suivant ‚û°Ô∏è</button>
            <button class="btn btn-warning" id="aideBtn" onclick="demanderAide()">üÜò Aide</button>
            <button class="btn btn-success" id="corrigerBtn" onclick="corriger()" style="display: none;">‚úÖ Corriger</button>
            <button class="btn btn-success" id="corrigesBtn" onclick="afficherCorriges()" style="display: none;">üìñ Voir corrig√©s</button>
        </div>

        <!-- RGPD FOOTER -->
        <div class="rgpd-notice">
            <p>üîí <strong>Conformit√© RGPD :</strong> Cet exercice respecte votre anonymat. Aucune donn√©e personnelle n'est collect√©e. 
            Vos r√©ponses sont trait√©es localement √† des fins p√©dagogiques uniquement.</p>
        </div>
    </div>

    <script>
        // VARIABLES GLOBALES
        let etapeActuelle = 1;
        let totalEtapes = 4;
        let performances = {
            C2: { tentatives: 0, reussites: 0 },
            C4: { tentatives: 0, reussites: 0 },
            C5: { tentatives: 0, reussites: 0 },
            C6: { tentatives: 0, reussites: 0 }
        };
        let sessionId = 'session_' + Date.now();

        // SYST√àME DE PROGRESSION PAR PALIERS
        function mettreAJourProgression() {
            const pourcentage = (etapeActuelle / totalEtapes) * 100;
            document.getElementById('progressBar').style.width = pourcentage + '%';
            document.getElementById('progressText').textContent = `Progression : √âtape ${etapeActuelle}/${totalEtapes}`;
        }

        function suivant() {
            if (etapeActuelle < totalEtapes) {
                // Valider l'√©tape actuelle
                const estValide = validerEtape(etapeActuelle);
                
                if (estValide) {
                    // Masquer √©tape actuelle
                    document.getElementById('etape' + etapeActuelle).style.display = 'none';
                    
                    // Afficher √©tape suivante
                    etapeActuelle++;
                    const prochaine = document.getElementById('etape' + etapeActuelle);
                    if (prochaine) {
                        prochaine.style.display = 'block';
                        prochaine.classList.add('fade-in');
                    }
                    
                    // Mettre √† jour navigation
                    document.getElementById('precedentBtn').disabled = false;
                    if (etapeActuelle === totalEtapes) {
                        document.getElementById('suivantBtn').style.display = 'none';
                        document.getElementById('corrigerBtn').style.display = 'inline-block';
                    }
                    
                    mettreAJourProgression();
                } else {
                    demanderAide();
                }
            }
        }

        function precedent() {
            if (etapeActuelle > 1) {
                document.getElementById('etape' + etapeActuelle).style.display = 'none';
                etapeActuelle--;
                document.getElementById('etape' + etapeActuelle).style.display = 'block';
                
                if (etapeActuelle === 1) {
                    document.getElementById('precedentBtn').disabled = true;
                }
                
                document.getElementById('suivantBtn').style.display = 'inline-block';
                document.getElementById('corrigerBtn').style.display = 'none';
                
                mettreAJourProgression();
            }
        }

        // VALIDATION PAR √âTAPE
        function validerEtape(etape) {
            switch(etape) {
                case 1:
                    const thomas = document.querySelector('input[name="thomas"]:checked');
                    const sarah = document.querySelector('input[name="sarah"]:checked');
                    return thomas && sarah;
                case 2:
                    const demarchesThomas = document.querySelectorAll('input[name="demarches_thomas"]:checked');
                    const demarchesSarah = document.querySelectorAll('input[name="demarches_sarah"]:checked');
                    return demarchesThomas.length > 0 && demarchesSarah.length > 0;
                case 3:
                    const calcul1 = document.querySelector('input[name="calcul1"]:checked');
                    const calcul2 = document.querySelector('input[name="calcul2"]:checked');
                    return calcul1 && calcul2;
                case 4:
                    const rapportThomas = document.getElementById('rapport_thomas').value.trim();
                    const rapportSarah = document.getElementById('rapport_sarah').value.trim();
                    return rapportThomas.length > 50 && rapportSarah.length > 50;
                default:
                    return true;
            }
        }

        // SYST√àME DE REM√âDIATION AUTOMATIQUE
        function demanderAide() {
            const zone = document.getElementById('zoneremediation');
            const message = document.getElementById('messageRemediation');
            
            let conseils = '';
            
            switch(etapeActuelle) {
                case 1:
                    conseils = `
                        <h4>üí° Aide pour qualifier les √©v√©nements :</h4>
                        <p><strong>Accident du travail :</strong> √âv√©nement soudain, pendant le travail, causant une l√©sion.</p>
                        <p><strong>Maladie professionnelle :</strong> Pathologie li√©e √† l'exposition chronique √† un risque professionnel.</p>
                        <p><em>Indice :</em> Thomas a fait une chute soudaine. Sarah d√©veloppe une maladie apr√®s 5 ans d'exposition.</p>
                    `;
                    break;
                case 2:
                    conseils = `
                        <h4>üí° Aide pour les d√©marches :</h4>
                        <p><strong>AT :</strong> Victime ‚Üí Employeur (24h) ‚Üí CPAM (48h) + Certificat m√©dical</p>
                        <p><strong>MP :</strong> Victime ‚Üí CPAM (15j) + CMI + Attestation salaire</p>
                        <p><em>Astuce :</em> Pour les AT, toutes les d√©marches list√©es sont correctes !</p>
                    `;
                    break;
                case 3:
                    conseils = `
                        <h4>üí° Aide pour les calculs :</h4>
                        <p><strong>Salaire journalier :</strong> 1800‚Ç¨ √∑ 30,42 = 59,17‚Ç¨</p>
                        <p><strong>28 premiers jours :</strong> 59,17‚Ç¨ √ó 60% √ó 28 jours</p>
                        <p><strong>Jours suivants :</strong> 59,17‚Ç¨ √ó 80% √ó 7 jours</p>
                    `;
                    break;
                case 4:
                    conseils = `
                        <h4>üí° Aide pour les rapports :</h4>
                        <p><strong>Pensez √† :</strong> Obligation de s√©curit√©, faute inexcusable, responsabilit√©s civile/p√©nale</p>
                        <p><strong>Mots-cl√©s :</strong> Pr√©vention, formation, EPI, surveillance m√©dicale, sanctions</p>
                        <p><em>Minimum 50 caract√®res par rapport</em></p>
                    `;
                    break;
            }
            
            message.innerHTML = conseils;
            zone.classList.add('show');
            
            // Enregistrer la demande d'aide
            trackCompetence(getCurrentCompetence(), 'aide_demandee', false);
        }

        // AUTO-√âVALUATION PAR COMP√âTENCES
        function trackCompetence(competenceCode, action, success) {
            if (!performances[competenceCode]) return;
            
            performances[competenceCode].tentatives++;
            if (success) {
                performances[competenceCode].reussites++;
            }
            
            // Stockage local anonyme
            localStorage.setItem('pse_performances_' + sessionId, JSON.stringify(performances));
        }

        function getCurrentCompetence() {
            const competences = ['C2', 'C4', 'C5', 'C6'];
            return competences[etapeActuelle - 1] || 'C2';
        }

        // CORRECTION FINALE
        function corriger() {
            let score = 0;
            let maxScore = 8; // 2 points par √©tape
            
            // √âtape 1
            const thomas = document.querySelector('input[name="thomas"]:checked');
            const sarah = document.querySelector('input[name="sarah"]:checked');
            
            if (thomas && thomas.value === 'at') score++;
            if (sarah && sarah.value === 'mp') score++;
            
            // √âtape 2 - Toutes les r√©ponses sont correctes
            const demarchesThomas = document.querySelectorAll('input[name="demarches_thomas"]:checked');
            const demarchesSarah = document.querySelectorAll('input[name="demarches_sarah"]:checked');
            
            if (demarchesThomas.length === 4) score++;
            if (demarchesSarah.length === 4) score++;
            
            // √âtape 3
            const calcul1 = document.querySelector('input[name="calcul1"]:checked');
            const calcul2 = document.querySelector('input[name="calcul2"]:checked');
            
            if (calcul1 && calcul1.value === 'a') score++; // 995,64‚Ç¨
            if (calcul2 && calcul2.value === 'b') score++; // 331,15‚Ç¨
            
            // √âtape 4 - √âvaluation qualitative
            const rapportThomas = document.getElementById('rapport_thomas').value.trim();
            const rapportSarah = document.getElementById('rapport_sarah').value.trim();
            
            if (rapportThomas.length > 100) score++;
            if (rapportSarah.length > 100) score++;
            
            // Affichage r√©sultats
            const pourcentageReussite = Math.round((score / maxScore) * 100);
            let message = '';
            
            if (pourcentageReussite >= 80) {
                message = `üéâ <strong>Excellente ma√Ætrise !</strong> ${score}/${maxScore} (${pourcentageReussite}%)<br>Vous √™tes pr√™t(e) pour l'√©preuve !`;
            } else if (pourcentageReussite >= 60) {
                message = `üëç <strong>Bonne compr√©hension !</strong> ${score}/${maxScore} (${pourcentageReussite}%)<br>Quelques r√©visions et ce sera parfait !`;
            } else {
                message = `üí™ <strong>Continuez vos efforts !</strong> ${score}/${maxScore} (${pourcentageReussite}%)<br>Consultez les corrig√©s pour progresser.`;
            }
            
            document.getElementById('messageRemediation').innerHTML = `
                <h3>üìä R√©sultats de votre √©valuation</h3>
                <p>${message}</p>
                <div class="progress-container">
                    <div class="progress-bar" style="width: ${pourcentageReussite}%;"></div>
                </div>
            `;
            
            document.getElementById('zoneremediation').classList.add('show');
            document.getElementById('corrigesBtn').style.display = 'inline-block';
            
            // Coloration des r√©ponses
            colorerReponses();
        }

        function colorerReponses() {
            // Colorer les bonnes/mauvaises r√©ponses
            const correctAnswers = {
                'thomas': 'at',
                'sarah': 'mp',
                'calcul1': 'a',
                'calcul2': 'b'
            };
            
            for (let [name, correct] of Object.entries(correctAnswers)) {
                const options = document.querySelectorAll(`input[name="${name}"]`);
                options.forEach(option => {
                    const label = option.parentElement;
                    if (option.value === correct) {
                        label.classList.add('correct');
                    } else if (option.checked) {
                        label.classList.add('incorrect');
                    }
                });
            }
        }

        function afficherCorriges() {
            document.getElementById('corriges').classList.add('show');
            document.getElementById('corriges').scrollIntoView({ behavior: 'smooth' });
        }

        // ACCESSIBILIT√â - Synth√®se vocale
        let speechSynth = window.speechSynthesis;
        let isReading = false;

        function toggleSpeech() {
            if (isReading) {
                speechSynth.cancel();
                isReading = false;
                document.getElementById('playBtn').textContent = 'üîä';
            } else {
                const text = document.querySelector('.exercice-principal').textContent;
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'fr-FR';
                utterance.rate = 0.8;
                
                utterance.onend = function() {
                    isReading = false;
                    document.getElementById('playBtn').textContent = 'üîä';
                };
                
                speechSynth.speak(utterance);
                isReading = true;
                document.getElementById('playBtn').textContent = '‚è∏Ô∏è';
            }
        }

        // ACCESSIBILIT√â - Police OpenDyslexie
        function toggleDyslexieFont() {
            document.body.classList.toggle('dyslexie-mode');
            const btn = document.getElementById('dyslexieBtn');
            btn.textContent = document.body.classList.contains('dyslexie-mode') ? 'üëÅÔ∏è' : 'üëÅ';
        }

        // INITIALISATION
        document.addEventListener('DOMContentLoaded', function() {
            mettreAJourProgression();
            
            // Support clavier pour accessibilit√©
            document.addEventListener('keydown', function(e) {
                if (e.key === 'ArrowRight' && !document.getElementById('suivantBtn').disabled) {
                    suivant();
                } else if (e.key === 'ArrowLeft' && !document.getElementById('precedentBtn').disabled) {
                    precedent();
                } else if (e.key === 'h' || e.key === 'H') {
                    demanderAide();
                }
            });
        });
    </script>
</body>
</html>