<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Budget Vacances - Sarah</title>
  <style>
    :root {
      --col-argent: #d4edda; --bor-argent: #28a745;
      --col-transp: #cce5ff; --bor-transp: #007bff;
      --col-vie:    #fff3cd; --bor-vie:    #ffc107;
      --col-fun:    #e2e6ea; --bor-fun:    #6c757d;
      --text-color: #333;
    }

    body {
      font-family: Verdana, sans-serif;
      background-color: #f9f9f9;
      color: var(--text-color);
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow-x: hidden;
    }

    h1 { color: #2c3e50; margin-bottom: 10px; text-align:center; }

    .toolbar{
      width:100%;
      max-width:1000px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:center;
      align-items:center;
      margin: 8px 0 16px 0;
    }
    .tool-btn{
      padding:10px 14px;
      font-size:1rem;
      cursor:pointer;
      background:#fff;
      border:2px solid #cbd5e1;
      border-radius:999px;
      box-shadow:0 2px 6px rgba(0,0,0,0.06);
      display:flex;
      align-items:center;
      gap:8px;
      user-select:none;
    }
    .tool-btn:active{ transform: translateY(1px); }
    .tool-btn.primary{
      background:#333;
      color:#fff;
      border-color:#333;
    }

    .visual-guide {
      display: flex;
      gap: 15px;
      background: white;
      padding: 15px;
      border-radius: 15px;
      border: 2px solid #ddd;
      margin-bottom: 20px;
      flex-wrap: wrap;
      justify-content: center;
      width:100%;
      max-width:1000px;
    }

    .guide-tag {
      padding: 8px 15px;
      border-radius: 20px;
      font-weight: bold;
      border: 3px solid;
      display: flex;
      align-items: center;
      gap: 8px;
      background: white;
    }

    .g-r { border-color: var(--bor-argent); background: var(--col-argent); }
    .g-t { border-color: var(--bor-transp); background: var(--col-transp); }
    .g-v { border-color: var(--bor-vie);    background: var(--col-vie); }
    .g-l { border-color: var(--bor-fun);    background: var(--col-fun); }

    .selection-panel{
      width:100%;
      max-width:1000px;
      background:#fff;
      border:2px solid #d1d5db;
      border-radius:12px;
      padding:12px 14px;
      margin-bottom:14px;
      box-shadow:0 4px 6px rgba(0,0,0,0.04);
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      justify-content:space-between;
      align-items:center;
    }
    .selection-left{
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width:240px;
    }
    .selection-title{
      font-weight:bold;
      font-size:1.02rem;
    }
    .selection-current{
      font-size:1rem;
      padding:8px 10px;
      border-radius:10px;
      background:#f1f5f9;
      border:2px solid #cbd5e1;
      min-height:42px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .selection-current .pill{
      font-weight:bold;
      padding:3px 8px;
      border-radius:8px;
      border:2px solid #111827;
      background:#fff;
      font-size:0.95rem;
      white-space:nowrap;
    }
    .selection-hint{
      font-size:0.95rem;
      opacity:0.85;
    }
    .selection-actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:center;
    }
    .selection-actions select{
      padding:10px 12px;
      font-size:1.05rem;
      border-radius:10px;
      border:2px solid #999;
      font-weight:bold;
      background:#fff;
    }

    #bank {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
      background: #fff;
      padding: 20px;
      border: 3px dashed #888;
      border-radius: 12px;
      width: 100%;
      max-width: 1000px;
      min-height: 120px;
      margin-bottom: 30px;
    }

    .item {
      background: white;
      border: 2px solid #555;
      border-radius: 10px;
      padding: 10px;
      cursor: grab;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      width: 130px;
      box-shadow: 0 4px 5px rgba(0,0,0,0.1);
      transition: transform 0.1s, box-shadow 0.1s, border-color 0.1s;
      user-select: none;
      touch-action: manipulation;
    }
    .item:active { cursor: grabbing; transform: scale(1.03); }
    .item strong { font-size: 1.2rem; margin-top: 5px; color: #000; }
    .item.selected{
      border-color:#111827;
      box-shadow:0 8px 16px rgba(0,0,0,0.18);
      transform: scale(1.03);
      cursor: pointer;
    }

    .code-badge {
      font-weight: bold;
      font-size: 1.1rem;
      padding: 2px 10px;
      border-radius: 5px;
      margin-bottom: 5px;
      width: 100%;
      display: block;
      border: 1px solid rgba(0,0,0,0.1);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      width: 100%;
      max-width: 1200px;
    }

    .col {
      background: white;
      border-radius: 10px;
      border-top: 10px solid #555;
      padding: 10px;
      display: flex;
      flex-direction: column;
      min-height: 450px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    .col h3 {
      text-align: center;
      margin-top: 0;
      padding-bottom: 10px;
      border-bottom: 2px solid rgba(0,0,0,0.05);
    }

    #c-argent { border-color: var(--bor-argent); background: #f4fff4; }
    #c-transp { border-color: var(--bor-transp); background: #f0f8ff; }
    #c-vie    { border-color: var(--bor-vie);    background: #fffdf0; }
    #c-fun    { border-color: var(--bor-fun);    background: #f8f9fa; }

    .drop-zone {
      flex-grow: 1;
      border: 2px dashed rgba(0,0,0,0.1);
      border-radius: 8px;
      margin-bottom: 15px;
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: center;
      transition: background 0.12s, outline 0.12s;
      min-height: 110px;
    }
    .drop-zone.active{
      background: rgba(0,0,0,0.05);
      outline: 3px solid rgba(17,24,39,0.12);
    }

    .total-box {
      background: rgba(255,255,255,0.8);
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      border: 1px solid #ddd;
    }

    input[type="number"] {
      width: 90px;
      padding: 8px;
      font-size: 1.2rem;
      text-align: right;
      border: 2px solid #ccc;
      border-radius: 5px;
      font-weight: bold;
    }

    button {
      background: #e9ecef;
      border: 1px solid #ced4da;
      padding: 8px 16px;
      font-size: 1rem;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 8px;
      transition: background 0.2s;
      user-select:none;
    }
    button:hover { background: #dee2e6; }

    .msg { font-size: 1rem; font-weight: bold; display: block; margin-top: 8px; min-height: 1.4em; }
    .ok { color: #28a745; }
    .ko { color: #dc3545; }

    .summary {
      margin-top: 40px;
      background: white;
      padding: 25px;
      border-radius: 15px;
      width: 100%;
      max-width: 700px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      border-left: 10px solid #2c3e50;
    }
    .sum-row {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 15px; font-size: 1.3rem;
      gap: 10px; flex-wrap: wrap;
    }

    @media (max-width: 900px) {
      .grid { grid-template-columns: 1fr 1fr; }
      input[type="number"] { width: 110px; }
    }
  </style>
</head>
<body>

  <h1>üèñÔ∏è Le Budget Vacances de Sarah</h1>

  <div class="toolbar">
    <button class="tool-btn" id="btn-sound" onclick="toggleSound()">üîà Son : ON</button>
    <button class="tool-btn" onclick="clearSelection()">‚úã Annuler la s√©lection</button>
    <button class="tool-btn primary" onclick="location.reload()">üîÑ Recommencer</button>
  </div>

  <div class="visual-guide">
    <div class="guide-tag g-r">üí∞ (R) = Mes Sous</div>
    <div class="guide-tag g-t">üöÜ (T) = Transport</div>
    <div class="guide-tag g-v">üè† (V) = Vie (Dodo/Miam)</div>
    <div class="guide-tag g-l">üéâ (L) = Loisirs</div>
  </div>

  <div class="selection-panel" id="selection-panel">
    <div class="selection-left">
      <div class="selection-title">Mode t√©l√©phone : je s√©lectionne une √©tiquette puis je clique une zone</div>
      <div class="selection-current" id="selection-current">
        <span class="pill">Aucune</span>
        <span>√âtiquette s√©lectionn√©e</span>
      </div>
      <div class="selection-hint" id="mode-hint">Sur ordinateur, tu peux glisser-d√©poser. Sur t√©l√©phone, utilise surtout les clics.</div>
    </div>
    <div class="selection-actions">
      <label for="mobile-target" style="font-weight:bold;">Zone cible :</label>
      <select id="mobile-target">
        <option value="bank">üè¶ Banque (retour)</option>
        <option value="R">üí∞ Mes Sous (R)</option>
        <option value="T">üöÜ Transport (T)</option>
        <option value="V">üè† Vie sur place (V)</option>
        <option value="L">üéâ Loisirs (L)</option>
      </select>
    </div>
  </div>

  <p style="text-align:center; margin-bottom:20px; font-size:1.1rem; max-width: 1000px;">
    <strong>Consigne :</strong>
    1. Regarde la lettre <strong>(R, T, V, L)</strong> sur l'√©tiquette.<br>
    2. Range l'√©tiquette dans la colonne de la m√™me couleur.<br>
    3. Fais les calculs.
  </p>

  <div id="bank"></div>

  <div class="grid">

    <div class="col" id="c-argent">
      <h3>üí∞ Mes Sous (R)</h3>
      <div class="drop-zone" data-type="R"></div>
      <div class="total-box">
        Total : <input type="number" id="inp-R" placeholder="0" inputmode="numeric"> ‚Ç¨
        <br><button onclick="check('R')">V√©rifier</button>
        <span id="msg-R" class="msg"></span>
      </div>
    </div>

    <div class="col" id="c-transp">
      <h3>üöÜ Transport (T)</h3>
      <div class="drop-zone" data-type="T"></div>
      <div class="total-box">
        Total : <input type="number" id="inp-T" placeholder="0" inputmode="numeric"> ‚Ç¨
        <br><button onclick="check('T')">V√©rifier</button>
        <span id="msg-T" class="msg"></span>
      </div>
    </div>

    <div class="col" id="c-vie">
      <h3>üè† Vie sur place (V)</h3>
      <div class="drop-zone" data-type="V"></div>
      <div class="total-box">
        Total : <input type="number" id="inp-V" placeholder="0" inputmode="numeric"> ‚Ç¨
        <br><button onclick="check('V')">V√©rifier</button>
        <span id="msg-V" class="msg"></span>
      </div>
    </div>

    <div class="col" id="c-fun">
      <h3>üéâ Loisirs (L)</h3>
      <div class="drop-zone" data-type="L"></div>
      <div class="total-box">
        Total : <input type="number" id="inp-L" placeholder="0" inputmode="numeric"> ‚Ç¨
        <br><button onclick="check('L')">V√©rifier</button>
        <span id="msg-L" class="msg"></span>
      </div>
    </div>
  </div>

  <div class="summary">
    <h2 style="text-align:center;">üìä Bilan Final</h2>
    <div class="sum-row" style="color:#28a745;">
      <span>Mes Sous (Recettes) :</span>
      <span id="res-recette">...</span>
    </div>
    <div class="sum-row" style="color:#dc3545;">
      <span>Total des D√©penses :</span>
      <span id="res-depense">...</span>
    </div>
    <hr>
    <div class="sum-row" style="font-weight:bold;">
      <span>Reste-t-il de l'argent ?</span>
      <input type="number" id="inp-solde" placeholder="?" inputmode="numeric"> ‚Ç¨
    </div>
    <div style="text-align:center;">
      <button onclick="checkFinal()" style="padding:12px 24px; font-size:1.1rem; background:#333; color:white; border:none;">
        V√©rifier le Solde
      </button>
      <span id="msg-final" class="msg" style="font-size:1.2rem; margin-top:15px;"></span>
    </div>
  </div>

  <script>
    const data = [
      { id:1,  name:"√âconomies",      val:200, type:"R", color:"g-r" },
      { id:2,  name:"Cadeau Anniv",   val:100, type:"R", color:"g-r" },
      { id:3,  name:"Baby-sitting",   val:50,  type:"R", color:"g-r" },

      { id:4,  name:"Billet Train",   val:80,  type:"T", color:"g-t" },
      { id:5,  name:"Bus de ville",   val:20,  type:"T", color:"g-t" },

      { id:6,  name:"Camping",        val:120, type:"V", color:"g-v" },
      { id:7,  name:"Supermarch√©",    val:60,  type:"V", color:"g-v" },
      { id:8,  name:"Sandwichs",      val:20,  type:"V", color:"g-v" },

      { id:9,  name:"Parc Aquatique", val:40,  type:"L", color:"g-l" },
      { id:10, name:"Souvenirs",      val:25,  type:"L", color:"g-l" },
      { id:11, name:"Glaces",         val:15,  type:"L", color:"g-l" },
      { id:12, name:"Cin√© Plage",     val:10,  type:"L", color:"g-l" }
    ];

    data.sort(() => Math.random() - 0.5);

    const bank = document.getElementById("bank");
    let selected = null;
    let soundEnabled = true;

    function isMobileLayout(){
      return window.matchMedia("(max-width: 900px)").matches;
    }

    function toggleSound(){
      soundEnabled = !soundEnabled;
      const btn = document.getElementById("btn-sound");
      btn.textContent = soundEnabled ? "üîà Son : ON" : "üîá Son : OFF";
      try { if (!soundEnabled && window.speechSynthesis) window.speechSynthesis.cancel(); } catch(e){}
    }

    function speak(text){
      if (!soundEnabled) return;
      try{
        if (!window.speechSynthesis) return;
        window.speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(text);
        u.lang = "fr-FR";
        window.speechSynthesis.speak(u);
      }catch(e){}
    }

    function updateSelectionPanel(){
      const box = document.getElementById("selection-current");
      if (!selected){
        box.innerHTML = '<span class="pill">Aucune</span><span>√âtiquette s√©lectionn√©e</span>';
        return;
      }
      const type = selected.dataset.type || "?";
      const name = selected.dataset.name || "√âtiquette";
      const val = selected.dataset.val || "";
      box.innerHTML = `<span class="pill">${type}</span><span>${name} ‚Äî ${val} ‚Ç¨</span>`;
    }

    function setSelected(el){
      document.querySelectorAll(".item.selected").forEach(x => x.classList.remove("selected"));
      selected = el;
      el.classList.add("selected");
      updateSelectionPanel();
    }

    function clearSelection(){
      document.querySelectorAll(".item.selected").forEach(x => x.classList.remove("selected"));
      selected = null;
      updateSelectionPanel();
    }

    function setDragMode(){
      const enableDrag = !isMobileLayout();
      document.querySelectorAll(".item").forEach(el => {
        el.draggable = enableDrag;
        el.style.cursor = enableDrag ? "grab" : "pointer";
      });
      document.getElementById("mode-hint").textContent = enableDrag
        ? "Ordinateur : tu peux glisser-d√©poser. T√©l√©phone : utilise surtout les clics."
        : "T√©l√©phone : utilise le mode clic (s√©lection + clic sur zone).";
    }

    function findZoneByType(type){
      return document.querySelector(`.drop-zone[data-type="${type}"]`);
    }

    function findTargetZoneBySelect(){
      const v = document.getElementById("mobile-target").value;
      if (v === "bank") return bank;
      return findZoneByType(v);
    }

    function moveSelectedToTarget(target){
      if (!selected || !target) return;
      target.appendChild(selected);
      clearSelection();
    }

    function activateZone(zone, on){
      if (!zone.classList) return;
      if (on) zone.classList.add("active");
      else zone.classList.remove("active");
    }

    data.forEach(d => {
      const el = document.createElement("div");
      el.className = "item";
      el.id = "item-" + d.id;
      el.dataset.val = d.val;
      el.dataset.type = d.type;
      el.dataset.name = d.name;

      el.innerHTML = `
        <span class="code-badge ${d.color}">${d.type}</span>
        <span>${d.name}</span>
        <strong>${d.val} ‚Ç¨</strong>
      `;

      el.addEventListener("dragstart", e => {
        if (isMobileLayout()) { e.preventDefault(); return; }
        e.dataTransfer.setData("text", el.id);
        setSelected(el);
      });

      el.addEventListener("click", () => {
        setSelected(el);
        speak(d.name + " " + d.val + " euros");
        if (isMobileLayout()){
          const target = findTargetZoneBySelect();
          moveSelectedToTarget(target);
        }
      });

      bank.appendChild(el);
    });

    const zones = document.querySelectorAll(".drop-zone, #bank");
    zones.forEach(zone => {
      zone.addEventListener("dragover", e => {
        if (isMobileLayout()) return;
        e.preventDefault();
        activateZone(zone, true);
      });

      zone.addEventListener("dragleave", e => {
        if (isMobileLayout()) return;
        activateZone(zone, false);
      });

      zone.addEventListener("drop", e => {
        if (isMobileLayout()) return;
        e.preventDefault();
        activateZone(zone, false);
        const id = e.dataTransfer.getData("text");
        const el = document.getElementById(id);
        if (el) zone.appendChild(el);
        clearSelection();
      });

      zone.addEventListener("click", () => {
        if (!selected) return;
        zone.appendChild(selected);
        clearSelection();
      });
    });

    setDragMode();
    updateSelectionPanel();
    window.addEventListener("resize", () => {
      setDragMode();
      clearSelection();
    });

    function check(type) {
      const zone = document.querySelector(`.drop-zone[data-type="${type}"]`);
      const input = document.getElementById(`inp-${type}`);
      const msg = document.getElementById(`msg-${type}`);

      if (!zone || !input || !msg) return;

      let sum = 0;
      let error = false;

      if (zone.children.length === 0) {
        msg.textContent = "La case est vide.";
        msg.className = "msg ko";
        return;
      }

      [...zone.children].forEach(child => {
        sum += parseInt(child.dataset.val, 10) || 0;
        if (child.dataset.type !== type) error = true;
      });

      const userVal = parseInt(input.value, 10);

      if (error) {
        msg.innerHTML = "‚ö†Ô∏è Une √©tiquette est mal rang√©e.<br>Regarde bien les lettres (R, T, V, L).";
        msg.className = "msg ko";
      } else if (isNaN(userVal)) {
        msg.textContent = "√âcris le total dans la case.";
        msg.className = "msg ko";
      } else if (userVal === sum) {
        msg.textContent = "‚úÖ Bravo ! C'est correct.";
        msg.className = "msg ok";
        input.disabled = true;
        input.style.backgroundColor = "#e8f5e9";
        input.style.borderColor = "#28a745";
        updateSummary();
      } else {
        msg.textContent = "‚ùå Erreur de calcul. R√©essaie.";
        msg.className = "msg ko";
      }
    }

    function updateSummary() {
      const inputs = ["inp-R", "inp-T", "inp-V", "inp-L"];
      const allDone = inputs.every(id => document.getElementById(id).disabled === true);

      if (allDone) {
        const r = parseInt(document.getElementById("inp-R").value, 10) || 0;
        const t = parseInt(document.getElementById("inp-T").value, 10) || 0;
        const v = parseInt(document.getElementById("inp-V").value, 10) || 0;
        const l = parseInt(document.getElementById("inp-L").value, 10) || 0;

        const totalDep = t + v + l;

        document.getElementById("res-recette").textContent = r + " ‚Ç¨";
        document.getElementById("res-depense").textContent = totalDep + " ‚Ç¨";
      }
    }

    function checkFinal() {
      const r = parseInt(document.getElementById("inp-R").value, 10);
      const t = parseInt(document.getElementById("inp-T").value, 10);
      const v = parseInt(document.getElementById("inp-V").value, 10);
      const l = parseInt(document.getElementById("inp-L").value, 10);

      if (isNaN(r) || isNaN(t) || isNaN(v) || isNaN(l)) {
        document.getElementById("msg-final").textContent = "Valide d'abord les 4 colonnes ci-dessus.";
        document.getElementById("msg-final").className = "msg ko";
        return;
      }

      const totalDep = t + v + l;
      const userSolde = parseInt(document.getElementById("inp-solde").value, 10);
      const realSolde = r - totalDep;

      if (isNaN(userSolde)) {
        document.getElementById("msg-final").textContent = "√âcris le solde dans la case.";
        document.getElementById("msg-final").className = "msg ko";
        return;
      }

      if (userSolde === realSolde) {
        document.getElementById("msg-final").textContent = "üéâ BRAVO ! Exercice termin√© avec succ√®s !";
        document.getElementById("msg-final").className = "msg ok";
        document.body.style.backgroundColor = "#d4edda";
      } else {
        document.getElementById("msg-final").textContent = "‚ùå Ce n'est pas √ßa. Rappel : Recettes - D√©penses.";
        document.getElementById("msg-final").className = "msg ko";
      }
    }
  </script>
</body>
</html>
