<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Julie et l'Impr√©vu</title>
    <style>
        :root {
            --bg: #ffebee; /* Fond ros√¢tre l√©ger */
            --bank: #fff;
            --column: #fff;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* BOUTONS */
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        button {
            padding: 12px 25px;
            font-size: 1.2rem;
            cursor: pointer;
            border: none;
            border-radius: 50px;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
        }
        button:active { transform: translateY(4px); box-shadow: none; }
        .audio-btn { background: #e91e63; }
        .event-btn { background: #ff9800; font-weight: bold; border: 2px solid #f57c00; animation: pulse 2s infinite;}
        .reset-btn { background: #607d8b; }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* ZONE PRINCIPALE */
        .game-area {
            display: flex;
            gap: 20px;
            width: 100%;
            max-width: 1000px;
            justify-content: center;
        }

        /* BANQUE ET POUBELLE */
        .side-panel {
            width: 25%;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .bank {
            background: white;
            border: 4px dashed #ccc;
            border-radius: 15px;
            padding: 10px;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* TABLEAU BUDGET */
        .budget-board {
            background: white;
            width: 50%;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            border: 2px solid #333;
        }

        .budget-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
            font-size: 1.2rem;
        }

        .drop-zone {
            width: 100%;
            min-height: 300px;
            background: #f9f9f9;
            border: 2px solid #eee;
            border-radius: 10px;
            padding: 10px;
            margin-top: 10px;
        }

        /* ZONE DE RESULTAT */
        .result-box {
            margin-top: 20px;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            border: 3px solid #333;
            transition: background 0.5s;
        }
        .positive { background: #d4edda; color: #155724; border-color: #c3e6cb; }
        .negative { background: #f8d7da; color: #721c24; border-color: #f5c6cb; }

        /* ITEMS */
        .item {
            background: #fff;
            border: 2px solid #555;
            border-radius: 10px;
            padding: 8px;
            margin-bottom: 8px;
            width: 90%;
            cursor: grab;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
        }
        .item.fixed { border-color: #ff9800; background: #fff3e0; } /* D√©penses obligatoires */
        .item.fun { border-color: #9c27b0; background: #f3e5f5; }   /* D√©penses plaisir */
        .item.bad { border-color: #d32f2f; background: #ffebee; border-width: 4px; }   /* Impr√©vu */

        .icon { font-size: 1.5rem; margin-right: 10px; }

        /* ALERT OVERLAY */
        #alert-box {
            display: none;
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border: 5px solid #d32f2f;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            z-index: 100;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }
        #alert-box h2 { color: #d32f2f; margin: 0 0 10px 0; }
        #alert-box button { margin: 20px auto; background: #d32f2f; }

    </style>
</head>
<body>

    <h1>üê± Le Budget de Julie</h1>

    <div class="controls">
        <button class="audio-btn" onclick="lireConsigne()">üîä 1. Consigne</button>
        <button id="btn-imprevu" class="event-btn" onclick="declencherImprevu()" style="display:none;">‚ö†Ô∏è 2. OH NON ! (Cliquer ici)</button>
        <button class="reset-btn" onclick="location.reload()">üîÑ Recommencer</button>
    </div>

    <div class="game-area">
        
        <div class="side-panel">
            <h3 style="text-align:center;">Banque</h3>
            <div class="bank" id="bank" ondrop="drop(event)" ondragover="allowDrop(event)">
                </div>
        </div>

        <div class="budget-board">
            
            <div class="budget-row">
                <span>üí∞ SALAIRE de Julie :</span>
                <span style="font-weight:bold; color:green;">1200 ‚Ç¨</span>
            </div>

            <h3>üìâ Glisse les d√©penses ici :</h3>
            <div class="drop-zone" id="depenses" ondrop="drop(event)" ondragover="allowDrop(event)">
                </div>

            <div id="result-box" class="result-box positive">
                Solde (Reste) : <span id="solde-val">1200</span> ‚Ç¨
            </div>
            
            <div style="text-align:center; margin-top:10px; font-style:italic; font-size:0.9rem;">
                Le solde doit rester POSITIF (Vert) !
            </div>

        </div>
    </div>

    <div id="alert-box">
        <div style="font-size:4rem;">üòø</div>
        <h2>CATASTROPHE !</h2>
        <p>Le chat est malade !<br>Il faut payer le v√©t√©rinaire tout de suite.</p>
        <div class="item bad" id="veto-item" draggable="true" ondragstart="drag(event)" data-price="100">
            <span>üíâ V√©t√©rinaire</span>
            <span>100 ‚Ç¨</span>
        </div>
        <button onclick="fermerAlerte()">OK, je paie...</button>
    </div>

<script>
    // DONN√âES
    // Type: 'fixed' (Obligatoire) ou 'fun' (Plaisir)
    const itemsData = [
        { id: 'i1', name: 'Loyer', icon: 'üè†', price: 600, type: 'fixed' },
        { id: 'i2', name: 'Courses', icon: 'üõí', price: 300, type: 'fixed' },
        { id: 'i3', name: 'Facture Elec', icon: '‚ö°', price: 50, type: 'fixed' },
        { id: 'i4', name: 'Restaurant', icon: 'üçù', price: 60, type: 'fun' },
        { id: 'i5', name: 'Parc Attraction', icon: 'üé¢', price: 80, type: 'fun' },
        { id: 'i6', name: 'Nouveau Pull', icon: 'üëï', price: 50, type: 'fun' }
    ];

    const SALAIRE = 1200;
    let currentTotal = 0;
    let etapeImprevu = false;

    function init() {
        const bank = document.getElementById('bank');
        itemsData.forEach(item => {
            createItem(item, bank);
        });
        updateCalcul();
    }

    function createItem(item, container) {
        const div = document.createElement('div');
        div.className = `item ${item.type}`;
        div.draggable = true;
        div.id = item.id;
        div.dataset.price = item.price;
        div.dataset.type = item.type; // Pour savoir si c'est vital ou plaisir
        div.ondragstart = drag;
        div.onclick = () => speak(item.name + ", " + item.price + " euros");
        div.innerHTML = `
            <div style="display:flex; align-items:center;">
                <span class="icon">${item.icon}</span>
                <span>${item.name}</span>
            </div>
            <span>${item.price} ‚Ç¨</span>
        `;
        container.appendChild(div);
    }

    // --- DRAG & DROP ---
    function allowDrop(ev) { ev.preventDefault(); }
    function drag(ev) { ev.dataTransfer.setData("text", ev.target.id); }
    
    function drop(ev) {
        ev.preventDefault();
        var data = ev.dataTransfer.getData("text");
        let target = ev.target;
        
        // Remonter vers la zone valide (bank ou depenses)
        let zone = target.closest('#bank') || target.closest('#depenses');
        
        if (zone) {
            zone.appendChild(document.getElementById(data));
            updateCalcul();
        }
    }

    // --- CALCUL DU SOLDE ---
    function updateCalcul() {
        // Calculer la somme des items dans la zone "depenses"
        const zoneDepenses = document.getElementById('depenses');
        const items = zoneDepenses.getElementsByClassName('item');
        let totalDepenses = 0;
        let countItems = items.length;

        for(let item of items) {
            totalDepenses += parseInt(item.dataset.price);
        }

        let solde = SALAIRE - totalDepenses;
        
        // Mise √† jour Affichage
        const resBox = document.getElementById('result-box');
        const soldeSpan = document.getElementById('solde-val');
        
        soldeSpan.innerText = solde;

        if (solde >= 0) {
            resBox.className = "result-box positive";
            resBox.innerHTML = `Solde (Reste) : ${solde} ‚Ç¨ <br><small>üëç C'est bon !</small>`;
        } else {
            resBox.className = "result-box negative";
            resBox.innerHTML = `Solde (Reste) : ${solde} ‚Ç¨ <br><small>‚ö†Ô∏è ATTENTION ! Tu n'as plus d'argent !</small>`;
            speak("Attention, le budget est rouge. Tu d√©penses trop. Il faut enlever quelque chose.");
        }

        // Gestion de l'apparition du bouton Impr√©vu
        // Il apparait seulement si tout est plac√© et que le solde est positif
        const bankItems = document.getElementById('bank').getElementsByClassName('item').length;
        if (bankItems === 0 && solde >= 0 && !etapeImprevu) {
            document.getElementById('btn-imprevu').style.display = 'flex';
            // Petite animation pour attirer l'attention
            speak("Bravo, le budget est pr√™t. Mais... oh oh... clique sur le bouton orange !");
        }
    }

    // --- SCENARIO IMPREVU ---
    function declencherImprevu() {
        document.getElementById('alert-box').style.display = 'block';
        speak("Catastrophe ! Le chat est malade. Il faut payer le v√©t√©rinaire 100 euros.");
        document.getElementById('btn-imprevu').style.display = 'none';
        etapeImprevu = true;
    }

    function fermerAlerte() {
        // On d√©place l'item Veto dans les d√©penses automatiquement
        const veto = document.getElementById('veto-item');
        const zoneDepenses = document.getElementById('depenses');
        zoneDepenses.appendChild(veto);
        document.getElementById('alert-box').style.display = 'none';
        updateCalcul(); // Cela va mettre le budget en rouge
    }

    // --- AUDIO ---
    function speak(txt) {
        const msg = new SpeechSynthesisUtterance(txt);
        msg.lang = 'fr-FR';
        window.speechSynthesis.speak(msg);
    }

    function lireConsigne() {
        speak("Julie gagne 1200 euros. Glisse toutes les d√©penses dans la zone budget. Le r√©sultat doit rester vert.");
    }

    init();
</script>

</body>
</html>