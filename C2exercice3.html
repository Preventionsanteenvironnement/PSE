<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>PSE Bac Pro — Analyse du risque (Chute de hauteur) — C2</title>
  <style>
    :root{
      --bg:#0b1220;
      --card:#101b33;
      --card2:#0f1830;
      --stroke:rgba(255,255,255,.10);
      --stroke2:rgba(255,255,255,.16);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.72);
      --muted2:rgba(255,255,255,.55);
      --ok:#37d67a;
      --bad:#ff5a7a;
      --accent:#6d7cff;
      --accent2:#2ad3ff;
      --chip:#162450;
      --shadow:0 14px 35px rgba(0,0,0,.35);
      --radius:18px;
      --radius2:26px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 700px at 20% 10%, rgba(109,124,255,.18), transparent 60%),
                  radial-gradient(900px 600px at 80% 10%, rgba(42,211,255,.14), transparent 55%),
                  radial-gradient(900px 600px at 50% 100%, rgba(55,214,122,.12), transparent 55%),
                  var(--bg);
      color:var(--text);
      padding: clamp(14px, 3vw, 26px);
    }
    .wrap{max-width:1020px;margin:0 auto; padding-bottom:40px}
    header{
      display:flex; gap:14px; align-items:flex-start; justify-content:space-between;
      margin-bottom:16px;
    }
    .title{
      display:flex; flex-direction:column; gap:6px;
    }
    h1{
      margin:0;
      font-size: clamp(20px, 3.8vw, 34px);
      letter-spacing:.2px;
    }
    .sub{
      color:var(--muted);
      font-size: clamp(13px, 2.5vw, 15px);
      line-height:1.35;
    }
    .badges{display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end}
    .badge{
      padding:10px 12px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      border-radius: 999px;
      font-size:13px;
      color:var(--muted);
      display:flex; gap:8px; align-items:center;
      backdrop-filter: blur(10px);
    }
    .badge b{color:var(--text)}
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--stroke);
      border-radius: var(--radius2);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card + .card{margin-top:14px}
    .card-h{
      padding:14px 16px;
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      background: rgba(0,0,0,.15);
      border-bottom:1px solid var(--stroke);
    }
    .card-h .left{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
      min-width:0;
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      font-size:13px;
      color:var(--muted);
      white-space:nowrap;
    }
    .pill strong{color:var(--text)}
    .pts{opacity:.95}
    .card-b{padding:14px 16px}
    .note{
      color:var(--muted);
      line-height:1.45;
      font-size:14px;
      margin:0 0 12px 0;
    }
    .mini{
      color:var(--muted2);
      font-size:12.5px;
      margin-top:8px;
      line-height:1.35;
    }
    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    @media (min-width: 860px){
      .grid.cols2{grid-template-columns: 1fr 1fr}
      .grid.cols3{grid-template-columns: 1fr 1fr 1fr}
    }
    .box{
      background: rgba(0,0,0,.16);
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      padding:12px;
    }
    .box h3{
      margin:0 0 8px 0;
      font-size:15px;
      color:var(--text);
    }
    .scenario{
      color:var(--muted);
      font-size:14px;
      line-height:1.45;
      margin:0 0 10px 0;
    }
    .row{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    @media(min-width:860px){
      .row{grid-template-columns: 1fr 1fr}
    }
    label{
      display:block;
      font-size:13px;
      color:var(--muted);
      margin-bottom:6px;
    }
    select, input[type="number"]{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid var(--stroke2);
      background: rgba(15,24,48,.85);
      color:var(--text);
      outline:none;
      font-size:14px;
    }
    select:focus, input:focus{border-color: rgba(109,124,255,.55); box-shadow: 0 0 0 4px rgba(109,124,255,.16)}
    .actions{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
      margin-top:12px;
    }
    button{
      cursor:pointer;
      border:none;
      border-radius: 14px;
      padding:12px 14px;
      font-weight:650;
      color:var(--text);
      background: linear-gradient(180deg, rgba(109,124,255,.95), rgba(109,124,255,.78));
      box-shadow: 0 10px 20px rgba(109,124,255,.22);
      transition: transform .06s ease, filter .12s ease;
      -webkit-tap-highlight-color: transparent;
    }
    button:active{transform: translateY(1px)}
    .btn2{
      background: rgba(255,255,255,.08);
      border:1px solid var(--stroke);
      color:var(--muted);
      box-shadow:none;
      font-weight:650;
    }
    .result{
      margin-top:10px;
      padding:12px;
      border-radius: var(--radius);
      border:1px dashed rgba(255,255,255,.18);
      color:var(--muted);
      background: rgba(0,0,0,.18);
      line-height:1.45;
      font-size:14px;
    }
    .result.ok{border-color: rgba(55,214,122,.45); color: rgba(221,255,236,.92)}
    .result.bad{border-color: rgba(255,90,122,.55); color: rgba(255,228,235,.92)}
    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      padding:3px 7px;
      border-radius: 10px;
      background: rgba(255,255,255,.08);
      border:1px solid var(--stroke);
      color: var(--muted);
      display:inline-block;
    }
    /* Chips / 5M */
    .bank{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      min-height: 46px;
      padding:10px;
      border-radius: var(--radius);
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.16);
    }
    .chip{
      user-select:none;
      -webkit-user-select:none;
      touch-action: manipulation;
      padding:10px 12px;
      border-radius: 999px;
      border:1px solid var(--stroke2);
      background: linear-gradient(180deg, rgba(22,36,80,.92), rgba(22,36,80,.72));
      color: var(--text);
      font-size: 13.5px;
      line-height:1;
      display:inline-flex;
      gap:8px;
      align-items:center;
    }
    .chip small{
      color: var(--muted2);
      font-weight:600;
      font-size:12px;
    }
    .chip[draggable="true"]{cursor:grab}
    .chip.selected{
      outline: 3px solid rgba(42,211,255,.42);
      box-shadow: 0 0 0 4px rgba(42,211,255,.16);
      transform: translateY(-1px);
    }
    .drop{
      min-height: 56px;
      padding:10px;
      border-radius: var(--radius);
      border:2px dashed rgba(109,124,255,.35);
      background: rgba(109,124,255,.07);
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:flex-start;
    }
    .drop.dragover{
      border-color: rgba(42,211,255,.62);
      background: rgba(42,211,255,.08);
    }
    .drop .hint{
      color: rgba(255,255,255,.55);
      font-size: 13px;
      padding: 8px 10px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.10);
    }
    .twoCol{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    @media(min-width:860px){
      .twoCol{grid-template-columns: 1fr 1fr}
    }
    .familyHead{
      display:flex; align-items:baseline; justify-content:space-between; gap:10px;
      margin-bottom:8px;
    }
    .familyHead .tag{
      color: rgba(255,255,255,.65);
      font-size: 12.5px;
    }
    .scorebar{
      display:flex; flex-wrap:wrap; gap:10px; align-items:center;
    }
    .scorebig{
      padding:10px 12px;
      border-radius: 999px;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.16);
      color: var(--muted);
      font-size:13px;
    }
    .scorebig b{color:var(--text)}
    .footer{
      margin-top:16px;
      color: var(--muted2);
      font-size:12.5px;
      line-height:1.35;
      text-align:center;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">
        <h1>Analyse du risque au travail • Chute de hauteur</h1>
        <div class="sub">
          Compétence visée : <b>C2</b> — Appliquer une démarche d’analyse dans une situation donnée
          <span class="kbd">Mobile + PC</span>
        </div>
      </div>
      <div class="badges">
        <div class="badge"><b id="totalScore">0</b>/<span id="totalMax">22</span> points</div>
        <div class="badge"><b id="doneCount">0</b>/3 exercices corrigés</div>
      </div>
    </header>

    <section class="card">
      <div class="card-h">
        <div class="left">
          <div class="pill">Objectif</div>
          <div class="pill"><strong>Comprendre</strong> le processus Danger → Situation dangereuse → Événement dangereux → Dommage</div>
        </div>
        <div class="pill pts"><strong>Rappel</strong> : en analyse, tu relies des éléments du document à une situation concrète</div>
      </div>
      <div class="card-b">
        <p class="note">
          Un dommage (lésion/atteinte à la santé) apparaît quand une <b>personne</b> est exposée à un <b>danger</b> (elle est alors en <b>situation dangereuse</b>) et qu’un <b>événement dangereux</b> survient.
        </p>
        <div class="mini">
          Astuce : tu peux répondre uniquement à partir du document et du scénario. Pas besoin d’inventer.
        </div>
      </div>
    </section>

    <!-- EXO 1 -->
    <section class="card" id="exo1">
      <div class="card-h">
        <div class="left">
          <div class="pill">Exercice 1</div>
          <div class="pill"><strong>Processus du dommage</strong></div>
          <div class="pill pts"><strong>8</strong> pts • C2</div>
        </div>
        <div class="pill">3 scénarios</div>
      </div>
      <div class="card-b">
        <p class="note">
          Pour chaque scénario, associe le bon élément : <b>Danger</b> • <b>Situation dangereuse</b> • <b>Événement dangereux</b> • <b>Dommage</b>.
        </p>

        <div class="grid">
          <div class="box">
            <h3>Scénario A</h3>
            <p class="scenario">Sur une toiture, un salarié s’assoit sur un dôme translucide. Le dôme cède sous son poids. Il passe au travers et chute de plusieurs mètres.</p>
            <div class="row">
              <div>
                <label>Danger</label>
                <select data-q="A_danger">
                  <option value="">Choisir…</option>
                  <option value="impact">Sol/obstacle heurté pendant la chute</option>
                  <option value="ouverture">Ouverture / matériau fragile (dôme) non résistant</option>
                  <option value="echelle">Échelle mal fixée</option>
                  <option value="outil">Outil coupant</option>
                </select>
              </div>
              <div>
                <label>Situation dangereuse</label>
                <select data-q="A_situation">
                  <option value="">Choisir…</option>
                  <option value="toit_sans_protec">Présence en hauteur sur une zone non sécurisée</option>
                  <option value="toit_fragile">Travail / déplacement en toiture avec matériaux fragiles</option>
                  <option value="atelier">Travail en atelier au sol</option>
                  <option value="circulation">Zone de circulation au sol encombrée</option>
                </select>
              </div>
              <div>
                <label>Événement dangereux</label>
                <select data-q="A_event">
                  <option value="">Choisir…</option>
                  <option value="rupture">Rupture/cassage du matériau fragile → chute au travers</option>
                  <option value="basculement">Basculement d’une échelle mal fixée</option>
                  <option value="glissade">Glissade au sol</option>
                  <option value="pincement">Pincement de doigts</option>
                </select>
              </div>
              <div>
                <label>Dommage</label>
                <select data-q="A_damage">
                  <option value="">Choisir…</option>
                  <option value="grave">Blessure grave / fracture / traumatisme crânien / décès</option>
                  <option value="leger">Égratignure</option>
                  <option value="audition">Acouphènes</option>
                  <option value="intox">Intoxication</option>
                </select>
              </div>
            </div>
          </div>

          <div class="box">
            <h3>Scénario B</h3>
            <p class="scenario">En fin de journée, un salarié rassemble ses outils. Il chute dans une trémie qui n’était pas sécurisée. Il reste paralysé à vie.</p>
            <div class="row">
              <div>
                <label>Danger</label>
                <select data-q="B_danger">
                  <option value="">Choisir…</option>
                  <option value="ouverture">Vide / trémie non protégée</option>
                  <option value="impact">Sol/obstacle heurté pendant la chute</option>
                  <option value="chimique">Produit nocif</option>
                  <option value="bruit">Bruit</option>
                </select>
              </div>
              <div>
                <label>Situation dangereuse</label>
                <select data-q="B_situation">
                  <option value="">Choisir…</option>
                  <option value="zone_non_secu">Présence en hauteur dans une zone non sécurisée</option>
                  <option value="epi_ok">Travail en hauteur avec EPI correctement utilisé</option>
                  <option value="bureau">Travail de bureau</option>
                  <option value="atelier">Travail au sol en atelier</option>
                </select>
              </div>
              <div>
                <label>Événement dangereux</label>
                <select data-q="B_event">
                  <option value="">Choisir…</option>
                  <option value="chute_dans_vide">Chute dans le vide (trémie) / perte d’équilibre</option>
                  <option value="coupure">Coupure</option>
                  <option value="inhalation">Inhalation</option>
                  <option value="brulure">Brûlure</option>
                </select>
              </div>
              <div>
                <label>Dommage</label>
                <select data-q="B_damage">
                  <option value="">Choisir…</option>
                  <option value="grave">Blessure grave / incapacité permanente (paralysie)</option>
                  <option value="leger">Bleu</option>
                  <option value="audition">Surdité</option>
                  <option value="intox">Intoxication</option>
                </select>
              </div>
            </div>
          </div>

          <div class="box">
            <h3>Scénario C</h3>
            <p class="scenario">Lors du démontage d’un échafaudage, un maçon perd l’équilibre et fait une chute de hauteur. Il se casse une jambe.</p>
            <div class="row">
              <div>
                <label>Danger</label>
                <select data-q="C_danger">
                  <option value="">Choisir…</option>
                  <option value="impact">Sol/obstacle heurté pendant la chute</option>
                  <option value="echelle">Échelle mal fixée</option>
                  <option value="bruit">Bruit</option>
                  <option value="elec">Électricité</option>
                </select>
              </div>
              <div>
                <label>Situation dangereuse</label>
                <select data-q="C_situation">
                  <option value="">Choisir…</option>
                  <option value="echafaud">Travail en hauteur avec échafaudage</option>
                  <option value="atelier">Travail au sol</option>
                  <option value="chimique">Manipulation de produits</option>
                  <option value="route">Conduite sur route</option>
                </select>
              </div>
              <div>
                <label>Événement dangereux</label>
                <select data-q="C_event">
                  <option value="">Choisir…</option>
                  <option value="perte_equilibre">Perte d’équilibre → chute de hauteur</option>
                  <option value="contact_elec">Contact électrique</option>
                  <option value="intox">Inhalation</option>
                  <option value="coupure">Coupure</option>
                </select>
              </div>
              <div>
                <label>Dommage</label>
                <select data-q="C_damage">
                  <option value="">Choisir…</option>
                  <option value="fracture">Fracture (jambe)</option>
                  <option value="leger">Égratignure</option>
                  <option value="audition">Acouphènes</option>
                  <option value="intox">Intoxication</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <div class="actions">
          <button type="button" data-check="exo1">Corriger</button>
          <button type="button" class="btn2" data-reset="exo1">Réinitialiser</button>
          <div class="scorebar">
            <div class="scorebig">Score ex. 1 : <b id="s1">0</b>/8</div>
          </div>
        </div>
        <div class="result" id="r1">Résultat : en attente de correction.</div>
      </div>
    </section>

    <!-- EXO 2 -->
    <section class="card" id="exo2">
      <div class="card-h">
        <div class="left">
          <div class="pill">Exercice 2</div>
          <div class="pill"><strong>Classer les causes (5M)</strong></div>
          <div class="pill pts"><strong>8</strong> pts • C2</div>
        </div>
        <div class="pill">Glisser-déposer ou toucher</div>
      </div>
      <div class="card-b">
        <p class="note">
          Classe les causes possibles d’une <b>chute de hauteur</b> dans la bonne famille <b>5M</b>.
          <span class="kbd">Téléphone</span> : touche un chip (il devient violet) puis touche une zone pour le déposer.
          Tu peux retirer un chip d’une zone en le touchant.
        </p>

        <div class="box">
          <div class="familyHead">
            <h3 style="margin:0">Banque de causes (à placer)</h3>
            <div class="tag">Réinitialise si besoin</div>
          </div>
          <div class="bank" id="bank5m"></div>
          <div class="mini">Astuce : certaines familles auront plusieurs causes.</div>
        </div>

        <div class="twoCol" style="margin-top:12px">
          <div class="box">
            <div class="familyHead">
              <h3>Main d’œuvre</h3>
              <div class="tag">humain</div>
            </div>
            <div class="drop" data-zone="main_oeuvre"><span class="hint">Dépose ici</span></div>
          </div>
          <div class="box">
            <div class="familyHead">
              <h3>Matériel</h3>
              <div class="tag">équipement</div>
            </div>
            <div class="drop" data-zone="materiel"><span class="hint">Dépose ici</span></div>
          </div>
          <div class="box">
            <div class="familyHead">
              <h3>Méthode</h3>
              <div class="tag">organisation</div>
            </div>
            <div class="drop" data-zone="methode"><span class="hint">Dépose ici</span></div>
          </div>
          <div class="box">
            <div class="familyHead">
              <h3>Milieu</h3>
              <div class="tag">environnement</div>
            </div>
            <div class="drop" data-zone="milieu"><span class="hint">Dépose ici</span></div>
          </div>
        </div>

        <div class="actions">
          <button type="button" data-check="exo2">Corriger</button>
          <button type="button" class="btn2" data-reset="exo2">Réinitialiser</button>
          <div class="scorebar">
            <div class="scorebig">Score ex. 2 : <b id="s2">0</b>/8</div>
          </div>
        </div>
        <div class="result" id="r2">Résultat : en attente de correction.</div>
      </div>
    </section>

    <!-- EXO 3 -->
    <section class="card" id="exo3">
      <div class="card-h">
        <div class="left">
          <div class="pill">Exercice 3</div>
          <div class="pill"><strong>Hiérarchiser le risque</strong></div>
          <div class="pill pts"><strong>6</strong> pts • C2</div>
        </div>
        <div class="pill">Gravité + Probabilité</div>
      </div>
      <div class="card-b">
        <p class="note">
          Situation : un salarié travaille sur une toiture à <b>4 mètres</b> de hauteur. Il n’y a <b>pas de garde-corps</b>. L’activité a lieu <b>tous les jours</b>.
          Choisis le niveau de <b>gravité</b> et de <b>probabilité</b>, puis déduis la <b>priorité</b> (faible / moyenne / élevée).
        </p>

        <div class="grid cols2">
          <div class="box">
            <h3>Évaluation</h3>
            <div class="row">
              <div>
                <label>Gravité (1 à 4)</label>
                <select data-q="gravite">
                  <option value="">Choisir…</option>
                  <option value="1">1 — Dommage léger</option>
                  <option value="2">2 — Dommage modéré</option>
                  <option value="3">3 — Dommage grave / hospitalisation</option>
                  <option value="4">4 — Très grave / décès / incapacité permanente</option>
                </select>
              </div>
              <div>
                <label>Probabilité (1 à 4)</label>
                <select data-q="proba">
                  <option value="">Choisir…</option>
                  <option value="1">1 — Rare</option>
                  <option value="2">2 — Occasionnelle</option>
                  <option value="3">3 — Fréquente</option>
                  <option value="4">4 — Très fréquente</option>
                </select>
              </div>
              <div>
                <label>Priorité de réduction</label>
                <select data-q="priorite">
                  <option value="">Choisir…</option>
                  <option value="faible">Faible</option>
                  <option value="moyenne">Moyenne</option>
                  <option value="elevee">Élevée</option>
                </select>
              </div>
              <div>
                <label>Justification (1 phrase)</label>
                <select data-q="justif">
                  <option value="">Choisir…</option>
                  <option value="bonne">Chute possible + conséquences potentiellement très graves</option>
                  <option value="mauvaise1">Risque faible car on fait attention</option>
                  <option value="mauvaise2">Risque moyen car il n’y a pas de bruit</option>
                  <option value="mauvaise3">Risque faible car c’est en extérieur</option>
                </select>
              </div>
            </div>
          </div>

          <div class="box">
            <h3>Aide rapide</h3>
            <p class="scenario">
              Chute de hauteur : les dommages peuvent être <b>très graves</b> (fracture, traumatisme crânien, décès).
              Si le travail est <b>fréquent</b> et sans protection collective (garde-corps), la probabilité augmente.
            </p>
            <div class="mini">
              Méthode : tu relies <b>gravité</b> et <b>probabilité</b> pour décider de la priorité d’action.
            </div>
          </div>
        </div>

        <div class="actions">
          <button type="button" data-check="exo3">Corriger</button>
          <button type="button" class="btn2" data-reset="exo3">Réinitialiser</button>
          <div class="scorebar">
            <div class="scorebig">Score ex. 3 : <b id="s3">0</b>/6</div>
          </div>
        </div>
        <div class="result" id="r3">Résultat : en attente de correction.</div>
      </div>
    </section>

    <div class="footer">
      Conseils : si tu es sur téléphone, utilise le mode toucher pour le classement 5M. Sur ordinateur, tu peux aussi glisser-déposer.
    </div>
  </div>

<script>
(function(){
  const TOTAL_MAX = 22;
  const totalScoreEl = document.getElementById('totalScore');
  const doneCountEl = document.getElementById('doneCount');
  document.getElementById('totalMax').textContent = String(TOTAL_MAX);

  const state = {
    done: { exo1:false, exo2:false, exo3:false },
    scores: { exo1:0, exo2:0, exo3:0 }
  };

  function sumScores(){
    const t = state.scores.exo1 + state.scores.exo2 + state.scores.exo3;
    totalScoreEl.textContent = String(t);
    const d = Object.values(state.done).filter(Boolean).length;
    doneCountEl.textContent = String(d);
  }

  // ---------- EXO 1 ----------
  const exo1Answers = {
    A_danger: "ouverture",
    A_situation: "toit_fragile",
    A_event: "rupture",
    A_damage: "grave",
    B_danger: "ouverture",
    B_situation: "zone_non_secu",
    B_event: "chute_dans_vide",
    B_damage: "grave",
    C_danger: "impact",
    C_situation: "echafaud",
    C_event: "perte_equilibre",
    C_damage: "fracture",
  };
  function checkExo1(){
    let pts = 0;
    const total = 8;
    const keys = Object.keys(exo1Answers);

    // 12 items => 8 points: 2 points per scenario (4 items)
    // each correct item = 0.5 pt -> 8 pts max
    keys.forEach(k=>{
      const sel = document.querySelector(`#exo1 [data-q="${k}"]`);
      const v = sel ? sel.value : "";
      if(v && v === exo1Answers[k]) pts += 0.5;
    });

    pts = Math.round(pts * 2) / 2; // keep .5
    document.getElementById('s1').textContent = String(pts);
    const r = document.getElementById('r1');
    const missing = keys.filter(k=>{
      const sel = document.querySelector(`#exo1 [data-q="${k}"]`);
      return !sel || !sel.value;
    }).length;

    let msg = `Score : ${pts}/${total}. `;
    if(missing>0) msg += `Il manque ${missing} sélection(s). `;
    msg += `Correction attendue : A(ouverture→toit matériaux fragiles→rupture→dommage grave), B(trémie/vide→zone non sécurisée→chute→dommage grave), C(impact sol→travail sur échafaudage→perte d’équilibre→fracture).`;

    r.className = "result " + (pts>=6 ? "ok" : (pts>=3 ? "" : "bad"));
    r.textContent = msg;

    state.scores.exo1 = pts;
    state.done.exo1 = true;
    sumScores();
  }
  function resetExo1(){
    document.querySelectorAll('#exo1 select').forEach(s=>s.value="");
    document.getElementById('s1').textContent = "0";
    const r = document.getElementById('r1');
    r.className = "result";
    r.textContent = "Résultat : en attente de correction.";
    state.scores.exo1 = 0;
    state.done.exo1 = false;
    sumScores();
  }

  // ---------- EXO 2 (5M) ----------
  const bank = document.getElementById('bank5m');

  const chipsData = [
    { id:"c1", text:"Ne ferme pas le portillon d’une nacelle", zone:"main_oeuvre", hint:"erreur humaine" },
    { id:"c2", text:"Oublie de s’attacher (harnais non utilisé)", zone:"main_oeuvre", hint:"EPI" },
    { id:"c3", text:"Travaille trop vite / fatigue en fin de journée", zone:"main_oeuvre", hint:"vigilance" },

    { id:"c4", text:"Garde-corps absent ou incomplet", zone:"materiel", hint:"protection collective" },
    { id:"c5", text:"Échelle mal fixée ou glissante", zone:"materiel", hint:"accès" },
    { id:"c6", text:"Échafaudage instable / mal monté", zone:"materiel", hint:"structure" },

    { id:"c7", text:"Pas de balisage des zones à risque", zone:"methode", hint:"organisation" },
    { id:"c8", text:"Pas de formation au travail en hauteur", zone:"methode", hint:"consigne" },
    { id:"c9", text:"Préparation au sol non faite → trop d’actions en hauteur", zone:"methode", hint:"planification" },

    { id:"c10", text:"Toiture humide / vent", zone:"milieu", hint:"conditions" },
    { id:"c11", text:"Matériaux fragiles (verrière, dôme)", zone:"milieu", hint:"support" },
    { id:"c12", text:"Zone encombrée (outils, câbles)", zone:"milieu", hint:"circulation" },
  ];

  // Tap-to-place state
  let selectedChipId = null;

  function makeChip(ch){
    const el = document.createElement('div');
    el.className = "chip";
    el.setAttribute('draggable','true');
    el.dataset.chipId = ch.id;
    el.dataset.correctZone = ch.zone;
    el.innerHTML = `<span>${escapeHtml(ch.text)}</span><small>${escapeHtml(ch.hint)}</small>`;

    el.addEventListener('click', (e)=>{
      // If chip is in a drop zone, clicking removes it to bank
      const parentDrop = el.closest('.drop');
      if(parentDrop){
        moveChipToBank(el);
        clearSelection();
        return;
      }
      // chip in bank: select
      if(selectedChipId === ch.id){
        clearSelection();
      } else {
        clearSelection();
        selectedChipId = ch.id;
        el.classList.add('selected');
      }
    }, {passive:true});

    el.addEventListener('dragstart', (ev)=>{
      ev.dataTransfer.setData('text/plain', ch.id);
      try{ ev.dataTransfer.effectAllowed = "move"; }catch(_){}
      // also set selection to avoid iOS weirdness
      selectedChipId = ch.id;
      el.classList.add('selected');
    });

    return el;
  }

  function escapeHtml(str){
    return String(str).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
  }

  function clearSelection(){
    selectedChipId = null;
    document.querySelectorAll('.chip.selected').forEach(c=>c.classList.remove('selected'));
  }

  function moveChipToBank(chipEl){
    // remove placeholder hints if any
    const parentDrop = chipEl.closest('.drop');
    if(parentDrop){
      parentDrop.querySelectorAll('.hint').forEach(h=>h.remove());
    }
    chipEl.classList.remove('selected');
    bank.appendChild(chipEl);
    ensureDropHints();
  }

  function ensureDropHints(){
    document.querySelectorAll('#exo2 .drop').forEach(drop=>{
      if(drop.querySelectorAll('.chip').length === 0){
        if(!drop.querySelector('.hint')){
          const hint = document.createElement('span');
          hint.className = "hint";
          hint.textContent = "Dépose ici";
          drop.appendChild(hint);
        }
      } else {
        drop.querySelectorAll('.hint').forEach(h=>h.remove());
      }
    });
  }

  function getChipById(id){
    return document.querySelector(`.chip[data-chip-id="${CSS.escape(id)}"]`);
  }

  function placeSelectedInto(drop){
    if(!selectedChipId) return;
    const chipEl = getChipById(selectedChipId);
    if(!chipEl) return;

    // remove hint
    drop.querySelectorAll('.hint').forEach(h=>h.remove());
    chipEl.classList.remove('selected');
    drop.appendChild(chipEl);
    selectedChipId = null;
    ensureDropHints();
  }

  function init5M(){
    bank.innerHTML = "";
    chipsData.forEach(ch=>bank.appendChild(makeChip(ch)));
    ensureDropHints();

    // Dropzones: tap to place + drag/drop
    document.querySelectorAll('#exo2 .drop').forEach(drop=>{
      drop.addEventListener('click', (e)=>{
        // If user taps empty space in the drop zone, place selected chip
        if(e.target.classList.contains('drop') || e.target.classList.contains('hint')){
          placeSelectedInto(drop);
        }
      });

      drop.addEventListener('dragover', (ev)=>{
        ev.preventDefault();
        drop.classList.add('dragover');
      });
      drop.addEventListener('dragleave', ()=>{
        drop.classList.remove('dragover');
      });
      drop.addEventListener('drop', (ev)=>{
        ev.preventDefault();
        drop.classList.remove('dragover');
        const id = ev.dataTransfer.getData('text/plain');
        if(!id) return;
        const chipEl = getChipById(id);
        if(!chipEl) return;
        drop.querySelectorAll('.hint').forEach(h=>h.remove());
        chipEl.classList.remove('selected');
        drop.appendChild(chipEl);
        clearSelection();
        ensureDropHints();
      });
    });

    // clicking anywhere else clears selection
    document.addEventListener('click', (e)=>{
      if(!e.target.closest('#exo2 .chip')) clearSelection();
    }, {passive:true});
  }

  const expected5M = {
    main_oeuvre: new Set(["c1","c2","c3"]),
    materiel: new Set(["c4","c5","c6"]),
    methode: new Set(["c7","c8","c9"]),
    milieu: new Set(["c10","c11","c12"]),
  };

  function score5M(){
    let pts = 0;
    const total = 8;

    // 12 chips, each correct placement = 2/3 pt -> 8 total
    const each = total / 12;

    Object.keys(expected5M).forEach(zone=>{
      const drop = document.querySelector(`#exo2 .drop[data-zone="${zone}"]`);
      const placed = Array.from(drop.querySelectorAll('.chip')).map(c=>c.dataset.chipId);
      placed.forEach(id=>{
        if(expected5M[zone].has(id)) pts += each;
      });
    });

    pts = Math.round(pts * 10) / 10; // 0.1 for display
    document.getElementById('s2').textContent = String(pts);
    const r = document.getElementById('r2');

    const allPlaced = document.querySelectorAll('#exo2 .drop .chip').length;
    let msg = `Score : ${pts}/${total}. `;
    if(allPlaced < 12) msg += `Il manque ${12 - allPlaced} cause(s) à placer. `;
    msg += `Rappel : 5M = Main d’œuvre (humain), Matériel (équipement), Méthode (organisation), Milieu (environnement).`;

    r.className = "result " + (pts>=6 ? "ok" : (pts>=3 ? "" : "bad"));
    r.textContent = msg;

    state.scores.exo2 = pts;
    state.done.exo2 = true;
    sumScores();
  }

  function reset5M(){
    // move all chips back to bank
    document.querySelectorAll('#exo2 .drop .chip').forEach(ch=>bank.appendChild(ch));
    clearSelection();
    ensureDropHints();
    document.getElementById('s2').textContent = "0";
    const r = document.getElementById('r2');
    r.className = "result";
    r.textContent = "Résultat : en attente de correction.";
    state.scores.exo2 = 0;
    state.done.exo2 = false;
    sumScores();
  }

  // ---------- EXO 3 ----------
  function checkExo3(){
    const total = 6;
    let pts = 0;

    const g = document.querySelector('#exo3 [data-q="gravite"]').value;
    const p = document.querySelector('#exo3 [data-q="proba"]').value;
    const pr = document.querySelector('#exo3 [data-q="priorite"]').value;
    const j = document.querySelector('#exo3 [data-q="justif"]').value;

    if(g === "4") pts += 2;
    if(p === "3" || p === "4") pts += 2; // daily -> frequent
    if(pr === "elevee") pts += 1;
    if(j === "bonne") pts += 1;

    document.getElementById('s3').textContent = String(pts);
    const r = document.getElementById('r3');

    const missing = [g,p,pr,j].filter(x=>!x).length;
    let msg = `Score : ${pts}/${total}. `;
    if(missing>0) msg += `Il manque ${missing} choix. `;
    msg += `Attendu : gravité très élevée (chute 4 m), probabilité fréquente (activité quotidienne + pas de garde-corps), priorité élevée, justification : chute possible + conséquences graves.`;

    r.className = "result " + (pts>=5 ? "ok" : (pts>=3 ? "" : "bad"));
    r.textContent = msg;

    state.scores.exo3 = pts;
    state.done.exo3 = true;
    sumScores();
  }

  function resetExo3(){
    document.querySelectorAll('#exo3 select').forEach(s=>s.value="");
    document.getElementById('s3').textContent = "0";
    const r = document.getElementById('r3');
    r.className = "result";
    r.textContent = "Résultat : en attente de correction.";
    state.scores.exo3 = 0;
    state.done.exo3 = false;
    sumScores();
  }

  // ---------- WIRE BUTTONS ----------
  function wire(){
    document.querySelectorAll('[data-check]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const exo = btn.getAttribute('data-check');
        if(exo === "exo1") checkExo1();
        if(exo === "exo2") score5M();
        if(exo === "exo3") checkExo3();
      });
    });
    document.querySelectorAll('[data-reset]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const exo = btn.getAttribute('data-reset');
        if(exo === "exo1") resetExo1();
        if(exo === "exo2") reset5M();
        if(exo === "exo3") resetExo3();
      });
    });
  }

  // ---------- INIT ----------
  document.addEventListener('DOMContentLoaded', ()=>{
    init5M();
    wire();
    sumScores();
  });

})();
</script>
</body>
</html>
