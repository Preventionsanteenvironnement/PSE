<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestion Pizzeria - Exercice Long</title>
  <style>
    :root{
      --c-vente:#d1e7dd; --b-vente:#198754;
      --c-ingr:#f8d7da;  --b-ingr:#dc3545;
      --c-frais:#cfe2ff; --b-frais:#0d6efd;
      --bg-app:#fffaf0;
    }

    body{
      font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
      background-color:var(--bg-app);
      color:#333;
      padding:20px;
      display:flex;
      flex-direction:column;
      align-items:center;
      overflow-x:hidden;
    }

    h1{ margin-bottom:5px; color:#d35400; text-align:center; }
    p.subtitle{ margin-bottom:14px; color:#666; font-style:italic; text-align:center; }

    .toolbar{
      width:100%;
      max-width:1100px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:center;
      align-items:center;
      margin: 6px 0 16px 0;
    }
    .tool-btn{
      padding:10px 14px;
      font-size:1rem;
      cursor:pointer;
      background:#fff;
      border:2px solid #cbd5e1;
      border-radius:999px;
      box-shadow:0 2px 6px rgba(0,0,0,0.06);
      display:flex;
      align-items:center;
      gap:8px;
      user-select:none;
    }
    .tool-btn:active{ transform: translateY(1px); }
    .tool-btn.primary{
      background:#333;
      color:#fff;
      border-color:#333;
    }

    .selection-panel{
      width:100%;
      max-width:1100px;
      background:#fff;
      border:2px solid #d1d5db;
      border-radius:12px;
      padding:12px 14px;
      margin: 0 0 14px 0;
      box-shadow:0 4px 6px rgba(0,0,0,0.04);
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      justify-content:space-between;
      align-items:center;
    }
    .selection-left{
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width:260px;
    }
    .selection-title{ font-weight:700; font-size:1.02rem; }
    .selection-current{
      font-size:1rem;
      padding:8px 10px;
      border-radius:10px;
      background:#f1f5f9;
      border:2px solid #cbd5e1;
      min-height:42px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .selection-current .pill{
      font-weight:700;
      padding:3px 8px;
      border-radius:8px;
      border:2px solid #111827;
      background:#fff;
      font-size:0.95rem;
      white-space:nowrap;
    }
    .selection-hint{ font-size:0.95rem; opacity:0.85; }
    .selection-actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:center;
    }
    .selection-actions select{
      padding:10px 12px;
      font-size:1.05rem;
      border-radius:10px;
      border:2px solid #999;
      font-weight:700;
      background:#fff;
    }

    .legend-bar{
      display:flex;
      gap:20px;
      margin-bottom:18px;
      background:white;
      padding:15px 25px;
      border-radius:50px;
      border:2px solid #ddd;
      flex-wrap:wrap;
      justify-content:center;
      max-width:1100px;
      width:100%;
    }
    .leg-item{
      display:flex;
      align-items:center;
      gap:8px;
      font-weight:700;
      padding:5px 12px;
      border-radius:20px;
      border:2px solid;
    }
    .l-v{ background:var(--c-vente); border-color:var(--b-vente); color:#0f5132; }
    .l-i{ background:var(--c-ingr);  border-color:var(--b-ingr);  color:#842029; }
    .l-f{ background:var(--c-frais); border-color:var(--b-frais); color:#084298; }

    #bank{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      justify-content:center;
      background:#fff;
      padding:15px;
      border:3px dashed #bbb;
      border-radius:12px;
      width:100%;
      max-width:1100px;
      min-height:150px;
      margin-bottom:24px;
      align-content:flex-start;
      transition: background 0.12s, outline 0.12s;
    }
    #bank.active{
      background: rgba(0,0,0,0.03);
      outline: 3px solid rgba(17,24,39,0.10);
    }

    .item{
      background:white;
      border:2px solid #777;
      border-radius:6px;
      padding:6px 10px;
      cursor:grab;
      font-size:0.95rem;
      display:flex;
      align-items:center;
      gap:8px;
      box-shadow:0 2px 4px rgba(0,0,0,0.1);
      user-select:none;
      touch-action:manipulation;
      transition: transform 0.1s, box-shadow 0.1s, border-color 0.1s;
    }
    .item:active{ cursor:grabbing; transform:scale(1.03); }
    .item strong{ margin-left:auto; padding-left:10px; border-left:1px solid #eee; }
    .item.selected{
      border-color:#111827;
      box-shadow:0 8px 16px rgba(0,0,0,0.18);
      transform: scale(1.02);
      cursor:pointer;
    }

    .tag{
      font-weight:700;
      padding:2px 6px;
      border-radius:4px;
      font-size:0.85rem;
      border:1px solid rgba(0,0,0,0.2);
    }

    .main-grid{
      display:grid;
      grid-template-columns:repeat(3, 1fr);
      gap:20px;
      width:100%;
      max-width:1200px;
    }

    .column{
      background:white;
      border-radius:12px;
      border-top:8px solid #555;
      padding:15px;
      display:flex;
      flex-direction:column;
      min-height:500px;
      box-shadow:0 4px 6px rgba(0,0,0,0.05);
    }

    .col-v{ border-color:var(--b-vente); background:#f1fcf5; }
    .col-i{ border-color:var(--b-ingr);  background:#fff5f5; }
    .col-f{ border-color:var(--b-frais); background:#f0f7ff; }

    h3{
      text-align:center;
      margin-top:0;
      border-bottom:2px solid rgba(0,0,0,0.1);
      padding-bottom:10px;
    }

    .drop-area{
      flex-grow:1;
      border:2px dashed rgba(0,0,0,0.1);
      border-radius:8px;
      padding:10px;
      display:flex;
      flex-direction:column;
      gap:6px;
      margin-bottom:15px;
      transition: background 0.12s, outline 0.12s;
      min-height:140px;
    }
    .drop-area.active{
      background: rgba(0,0,0,0.03);
      outline: 3px solid rgba(17,24,39,0.10);
    }

    .calc-box{
      background:rgba(255,255,255,0.8);
      padding:10px;
      border-radius:8px;
      text-align:center;
      border:1px solid #ccc;
    }
    input{
      width:110px;
      padding:6px;
      font-size:1.1rem;
      text-align:right;
      border:2px solid #ccc;
      border-radius:4px;
      margin-bottom:5px;
    }
    button{
      padding:6px 12px;
      cursor:pointer;
      font-size:1rem;
      user-select:none;
    }
    .feedback{
      display:block;
      font-weight:700;
      font-size:0.9rem;
      margin-top:5px;
      min-height:1.2em;
    }
    .ok{ color:var(--b-vente); }
    .ko{ color:var(--b-ingr); }

    .bilan-section{
      width:100%;
      max-width:800px;
      background:white;
      margin-top:40px;
      padding:30px;
      border-radius:15px;
      box-shadow:0 5px 15px rgba(0,0,0,0.1);
      border-left:10px solid #d35400;
    }
    .bilan-row{
      display:flex;
      justify-content:space-between;
      margin-bottom:12px;
      font-size:1.2rem;
      gap:10px;
      flex-wrap:wrap;
    }
    .separator{ border-top:2px solid #eee; margin:15px 0; }

    @media (max-width: 900px){
      .main-grid{ grid-template-columns: 1fr; }
      .legend-bar{ border-radius:16px; }
    }
  </style>
</head>
<body>

  <h1>üçï Pizzeria Chez Luigi</h1>
  <p class="subtitle">Aide Luigi √† trier ses tickets de la journ√©e pour calculer son b√©n√©fice.</p>

  <div class="toolbar">
    <button class="tool-btn" id="btn-sound" onclick="toggleSound()">üîà Son : ON</button>
    <button class="tool-btn" onclick="clearSelection()">‚úã Annuler la s√©lection</button>
    <button class="tool-btn primary" onclick="location.reload()">üîÑ Recommencer</button>
  </div>

  <div class="selection-panel" id="selection-panel">
    <div class="selection-left">
      <div class="selection-title">Mode t√©l√©phone : je s√©lectionne un ticket puis je clique une zone</div>
      <div class="selection-current" id="selection-current">
        <span class="pill">Aucun</span><span>Ticket s√©lectionn√©</span>
      </div>
      <div class="selection-hint" id="mode-hint">Ordinateur : glisser-d√©poser. T√©l√©phone : utiliser surtout les clics.</div>
    </div>
    <div class="selection-actions">
      <label for="mobile-target" style="font-weight:700;">Zone cible :</label>
      <select id="mobile-target">
        <option value="bank">üè¶ Banque (retour)</option>
        <option value="V">ü§ë Ventes (V)</option>
        <option value="I">üçÖ Ingr√©dients (I)</option>
        <option value="F">‚ö° Frais fixes (F)</option>
      </select>
    </div>
  </div>

  <div class="legend-bar">
    <div class="leg-item l-v">(V) = VENTES (Recettes)</div>
    <div class="leg-item l-i">(I) = INGR√âDIENTS (Achats)</div>
    <div class="leg-item l-f">(F) = FRAIS FIXES (Factures)</div>
  </div>

  <div style="margin-bottom:10px; font-weight:700; text-align:center;">Trie les 24 √©tiquettes ci-dessous :</div>

  <div id="bank" aria-label="Banque de tickets"></div>

  <div class="main-grid">

    <div class="column col-v">
      <h3>ü§ë VENTES (V)</h3>
      <div class="drop-area" data-cat="V" aria-label="Colonne ventes"></div>
      <div class="calc-box">
        Total Ventes : <input type="number" id="inp-V" inputmode="numeric"> ‚Ç¨
        <br><button onclick="checkColumn('V')">V√©rifier</button>
        <span id="msg-V" class="feedback"></span>
      </div>
    </div>

    <div class="column col-i">
      <h3>üçÖ INGR√âDIENTS (I)</h3>
      <div class="drop-area" data-cat="I" aria-label="Colonne ingr√©dients"></div>
      <div class="calc-box">
        Total Ingr√©dients : <input type="number" id="inp-I" inputmode="numeric"> ‚Ç¨
        <br><button onclick="checkColumn('I')">V√©rifier</button>
        <span id="msg-I" class="feedback"></span>
      </div>
    </div>

    <div class="column col-f">
      <h3>‚ö° FRAIS FIXES (F)</h3>
      <div class="drop-area" data-cat="F" aria-label="Colonne frais fixes"></div>
      <div class="calc-box">
        Total Frais : <input type="number" id="inp-F" inputmode="numeric"> ‚Ç¨
        <br><button onclick="checkColumn('F')">V√©rifier</button>
        <span id="msg-F" class="feedback"></span>
      </div>
    </div>

  </div>

  <div class="bilan-section">
    <h2 style="margin-top:0;">üìä Calcul du B√©n√©fice</h2>
    <p>Le b√©n√©fice, c'est ce qui reste dans la poche de Luigi √† la fin.</p>

    <div class="bilan-row" style="color:#198754;">
      <span>(+) Total des Ventes :</span>
      <span id="res-V">...</span>
    </div>
    <div class="bilan-row" style="color:#dc3545;">
      <span>(-) Total des Ingr√©dients :</span>
      <span id="res-I">...</span>
    </div>
    <div class="bilan-row" style="color:#0d6efd;">
      <span>(-) Total des Frais Fixes :</span>
      <span id="res-F">...</span>
    </div>

    <div class="separator"></div>

    <div class="bilan-row" style="font-weight:800; font-size:1.4rem;">
      <span>= B√âN√âFICE FINAL :</span>
      <input type="number" id="inp-benefice" placeholder="?" inputmode="numeric"> ‚Ç¨
    </div>

    <div style="text-align:center; margin-top:20px;">
      <button onclick="checkFinal()" style="padding:10px 30px; font-size:1.2rem; background:#333; color:white; border:none; border-radius:8px;">
        V√©rifier le R√©sultat
      </button>
      <span id="msg-final" class="feedback" style="font-size:1.2rem; margin-top:10px;"></span>
    </div>
  </div>

  <script>
    const itemsData = [
      { name:"Vente Pizzas Midi",      val:400, cat:"V", style:"l-v" },
      { name:"Vente Pizzas Soir",      val:800, cat:"V", style:"l-v" },
      { name:"Commandes UberEats",     val:150, cat:"V", style:"l-v" },
      { name:"Vente Boissons",        val:100, cat:"V", style:"l-v" },
      { name:"Vente Desserts",        val:80,  cat:"V", style:"l-v" },
      { name:"Vente Caf√©s",           val:30,  cat:"V", style:"l-v" },
      { name:"Pourboires",            val:20,  cat:"V", style:"l-v" },
      { name:"Vente √† emporter",      val:200, cat:"V", style:"l-v" },

      { name:"Sac de Farine",         val:50,  cat:"I", style:"l-i" },
      { name:"Caisse Tomates",        val:40,  cat:"I", style:"l-i" },
      { name:"Mozzarella",            val:120, cat:"I", style:"l-i" },
      { name:"Jambon",                val:60,  cat:"I", style:"l-i" },
      { name:"Champignons",           val:20,  cat:"I", style:"l-i" },
      { name:"Olives Noires",         val:15,  cat:"I", style:"l-i" },
      { name:"Levure",                val:10,  cat:"I", style:"l-i" },
      { name:"Huile d'olive",         val:25,  cat:"I", style:"l-i" },
      { name:"Cartons Pizza",         val:30,  cat:"I", style:"l-i" },

      { name:"Loyer Local",           val:200, cat:"F", style:"l-f" },
      { name:"√âlectricit√©",           val:80,  cat:"F", style:"l-f" },
      { name:"Assurance",             val:50,  cat:"F", style:"l-f" },
      { name:"Salaire Plongeur",      val:100, cat:"F", style:"l-f" },
      { name:"Abonnement Internet",   val:30,  cat:"F", style:"l-f" },
      { name:"Publicit√© Radio",       val:40,  cat:"F", style:"l-f" },
      { name:"Produits M√©nage",       val:20,  cat:"F", style:"l-f" }
    ];

    itemsData.sort(() => Math.random() - 0.5);

    const bank = document.getElementById("bank");
    let selected = null;
    let soundEnabled = true;

    function isMobileLayout(){
      return window.matchMedia("(max-width: 900px)").matches;
    }

    function toggleSound(){
      soundEnabled = !soundEnabled;
      const btn = document.getElementById("btn-sound");
      btn.textContent = soundEnabled ? "üîà Son : ON" : "üîá Son : OFF";
      try{ if(!soundEnabled && window.speechSynthesis) window.speechSynthesis.cancel(); }catch(e){}
    }

    function speak(text){
      if(!soundEnabled) return;
      try{
        if(!window.speechSynthesis) return;
        window.speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(text);
        u.lang = "fr-FR";
        window.speechSynthesis.speak(u);
      }catch(e){}
    }

    function updateSelectionPanel(){
      const box = document.getElementById("selection-current");
      if(!selected){
        box.innerHTML = '<span class="pill">Aucun</span><span>Ticket s√©lectionn√©</span>';
        return;
      }
      const cat = selected.dataset.cat || "?";
      const name = selected.dataset.name || "Ticket";
      const val = selected.dataset.val || "";
      box.innerHTML = `<span class="pill">${cat}</span><span>${name} ‚Äî ${val} ‚Ç¨</span>`;
    }

    function setSelected(el){
      document.querySelectorAll(".item.selected").forEach(x => x.classList.remove("selected"));
      selected = el;
      el.classList.add("selected");
      updateSelectionPanel();
    }

    function clearSelection(){
      document.querySelectorAll(".item.selected").forEach(x => x.classList.remove("selected"));
      selected = null;
      updateSelectionPanel();
    }

    function setDragMode(){
      const enableDrag = !isMobileLayout();
      document.querySelectorAll(".item").forEach(el => {
        el.draggable = enableDrag;
        el.style.cursor = enableDrag ? "grab" : "pointer";
      });
      document.getElementById("mode-hint").textContent = enableDrag
        ? "Ordinateur : glisser-d√©poser. T√©l√©phone : utiliser surtout les clics."
        : "T√©l√©phone : s√©lectionner un ticket puis cliquer une zone.";
    }

    function findDropZoneByCat(cat){
      return document.querySelector(`.drop-area[data-cat="${cat}"]`);
    }

    function findTargetZoneBySelect(){
      const v = document.getElementById("mobile-target").value;
      if(v === "bank") return bank;
      return findDropZoneByCat(v);
    }

    function moveSelectedToTarget(target){
      if(!selected || !target) return;
      target.appendChild(selected);
      clearSelection();
    }

    function activateZone(zone, on){
      if(!zone || !zone.classList) return;
      if(on) zone.classList.add("active");
      else zone.classList.remove("active");
    }

    itemsData.forEach((item, index) => {
      const el = document.createElement("div");
      el.className = "item";
      el.id = "itm-" + index;
      el.dataset.val = item.val;
      el.dataset.cat = item.cat;
      el.dataset.name = item.name;

      el.innerHTML = `
        <span class="tag ${item.style}">${item.cat}</span>
        <span>${item.name}</span>
        <strong>${item.val} ‚Ç¨</strong>
      `;

      el.addEventListener("dragstart", (e) => {
        if(isMobileLayout()){ e.preventDefault(); return; }
        e.dataTransfer.setData("text", el.id);
        setSelected(el);
      });

      el.addEventListener("click", () => {
        setSelected(el);
        speak(item.name + " " + item.val + " euros");
        if(isMobileLayout()){
          const target = findTargetZoneBySelect();
          moveSelectedToTarget(target);
        }
      });

      bank.appendChild(el);
    });

    document.querySelectorAll(".drop-area, #bank").forEach(zone => {
      zone.addEventListener("dragover", e => {
        if(isMobileLayout()) return;
        e.preventDefault();
        activateZone(zone, true);
      });

      zone.addEventListener("dragleave", e => {
        if(isMobileLayout()) return;
        activateZone(zone, false);
      });

      zone.addEventListener("drop", e => {
        if(isMobileLayout()) return;
        e.preventDefault();
        activateZone(zone, false);
        const id = e.dataTransfer.getData("text");
        const el = document.getElementById(id);
        if(el) zone.appendChild(el);
        clearSelection();
      });

      zone.addEventListener("click", () => {
        if(!selected) return;
        zone.appendChild(selected);
        clearSelection();
      });
    });

    setDragMode();
    updateSelectionPanel();
    window.addEventListener("resize", () => { setDragMode(); clearSelection(); });

    function checkColumn(cat){
      const zone = document.querySelector(`.drop-area[data-cat="${cat}"]`);
      const input = document.getElementById(`inp-${cat}`);
      const msg = document.getElementById(`msg-${cat}`);

      let sum = 0;
      let error = false;

      if(!zone || !input || !msg) return;

      if(zone.children.length === 0){
        msg.textContent = "La colonne est vide.";
        msg.className = "feedback ko";
        return;
      }

      [...zone.children].forEach(child => {
        sum += parseInt(child.dataset.val, 10) || 0;
        if(child.dataset.cat !== cat) error = true;
      });

      const userVal = parseInt(input.value, 10);

      if(error){
        msg.textContent = "‚ö†Ô∏è Une √©tiquette n'est pas √† sa place (v√©rifie le code).";
        msg.className = "feedback ko";
      } else if(isNaN(userVal)){
        msg.textContent = "Calcule et √©cris le total.";
        msg.className = "feedback ko";
      } else if(userVal === sum){
        msg.textContent = "‚úÖ Total correct !";
        msg.className = "feedback ok";
        input.disabled = true;
        input.style.borderColor = "#198754";
        input.style.backgroundColor = "#d1e7dd";
        updateBilan();
      } else {
        msg.textContent = "‚ùå Erreur de calcul.";
        msg.className = "feedback ko";
      }
    }

    function updateBilan(){
      const vDone = document.getElementById("inp-V").disabled;
      const iDone = document.getElementById("inp-I").disabled;
      const fDone = document.getElementById("inp-F").disabled;

      if(vDone && iDone && fDone){
        document.getElementById("res-V").textContent = document.getElementById("inp-V").value + " ‚Ç¨";
        document.getElementById("res-I").textContent = document.getElementById("inp-I").value + " ‚Ç¨";
        document.getElementById("res-F").textContent = document.getElementById("inp-F").value + " ‚Ç¨";
      }
    }

    function checkFinal(){
      const v = parseInt(document.getElementById("inp-V").value, 10);
      const i = parseInt(document.getElementById("inp-I").value, 10);
      const f = parseInt(document.getElementById("inp-F").value, 10);
      const userRes = parseInt(document.getElementById("inp-benefice").value, 10);
      const msg = document.getElementById("msg-final");

      if(isNaN(v) || isNaN(i) || isNaN(f)){
        msg.textContent = "Valide d'abord les 3 colonnes ci-dessus.";
        msg.className = "feedback ko";
        return;
      }
      if(isNaN(userRes)){
        msg.textContent = "√âcris le b√©n√©fice dans la case.";
        msg.className = "feedback ko";
        return;
      }

      const realRes = v - i - f;

      if(userRes === realRes){
        msg.innerHTML = "üéâ BRAVO ! Luigi te remercie.<br>L'exercice est termin√©.";
        msg.className = "feedback ok";
        document.body.style.backgroundColor = "#d1e7dd";
      } else {
        msg.textContent = "‚ùå Faux. Fais : Ventes - Ingr√©dients - Frais fixes.";
        msg.className = "feedback ko";
      }
    }
  </script>
</body>
</html>
