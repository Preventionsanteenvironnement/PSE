<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Évaluation A3 — Alimentation & activité physique</title>
  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --text:#111827;
      --muted:#4b5563;
      --border:#e5e7eb;
      --accent:#2563eb;
      --good:#16a34a;
      --bad:#dc2626;
      --scale:1;
      --radius:18px;
      --shadow: 0 10px 30px rgba(0,0,0,.08);
      --focus: 0 0 0 3px rgba(37,99,235,.25);
    }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height:1.45;
    }
    header{
      padding:20px 16px;
      text-align:center;
    }
    header h1{
      margin:0;
      font-size: clamp(20px, 2.5vw, 28px);
      font-weight:800;
      letter-spacing:-0.02em;
    }
    header p{
      margin:8px 0 0;
      color:var(--muted);
      font-size: 14px;
    }
    .wrap{
      max-width: 980px;
      margin: 0 auto;
      padding: 0 14px 40px;
    }
    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px;
      margin: 12px 0;
    }
    .row{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
    }
    .field{
      flex:1 1 200px;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    label{
      font-size: 13px;
      color: var(--muted);
    }
    input, textarea, select{
      width:100%;
      border:1px solid var(--border);
      border-radius: 12px;
      padding: 10px 12px;
      font-size: 15px;
      outline:none;
      background:#fff;
      box-sizing:border-box;
      font-family: inherit;
    }
    textarea{
      min-height: 110px;
      resize:vertical;
    }
    input:focus, textarea:focus, select:focus{
      box-shadow: var(--focus);
      border-color: rgba(37,99,235,.55);
    }
    .section-title{
      display:flex;
      align-items:center;
      gap:10px;
      margin:0 0 10px;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      font-size:12px;
      padding:6px 10px;
      border-radius: 999px;
      background: rgba(37,99,235,.1);
      color: var(--accent);
      border: 1px solid rgba(37,99,235,.2);
      font-weight:700;
    }
    .q{
      margin: 14px 0;
      padding-top: 12px;
      border-top:1px dashed var(--border);
    }
    .q:first-of-type{
      border-top:none;
      padding-top:0;
    }
    .q h3{
      margin:0 0 8px;
      font-size: 16px;
    }
    .hint{
      margin:0 0 10px;
      color:var(--muted);
      font-size: 13px;
    }
    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
      margin-top: 12px;
    }
    button{
      border:0;
      border-radius: 14px;
      padding: 10px 14px;
      font-size: 14px;
      font-weight:800;
      cursor:pointer;
      box-shadow: 0 6px 18px rgba(0,0,0,.08);
    }
    .btn-primary{
      background: var(--accent);
      color:#fff;
    }
    .btn-secondary{
      background:#111827;
      color:#fff;
    }
    .btn-ghost{
      background:#fff;
      color:#111827;
      border:1px solid var(--border);
      box-shadow:none;
    }
    footer{
      text-align:center;
      color:var(--muted);
      font-size: 12px;
      padding: 16px 0 0;
    }
    @media (max-width: 640px){
      .card{ padding: 14px; }
      button{ width: 100%; }
      .actions{ justify-content:stretch; }
    }
  </style>
</head>

<body>
<header>
  <h1>Devoir PSE — Module A3</h1>
  <p>Thème : Alimentation & activité physique — Réponses courtes et argumentées</p>
</header>

<div class="wrap">

  <div class="card">
    <div class="section-title">
      <span class="badge">Identification</span>
      <h2 style="margin:0;font-size:18px;">Élève</h2>
    </div>

    <div class="row">
      <div class="field">
        <label for="nom">Nom</label>
        <input id="nom" type="text" placeholder="Nom" autocomplete="family-name" />
      </div>
      <div class="field">
        <label for="prenom">Prénom</label>
        <input id="prenom" type="text" placeholder="Prénom" autocomplete="given-name" />
      </div>
      <div class="field">
        <label for="classe">Classe</label>
        <input id="classe" type="text" placeholder="Ex : 1CAP / TMELEC / ..." />
      </div>
    </div>
  </div>

  <div class="card">
    <div class="section-title">
      <span class="badge">Situation</span>
      <h2 style="margin:0;font-size:18px;">Lecture</h2>
    </div>

    <p style="margin:0;color:var(--muted);font-size:14px;">
      Tu vas répondre à des questions sur l’alimentation et l’activité physique. Appuie-toi sur tes connaissances
      et sur les documents vus en cours. Justifie tes réponses.
    </p>
  </div>

  <div class="card">
    <div class="section-title">
      <span class="badge">Questions</span>
      <h2 style="margin:0;font-size:18px;">Réponds directement dans les zones</h2>
    </div>

    <div class="q">
      <h3>1) Explique la différence entre activité physique et sport.</h3>
      <p class="hint">Donne une définition et un exemple pour chaque.</p>
      <textarea placeholder="Ta réponse..."></textarea>
    </div>

    <div class="q">
      <h3>2) Cite 2 effets positifs d’une activité physique régulière sur la santé.</h3>
      <p class="hint">Ex : sommeil, stress, cœur, poids, énergie...</p>
      <textarea placeholder="Ta réponse..."></textarea>
    </div>

    <div class="q">
      <h3>3) Donne 3 conseils concrets pour limiter la sédentarité au quotidien.</h3>
      <p class="hint">Conseils réalistes et précis.</p>
      <textarea placeholder="Ta réponse..."></textarea>
    </div>

    <div class="q">
      <h3>4) Construis un exemple de repas équilibré (entrée + plat + dessert ou équivalent).</h3>
      <p class="hint">Explique brièvement pourquoi c’est équilibré.</p>
      <textarea placeholder="Ta réponse..."></textarea>
    </div>

    <div class="q">
      <h3>5) Propose une solution pour une personne qui saute souvent le petit-déjeuner.</h3>
      <p class="hint">Solution + justification.</p>
      <textarea placeholder="Ta réponse..."></textarea>
    </div>

    <div class="actions">
      <button class="btn-ghost" id="downloadBtn" type="button">Télécharger en JSON</button>
      <button class="btn-secondary" id="resetBtn" type="button">Réinitialiser</button>
      <button class="btn-primary" id="sendBtn" type="button">Envoyer à l’enseignant</button>
    </div>
  </div>

  <footer>
    Pense à relire avant d’envoyer.
  </footer>
</div>

<script type="module">
  // --- Firebase (CDN) ---
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  // ⚠️ Configuration Firebase (à conserver identique à ta base)
  const firebaseConfig = {
    apiKey: "AIzaSyA...REMPLACE",
    authDomain: "TON-PROJET.firebaseapp.com",
    projectId: "TON-PROJET",
    storageBucket: "TON-PROJET.appspot.com",
    messagingSenderId: "000000000000",
    appId: "1:000000000000:web:xxxxxxxxxxxxxxxx"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  function validerIdentite(data){
    if(!data.nom || !data.prenom || !data.classe){
      alert("Merci de compléter Nom, Prénom et Classe avant d'envoyer ou d'enregistrer.");
      return false;
    }
    return true;
  }

  function getDataPayload(){
    const nom = document.getElementById("nom").value.trim();
    const prenom = document.getElementById("prenom").value.trim();
    const classe = document.getElementById("classe").value.trim();

    const reponsesObj = {};
    Array.from(document.querySelectorAll("textarea")).forEach((t, i) => {
      reponsesObj[String(i + 1)] = (t.value || "").trim();
    });

    return {
      type: "copie_eleve_pse",
      nom,
      prenom,
      classe,
      reponses: reponsesObj,
      meta: {
        createdAt: new Date().toISOString(),
        competences: ["C2","C3","C4","C5"],
        score: null,
        maxScore: null,
        bareme: "",
        details: {}
      }
    };
  }

  async function envoyerCopie(){
    const data = getDataPayload();
    if(!validerIdentite(data)) return;

    const btn = document.getElementById("sendBtn");
    const texteOriginal = btn.textContent;
    btn.textContent = "Envoi...";
    btn.disabled = true;

    try {
      await addDoc(collection(db, "bacpro"), data);
      alert("Confirmation : Votre devoir a bien été envoyé.");
      btn.textContent = "Envoyé";
    } catch (e) {
      console.error(e);
      alert("Erreur lors de l'envoi. Vérifiez votre connexion.");
      btn.textContent = texteOriginal;
      btn.disabled = false;
    }
  }

  function telechargerJSON(){
    const data = getDataPayload();
    if(!validerIdentite(data)) return;

    const blob = new Blob([JSON.stringify(data, null, 2)], {type: "application/json"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    const safeName = (str) => str.replace(/[^a-z0-9]/gi, "_").toLowerCase();
    a.download = `eval_A3_${safeName(data.classe)}_${safeName(data.nom)}.json`;
    a.click();
    URL.revokeObjectURL(a.href);
  }

  function resetForm(){
    if(!confirm("Réinitialiser toutes les réponses ?")) return;
    document.getElementById("nom").value = "";
    document.getElementById("prenom").value = "";
    document.getElementById("classe").value = "";
    document.querySelectorAll("textarea").forEach(t => t.value = "");
    const btn = document.getElementById("sendBtn");
    btn.textContent = "Envoyer à l’enseignant";
    btn.disabled = false;
  }

  document.getElementById("sendBtn").addEventListener("click", envoyerCopie);
  document.getElementById("downloadBtn").addEventListener("click", telechargerJSON);
  document.getElementById("resetBtn").addEventListener("click", resetForm);
</script>

</body>
</html>
