<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>√âVALUATION ‚Äì ACTIVIT√â PHYSIQUE ‚Äì MODULE A3</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body{
      font-family: Arial, sans-serif;
      margin:0;
      padding:0;
      color:#000;
      line-height:1.5;
      background:#fff;
    }

    .container{
      width:100%;
      max-width:none;
      padding:0 1cm;
      box-sizing:border-box;
    }

    header{
      border-bottom:2px solid #000;
      padding-bottom:10px;
      margin-bottom:15px;
    }

    h1{
      font-size:1.6em;
      margin:0;
      text-transform:uppercase;
    }

    .identite{
      display:flex;
      justify-content:space-between;
      margin-top:10px;
      font-weight:bold;
      gap:10px;
      flex-wrap:wrap;
    }

    .competences{
      font-size:0.85em;
      margin-top:8px;
    }

    .section-title{
      font-weight:bold;
      margin:20px 0 5px;
      font-size:1.1em;
    }

    .situation{
      display:flex;
      gap:15px;
      margin-bottom:20px;
      flex-wrap:wrap;
    }

    .situation img{
      width:120px;
      max-width:100%;
    }

    .question{
      margin-bottom:18px;
      font-weight: normal; /* Par d√©faut, pas de gras */
    }

    /* Le style pour mettre en gras uniquement ce qui est dans <strong> */
    .q-text, .question div, .question span {
        font-weight: normal;
    }
    strong {
        font-weight: bold;
    }

    .q-head{
      margin-bottom:5px;
    }

    .q-comp{
      font-size:0.85em;
      margin-left:8px;
      color:#333;
      font-weight: bold;
    }

    table{
      width:100%;
      border-collapse:collapse;
      margin-top:8px;
    }

    th, td{
      border:1px solid #000;
      padding:8px;
      vertical-align:top;
    }

    th{
      width:30%;
      background:#eee;
    }

    textarea{
      width:100%;
      min-height:60px;
      resize:vertical;
      box-sizing:border-box;
      font-family:inherit;
      font-size:1em;
      padding:6px;
    }

    .doc{
      margin-top:20px;
    }

    .doc-title{
      font-weight:bold;
      margin-bottom:5px;
    }

    .doc img{
      max-width:70%;
      display:block;
    }

    .doc-source{
      font-size:0.7em;
      color:#555;
      margin-bottom:10px;
    }

    .actions{
      position:fixed;
      bottom:15px;
      right:15px;
      display:flex;
      gap:8px;
      z-index:1000;
    }

    .btn{
      padding:10px 12px;
      border:1px solid #000;
      background:#fff;
      cursor:pointer;
      font-weight:bold;
      font-size:0.9em;
    }

    @media print{
      .actions{ display:none; }
      .container{ padding:0; }
    }
  </style>
</head>

<body>
<div class="container">

<header>
  <h1>√âvaluation ‚Äì Activit√© physique ‚Äì Module A3</h1>

  <div class="identite">
    <div>
      Classe : <input type="text" id="classe">
      Date : <input type="date" id="date">
      <span id="display-pseudo" style="font-weight:bold; color:#3b82f6; margin-left:15px;"></span>
    </div>
    <div>Note : / 20</div>
  </div>

  <div class="competences">
    √âvaluation par comp√©tences :<br>
    C2 ‚Äì Appliquer une d√©marche d‚Äôanalyse dans une situation donn√©e<br>
    C3 ‚Äì Expliquer un ph√©nom√®ne physiologique ou un enjeu de sant√©<br>
    C4 ‚Äì Proposer une solution adapt√©e<br>
    C5 ‚Äì Argumenter un choix li√© √† la pr√©vention
  </div>
</header>

<div class="section-title">SITUATION</div>
<div class="situation">
  <div>
    En France, de nombreux adolescents en formation professionnelle passent une grande partie
    de leur temps libre devant les √©crans. En dehors des cours et de l‚ÄôEPS, ils pratiquent peu
    d‚Äôactivit√© physique. Cette s√©dentarit√© √©lev√©e peut avoir des cons√©quences sur leur sant√©
    physique, mentale et sociale. Les autorit√©s de sant√© rappellent l‚Äôimportance de bouger
    r√©guli√®rement pour pr√©server son capital sant√©.
  </div>
  <img src="situation.jpg" alt="">
</div>

<div class="question">
  <div class="q-head">1. <strong>Analyser</strong> la situation en compl√©tant le tableau d‚Äôanalyse (QQOQCP)
    <span class="q-comp">(C2)</span>
  </div>
  <table>
    <tr><th>QUI</th><td><textarea></textarea></td></tr>
    <tr><th>QUOI</th><td><textarea></textarea></td></tr>
    <tr><th>O√ô</th><td><textarea></textarea></td></tr>
    <tr><th>POURQUOI</th><td><textarea></textarea></td></tr>
  </table>
</div>

<div class="question">
  <div class="q-head">2. √Ä l‚Äôaide de vos connaissances, <strong>expliquer</strong> ce que signifie la s√©dentarit√©
    <span class="q-comp">(C3)</span>
  </div>
  <textarea></textarea>
</div>

<div class="doc">
  <div class="doc-title">Document 1 : Le trajet de l‚Äôinformation nerveuse pour r√©aliser un mouvement</div>
  <img src="lemouvement.jpg" alt="">
  <div class="doc-source">Source : √âditions FOUCHER</div>
</div>

<div class="question">
  <div class="q-head">3. √Ä l‚Äôaide du document 1</div>
  3.1 <strong>Rep√©rer</strong> l‚Äôorgane qui commande le mouvement <span class="q-comp">(C2)</span>  
  <textarea></textarea>

  3.2 <strong>D√©crire</strong> le trajet du message nerveux du cerveau jusqu‚Äôau muscle <span class="q-comp">(C2)</span>  
  <textarea></textarea>
</div>

<div class="doc">
  <div class="doc-title">Document 2 : L‚Äôanatomie du muscle et la contraction musculaire</div>
  <img src="muscle s.jpg" alt="">
  <div class="doc-source">Source : √âditions FOUCHER</div>
</div>

<div class="question">
  <div class="q-head">4. √Ä l‚Äôaide du document 2, <strong>expliquer</strong> comment le muscle se contracte
    <span class="q-comp">(C3)</span>
  </div>
  <textarea></textarea>
</div>

<div class="doc">
  <div class="doc-title">Document 3 : Les √©changes entre le sang et les muscles</div>
  <img src="Le mecanisme_du travail_musculaire.jpg" alt="">
  <div class="doc-source">Source : √âditions FOUCHER</div>
</div>

<div class="question">
  <div class="q-head">5. √Ä l‚Äôaide du document 3</div>

  5.1 <strong>Citer</strong> les deux √©l√©ments n√©cessaires au fonctionnement du muscle <span class="q-comp">(C2)</span>  
  <textarea></textarea>

  5.2 <strong>Expliquer</strong> pourquoi le muscle consomme du dioxyg√®ne lors de l‚Äôactivit√© <span class="q-comp">(C3)</span>  
  <textarea></textarea>

  5.3 <strong>Identifier</strong> le d√©chet rejet√© par le muscle <span class="q-comp">(C2)</span>  
  <textarea></textarea>
</div>

<div class="doc">
  <div class="doc-title">Document 4 : Activit√© physique et sant√©</div>
  <img src="Lactivitephysiquerecommandeeparjour.jpg" alt="">
</div>

<div class="question">
  <div class="q-head">6. √Ä l‚Äôaide du document 4</div>

  6.1 <strong>Indiquer</strong> la recommandation de l‚ÄôOMS pour un adolescent <span class="q-comp">(C2)</span>  
  <textarea></textarea>

  6.2 <strong>Justifier</strong> en quoi l‚Äôactivit√© physique est une mesure de pr√©vention pour la sant√© <span class="q-comp">(C5)</span>  
  <textarea></textarea>
</div>

<div class="question">
  <div class="q-head">7. <strong>Proposer</strong> deux activit√©s physiques simples permettant de respecter cette recommandation
    <span class="q-comp">(C4)</span>
  </div>
  <textarea></textarea>
</div>

</div>

<div class="actions">
  <button class="btn" onclick="window.print()">Imprimer PDF</button>
  <button class="btn" id="downloadJsonBtn">Enregistrer JSON</button>
  <button class="btn" id="sendBtn">Envoyer</button>
</div>

<script type="module">
  // 1. CONFIGURATION FIREBASE
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAWdCMvOiAJJn3eT9LIAQD3RWJUD0lQcLI",
    authDomain: "devoirs-pse.firebaseapp.com",
    projectId: "devoirs-pse",
    storageBucket: "devoirs-pse.firebasestorage.app",
    messagingSenderId: "614730413904",
    appId: "1:614730413904:web:a5dd478af5de30f6bede55",
    measurementId: "G-7R9N0JL6GG"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  /* PSEUDO AUTO (RGPD) */
  const PSEUDOS = [
      "Panda üêº","Etoile ‚≠ê","Fusee üöÄ","Diamant üíé","Tigre üêØ","Dragon üêâ",
      "Licorne ü¶Ñ","Phoenix üî•","Ninja ü•∑","Robot ü§ñ","Koala üê®","Dauphin üê¨",
      "Aigle ü¶Ö","Papillon ü¶ã","Lion ü¶Å","Comete ‚òÑÔ∏è","Eclair ‚ö°","Flocon ‚ùÑÔ∏è",
      "Soleil ‚òÄÔ∏è","Lune üåô","Galaxie üåå","Hibou ü¶â","Renard ü¶ä","Tornade üå™Ô∏è",
      "Volcan üåã","Cristal üí†","Trefle üçÄ","Cerise üçí","Arc-en-ciel üåà","Pingouin üêß"
  ];
  const myPseudo = PSEUDOS[Math.floor(Math.random() * PSEUDOS.length)];
  document.getElementById('display-pseudo').textContent = myPseudo;

  // 2. FONCTIONS
  function getDataPayload(){
    const nom = myPseudo;
    const prenom = myPseudo;
    const classe = document.getElementById("classe").value.trim();

    const reponsesObj = {};
    Array.from(document.querySelectorAll('textarea')).forEach((t, i) => {
      reponsesObj[String(i + 1)] = (t.value || "").trim();
    });

    const nowISO = new Date().toISOString();

    return {
      type: "copie_eleve_pse",
      nom: nom,
      prenom: prenom,
      classe: classe,
      reponses: reponsesObj,
      dateEnvoi: nowISO,
      meta: {
        createdAt: nowISO,
        competences: ["C2","C3","C4","C5"],
        score: null,
        maxScore: null,
        bareme: "",
        details: { sourceType: "evaluation_A3_version_prof" }
      }
    };
  }

  function validerIdentite(data){
    if(!data.classe){
      alert("Indique ta classe avant d'envoyer.");
      return false;
    }
    return true;
  }

  async function envoyerCopie(){
    const data = getDataPayload();
    if(!validerIdentite(data)) return;

    const btn = document.getElementById("sendBtn");
    const texteOriginal = btn.textContent;
    btn.textContent = "Envoi...";
    btn.disabled = true;

    try {
      await addDoc(collection(db, "bacpro"), data);
      alert("Confirmation : Votre devoir a bien √©t√© envoy√©.");
      btn.textContent = "Envoy√©";
    } catch (e) {
      console.error(e);
      alert("Erreur lors de l'envoi. V√©rifiez votre connexion.");
      btn.textContent = texteOriginal;
      btn.disabled = false;
    }
  }

  function telechargerJSON(){
    const data = getDataPayload();
    if(!validerIdentite(data)) return;

    const structureGrille = data;

    const blob = new Blob([JSON.stringify(structureGrille, null, 2)], {type: "application/json"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    const safeName = (str) => str.replace(/[^a-z0-9]/gi, '_').toLowerCase();
    a.download = `eval_A3_${safeName(data.classe)}_${safeName(myPseudo)}.json`;
    a.click();
    URL.revokeObjectURL(a.href);
  }

  document.getElementById("sendBtn").addEventListener("click", envoyerCopie);
  document.getElementById("downloadJsonBtn").addEventListener("click", telechargerJSON);

</script>

</body>
</html>
