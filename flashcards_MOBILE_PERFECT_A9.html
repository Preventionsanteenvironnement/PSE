<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R√©vision A.9 - S√©curit√© Alimentaire - Bac Pro Terminale</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
            transition: all 0.3s ease;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }
        
        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .btn-back {
            background: rgba(255,255,255,0.1);
            color: var(--text-primary);
            padding: 10px 20px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            border: 2px solid var(--border-color);
            cursor: pointer;
        }
        
        .btn-back:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        .theme-toggle {
            background: rgba(255,255,255,0.1);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
            padding: 10px;
            border-radius: 50px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-toggle:hover {
            background: rgba(255,255,255,0.2);
            transform: scale(1.1);
        }

        body.light-mode .theme-toggle {
            background: rgba(26, 26, 46, 0.1);
        }

        body.light-mode .theme-toggle:hover {
            background: rgba(26, 26, 46, 0.2);
        }
        
        .score-bar {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 50px;
        }
        
        .score-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .score-item .icon {
            font-size: 18px;
        }
        
        /* √âcrans */
        .screen {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .screen.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* √âcran d'accueil */
        .welcome-screen {
            text-align: center;
            padding: 30px 0;
        }
        
        .welcome-title {
            font-size: 42px;
            font-weight: 900;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .welcome-subtitle {
            font-size: 18px;
            color: rgba(255,255,255,0.7);
            margin-bottom: 30px;
        }
        
        /* Objectifs */
        .objectifs-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3));
            border: 2px solid rgba(102, 126, 234, 0.5);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            text-align: left;
        }
        
        .objectifs-card h3 {
            font-size: 18px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .objectif-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            font-size: 14px;
            line-height: 1.5;
        }
        
        .objectif-item:last-child {
            border-bottom: none;
        }
        
        .objectif-item .check {
            color: #4CAF50;
            font-size: 18px;
            flex-shrink: 0;
        }
        
        .competences-row {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .comp-badge {
            background: rgba(255,255,255,0.15);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
        }
        
        .comp-badge.c1 { background: rgba(16, 185, 129, 0.3); border: 1px solid #10b981; }
        .comp-badge.c2 { background: rgba(102, 126, 234, 0.3); border: 1px solid #667eea; }
        .comp-badge.c3 { background: rgba(245, 158, 11, 0.3); border: 1px solid #f59e0b; }
        .comp-badge.c4 { background: rgba(239, 68, 68, 0.3); border: 1px solid #ef4444; }
        .comp-badge.c5 { background: rgba(168, 85, 247, 0.3); border: 1px solid #a855f7; }
        .comp-badge.c6 { background: rgba(34, 197, 94, 0.3); border: 1px solid #22c55e; }
        
        /* Niveaux */
        .niveaux-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 25px;
        }
        
        .niveau-card {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .niveau-card:hover:not(.locked) {
            background: rgba(255,255,255,0.1);
            transform: translateX(5px);
            border-color: rgba(102, 126, 234, 0.5);
        }
        
        .niveau-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .niveau-card.completed {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }
        
        .niveau-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            flex-shrink: 0;
        }
        
        .niveau-card:nth-child(1) .niveau-icon { background: linear-gradient(135deg, #667eea, #764ba2); }
        .niveau-card:nth-child(2) .niveau-icon { background: linear-gradient(135deg, #f093fb, #f5576c); }
        .niveau-card:nth-child(3) .niveau-icon { background: linear-gradient(135deg, #4facfe, #00f2fe); }
        .niveau-card:nth-child(4) .niveau-icon { background: linear-gradient(135deg, #43e97b, #38f9d7); }
        .niveau-card:nth-child(5) .niveau-icon { background: linear-gradient(135deg, #fa709a, #fee140); }
        
        .niveau-info {
            flex: 1;
        }
        
        .niveau-info h4 {
            font-size: 16px;
            margin-bottom: 4px;
        }
        
        .niveau-info p {
            font-size: 12px;
            color: rgba(255,255,255,0.6);
        }
        
        .niveau-progress {
            width: 80px;
            text-align: right;
        }
        
        .niveau-progress .percent {
            font-size: 18px;
            font-weight: 700;
        }
        
        .progress-mini {
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .progress-mini-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        
        .lock-icon {
            font-size: 24px;
            color: rgba(255,255,255,0.3);
        }
        
        /* √âcran de jeu */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .game-title {
            font-size: 20px;
            font-weight: 700;
        }
        
        .game-progress {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-counter {
            font-size: 14px;
            color: rgba(255,255,255,0.7);
        }
        
        .progress-bar {
            width: 150px;
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }
        
        /* Carte */
        .flashcard {
            background: var(--bg-card);
            border-radius: 25px;
            padding: 35px;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            border: 2px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        body.light-mode .flashcard {
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
        }
        
        .card-type {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.1);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .card-competence {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
        }
        
        .question-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            text-align: center;
            padding: 20px 0;
        }
        
        .question-text {
            font-size: 22px;
            font-weight: 600;
            line-height: 1.5;
            margin-bottom: 25px;
        }
        
        .question-text .highlight {
            color: #f093fb;
            font-weight: 700;
        }
        
        /* Input mot-cl√© */
        .keyword-input-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        .keyword-input {
            background: rgba(255,255,255,0.1);
            border: 3px solid rgba(255,255,255,0.2);
            border-radius: 15px;
            padding: 18px 25px;
            font-size: 24px;
            font-weight: 700;
            color: white;
            text-align: center;
            width: 100%;
            max-width: 350px;
            font-family: inherit;
            transition: all 0.3s ease;
            text-transform: lowercase;
        }
        
        .keyword-input:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }
        
        .keyword-input::placeholder {
            color: rgba(255,255,255,0.3);
            font-weight: 400;
        }
        
        .hint-text {
            font-size: 14px;
            color: rgba(255,255,255,0.5);
        }
        
        .hint-text strong {
            color: #f093fb;
        }
        
        /* Options QCM */
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
        }
        
        .option-btn {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.15);
            border-radius: 12px;
            padding: 16px 20px;
            color: white;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .option-btn:hover {
            background: rgba(102, 126, 234, 0.2);
            border-color: rgba(102, 126, 234, 0.5);
            transform: translateX(5px);
        }
        
        .option-btn.selected {
            background: rgba(102, 126, 234, 0.3);
            border-color: #667eea;
        }
        
        .option-btn.correct {
            background: rgba(76, 175, 80, 0.3);
            border-color: #4CAF50;
        }
        
        .option-btn.incorrect {
            background: rgba(244, 67, 54, 0.3);
            border-color: #f44336;
        }
        
        .option-letter {
            width: 30px;
            height: 30px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            flex-shrink: 0;
        }
        
        /* Vrai/Faux */
        .vf-container {
            display: flex;
            gap: 20px;
            justify-content: center;
        }
        
        .vf-btn {
            width: 140px;
            height: 80px;
            border-radius: 15px;
            border: 3px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.05);
            color: white;
            font-size: 20px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .vf-btn:hover {
            transform: scale(1.05);
        }
        
        .vf-btn.vrai:hover { background: rgba(76, 175, 80, 0.3); border-color: #4CAF50; }
        .vf-btn.faux:hover { background: rgba(244, 67, 54, 0.3); border-color: #f44336; }
        
        .vf-btn.selected.vrai { background: rgba(76, 175, 80, 0.3); border-color: #4CAF50; }
        .vf-btn.selected.faux { background: rgba(244, 67, 54, 0.3); border-color: #f44336; }
        
        /* Boutons action */
        .action-row {
            display: flex;
            gap: 12px;
            margin-top: 25px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 14px 30px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 2px solid rgba(255,255,255,0.2);
        }
        
        .btn-secondary:hover {
            background: rgba(255,255,255,0.15);
        }
        
        .btn-hint {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
            border: 2px solid rgba(245, 158, 11, 0.3);
        }
        
        .btn-hint:hover {
            background: rgba(245, 158, 11, 0.3);
        }
        
        /* Feedback */
        .feedback-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .feedback-overlay.visible {
            display: flex;
            animation: fadeIn 0.3s ease;
        }
        
        .feedback-card {
            background: linear-gradient(145deg, #1e1e2f, #2a2a40);
            border-radius: 25px;
            padding: 35px;
            max-width: 500px;
            width: 100%;
            text-align: center;
            border: 3px solid;
            color: white;
        }
        
        .feedback-card.correct {
            border-color: #4CAF50;
        }
        
        .feedback-card.incorrect {
            border-color: #f44336;
        }
        
        .feedback-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }
        
        .feedback-title {
            font-size: 28px;
            font-weight: 900;
            margin-bottom: 10px;
        }
        
        .feedback-card.correct .feedback-title { color: #4CAF50; }
        .feedback-card.incorrect .feedback-title { color: #f44336; }
        
        .feedback-points {
            font-size: 18px;
            color: #f59e0b;
            margin-bottom: 20px;
        }
        
        .feedback-explanation {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            text-align: left;
            margin-bottom: 20px;
        }
        
        .feedback-explanation h4 {
            font-size: 14px;
            color: #667eea;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .feedback-explanation p {
            font-size: 14px;
            line-height: 1.6;
            color: rgba(255,255,255,0.8);
        }
        
        .keyword-box {
            background: rgba(102, 126, 234, 0.2);
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 10px 15px;
            margin-top: 12px;
            display: inline-block;
        }
        
        .keyword-box span {
            font-weight: 700;
            color: #f093fb;
        }
        
        .tip-box {
            background: rgba(245, 158, 11, 0.1);
            border-left: 4px solid #f59e0b;
            border-radius: 8px;
            padding: 12px 15px;
            margin-top: 15px;
            text-align: left;
        }
        
        .tip-box h5 {
            font-size: 12px;
            color: #f59e0b;
            margin-bottom: 5px;
        }
        
        .tip-box p {
            font-size: 13px;
            color: rgba(255,255,255,0.7);
        }
        
        /* Streak */
        .streak-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #f093fb, #f5576c);
            padding: 20px 40px;
            border-radius: 20px;
            font-size: 24px;
            font-weight: 900;
            z-index: 1001;
            display: none;
            animation: streakPop 0.5s ease;
        }
        
        @keyframes streakPop {
            0% { transform: translate(-50%, -50%) scale(0); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }
        
        /* √âcran r√©sultats */
        .results-screen {
            text-align: center;
            padding: 30px 0;
        }
        
        .results-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }
        
        .results-title {
            font-size: 36px;
            font-weight: 900;
            margin-bottom: 10px;
        }
        
        .results-score {
            font-size: 60px;
            font-weight: 900;
            background: linear-gradient(135deg, #667eea, #764ba2, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 20px 0;
        }
        
        .results-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .stat-item {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px 30px;
            min-width: 120px;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 900;
            color: #667eea;
        }
        
        .stat-label {
            font-size: 12px;
            color: rgba(255,255,255,0.6);
            margin-top: 5px;
        }
        
        .errors-recap {
            background: rgba(244, 67, 54, 0.1);
            border: 2px solid rgba(244, 67, 54, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 25px 0;
            text-align: left;
        }
        
        .errors-recap h4 {
            color: #f44336;
            margin-bottom: 12px;
            font-size: 16px;
        }
        
        .errors-recap ul {
            margin-left: 20px;
            font-size: 14px;
            color: rgba(255,255,255,0.7);
        }
        
        .errors-recap li {
            margin: 8px 0;
        }
        
        /* Confettis */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            top: -10px;
            z-index: 1002;
            animation: confettiFall 3s ease-out forwards;
        }
        
        @keyframes confettiFall {
            to {
                top: 100vh;
                transform: rotate(720deg);
            }
        }
        
        /* Responsive */
        @media (max-width: 600px) {
            .welcome-title { font-size: 32px; }
            .question-text { font-size: 18px; }
            .flashcard { padding: 25px; min-height: 350px; }
            .keyword-input { font-size: 20px; padding: 15px 20px; }
            .vf-container { gap: 12px; }
            .vf-btn { width: 120px; height: 70px; font-size: 16px; }
            .results-score { font-size: 48px; }
        }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div class="container">
        
        <!-- Header -->
        <div class="header">
            <button class="btn-back" onclick="goHome()">‚¨ÖÔ∏è Retour</button>
            <div class="score-bar" id="scoreBar">
                <div class="score-item">
                    <span class="icon">‚≠ê</span>
                    <span id="totalPoints">0</span> pts
                </div>
                <div class="score-item">
                    <span class="icon">üî•</span>
                    <span id="currentStreak">0</span>
                </div>
            </div>
        </div>
        
        <!-- √âCRAN ACCUEIL -->
        <div class="screen active" id="homeScreen">
            <div class="welcome-screen">
                <h1 class="welcome-title">üçΩÔ∏è R√âVISION A.9</h1>
                <p class="welcome-subtitle">La s√©curit√© alimentaire - Mode Expert</p>
                
                <div class="objectifs-card">
                    <h3>üéØ Module A.9 - Objectif :</h3>
                    <div class="objectif-item">
                        <span class="check">‚úì</span>
                        <span><strong>Appr√©hender</strong> les risques li√©s aux aliments pour agir en consommateur responsable</span>
                    </div>
                    <div class="objectif-item">
                        <span class="check">‚úì</span>
                        <span><strong>Ma√Ætriser</strong> les sigles, normes, r√©glementation, microorganismes pathog√®nes</span>
                    </div>
                    <div class="objectif-item">
                        <span class="check">‚úì</span>
                        <span><strong>Analyser</strong> des situations √† risque et proposer des mesures pr√©ventives</span>
                    </div>
                    <div class="objectif-item">
                        <span class="check">‚úì</span>
                        <span><strong>Se pr√©parer</strong> efficacement √† l'√©preuve PSE Bac Pro Terminale</span>
                    </div>
                    
                    <div class="competences-row">
                        <span class="comp-badge c1">C1 - Traiter</span>
                        <span class="comp-badge c2">C2 - Appliquer</span>
                        <span class="comp-badge c3">C3 - Expliquer</span>
                        <span class="comp-badge c4">C4 - Proposer</span>
                        <span class="comp-badge c5">C5 - Argumenter</span>
                        <span class="comp-badge c6">C6 - Communiquer</span>
                    </div>
                </div>
                
                <div class="niveaux-grid">
                    <div class="niveau-card" onclick="startLevel(1)">
                        <div class="niveau-icon">üî§</div>
                        <div class="niveau-info">
                            <h4>Niveau 1 : Sigles & Bases</h4>
                            <p>DLC, DDM, DGAL, HACCP, UFC, LMR, AOP...</p>
                        </div>
                        <div class="niveau-progress">
                            <span class="percent" id="level1Percent">0%</span>
                            <div class="progress-mini">
                                <div class="progress-mini-fill" id="level1Bar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="niveau-card" id="level2Card" onclick="startLevel(2)">
                        <div class="niveau-icon">ü¶†</div>
                        <div class="niveau-info">
                            <h4>Niveau 2 : Microorganismes</h4>
                            <p>Listeria, Salmonelles, E.coli, Staphylocoque...</p>
                        </div>
                        <div class="niveau-progress">
                            <span class="percent" id="level2Percent">0%</span>
                            <div class="progress-mini">
                                <div class="progress-mini-fill" id="level2Bar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="niveau-card" id="level3Card" onclick="startLevel(3)">
                        <div class="niveau-icon">üå°Ô∏è</div>
                        <div class="niveau-info">
                            <h4>Niveau 3 : Normes & Temp√©ratures</h4>
                            <p>Conservation, cuisson, crit√®res microbiologiques</p>
                        </div>
                        <div class="niveau-progress">
                            <span class="percent" id="level3Percent">0%</span>
                            <div class="progress-mini">
                                <div class="progress-mini-fill" id="level3Bar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="niveau-card" id="level4Card" onclick="startLevel(4)">
                        <div class="niveau-icon">‚öñÔ∏è</div>
                        <div class="niveau-info">
                            <h4>Niveau 4 : R√©glementation</h4>
                            <p>Paquet Hygi√®ne, allerg√®nes, contr√¥les, sanctions</p>
                        </div>
                        <div class="niveau-progress">
                            <span class="percent" id="level4Percent">0%</span>
                            <div class="progress-mini">
                                <div class="progress-mini-fill" id="level4Bar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="niveau-card" id="level5Card" onclick="startLevel(5)">
                        <div class="niveau-icon">üèÜ</div>
                        <div class="niveau-info">
                            <h4>Niveau 5 : Quiz Final Expert</h4>
                            <p>Tout m√©lang√© - Pr√©paration Bac Pro !</p>
                        </div>
                        <div class="niveau-progress">
                            <span class="percent" id="level5Percent">0%</span>
                            <div class="progress-mini">
                                <div class="progress-mini-fill" id="level5Bar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- √âCRAN JEU -->
        <div class="screen" id="gameScreen">
            <div class="game-header">
                <h3 class="game-title" id="levelTitle">Niveau 1</h3>
                <div class="game-progress">
                    <span class="card-counter"><span id="currentCard">1</span>/<span id="totalCards">10</span></span>
                    <div class="progress-bar">
                        <div class="progress-fill" id="gameProgress" style="width: 0%"></div>
                    </div>
                </div>
            </div>
            
            <div class="flashcard" id="flashcard">
                <div class="card-competence comp-badge c1" id="cardCompetence">C1</div>
                <div class="card-type" id="cardType">MOT-CL√â</div>
                
                <div class="question-section" id="questionSection">
                    <!-- Contenu dynamique -->
                </div>
                
                <div class="action-row" id="actionRow">
                    <button class="btn btn-hint" onclick="showHint()">üí° Indice</button>
                    <button class="btn btn-primary" id="validateBtn" onclick="validateAnswer()">Valider ‚úì</button>
                </div>
            </div>
        </div>
        
        <!-- √âCRAN R√âSULTATS -->
        <div class="screen" id="resultsScreen">
            <div class="results-screen">
                <div class="results-icon" id="resultsIcon">üéâ</div>
                <h2 class="results-title" id="resultsTitle">Niveau termin√© !</h2>
                <div class="results-score" id="resultsScore">85%</div>
                
                <div class="results-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="correctCount">8</div>
                        <div class="stat-label">Bonnes r√©ponses</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="pointsEarned">+120</div>
                        <div class="stat-label">Points gagn√©s</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="bestStreak">5</div>
                        <div class="stat-label">Meilleur streak</div>
                    </div>
                </div>
                
                <div class="errors-recap" id="errorsRecap">
                    <h4>üìù Notions √† revoir :</h4>
                    <ul id="errorsList"></ul>
                </div>
                
                <div class="action-row">
                    <button class="btn btn-secondary" onclick="goHome()">üè† Accueil</button>
                    <button class="btn btn-primary" id="nextLevelBtn" onclick="nextLevel()">Niveau suivant ‚Üí</button>
                </div>
            </div>
        </div>
        
        <!-- FEEDBACK OVERLAY -->
        <div class="feedback-overlay" id="feedbackOverlay">
            <div class="feedback-card" id="feedbackCard">
                <div class="feedback-icon" id="feedbackIcon">‚úÖ</div>
                <h3 class="feedback-title" id="feedbackTitle">Bravo !</h3>
                <div class="feedback-points" id="feedbackPoints">+10 points</div>
                
                <div class="feedback-explanation" id="feedbackExplanation">
                    <!-- Contenu dynamique -->
                </div>
                
                <button class="btn btn-primary" onclick="nextCard()">Suivant ‚Üí</button>
            </div>
        </div>
        
        <!-- STREAK POPUP -->
        <div class="streak-popup" id="streakPopup"></div>
        
    </div>

    <script>
        // === DONN√âES ===
        let totalPoints = 0;
        let currentStreak = 0;
        let bestStreak = 0;
        let currentLevel = 1;
        let currentCardIndex = 0;
        let levelCorrect = 0;
        let levelPoints = 0;
        let levelErrors = [];
        let levelProgress = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 };
        let hintUsed = false;
        
        // Questions par niveau - Module A.9 S√©curit√© Alimentaire
        const levels = {
            1: { // Sigles & Bases
                title: "Niveau 1 : Sigles & Bases",
                competence: "C1",
                cards: [
                    {
                        type: "keyword",
                        question: "Que signifie <span class='highlight'>DLC</span> ?",
                        answer: "date limite de consommation",
                        hint: "Date Limite de C _ _ _ _ _ _ _ _ _ _ _ (12 lettres)",
                        explanation: "DLC = Date Limite de Consommation. Cette date NE DOIT PAS √™tre d√©pass√©e car risque sanitaire grave.",
                        keyword: "DLC = Date Limite Consommation",
                        tip: "√Ä ne pas confondre avec DDM ! DLC = risque sanitaire."
                    },
                    {
                        type: "keyword",
                        question: "Que signifie <span class='highlight'>DDM</span> ?",
                        answer: "date de durabilit√© minimale",
                        hint: "Date de D _ _ _ _ _ _ _ _ _ Minimale (11 lettres)",
                        explanation: "DDM = Date de Durabilit√© Minimale. Remplace l'ancienne DLUO. Perte de qualit√© possible mais pas de danger.",
                        keyword: "DDM = ex-DLUO",
                        tip: "DDM = qualit√©, DLC = s√©curit√© sanitaire."
                    },
                    {
                        type: "keyword",
                        question: "Que signifie <span class='highlight'>DGAL</span> ?",
                        answer: "direction g√©n√©rale de l'alimentation",
                        hint: "Direction G _ _ _ _ _ _ _ _ de l'A _ _ _ _ _ _ _ _ _ _ _",
                        explanation: "DGAL = Direction G√©n√©rale de l'Alimentation. Service du minist√®re de l'Agriculture charg√© des contr√¥les sanitaires.",
                        keyword: "DGAL = contr√¥les agricoles",
                        tip: "DGAL d√©pend du minist√®re de l'Agriculture."
                    },
                    {
                        type: "keyword",
                        question: "Que signifie <span class='highlight'>HACCP</span> ?",
                        answer: "hazard analysis critical control points",
                        hint: "Hazard Analysis Critical Control P _ _ _ _ _",
                        explanation: "HACCP = Hazard Analysis Critical Control Points. Syst√®me d'analyse des dangers et ma√Ætrise des points critiques.",
                        keyword: "HACCP = syst√®me pr√©ventif",
                        tip: "HACCP est obligatoire dans toute l'industrie alimentaire."
                    },
                    {
                        type: "keyword",
                        question: "Que signifie <span class='highlight'>UFC</span> dans les analyses micro ?",
                        answer: "unit√© formant colonie",
                        hint: "Unit√© F _ _ _ _ _ _ Colonie",
                        explanation: "UFC = Unit√© Formant Colonie. Unit√© de mesure des micro-organismes dans un √©chantillon alimentaire.",
                        keyword: "UFC = comptage bact√©ries",
                        tip: "Exemple : Listeria < 100 UFC/g dans les aliments."
                    },
                    {
                        type: "qcm",
                        question: "Que signifie <span class='highlight'>LMR</span> ?",
                        options: [
                            "Limite Maximale de R√©sidus",
                            "Laboratoire de Mesure R√©glementaire", 
                            "Liste des Mati√®res R√©glement√©es",
                            "Limite Minimale Recommand√©e"
                        ],
                        answer: 0,
                        explanation: "LMR = Limite Maximale de R√©sidus de pesticides autoris√©e dans les aliments. Fix√©e par l'UE.",
                        keyword: "LMR = pesticides maximum",
                        tip: "Les LMR prot√®gent le consommateur des r√©sidus de pesticides."
                    },
                    {
                        type: "keyword",
                        question: "Que signifie <span class='highlight'>AOP</span> ?",
                        answer: "appellation d'origine prot√©g√©e",
                        hint: "Appellation d'O _ _ _ _ _ _ Prot√©g√©e",
                        explanation: "AOP = Appellation d'Origine Prot√©g√©e. Label europ√©en qui garantit l'origine g√©ographique d'un produit.",
                        keyword: "AOP = origine garantie",
                        tip: "Exemples : Roquefort AOP, Champagne AOP."
                    },
                    {
                        type: "vf",
                        question: "La <span class='highlight'>tra√ßabilit√©</span> permet de suivre un aliment de la production √† la consommation.",
                        answer: true,
                        explanation: "VRAI ! La tra√ßabilit√© = capacit√© de retracer l'historique d'un produit (du champ √† l'assiette).",
                        keyword: "Tra√ßabilit√© = du champ √† l'assiette",
                        tip: "Tra√ßabilit√© obligatoire dans l'UE depuis 2005."
                    },
                    {
                        type: "qcm",
                        question: "Que signifie <span class='highlight'>TIAC</span> ?",
                        options: [
                            "Toxine Infectieuse Alimentaire Critique",
                            "Toxi-Infection Alimentaire Collective",
                            "Test d'Identification des Agents Contaminants", 
                            "Traitement Imm√©diat Anti-Contamination"
                        ],
                        answer: 1,
                        explanation: "TIAC = Toxi-Infection Alimentaire Collective. Au moins 2 personnes malades apr√®s consommation du m√™me aliment.",
                        keyword: "TIAC = intoxication collective",
                        tip: "TIAC = d√©claration obligatoire aux autorit√©s sanitaires."
                    },
                    {
                        type: "keyword",
                        question: "Comment appelle-t-on l'ensemble des micro-organismes naturellement pr√©sents dans un aliment ?",
                        answer: "flore microbienne",
                        hint: "Flore m _ _ _ _ _ _ _ _ _ _",
                        explanation: "La FLORE MICROBIENNE = ensemble des micro-organismes (bact√©ries, levures, moisissures) d'un aliment.",
                        keyword: "Flore = micro-organismes naturels",
                        tip: "La flore peut √™tre b√©n√©fique (fermentation) ou nuisible (alt√©ration)."
                    }
                ]
            },
            2: { // Microorganismes
                title: "Niveau 2 : Microorganismes",
                competence: "C2",
                cards: [
                    {
                        type: "keyword",
                        question: "Quel microorganisme est responsable de la <span class='highlight'>list√©riose</span> ?",
                        answer: "listeria monocytogenes",
                        hint: "L _ _ _ _ _ _ _ Monocytogenes",
                        explanation: "Listeria Monocytogenes provoque la list√©riose. Tr√®s dangereuse pour femmes enceintes et personnes √¢g√©es.",
                        keyword: "Listeria = list√©riose",
                        tip: "Listeria peut se multiplier au froid (4¬∞C) contrairement aux autres."
                    },
                    {
                        type: "qcm",
                        question: "Dans quels aliments trouve-t-on principalement <span class='highlight'>Listeria</span> ?",
                        options: [
                            "Fruits et l√©gumes frais",
                            "Charcuteries et fromages au lait cru",
                            "C√©r√©ales et l√©gumineuses",
                            "Viandes bien cuites"
                        ],
                        answer: 1,
                        explanation: "Listeria se d√©veloppe surtout dans charcuteries, fromages au lait cru, poissons fum√©s, produits r√©frig√©r√©s.",
                        keyword: "Listeria = charcuterie + fromage",
                        tip: "Listeria r√©siste au froid et au sel, d'o√π sa pr√©sence dans ces produits."
                    },
                    {
                        type: "keyword",
                        question: "Quel microorganisme provoque la <span class='highlight'>salmonellose</span> ?",
                        answer: "salmonella",
                        hint: "S _ _ _ _ _ _ _ _ _ (9 lettres)",
                        explanation: "Salmonella (notamment Enteritidis et Typhimurium) provoque la salmonellose, principal agent des TIAC.",
                        keyword: "Salmonella = salmonellose",
                        tip: "Salmonella tr√®s r√©pandue, surtout dans ≈ìufs et volailles."
                    },
                    {
                        type: "qcm",
                        question: "Quelle est la principale source de contamination par <span class='highlight'>Salmonella</span> ?",
                        options: [
                            "L√©gumes verts",
                            "Produits laitiers",
                            "≈íufs et volailles",
                            "Poissons de mer"
                        ],
                        answer: 2,
                        explanation: "≈íufs et volailles = principale source Salmonella. La bact√©rie colonise le tube digestif des poules.",
                        keyword: "Salmonella = ≈ìufs + volaille",
                        tip: "Cuisson √† 75¬∞C d√©truit Salmonella."
                    },
                    {
                        type: "keyword",
                        question: "Comment s'appelle la bact√©rie <span class='highlight'>E. coli</span> pathog√®ne ?",
                        answer: "escherichia coli",
                        hint: "E _ _ _ _ _ _ _ _ _ _ _ Coli",
                        explanation: "Escherichia Coli. La souche O157:H7 est particuli√®rement dangereuse (syndrome h√©molytique et ur√©mique).",
                        keyword: "E. coli = Escherichia Coli",
                        tip: "E. coli O157:H7 peut √™tre mortelle, surtout chez les enfants."
                    },
                    {
                        type: "qcm",
                        question: "Dans quels produits trouve-t-on <span class='highlight'>E. coli</span> pathog√®ne ?",
                        options: [
                            "Viande hach√©e mal cuite",
                            "Poissons fum√©s", 
                            "Fromages affin√©s",
                            "Fruits secs"
                        ],
                        answer: 0,
                        explanation: "E. coli O157:H7 dans viande hach√©e mal cuite, lait cru, l√©gumes contamin√©s par fumier.",
                        keyword: "E. coli = viande hach√©e",
                        tip: "Cuisson √† c≈ìur obligatoire pour la viande hach√©e (75¬∞C)."
                    },
                    {
                        type: "keyword",
                        question: "Quel microorganisme produit des <span class='highlight'>ent√©rotoxines</span> thermor√©sistantes ?",
                        answer: "staphylococcus aureus",
                        hint: "S _ _ _ _ _ _ _ _ _ _ _ _ _ Aureus",
                        explanation: "Staphylococcus Aureus produit des ent√©rotoxines r√©sistantes √† la cuisson. Contamination par manipulation.",
                        keyword: "Staphylocoque = toxines r√©sistantes",
                        tip: "La cuisson ne d√©truit pas les toxines, seulement les bact√©ries."
                    },
                    {
                        type: "vf",
                        question: "Les toxines de <span class='highlight'>Staphylococcus Aureus</span> r√©sistent √† la cuisson.",
                        answer: true,
                        explanation: "VRAI ! Les ent√©rotoxines staphylococciques sont thermor√©sistantes (r√©sistent √† 100¬∞C/30min).",
                        keyword: "Toxines staphylo = thermor√©sistantes",
                        tip: "C'est pourquoi il faut √©viter la contamination, pas seulement cuire."
                    },
                    {
                        type: "keyword",
                        question: "Quel microorganisme provoque le <span class='highlight'>botulisme</span> ?",
                        answer: "clostridium botulinum",
                        hint: "C _ _ _ _ _ _ _ _ _ _ Botulinum",
                        explanation: "Clostridium Botulinum produit la toxine botulique, la plus puissante connue. Conserves mal st√©rilis√©es.",
                        keyword: "Clostridium = botulisme",
                        tip: "Botulisme rare mais mortel. Conserves bomb√©es = danger !"
                    },
                    {
                        type: "qcm",
                        question: "Les <span class='highlight'>moisissures</span> peuvent produire :",
                        options: [
                            "Des vitamines b√©n√©fiques",
                            "Des mycotoxines toxiques",
                            "Des probiotiques",
                            "Des antioxydants"
                        ],
                        answer: 1,
                        explanation: "Certaines moisissures produisent des MYCOTOXINES (aflatoxines, ochratoxines) tr√®s toxiques et canc√©rig√®nes.",
                        keyword: "Moisissures = mycotoxines",
                        tip: "Aflatoxines = parmi les substances les plus canc√©rig√®nes."
                    }
                ]
            },
            3: { // Normes & Temp√©ratures  
                title: "Niveau 3 : Normes & Temp√©ratures",
                competence: "C3",
                cards: [
                    {
                        type: "qcm",
                        question: "Temp√©rature r√©glementaire de conservation des <span class='highlight'>produits frais</span> ?",
                        options: [
                            "0¬∞C √† 2¬∞C",
                            "0¬∞C √† 4¬∞C", 
                            "2¬∞C √† 6¬∞C",
                            "4¬∞C √† 8¬∞C"
                        ],
                        answer: 1,
                        explanation: "Produits frais : conservation entre 0¬∞C et +4¬∞C pour limiter la multiplication microbienne.",
                        keyword: "Frais = 0¬∞C √† +4¬∞C",
                        tip: "Au-dessus de 4¬∞C, multiplication rapide des pathog√®nes."
                    },
                    {
                        type: "qcm",
                        question: "Temp√©rature de cuisson √† c≈ìur pour d√©truire les <span class='highlight'>pathog√®nes</span> ?",
                        options: [
                            "65¬∞C",
                            "70¬∞C",
                            "75¬∞C", 
                            "80¬∞C"
                        ],
                        answer: 2,
                        explanation: "75¬∞C √† c≈ìur pendant au moins 1 minute garantit la destruction des principaux pathog√®nes.",
                        keyword: "Cuisson = 75¬∞C √† c≈ìur",
                        tip: "75¬∞C = temp√©rature de s√©curit√© sanitaire."
                    },
                    {
                        type: "keyword",
                        question: "Temp√©rature de conservation des <span class='highlight'>produits congel√©s</span> ?",
                        answer: "-18¬∞c",
                        hint: "- _ _ ¬∞C",
                        explanation: "Produits congel√©s : -18¬∞C ou moins. Bloque la multiplication microbienne et pr√©serve la qualit√©.",
                        keyword: "Congel√© = -18¬∞C",
                        tip: "Rupture cha√Æne du froid = danger et perte qualit√©."
                    },
                    {
                        type: "qcm",
                        question: "Norme <span class='highlight'>Listeria Monocytogenes</span> dans aliments pr√™ts √† consommer ?",
                        options: [
                            "0 UFC/g",
                            "< 10 UFC/g",
                            "< 100 UFC/g",
                            "< 1000 UFC/g"
                        ],
                        answer: 2,
                        explanation: "Listeria : < 100 UFC/g dans aliments pr√™ts √† consommer. Au-del√† = rappel produit obligatoire.",
                        keyword: "Listeria = < 100 UFC/g",
                        tip: "Norme la plus stricte car Listeria tr√®s dangereuse."
                    },
                    {
                        type: "qcm",
                        question: "Norme <span class='highlight'>Salmonelles</span> dans les aliments ?",
                        options: [
                            "0 dans 25g",
                            "< 10 dans 25g", 
                            "< 100 dans 25g",
                            "< 1000 dans 25g"
                        ],
                        answer: 0,
                        explanation: "Salmonelles : 0 dans 25g d'aliment. Tol√©rance z√©ro car tr√®s pathog√®ne m√™me √† faible dose.",
                        keyword: "Salmonelles = tol√©rance z√©ro",
                        tip: "Une seule Salmonelle peut provoquer une infection."
                    },
                    {
                        type: "keyword",
                        question: "Comment s'appelle la temp√©rature dangereuse entre 4¬∞C et 63¬∞C ?",
                        answer: "zone de danger",
                        hint: "Zone de d _ _ _ _ _",
                        explanation: "ZONE DE DANGER (4¬∞C-63¬∞C) : temp√©rature de multiplication optimale des pathog√®nes. √Ä √©viter !",
                        keyword: "4¬∞C-63¬∞C = zone danger",
                        tip: "R√®gle : rester le moins longtemps possible dans cette zone."
                    },
                    {
                        type: "vf",
                        question: "Le <span class='highlight'>refroidissement rapide</span> doit passer de 63¬∞C √† 10¬∞C en moins de 2h.",
                        answer: true,
                        explanation: "VRAI ! Refroidissement rapide obligatoire : 63¬∞C ‚Üí 10¬∞C en moins de 2h pour √©viter la zone de danger.",
                        keyword: "Refroidissement = 63¬∞C‚Üí10¬∞C <2h",
                        tip: "Cellule de refroidissement indispensable en restauration."
                    },
                    {
                        type: "qcm",
                        question: "Dur√©e maximale de conservation d'un plat cuisin√© r√©frig√©r√© ?",
                        options: [
                            "24 heures",
                            "48 heures",
                            "72 heures",
                            "96 heures"
                        ],
                        answer: 2,
                        explanation: "Plat cuisin√© : maximum 72h (3 jours) entre +0¬∞C et +3¬∞C. Au-del√† = risque microbien.",
                        keyword: "Plat cuisin√© = 72h max",
                        tip: "R√®gle des 3 jours pour les plats pr√©par√©s √† l'avance."
                    },
                    {
                        type: "keyword",
                        question: "Que signifie <span class='highlight'>DLV</span> en restauration collective ?",
                        answer: "dur√©e de vie",
                        hint: "Dur√©e de V _ _",
                        explanation: "DLV = Dur√©e de Vie. Temps pendant lequel un plat pr√©par√© peut √™tre conserv√© sans risque.",
                        keyword: "DLV = dur√©e de vie plat",
                        tip: "DLV fix√©e par l'√©tablissement selon analyse microbiologique."
                    },
                    {
                        type: "vf",
                        question: "La <span class='highlight'>liaison froide</span> consiste √† refroidir rapidement puis r√©chauffer avant service.",
                        answer: true,
                        explanation: "VRAI ! Liaison froide : cuisson ‚Üí refroidissement rapide ‚Üí stockage froid ‚Üí r√©chauffage service.",
                        keyword: "Liaison froide = cuire‚Üírefroidir‚Üír√©chauffer",
                        tip: "Permet de pr√©parer √† l'avance tout en gardant la s√©curit√©."
                    }
                ]
            },
            4: { // R√©glementation
                title: "Niveau 4 : R√©glementation",
                competence: "C4",
                cards: [
                    {
                        type: "qcm",
                        question: "Le <span class='highlight'>Paquet Hygi√®ne</span> europ√©en comprend combien de r√®glements ?",
                        options: [
                            "2 r√®glements",
                            "3 r√®glements", 
                            "4 r√®glements",
                            "5 r√®glements"
                        ],
                        answer: 2,
                        explanation: "Paquet Hygi√®ne = 4 r√®glements europ√©ens : 852/2004 (hygi√®ne), 853/2004 (origine animale), 854/2004 (contr√¥les), 882/2004 (officiels).",
                        keyword: "Paquet Hygi√®ne = 4 r√®glements",
                        tip: "Base de toute la r√©glementation alimentaire europ√©enne."
                    },
                    {
                        type: "qcm",
                        question: "Combien d'<span class='highlight'>allerg√®nes majeurs</span> doivent √™tre obligatoirement d√©clar√©s ?",
                        options: [
                            "12 allerg√®nes",
                            "14 allerg√®nes",
                            "16 allerg√®nes", 
                            "18 allerg√®nes"
                        ],
                        answer: 1,
                        explanation: "14 allerg√®nes majeurs selon r√®glement INCO : gluten, crustac√©s, ≈ìufs, poissons, arachides, soja, lait, fruits √† coque, c√©leri, moutarde, s√©same, sulfites, lupin, mollusques.",
                        keyword: "14 allerg√®nes obligatoires",
                        tip: "Ces 14 repr√©sentent 90% des allergies alimentaires."
                    },
                    {
                        type: "keyword",
                        question: "Que signifie <span class='highlight'>INCO</span> ?",
                        answer: "information du consommateur",
                        hint: "Information du C _ _ _ _ _ _ _ _ _ _ _",
                        explanation: "R√®glement INCO = Information du COnsommateur. Impose √©tiquetage allerg√®nes, origine, valeurs nutritionnelles.",
                        keyword: "INCO = info consommateur",
                        tip: "INCO 1169/2011 r√©volutionne l'√©tiquetage alimentaire."
                    },
                    {
                        type: "qcm",
                        question: "Qui peut ordonner la <span class='highlight'>fermeture administrative</span> d'un √©tablissement ?",
                        options: [
                            "Seulement le Pr√©fet",
                            "Maire ou Pr√©fet",
                            "Seulement la DGCCRF",
                            "N'importe quel inspecteur"
                        ],
                        answer: 1,
                        explanation: "Maire (police municipale) ou Pr√©fet (repr√©sentant √âtat) peuvent ordonner fermeture en cas de danger imminent.",
                        keyword: "Fermeture = Maire ou Pr√©fet",
                        tip: "Mesure d'urgence pour prot√©ger sant√© publique."
                    },
                    {
                        type: "keyword",
                        question: "Que signifie <span class='highlight'>DGCCRF</span> ?",
                        answer: "direction g√©n√©rale concurrence consommation r√©pression fraudes",
                        hint: "Direction G√©n√©rale C _ _ _ _ _ _ _ _ _ _ _ C _ _ _ _ _ _ _ _ _ _ _ R _ _ _ _ _ _ _ _ _ F _ _ _ _ _ _",
                        explanation: "DGCCRF = Direction G√©n√©rale Concurrence, Consommation et R√©pression des Fraudes. Service du minist√®re de l'√âconomie.",
                        keyword: "DGCCRF = anti-fraude",
                        tip: "DGCCRF contr√¥le qualit√©, √©tiquetage, fraudes alimentaires."
                    },
                    {
                        type: "qcm",
                        question: "Quel organisme g√®re la plateforme <span class='highlight'>RappelConso</span> ?",
                        options: [
                            "ANSES",
                            "DGCCRF",
                            "DGAL",
                            "InVS"
                        ],
                        answer: 1,
                        explanation: "RappelConso = plateforme officielle DGCCRF pour informer consommateurs des rappels produits.",
                        keyword: "RappelConso = DGCCRF",
                        tip: "Site gouvernemental : rappel-conso.beta.gouv.fr"
                    },
                    {
                        type: "vf",
                        question: "L'<span class='highlight'>√©tiquetage nutritionnel</span> est obligatoire sur tous les aliments pr√©emball√©s.",
                        answer: true,
                        explanation: "VRAI ! Depuis d√©cembre 2016, √©tiquetage nutritionnel obligatoire (√©nergie, lipides, glucides, prot√©ines, sel).",
                        keyword: "√âtiquetage nutritionnel = obligatoire",
                        tip: "Exceptions : boissons alcoolis√©es, compl√©ments alimentaires."
                    },
                    {
                        type: "keyword",
                        question: "Comment s'appelle le syst√®me europ√©en d'alerte alimentaire ?",
                        answer: "rasff",
                        hint: "R _ _ _ _ (5 lettres)",
                        explanation: "RASFF = Rapid Alert System for Food and Feed. Syst√®me d'alerte rapide europ√©en pour denr√©es alimentaires.",
                        keyword: "RASFF = alerte europ√©enne",
                        tip: "Permet √©change rapide infos entre √âtats membres UE."
                    },
                    {
                        type: "qcm",
                        question: "Sanction maximale pour <span class='highlight'>mise en danger d'autrui</span> par aliment ?",
                        options: [
                            "Amende seulement",
                            "1 an prison + 15 000‚Ç¨ amende",
                            "3 ans prison + 45 000‚Ç¨ amende",
                            "5 ans prison + 75 000‚Ç¨ amende"
                        ],
                        answer: 1,
                        explanation: "Mise en danger = 1 an emprisonnement + 15 000‚Ç¨ d'amende. Si d√©c√®s : jusqu'√† 3 ans prison.",
                        keyword: "Mise danger = 1 an + 15 000‚Ç¨",
                        tip: "Sanctions p√©nales lourdes = responsabilit√© importante."
                    },
                    {
                        type: "vf",
                        question: "Le <span class='highlight'>principe de pr√©caution</span> permet de retirer un produit sans preuve scientifique compl√®te.",
                        answer: true,
                        explanation: "VRAI ! Principe de pr√©caution = mesures pr√©ventives m√™me sans certitude scientifique absolue si risque grave.",
                        keyword: "Pr√©caution = agir sans preuve compl√®te",
                        tip: "Mieux vaut pr√©venir que gu√©rir en sant√© publique."
                    }
                ]
            },
            5: { // Quiz final
                title: "Niveau 5 : Quiz Final Expert",
                competence: "C1-C6",
                cards: [] // Sera rempli avec un mix al√©atoire
            }
        };
        
        // G√©n√©rer le niveau 5 (mix al√©atoire)
        function generateLevel5() {
            let allCards = [];
            for (let i = 1; i <= 4; i++) {
                levels[i].cards.forEach(card => {
                    allCards.push({...card, fromLevel: i});
                });
            }
            // M√©langer et prendre 15 cartes
            allCards.sort(() => Math.random() - 0.5);
            levels[5].cards = allCards.slice(0, 15);
        }
        generateLevel5();
        
        // === FONCTIONS ===
        function startLevel(level) {
            currentLevel = level;
            currentCardIndex = 0;
            levelCorrect = 0;
            levelPoints = 0;
            levelErrors = [];
            
            document.getElementById('homeScreen').classList.remove('active');
            document.getElementById('gameScreen').classList.add('active');
            document.getElementById('levelTitle').textContent = levels[level].title;
            document.getElementById('totalCards').textContent = levels[level].cards.length;
            
            showCard();
        }
        
        function showCard() {
            const cards = levels[currentLevel].cards;
            const card = cards[currentCardIndex];
            hintUsed = false;
            
            document.getElementById('currentCard').textContent = currentCardIndex + 1;
            document.getElementById('gameProgress').style.width = ((currentCardIndex / cards.length) * 100) + '%';
            
            // Comp√©tence
            const compBadge = document.getElementById('cardCompetence');
            compBadge.textContent = card.fromLevel ? `C${card.fromLevel}` : levels[currentLevel].competence;
            compBadge.className = 'card-competence comp-badge c' + (card.fromLevel || currentLevel);
            
            // Type de carte
            const typeNames = { keyword: 'MOT-CL√â', qcm: 'QCM', vf: 'VRAI / FAUX' };
            document.getElementById('cardType').textContent = typeNames[card.type] || card.type;
            
            // Contenu
            const questionSection = document.getElementById('questionSection');
            
            if (card.type === 'keyword') {
                questionSection.innerHTML = `
                    <p class="question-text">${card.question}</p>
                    <div class="keyword-input-container">
                        <input type="text" class="keyword-input" id="keywordAnswer" placeholder="√âcris ta r√©ponse..." autocomplete="off">
                        <p class="hint-text" id="hintText">üí° Clique sur "Indice" si besoin</p>
                    </div>
                `;
                document.getElementById('keywordAnswer').addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') validateAnswer();
                });
            }
            else if (card.type === 'qcm') {
                let optionsHTML = card.options.map((opt, i) => `
                    <button class="option-btn" data-index="${i}" onclick="selectOption(this)">
                        <span class="option-letter">${String.fromCharCode(65 + i)}</span>
                        <span>${opt}</span>
                    </button>
                `).join('');
                
                questionSection.innerHTML = `
                    <p class="question-text">${card.question}</p>
                    <div class="options-container">${optionsHTML}</div>
                `;
            }
            else if (card.type === 'vf') {
                questionSection.innerHTML = `
                    <p class="question-text">${card.question}</p>
                    <div class="vf-container">
                        <button class="vf-btn vrai" onclick="selectVF(this, true)">‚úì VRAI</button>
                        <button class="vf-btn faux" onclick="selectVF(this, false)">‚úó FAUX</button>
                    </div>
                `;
            }
        }
        
        function selectOption(btn) {
            document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
        }
        
        function selectVF(btn, value) {
            document.querySelectorAll('.vf-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            btn.dataset.value = value;
        }
        
        function showHint() {
            const card = levels[currentLevel].cards[currentCardIndex];
            if (card.hint) {
                document.getElementById('hintText').innerHTML = `üí° <strong>Indice :</strong> ${card.hint}`;
                hintUsed = true;
            }
        }
        
        function validateAnswer() {
            const card = levels[currentLevel].cards[currentCardIndex];
            let isCorrect = false;
            let userAnswer = '';
            
            if (card.type === 'keyword') {
                userAnswer = document.getElementById('keywordAnswer').value.trim().toLowerCase();
                // Normaliser (accents, etc.)
                const normalize = str => str.normalize('NFD').replace(/[\u0300-\u036f]/g, '').toLowerCase();
                isCorrect = normalize(userAnswer) === normalize(card.answer) || 
                            userAnswer.includes(normalize(card.answer)) ||
                            normalize(card.answer).includes(userAnswer);
            }
            else if (card.type === 'qcm') {
                const selected = document.querySelector('.option-btn.selected');
                if (!selected) { alert('S√©lectionne une r√©ponse'); return; }
                userAnswer = parseInt(selected.dataset.index);
                isCorrect = userAnswer === card.answer;
            }
            else if (card.type === 'vf') {
                const selected = document.querySelector('.vf-btn.selected');
                if (!selected) { alert('S√©lectionne VRAI ou FAUX'); return; }
                userAnswer = selected.dataset.value === 'true';
                isCorrect = userAnswer === card.answer;
            }
            
            showFeedback(isCorrect, card);
        }
        
        function showFeedback(isCorrect, card) {
            const overlay = document.getElementById('feedbackOverlay');
            const feedbackCard = document.getElementById('feedbackCard');
            
            let points = 0;
            if (isCorrect) {
                points = hintUsed ? 5 : 10;
                levelCorrect++;
                currentStreak++;
                if (currentStreak > bestStreak) bestStreak = currentStreak;
                
                // Streak bonus
                if (currentStreak === 3) showStreakPopup('üî• 3 de suite !');
                else if (currentStreak === 5) showStreakPopup('üî•üî• 5 de suite !');
                else if (currentStreak === 10) showStreakPopup('üî•üî•üî• INCROYABLE !');
            } else {
                currentStreak = 0;
                levelErrors.push(card.keyword || card.question.replace(/<[^>]*>/g, '').substring(0, 50) + '...');
            }
            
            levelPoints += points;
            totalPoints += points;
            updateScoreDisplay();
            
            feedbackCard.className = 'feedback-card ' + (isCorrect ? 'correct' : 'incorrect');
            document.getElementById('feedbackIcon').textContent = isCorrect ? '‚úÖ' : '‚ùå';
            document.getElementById('feedbackTitle').textContent = isCorrect ? 
                (currentStreak >= 3 ? 'Excellent ! üî•' : 'Bravo !') : 'Pas tout √† fait...';
            document.getElementById('feedbackPoints').textContent = isCorrect ? `+${points} points` : '0 point';
            document.getElementById('feedbackPoints').style.display = isCorrect ? 'block' : 'none';
            
            document.getElementById('feedbackExplanation').innerHTML = `
                <h4>üìö Explication</h4>
                <p>${card.explanation}</p>
                <div class="keyword-box">üîë <span>${card.keyword}</span></div>
                ${card.tip ? `<div class="tip-box"><h5>üí° Astuce BAC</h5><p>${card.tip}</p></div>` : ''}
            `;
            
            overlay.classList.add('visible');
        }
        
        function showStreakPopup(text) {
            const popup = document.getElementById('streakPopup');
            popup.textContent = text;
            popup.style.display = 'block';
            setTimeout(() => { popup.style.display = 'none'; }, 1500);
        }
        
        function nextCard() {
            document.getElementById('feedbackOverlay').classList.remove('visible');
            currentCardIndex++;
            
            if (currentCardIndex >= levels[currentLevel].cards.length) {
                showResults();
            } else {
                showCard();
            }
        }
        
        function showResults() {
            const total = levels[currentLevel].cards.length;
            const percent = Math.round((levelCorrect / total) * 100);
            
            levelProgress[currentLevel] = Math.max(levelProgress[currentLevel], percent);
            
            document.getElementById('gameScreen').classList.remove('active');
            document.getElementById('resultsScreen').classList.add('active');
            
            document.getElementById('resultsIcon').textContent = percent >= 80 ? 'üéâ' : percent >= 50 ? 'üëç' : 'üí™';
            document.getElementById('resultsTitle').textContent = percent >= 80 ? 'Niveau r√©ussi !' : percent >= 50 ? 'Pas mal !' : 'Continue !';
            document.getElementById('resultsScore').textContent = percent + '%';
            document.getElementById('correctCount').textContent = levelCorrect + '/' + total;
            document.getElementById('pointsEarned').textContent = '+' + levelPoints;
            document.getElementById('bestStreak').textContent = bestStreak;
            
            // Erreurs
            const errorsRecap = document.getElementById('errorsRecap');
            if (levelErrors.length > 0) {
                errorsRecap.style.display = 'block';
                document.getElementById('errorsList').innerHTML = levelErrors.map(e => `<li>${e}</li>`).join('');
            } else {
                errorsRecap.style.display = 'none';
            }
            
            // Confettis si r√©ussi
            if (percent >= 80) {
                createConfetti();
            }
            
            // Bouton niveau suivant
            document.getElementById('nextLevelBtn').style.display = (currentLevel < 5 && percent >= 60) ? 'flex' : 'none';
            
            updateHomeProgress();
        }
        
        function createConfetti() {
            const colors = ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#4CAF50', '#FFD700'];
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 2 + 's';
                confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                document.body.appendChild(confetti);
                setTimeout(() => confetti.remove(), 3000);
            }
        }
        
        function goHome() {
            document.getElementById('resultsScreen').classList.remove('active');
            document.getElementById('gameScreen').classList.remove('active');
            document.getElementById('homeScreen').classList.add('active');
            updateHomeProgress();
        }
        
        function nextLevel() {
            if (currentLevel < 5) {
                startLevel(currentLevel + 1);
                document.getElementById('resultsScreen').classList.remove('active');
            }
        }
        
        function updateScoreDisplay() {
            document.getElementById('totalPoints').textContent = totalPoints;
            document.getElementById('currentStreak').textContent = currentStreak;
        }
        
        function updateHomeProgress() {
            for (let i = 1; i <= 5; i++) {
                document.getElementById(`level${i}Percent`).textContent = levelProgress[i] + '%';
                document.getElementById(`level${i}Bar`).style.width = levelProgress[i] + '%';
            }
        }
        
        // Init
        updateScoreDisplay();
        updateHomeProgress();
    </script>
</body>
</html>
