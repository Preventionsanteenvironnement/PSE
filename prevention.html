<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"/>
<title>Exercice - Les Mesures de Pr√©vention</title>
<style>
  :root{
    --bg:#0f172a; --text:#f1f5f9;
    --card-bg: white;
    --font-ui: system-ui, -apple-system, sans-serif;
    --success:#10b981;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:var(--font-ui); color:var(--text);
    background:var(--bg); padding:10px; padding-bottom:80px;
    background-image: radial-gradient(circle at 50% 0%, #064e3b 0%, #020617 80%);
    background-attachment: fixed;
    overflow-x: hidden;
    user-select: auto;
  }
  .wrap{max-width:900px; margin:0 auto; min-height: 90vh; display: flex; flex-direction: column;}

  .btn-back{
    position: fixed;
    top: 10px; left: 10px;
    z-index: 9998;
    padding: 8px 10px;
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.15);
    background: rgba(255,255,255,0.06);
    color:#fff;
    font-weight: 900;
    cursor:pointer;
    display:none;
    backdrop-filter: blur(6px);
  }
  .btn-back:active{ transform: scale(0.98); }

  .header-zone {
    display:flex; align-items:center; gap:15px; background: rgba(30, 41, 59, 0.95);
    padding: 15px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px;
  }
  .coach-bubble { font-size: 0.9rem; color: #e2e8f0; line-height: 1.4; flex:1; }
  .a11y-controls{ display:flex; gap:8px; align-items:center; }
  .btn-a11y{
    padding:8px 10px; border-radius:10px; border:1px solid rgba(255,255,255,0.15);
    background: rgba(255,255,255,0.06); color:#fff; font-weight:900; cursor:pointer;
  }
  .btn-a11y:active{ transform: scale(0.98); }

  .page-section { display: none; animation: fadeIn 0.5s; }
  .page-section.active { display: block; }

  .intro-box, .login-box { text-align: center; padding: 30px 20px; background: rgba(255,255,255,0.05); border-radius: 16px; border: 1px solid rgba(255,255,255,0.1); }
  .btn-start { padding: 15px 30px; background: #10b981; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 1rem; margin-top: 20px; box-shadow: 0 4px 0 #047857; width: 100%; }
  .btn-start:active { transform: translateY(2px); box-shadow: 0 2px 0 #047857; }

  .main-layout { display: flex; gap: 15px; min-height: 520px; }

  .sidebar-arrow {
      width: 50px; border-radius: 25px;
      background: linear-gradient(to bottom, #15803d 0%, #22c55e 20%, #eab308 40%, #f97316 60%, #ef4444 80%, #991b1b 100%);
      display: flex; flex-direction: column; justify-content: space-between; align-items: center;
      padding: 15px 0; color: white; font-weight: 900; font-size: 0.65rem; text-align: center;
      box-shadow: 2px 4px 10px rgba(0,0,0,0.5); border: 2px solid rgba(255,255,255,0.2);
      position: relative;
  }
  .vertical-txt { writing-mode: vertical-rl; transform: rotate(180deg); letter-spacing: 2px; text-shadow: 0 1px 2px rgba(0,0,0,0.5); }

  .arrow-cursor {
      position: absolute; left: -10px; width: 0; height: 0;
      border-top: 10px solid transparent; border-bottom: 10px solid transparent;
      border-left: 15px solid white; filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.5));
      transition: top 0.5s ease-in-out; top: 8%;
  }

  .content-zone { flex: 1; position: relative; }

  .step-card {
      background: white; border-radius: 12px; padding: 20px; color: #334155;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3); display: none; animation: slideIn 0.4s;
      height: 100%; flex-direction: column;
  }
  .step-card.active { display: flex; }

  .group-header { font-size: 0.75rem; text-transform: uppercase; font-weight: bold; color: #64748b; margin-bottom: 5px; border-bottom: 2px solid #e2e8f0; padding-bottom: 5px; }
  .lvl-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
  .lvl-badge { padding: 5px 10px; border-radius: 6px; color: white; font-weight: bold; font-size: 0.75rem; text-transform: uppercase; }
  .lvl-title { margin: 0; font-size: 1.2rem; font-weight: 800; color: #1e293b; }
  .lvl-desc { font-style: italic; color: #475569; margin-bottom: 15px; font-size: 0.9rem; line-height: 1.4; border-left: 3px solid #cbd5e1; padding-left: 10px; }

  .detail-list { list-style: none; padding: 0; margin: 0; }
  .detail-item { background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 10px; margin-bottom: 10px; display: flex; gap: 10px; align-items: center; }
  .detail-icon { font-size: 1.5rem; min-width: 40px; text-align: center; }
  .detail-text strong { display: block; color: #334155; font-size: 0.9rem; margin-bottom: 3px; }
  .detail-text p { margin: 0; font-size: 0.8rem; color: #64748b; }

  .nav-bar { display: flex; justify-content: space-between; margin-top: 15px; gap:10px; flex-wrap:wrap; }
  .btn-step { padding: 12px 20px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; color: white; font-size: 1rem; transition: 0.2s; }
  .btn-prev { background: #64748b; visibility: hidden; }
  .btn-next-step { background: #10b981; box-shadow: 0 4px 0 #047857; }
  .btn-next-step:active { transform: translateY(2px); box-shadow: 0 2px 0 #047857; }

  .c-1 { color: #15803d; border-color: #22c55e; } .bg-1 { background: #16a34a; }
  .c-2 { color: #3f6212; border-color: #84cc16; } .bg-2 { background: #65a30d; }
  .c-3 { color: #854d0e; border-color: #eab308; } .bg-3 { background: #ca8a04; }
  .c-4 { color: #9a3412; border-color: #f97316; } .bg-4 { background: #ea580c; }
  .c-5 { color: #991b1b; border-color: #ef4444; } .bg-5 { background: #dc2626; }
  .c-6 { color: #7f1d1d; border-color: #b91c1c; } .bg-6 { background: #991b1b; }

  .prev-table { display: grid; gap: 8px; }
  .prev-row { background: white; padding: 10px; border-radius: 8px; display: flex; flex-direction: column; gap: 5px; border-left: 5px solid #cbd5e1; }
  .prev-label { font-weight: 800; font-size: 0.9rem; text-transform: uppercase; color: #1e293b; }
  .prev-drop-zone {
    background: #f1f5f9; border: 2px dashed #94a3b8; border-radius: 6px; min-height: 50px;
    display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 8px;
    font-size: 0.9rem; text-align: center; color: #64748b; transition: 0.2s; gap: 5px;
    cursor: pointer;
  }
  .prev-drop-zone.filled { background: #dcfce7; border-color: #16a34a; color: #166534; border-style: solid; font-weight: bold; }
  .dock { display: flex; flex-wrap: wrap; gap: 8px; justify-content: flex-start; background: rgba(255,255,255,0.1); padding: 10px; border-radius: 12px; margin-bottom: 15px; min-height: 60px; }
  .prev-option { background: #3b82f6; color: white; padding: 10px; border-radius: 6px; font-size: 0.85rem; margin: 5px; cursor: pointer; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.2); user-select:none; }
  .prev-option.selected { transform: scale(1.05); background: #2563eb; outline: 2px solid rgba(255,255,255,0.95); outline-offset: 2px; }

  .fixed-item {
    font-size: 0.8rem; color: #475569; font-weight: 600; font-style: italic; margin-bottom: 6px;
    pointer-events: none; border-bottom: 1px solid #cbd5e1; width: 100%; text-align: center; padding-bottom: 4px;
    background: rgba(0,0,0,0.03); border-radius: 4px;
  }

  .doc-container { background: white; color: #334155; padding: 20px; border-radius: 12px; line-height: 1.6; font-size: 0.95rem; text-align: justify; box-shadow: 0 4px 10px rgba(0,0,0,0.2); margin-bottom: 20px; border-left: 5px solid #10b981; }
  .btn-nav { padding: 12px 20px; background: #334155; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 0.9rem; font-weight: bold; }
  .btn-reset { background: #f59e0b; color: #fff; }
  .btn-next { background: var(--success); flex-grow: 1; display: none; }
  .action-bar { display: flex; gap: 10px; margin-top: 20px; justify-content: space-between; flex-wrap:wrap; }
  .footer { text-align: center; color: #64748b; font-size: 0.8rem; margin-top: 20px; font-style: italic; }

  .final-quiz-card { background: white; padding: 20px; border-radius: 12px; margin-bottom: 15px; }
  .final-q-text { font-size: 1.1rem; font-weight: bold; margin-bottom: 15px; color: #1e293b; }
  .final-opt-btn { display: block; width: 100%; padding: 12px; margin-bottom: 10px; background: #f1f5f9; border: 2px solid #cbd5e1; border-radius: 8px; color: #334155; text-align: left; cursor: pointer; transition:0.2s;}
  .final-opt-btn.correct { background: #dcfce7; border-color: #16a34a; color: #14532d; }
  .final-opt-btn.wrong { background: #fee2e2; border-color: #ef4444; color: #991b1b; }

  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

  .confetti { position: fixed; width: 10px; height: 10px; animation: fall linear forwards; z-index: 9999; top: -10px; }
  @keyframes fall { to { transform: translateY(100vh) rotate(720deg); } }

  @media (max-width: 650px){
    .header-zone{ flex-wrap:wrap; align-items:flex-start; }
    .a11y-controls{ width:100%; justify-content:flex-end; }
    .main-layout{ flex-direction: column; min-height: auto; }
    .sidebar-arrow{
      width: 100%;
      border-radius: 16px;
      padding: 10px 12px;
      flex-direction: row;
      justify-content: space-between;
      gap: 12px;
    }
    .vertical-txt{ writing-mode: horizontal-tb; transform: none; letter-spacing: 1px; }
    .arrow-cursor{ display:none; }
    .step-card{ height:auto; }
    .nav-bar{ flex-direction: column; }
    .btn-step{ width:100%; }
    .doc-container{ padding: 16px; }
  }
</style>
</head>
<body>

<button id="btnBack" class="btn-back" type="button" onclick="goReturn()">‚¨Ö</button>

<div class="wrap">

  <div class="header-zone">
    <div class="coach-bubble" id="coachText">Exercice : suis les consignes, puis avance √©tape par √©tape.</div>
    <div class="a11y-controls">
      <button class="btn-a11y" type="button" onclick="changeSize(-1)">A-</button>
      <button class="btn-a11y" type="button" onclick="changeSize(1)">A+</button>
    </div>
  </div>

  <div id="page0" class="page-section active">
    <div class="login-box" style="text-align:left;">
      <h1 style="color:white; margin:0 0 10px 0;">LA PR√âVENTION</h1>
      <div style="color:#34d399; font-weight:900; margin-bottom:10px;">Objectif</div>
      <div style="margin:0; color:#e2e8f0; line-height:1.6;">
        √ätre capable d‚Äôidentifier et de classer les diff√©rentes mesures de pr√©vention.
      </div>
      <div style="font-size:2.5rem; margin:18px 0; text-align:center;">üõ°Ô∏è‚ö†Ô∏è‚úÖ</div>
      <button class="btn-start" type="button" onclick="startModule()">C'est parti !</button>
    </div>
    <div class="footer">√âdition FOUCHER</div>
  </div>

  <div id="page1" class="page-section">
    <div class="intro-box">
      <h2 style="color:#34d399; margin-top:0;">CONSIGNE</h2>
      <hr style="border:1px solid #10b981; width:50%; margin:15px auto;">
      <p style="font-size:1.05rem; color:#e2e8f0; font-weight:500; margin-bottom:0;">
        Tu vas d‚Äôabord lire la hi√©rarchie des mesures, puis r√©aliser 2 exercices et une auto-√©valuation.
      </p>
      <div style="background:rgba(16, 185, 129, 0.2); padding:15px; border-radius:10px; margin-top:20px; text-align:left; border-left:4px solid #34d399;">
        <strong style="color:#34d399;">Principe</strong>
        <p style="margin:5px 0; color:#d1fae5;">
          Les mesures sont class√©es de la plus efficace (suppression du danger) √† la moins efficace (d√©pend de l‚Äôhumain).
        </p>
      </div>
      <button class="btn-start" type="button" onclick="goToPage(2)">J‚Äôacc√®de √† la hi√©rarchie ‚û°</button>
    </div>
    <div class="footer">√âdition FOUCHER</div>
  </div>

  <div id="page2" class="page-section">
    <div class="main-layout">
      <div class="sidebar-arrow">
        <span class="vertical-txt">TR√àS EFFICACE</span>
        <div id="arrowCursor" class="arrow-cursor"></div>
        <span style="font-size:1.5rem; text-shadow:0 2px 2px rgba(0,0,0,0.3);">‚¨á</span>
        <span class="vertical-txt">PEU EFFICACE</span>
      </div>
      <div class="content-zone">
        <div id="step1" class="step-card active" style="border-top: 5px solid #22c55e;">
          <div class="group-header">FAMILLE : SUPPRESSION OU R√âDUCTION</div>
          <div class="lvl-header"><span class="lvl-badge bg-1">Niveau 1</span></div>
          <h2 class="lvl-title c-1">SUPPRESSION DU RISQUE</h2>
          <p class="lvl-desc">On change le processus ou le mode op√©ratoire pour que le risque disparaisse totalement.</p>
          <ul class="detail-list">
            <li class="detail-item"><div class="detail-icon">ü§ñ</div><div class="detail-text"><strong>Automatiser</strong><p>Utiliser un robot √† la place de l'homme.</p></div></li>
            <li class="detail-item"><div class="detail-icon">üö´</div><div class="detail-text"><strong>Enlever</strong><p>Supprimer totalement un produit dangereux.</p></div></li>
          </ul>
          <img src="suppressionduproduitdangereux.jpg" style="width:100%; height:120px; object-fit:contain; border-radius:6px; margin-top:10px;" onerror="this.style.display='none'">
        </div>

        <div id="step2" class="step-card" style="border-top: 5px solid #84cc16;">
          <div class="group-header">FAMILLE : SUPPRESSION OU R√âDUCTION</div>
          <div class="lvl-header"><span class="lvl-badge bg-2">Niveau 2</span></div>
          <h2 class="lvl-title c-2">R√âDUCTION DU RISQUE</h2>
          <p class="lvl-desc">On ne peut pas supprimer, alors on limite le risque d'atteinte √† la sant√©.</p>
          <ul class="detail-list">
            <li class="detail-item"><div class="detail-icon">üîÑ</div><div class="detail-text"><strong>Substitution</strong><p>Remplacer un produit par un autre moins dangereux.</p></div></li>
            <li class="detail-item"><div class="detail-icon">üìâ</div><div class="detail-text"><strong>Intensit√©</strong><p>Utiliser une machine moins bruyante (92dB ‚û° 61dB).</p></div></li>
          </ul>
          <img src="Remplacementdunemachinebruyanteparunemachinemoibruyante.jpg" style="width:100%; height:120px; object-fit:contain; border-radius:6px; margin-top:10px;" onerror="this.style.display='none'">
        </div>

        <div id="step3" class="step-card" style="border-top: 5px solid #eab308;">
          <div class="group-header">FAMILLE : PROTECTION</div>
          <div class="lvl-header"><span class="lvl-badge bg-3">Niveau 3</span></div>
          <h2 class="lvl-title c-3">PROTECTION COLLECTIVE (EPC)</h2>
          <p class="lvl-desc">On prot√®ge <strong>plusieurs salari√©s</strong> √† la fois en les isolant du danger.</p>
          <ul class="detail-list">
            <li class="detail-item"><div class="detail-icon">üöß</div><div class="detail-text"><strong>√âcrans / Barri√®res</strong><p>Rambardes, Encoffrement de machine, Hottes.</p></div></li>
            <li class="detail-item"><div class="detail-icon">üõë</div><div class="detail-text"><strong>S√©curit√©</strong><p>Arr√™t d'urgence, sol antid√©rapant.</p></div></li>
          </ul>
          <img src="rambardedesecurite.jpg" style="width:100%; height:120px; object-fit:cover; border-radius:6px; margin-top:10px;" onerror="this.style.display='none'">
        </div>

        <div id="step4" class="step-card" style="border-top: 5px solid #f97316;">
          <div class="group-header">FAMILLE : PROTECTION</div>
          <div class="lvl-header"><span class="lvl-badge bg-4">Niveau 4</span></div>
          <h2 class="lvl-title c-4">PROTECTION INDIVIDUELLE (EPI)</h2>
          <p class="lvl-desc">On prot√®ge <strong>un seul salari√©</strong>. Uniquement si la protection collective est impossible.</p>
          <div style="display:flex; flex-wrap:wrap; gap:5px; margin-bottom:15px;"><span class="lvl-badge bg-4">Casque</span><span class="lvl-badge bg-4">Gants</span><span class="lvl-badge bg-4">Lunettes</span><span class="lvl-badge bg-4">Bouchons</span><span class="lvl-badge bg-4">Chaussures</span></div>
          <img src="casque.jpg" style="width:100%; height:120px; object-fit:contain; border-radius:6px;" onerror="this.style.display='none'">
        </div>

        <div id="step5" class="step-card" style="border-top: 5px solid #ef4444;">
          <div class="group-header">FAMILLE : INFO / FORMATION</div>
          <div class="lvl-header"><span class="lvl-badge bg-5">Niveau 5</span></div>
          <h2 class="lvl-title c-5">INFORMATIONS</h2>
          <p class="lvl-desc">Avertir et donner des consignes au personnel.</p>
          <ul class="detail-list">
            <li class="detail-item"><div class="detail-icon">üëÅÔ∏è</div><div class="detail-text"><strong>Visuel</strong><p>Panneaux, pictogrammes, affiches.</p></div></li>
            <li class="detail-item"><div class="detail-icon">üîä</div><div class="detail-text"><strong>Sonore / √âcrit</strong><p>Signaux d'alarme, Fiche de poste.</p></div></li>
          </ul>
          <img src="panneaudinformation.jpg" style="width:100%; height:120px; object-fit:contain; border-radius:6px; margin-top:10px;" onerror="this.style.display='none'">
        </div>

        <div id="step6" class="step-card" style="border-top: 5px solid #b91c1c;">
          <div class="group-header">FAMILLE : INFO / FORMATION</div>
          <div class="lvl-header"><span class="lvl-badge bg-6">Niveau 6</span></div>
          <h2 class="lvl-title c-6">FORMATION</h2>
          <p class="lvl-desc">Faire acqu√©rir des comp√©tences en sant√© s√©curit√© au travail.</p>
          <ul class="detail-list">
            <li class="detail-item"><div class="detail-icon">üöë</div><div class="detail-text"><strong>SST</strong><p>Sauveteur Secouriste du Travail.</p></div></li>
            <li class="detail-item"><div class="detail-icon">üèãÔ∏è</div><div class="detail-text"><strong>PRAP (Pr√©vention des Risques li√©s √† l'Activit√© Physique)</strong><p>Gestes et postures.</p></div></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="nav-bar">
      <button id="btnPrev" class="btn-step btn-prev" type="button" onclick="changeStep(-1)">‚¨Ö Pr√©c√©dent</button>
      <button id="btnNext" class="btn-step btn-next-step" type="button" onclick="changeStep(1)">Suivant (Niveau inf√©rieur) ‚û°</button>
    </div>
    <div class="footer">√âdition FOUCHER</div>
  </div>

  <div id="page3" class="page-section">
    <h3 style="color:white; margin:0 0 10px 0;">Cas n¬∞1 : Cl√©ment (Poin√ßonneur)</h3>
    <div class="doc-container" style="background:#ecfccb; color:#365314; border-color:#84cc16; font-size:0.85rem; padding:10px;">
      <strong>Situation :</strong> Cl√©ment a des <strong>douleurs aux √©paules</strong>. Propose des solutions en respectant la hi√©rarchie.
    </div>
    <div class="dock" id="prevDock"></div>
    <div class="prev-table">
      <div class="prev-row" style="border-color:#22c55e">
        <div class="prev-label" style="color:#16a34a;">1. Supprimer / R√©duire (Le mieux)</div>
        <div class="prev-drop-zone" id="drop-suppr" onclick="handlePrevClick(this)" data-ans="auto">Cliquer ici</div>
        <div class="prev-drop-zone" id="drop-red" onclick="handlePrevClick(this)" data-ans="orga">Cliquer ici</div>
      </div>
      <div class="prev-row" style="border-color:#eab308">
        <div class="prev-label" style="color:#ca8a04;">2. Protection Collective</div>
        <div class="prev-drop-zone" id="drop-coll" onclick="handlePrevClick(this)" data-ans="ventouse">Cliquer ici</div>
      </div>
      <div class="prev-row" style="border-color:#f97316">
        <div class="prev-label" style="color:#ea580c;">3. Protection Individuelle</div>
        <div class="prev-drop-zone" id="drop-indiv" onclick="handlePrevClick(this)" data-ans="gants">Cliquer ici</div>
      </div>
      <div class="prev-row" style="border-color:#ef4444">
        <div class="prev-label" style="color:#dc2626;">4. Info / Formation</div>
        <div class="prev-drop-zone" id="drop-form" onclick="handlePrevClick(this)" data-ans="prap">Cliquer ici</div>
      </div>
    </div>
    <div class="action-bar">
      <button class="btn-nav" type="button" onclick="goToPage(2)">‚¨Ö Revoir la hi√©rarchie</button>
      <button class="btn-nav btn-reset" type="button" onclick="initPage3()">üîÑ Recommencer</button>
      <button class="btn-nav btn-next" id="btnPage3" type="button" onclick="goToPage(4)">Suite : Cas n¬∞2 ‚û°</button>
    </div>
    <div class="footer">√âdition FOUCHER</div>
  </div>

  <div id="page4" class="page-section">
    <h3 style="color:white; border-bottom:2px solid #10b981; padding-bottom:10px;">Cas n¬∞2 : La situation de Yassine</h3>
    <div class="doc-container" style="max-height:60vh; overflow-y:auto;">
      <p><strong>Yassine, 24 ans</strong>, 1,90 m et 90 kg, titulaire d‚Äôun CAP op√©rateur logistique, est embauch√© en CDI depuis 18 mois comme cariste et pr√©parateur de commandes sur une plateforme logistique.</p>
      <p>Il travaille dans un entrep√¥t de 75 000 m¬≤ non chauff√©, avec des horaires altern√©s une semaine sur deux (5 h‚Äì13 h puis 13 h‚Äì21 h).</p>
      <p>La cadence est √©lev√©e : environ <strong>80 colis par heure</strong>. Il manipule souvent des colis de 5 kg port√©s √† la main puis d√©pos√©s sur un chariot, ce qui repr√©sente presque <strong>3 tonnes par jour</strong>.</p>
      <p>Yassine a eu plusieurs arr√™ts de travail pour des troubles musculo-squelettiques (TMS), notamment des <strong>lombalgies</strong> (mal au dos). Malgr√© cela, il se dit satisfait de son travail et appr√©cie la bonne ambiance. L‚Äôentreprise est reconnue pour la satisfaction client.</p>
    </div>
    <div class="action-bar">
      <button class="btn-nav" type="button" onclick="goToPage(3)">‚¨Ö Retour Cas 1</button>
      <button class="btn-nav btn-next" type="button" style="display:block" onclick="goToPage(5)">Je propose des solutions ‚û°</button>
    </div>
    <div class="footer">√âdition FOUCHER</div>
  </div>

  <div id="page5" class="page-section">
    <h3 style="color:white; margin:0 0 10px 0;">Exercice : les solutions pour Yassine</h3>
    <div class="main-layout">
      <div class="sidebar-arrow">
        <span class="vertical-txt">TR√àS EFFICACE</span>
        <span style="font-size:1.5rem; text-shadow:0 2px 2px rgba(0,0,0,0.3);">‚¨á</span>
        <span class="vertical-txt">PEU EFFICACE</span>
      </div>

      <div class="content-zone">
        <div class="doc-container" style="background:#dbeafe; color:#1e3a8a; border-color:#2563eb; font-size:0.85rem; padding:10px; margin-bottom:10px;">
          <strong>Mission :</strong> Classe les solutions pour le mal de dos de Yassine.
        </div>
        <div class="dock" id="yassineDock"></div>
        <div class="prev-table">
          <div class="prev-row" style="border-left:5px solid #22c55e;">
            <div class="prev-label" style="color:#16a34a;">1. Suppression ou r√©duction</div>
            <div class="prev-drop-zone" id="drop-y-1" onclick="handleYassineClick(this)" data-ans="multi">
              <div class="fixed-item">Cr√©er des postes ¬´ cadre vert ¬ª</div>
              Cliquer ici
            </div>
          </div>
          <div class="prev-row" style="border-left:5px solid #eab308;">
            <div class="prev-label" style="color:#ca8a04;">2. Protection coll. / indiv.</div>
            <div class="prev-drop-zone" id="drop-y-2" onclick="handleYassineClick(this)" data-ans="multi">
              <div class="fixed-item">R√©duire les distances de d√©placement</div>
              Cliquer ici
            </div>
          </div>
          <div class="prev-row" style="border-left:5px solid #ef4444;">
            <div class="prev-label" style="color:#dc2626;">3. Instructions / formation</div>
            <div class="prev-drop-zone" id="drop-y-3" onclick="handleYassineClick(this)" data-ans="multi">
              <div class="fixed-item">Affiches INRS</div>
              Cliquer ici
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="action-bar">
      <button class="btn-nav" type="button" onclick="goToPage(4)">‚¨Ö Relire le cas</button>
      <button class="btn-nav btn-reset" type="button" onclick="initPage5()">üîÑ Recommencer</button>
      <button class="btn-nav btn-next" id="btnPage5" type="button" onclick="goToPage(7)">Vers le bilan ‚û°</button>
    </div>
    <div class="footer">√âdition FOUCHER</div>
  </div>

  <div id="page7" class="page-section">
    <h3 style="color:white; text-align:center;">BILAN & AUTO-√âVALUATION</h3>
    <div class="doc-container" style="border-left-color:var(--success); font-size:0.85rem;">
      <h4 style="color:var(--success); margin-top:0;">Ce qu‚Äôil faut retenir</h4>
      <p><strong>L‚Äôergonomie</strong> est centr√©e sur l‚Äôactivit√© de travail de l‚Äôop√©rateur.</p>
      <p><strong>Pr√©vention :</strong> Les mesures se classent de la plus efficace (supprimer/r√©duire) √† la moins efficace (information/formation).</p>
      <p><strong>R√®gle :</strong> privil√©gier la <strong>suppression</strong> ou la <strong>r√©duction</strong> car on agit √† la source.</p>
    </div>
    <div id="finalQuizContainer">
      <h4 style="color:white; text-align:center; margin:20px 0 10px;">Auto-√âvaluation (5 questions)</h4>
    </div>
    <div id="finalScoreBoard" style="display:none; text-align:center; margin-top:20px;">
      <div style="font-size:3rem;">üéâ</div>
      <h3 style="color:white;">Exercice termin√©</h3>
      <p style="color:#cbd5e1;">Tu as termin√© l‚Äôactivit√©.</p>
      <button class="btn-nav btn-reset" type="button" onclick="location.reload()">Recommencer</button>
    </div>
    <div class="footer">√âdition FOUCHER</div>
  </div>

</div>

<script>
let currentSize = 16;
function changeSize(delta) {
  currentSize += delta;
  if (currentSize < 12) currentSize = 12;
  if (currentSize > 24) currentSize = 24;
  document.documentElement.style.fontSize = currentSize + 'px';
  const h1 = document.querySelector('h1');
  if(h1) h1.style.fontSize = (2 * (currentSize/16)) + 'rem';
  try { localStorage.setItem("ui_font_size_px", String(currentSize)); } catch(e) {}
}
(function restoreFont(){
  try{
    const v = parseInt(localStorage.getItem("ui_font_size_px") || "", 10);
    if(!isNaN(v)) { currentSize = v; changeSize(0); }
  }catch(e){}
})();
</script>

<script>
  let currentStep = 1;
  const totalSteps = 6;
  let prevFound = 0; let yassineFound = 0;
  let selectionPrev = null;
  let finalQuizIndex = 0;

  function setCoach(msg) {
    const el = document.getElementById('coachText');
    if(el) el.innerText = msg;
  }

  function startModule() {
    showBackBtn();
    goToPage(1);
    setCoach("Exercice : lis la consigne puis avance.");
  }

  function showBackBtn(){
    const btn = document.getElementById('btnBack');
    if(btn) btn.style.display = 'block';
  }

  function goReturn(){
    try{
      const u = sessionStorage.getItem('pse_return_url');
      if(u){
        location.href = u;
        return;
      }
    }catch(e){}
    history.back();
  }

  function goToPage(pageNum) {
    document.querySelectorAll('.page-section').forEach(p => p.classList.remove('active'));
    const target = document.getElementById('page' + pageNum);
    if(target) target.classList.add('active');
    window.scrollTo(0,0);

    if(pageNum === 2){ resetStepsIfNeeded(); updateButtons(); updateCoach(); }
    if(pageNum === 3) initPage3();
    if(pageNum === 5) initPage5();
    if(pageNum === 7) initPage7();
  }

  function resetStepsIfNeeded(){
    if(currentStep < 1 || currentStep > totalSteps) currentStep = 1;
    for(let i=1;i<=totalSteps;i++){
      const s = document.getElementById(`step${i}`);
      if(s) s.classList.remove('active');
    }
    const s1 = document.getElementById('step1');
    if(s1) s1.classList.add('active');
    currentStep = 1;
    const cursor = document.getElementById('arrowCursor');
    if(cursor) cursor.style.top = '8%';
  }

  function changeStep(direction) {
    const next = currentStep + direction;
    if(next < 1 || next > totalSteps) return;

    const curEl = document.getElementById(`step${currentStep}`);
    if(curEl) curEl.classList.remove('active');

    currentStep = next;

    const nextEl = document.getElementById(`step${currentStep}`);
    if(nextEl) nextEl.classList.add('active');

    const positions = { 1: '8%', 2: '25%', 3: '42%', 4: '58%', 5: '75%', 6: '92%' };
    const cursor = document.getElementById('arrowCursor');
    if(cursor) cursor.style.top = positions[currentStep];

    updateButtons();
    updateCoach();
  }

  function updateButtons() {
    const btnPrev = document.getElementById('btnPrev');
    const btnNext = document.getElementById('btnNext');
    if (!btnPrev || !btnNext) return;

    btnPrev.style.visibility = (currentStep === 1) ? 'hidden' : 'visible';

    if (currentStep === totalSteps) {
      btnNext.innerText = "Je passe √† l‚Äôexercice ‚û°";
      btnNext.onclick = () => goToPage(3);
    } else {
      btnNext.innerText = "Suivant (niveau inf√©rieur) ‚û°";
      btnNext.onclick = () => changeStep(1);
    }
  }

  function updateCoach() {
    const texts = {
      1: "N1 : suppression totale du danger.",
      2: "N2 : r√©duction du risque.",
      3: "N3 : protection collective (EPC).",
      4: "N4 : protection individuelle (EPI).",
      5: "N5 : informations (consignes).",
      6: "N6 : formation (SST, PRAP)."
    };
    setCoach(texts[currentStep] || "Lis et avance.");
  }

  const PREV_OPTS = [
    {id:"auto", txt:"Automatisation du port de plaques"},
    {id:"orga", txt:"R√©organisation / Rotation des postes"},
    {id:"ventouse", txt:"Aide √† la manutention (Ventouse)"},
    {id:"gants", txt:"Gants adapt√©s"},
    {id:"prap", txt:"Formation PRAP"}
  ];

  const YASSINE_DATA = [
    {id: "exo", txt: "Utiliser les exosquelettes", cat: "drop-y-2"},
    {id: "alterne", txt: "Alterner les postes de travail", cat: "drop-y-1"},
    {id: "auto_man", txt: "Automatiser la manutention manuelle", cat: "drop-y-1"},
    {id: "time", txt: "R√©duire les contraintes de temps", cat: "drop-y-1"},
    {id: "epi", txt: "EPI : chaussures, gants, tenue", cat: "drop-y-2"},
    {id: "prap_y", txt: "Formation gestes et postures (PRAP)", cat: "drop-y-3"}
  ];

  const FINAL_QUIZ = [
    { q: "Quelle est la mesure la plus efficace ?", opts: [{ txt: "Mettre un casque", correct: false, feed: "Non : c‚Äôest une protection individuelle." }, { txt: "Supprimer le danger", correct: true, feed: "Oui : agir √† la source." }] },
    { q: "Une barri√®re automatique est une...", opts: [{ txt: "Protection collective", correct: true, feed: "Oui : elle prot√®ge plusieurs personnes." }, { txt: "Protection individuelle", correct: false, feed: "Non." }] },
    { q: "Les EPI (casques, gants) sont...", opts: [{ txt: "La priorit√© absolue", correct: false, feed: "Non : on privil√©gie la suppression/r√©duction." }, { txt: "Un dernier recours", correct: true, feed: "Oui." }] },
    { q: "La formation PRAP sert √†...", opts: [{ txt: "R√©parer les machines", correct: false, feed: "Non." }, { txt: "Apprendre les bons gestes", correct: true, feed: "Oui." }] },
    { q: "Remplacer un produit toxique, c'est...", opts: [{ txt: "R√©duire le risque", correct: true, feed: "Oui." }, { txt: "De la formation", correct: false, feed: "Non." }] }
  ];

  function initPage3(){
    prevFound=0; selectionPrev=null;
    const btn = document.getElementById('btnPage3');
    if(btn) btn.style.display='none';

    const d=document.getElementById('prevDock');
    if(d) d.innerHTML="";

    document.querySelectorAll('#page3 .prev-drop-zone').forEach(z=>{
      z.innerText = "Cliquer ici";
      z.classList.remove('filled');
      z.style.borderColor = "#94a3b8";
      z.style.borderStyle = "dashed";
    });

    PREV_OPTS.slice().sort(()=>Math.random()-0.5).forEach(o=>{
      let b=document.createElement('div');
      b.className='prev-option';
      b.innerText=o.txt;
      b.dataset.id=o.id;
      b.onclick=()=>selectPrevOption(b);
      d.appendChild(b);
    });

    setCoach("Cas 1 : s√©lectionne une mesure puis clique sur la bonne cat√©gorie.");
  }

  function selectPrevOption(b){
    if(selectionPrev) selectionPrev.classList.remove('selected');
    selectionPrev=b;
    b.classList.add('selected');
  }

  function handlePrevClick(z){
    if(!selectionPrev || z.classList.contains('filled')) return;

    const expected = z.dataset.ans || "";
    const picked = selectionPrev.dataset.id || "";
    const isCorrect = (expected === picked);

    if(isCorrect){
      z.innerText = selectionPrev.innerText;
      z.classList.add('filled');
      z.style.borderStyle = "solid";
      selectionPrev.style.display='none';
      selectionPrev=null;
      prevFound++;
      setCoach("Correct.");

      if(prevFound===PREV_OPTS.length){
        setCoach("Tr√®s bien. Passe au cas 2.");
        const btn=document.getElementById('btnPage3');
        if(btn) btn.style.display='block';
      }
    } else {
      setCoach("Non. R√©essaie.");
      z.style.borderColor="red";
      setTimeout(()=>z.style.borderColor="#94a3b8", 500);
    }
  }

  function initPage5() {
    yassineFound = 0; selectionPrev = null;
    const btn = document.getElementById('btnPage5');
    if(btn) btn.style.display='none';

    const d = document.getElementById('yassineDock');
    if(d) d.innerHTML = "";

    const z1 = document.getElementById('drop-y-1');
    const z2 = document.getElementById('drop-y-2');
    const z3 = document.getElementById('drop-y-3');

    if(z1) z1.innerHTML = '<div class="fixed-item">Cr√©er des postes ¬´ cadre vert ¬ª</div><div style="opacity:.85">Cliquer ici</div>';
    if(z2) z2.innerHTML = '<div class="fixed-item">R√©duire les distances de d√©placement</div><div style="opacity:.85">Cliquer ici</div>';
    if(z3) z3.innerHTML = '<div class="fixed-item">Affiches INRS</div><div style="opacity:.85">Cliquer ici</div>';

    document.querySelectorAll('#page5 .prev-drop-zone').forEach(z => {
      z.classList.remove('filled');
      z.style.borderColor = "#94a3b8";
      z.style.borderStyle = "dashed";
    });

    YASSINE_DATA.slice().sort(()=>Math.random()-0.5).forEach(o => {
      let b = document.createElement('div');
      b.className = 'prev-option';
      b.innerText = o.txt;
      b.dataset.id = o.id;
      b.dataset.cat = o.cat;
      b.onclick = () => selectPrevOption(b);
      d.appendChild(b);
    });

    setCoach("Cas 2 : s√©lectionne une solution puis clique sur la bonne cat√©gorie.");
  }

  function handleYassineClick(z) {
    if(!selectionPrev) return;

    if(selectionPrev.dataset.cat === z.id) {
      let p = document.createElement('div');
      p.style.fontSize="0.85rem";
      p.style.margin="3px 0";
      p.style.color = "#0f172a";
      p.style.background = "rgba(255,255,255,0.9)";
      p.style.borderRadius = "6px";
      p.style.padding = "6px 8px";
      p.style.width = "100%";
      p.innerText = selectionPrev.innerText;
      z.appendChild(p);

      z.classList.add('filled');
      z.style.borderStyle = "solid";

      selectionPrev.style.display='none';
      selectionPrev=null;
      yassineFound++;
      setCoach("Bien.");

      if(yassineFound === YASSINE_DATA.length) {
        setCoach("Parfait. Passe au bilan.");
        const btn=document.getElementById('btnPage5');
        if(btn) btn.style.display='block';
      }
    } else {
      setCoach("Non. R√©essaie.");
      z.style.borderColor="red";
      setTimeout(()=>z.style.borderColor="#94a3b8", 500);
    }
  }

  function initPage7(){
    finalQuizIndex=0;
    const c = document.getElementById('finalQuizContainer');
    const b = document.getElementById('finalScoreBoard');
    if(c) c.innerHTML = '<h4 style="color:white; text-align:center; margin:20px 0 10px;">Auto-√âvaluation (5 questions)</h4>';
    if(b) b.style.display = "none";
    setCoach("Bilan : r√©ponds aux 5 questions.");
    showFinalQuestion();
  }

  function showFinalQuestion(){
    const c=document.getElementById('finalQuizContainer');
    if(!c) return;

    if(finalQuizIndex>=FINAL_QUIZ.length){
      c.innerHTML="";
      const board = document.getElementById('finalScoreBoard');
      if(board) board.style.display="block";
      setCoach("Bravo.");
      triggerConfetti();
      return;
    }

    let q=FINAL_QUIZ[finalQuizIndex];
    c.innerHTML += `
      <div class="final-quiz-card">
        <div class="final-q-text">${finalQuizIndex+1}. ${q.q}</div>
        <div id="finalOpts"></div>
      </div>
    `;

    const optsContainer = c.querySelector('#finalOpts');
    q.opts.forEach(o=>{
      let b=document.createElement('div');
      b.className='final-opt-btn';
      b.innerText=o.txt;
      b.onclick=()=>checkFinalAnswer(b,o);
      optsContainer.appendChild(b);
    });
  }

  function checkFinalAnswer(b,o){
    document.querySelectorAll('.final-opt-btn').forEach(btn=>btn.onclick=null);
    if(o.correct){
      b.classList.add('correct');
      setCoach(o.feed);
      setTimeout(()=>{ finalQuizIndex++; showFinalQuestion(); }, 1200);
    } else {
      b.classList.add('wrong');
      setCoach(o.feed);
      setTimeout(()=>{ finalQuizIndex++; showFinalQuestion(); }, 1400);
    }
  }

  function triggerConfetti() {
    const N = 40;
    for(let i=0; i<N; i++) {
      let conf = document.createElement('div');
      conf.className = 'confetti';
      conf.style.left = Math.random() * 100 + 'vw';
      conf.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
      conf.style.animationDuration = (Math.random() * 3 + 2) + 's';
      document.body.appendChild(conf);

      conf.addEventListener('animationend', () => {
        if(conf && conf.parentNode) conf.parentNode.removeChild(conf);
      });
      setTimeout(()=>{ if(conf && conf.parentNode) conf.parentNode.removeChild(conf); }, 6000);
    }
  }

  (function init(){
    updateButtons();
  })();
</script>

</body>
</html>
