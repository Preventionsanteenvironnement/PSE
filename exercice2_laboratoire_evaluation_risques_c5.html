<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module C.5 - Laboratoire √âvaluation Risques - Premi√®re Bac Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=OpenDyslexie&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-pse: #2E86AB;
            --secondary-pse: #A23B72;
            --success-pse: #219653;
            --warning-pse: #F2994A;
            --danger-pse: #EB5757;
            --dark-pse: #2F3542;
            --light-pse: #F1F2F6;
        }

        .competence-c1 { border-left: 5px solid #E74C3C; }
        .competence-c2 { border-left: 5px solid #3498DB; }
        .competence-c3 { border-left: 5px solid #2ECC71; }
        .competence-c4 { border-left: 5px solid #F39C12; }
        .competence-c5 { border-left: 5px solid #9B59B6; }
        .competence-c6 { border-left: 5px solid #1ABC9C; }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #00c6ff 0%, #0072ff 100%);
            min-height: 100vh;
            padding: 15px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        /* EN-T√äTE P√âDAGOGIQUE OBLIGATOIRE */
        .cadre-pedagogique {
            background: linear-gradient(135deg, var(--primary-pse), var(--secondary-pse));
            color: white;
            padding: 25px;
            text-align: center;
        }

        .module-info h2 {
            font-size: 1.8em;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .objectif {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .competences-travaillees {
            margin: 20px 0;
        }

        .competences-list {
            list-style: none;
            margin: 10px 0;
        }

        .competences-list li {
            background: rgba(255,255,255,0.1);
            margin: 8px 0;
            padding: 10px;
            border-radius: 5px;
            border-left: 4px solid #fff;
        }

        .niveau-cible {
            font-weight: 600;
            background: rgba(255,255,255,0.2);
            padding: 10px;
            border-radius: 8px;
        }

        /* EXERCICE PRINCIPAL */
        .exercice-principal {
            padding: 30px;
        }

        .laboratoire-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }

        .laboratoire-header h3::before {
            content: "üî¨";
            margin-right: 10px;
            font-size: 1.5em;
        }

        .situation-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .situation-card {
            background: white;
            border: 3px solid #e9ecef;
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .situation-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
            border-color: var(--primary-pse);
        }

        .situation-card.selected {
            border-color: var(--primary-pse);
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
        }

        .situation-card h4 {
            color: var(--primary-pse);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .situation-card h4::before {
            margin-right: 10px;
            font-size: 1.2em;
        }

        .situation-card.restaurant h4::before { content: "üçΩÔ∏è"; }
        .situation-card.chantier h4::before { content: "üèóÔ∏è"; }
        .situation-card.bureau h4::before { content: "üíº"; }

        .grille-evaluation {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            border: 2px solid var(--primary-pse);
            display: none;
        }

        .grille-evaluation.visible {
            display: block;
            animation: fadeInUp 0.5s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .evaluation-section {
            margin: 20px 0;
        }

        .evaluation-section h5 {
            color: var(--primary-pse);
            margin-bottom: 15px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border-left: 5px solid var(--primary-pse);
        }

        .criteres-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .critere-option {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .critere-option:hover {
            border-color: var(--primary-pse);
            transform: scale(1.02);
        }

        .critere-option.selected {
            border-color: var(--primary-pse);
            background: linear-gradient(135deg, #e3f2fd, #ffffff);
        }

        .critere-option.gravite-1 { border-left-color: #28a745; }
        .critere-option.gravite-2 { border-left-color: #ffc107; }
        .critere-option.gravite-3 { border-left-color: #fd7e14; }
        .critere-option.gravite-4 { border-left-color: #dc3545; }

        .critere-option.prob-1 { border-left-color: #17a2b8; }
        .critere-option.prob-2 { border-left-color: #6c757d; }
        .critere-option.prob-3 { border-left-color: #fd7e14; }
        .critere-option.prob-4 { border-left-color: #dc3545; }

        .matrice-risque {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
        }

        .matrice-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        .matrice-table th,
        .matrice-table td {
            border: 2px solid #dee2e6;
            padding: 12px;
            text-align: center;
            font-weight: 600;
        }

        .matrice-table th {
            background: var(--primary-pse);
            color: white;
        }

        .case-priorite-1 { background: #d4edda; color: #155724; }
        .case-priorite-2 { background: #fff3cd; color: #856404; }
        .case-priorite-3 { background: #f8d7da; color: #721c24; }

        .case-evaluation {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .case-evaluation:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .case-evaluation.selected {
            border: 4px solid #FFA726;
            transform: scale(1.1);
        }

        .instructions-interaction {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid #ffc107;
        }

        .instructions-interaction h5 {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .instructions-interaction h5::before {
            content: "üì±";
            margin-right: 10px;
        }

        .bouton-validation {
            background: linear-gradient(135deg, var(--success-pse), #27ae60);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px auto;
            display: block;
        }

        .bouton-validation:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .bouton-validation:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .sigles-explicatifs {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #2196f3;
        }

        .sigles-explicatifs h4 {
            color: #1976d2;
            margin-bottom: 15px;
        }

        .sigle {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 5px;
        }

        .sigle strong {
            color: #1976d2;
        }

        .resultats-finaux {
            background: linear-gradient(135deg, #e8f5e8, #d4edda);
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
            border: 2px solid var(--success-pse);
            display: none;
        }

        .resultats-finaux.visible {
            display: block;
            animation: fadeInUp 0.5s ease;
        }

        .feedback-card {
            background: linear-gradient(135deg, #2a2a3e, #1e1e2f);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .feedback-explanation {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .correction-explicite {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .progress-competences {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .competence-progress {
            margin: 10px 0;
        }

        .competence-bar {
            background: #e9ecef;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
        }

        .competence-fill {
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .competence-fill.c2 { background: #3498DB; }
        .competence-fill.c3 { background: #2ECC71; }

        .rgpd-notice {
            background: #f8f9fa;
            color: #6c757d;
            text-align: center;
            padding: 15px;
            font-size: 0.9em;
        }

        /* Responsive */
        @media (max-width: 768px) {
            body { padding: 10px; }
            .container { border-radius: 10px; }
            .cadre-pedagogique { padding: 20px; }
            .exercice-principal { padding: 20px; }
            .criteres-grid { grid-template-columns: 1fr; }
            .matrice-table th,
            .matrice-table td { padding: 8px; font-size: 0.9em; }
        }

        @media (min-width: 1024px) {
            .container { max-width: 1200px; }
        }
    </style>
</head>
<body>
    <!-- EN-T√äTE P√âDAGOGIQUE OBLIGATOIRE -->
    <div class="container">
        <div class="cadre-pedagogique">
            <div class="module-info">
                <h2>Module C.5 : L'analyse des risques professionnels</h2>
                <div class="objectif">
                    <strong>Objectif :</strong> S'approprier des outils m√©thodologiques d'analyse des risques en vue d'analyser et d'√©valuer un risque et de proposer des mesures hi√©rarchis√©es de pr√©vention
                </div>
            </div>
            
            <div class="competences-travaillees">
                <h3>Comp√©tences travaill√©es dans cet exercice :</h3>
                <ul class="competences-list">
                    <li><strong>C2</strong> - Appliquer une d√©marche d'analyse dans une situation donn√©e</li>
                    <li><strong>C3</strong> - Expliquer un ph√©nom√®ne en lien avec une mesure de pr√©vention</li>
                </ul>
            </div>
            
            <div class="niveau-cible">
                <strong>Niveau :</strong> Bac Pro Premi√®re
            </div>
        </div>

        <!-- EXERCICE PRINCIPAL -->
        <main class="exercice-principal">
            <div class="laboratoire-header">
                <h3>Laboratoire virtuel d'√©valuation des risques</h3>
                <p><strong>üéØ Mission :</strong> Vous √™tes consultant en pr√©vention des risques. Utilisez les outils d'√©valuation scientifique pour hi√©rarchiser les risques dans trois secteurs d'activit√© diff√©rents.</p>
            </div>

            <div class="sigles-explicatifs">
                <h4>üìö Outils d'√©valuation - Sigles explicites</h4>
                <div class="sigle">
                    <strong>DUERP</strong> = <strong>D</strong>ocument <strong>U</strong>nique d'<strong>√â</strong>valuation des <strong>R</strong>isques <strong>P</strong>rofessionnels
                    <br><em>Document obligatoire qui recense tous les risques identifi√©s dans l'entreprise et leur √©valuation</em>
                </div>
                <div class="sigle">
                    <strong>INRS</strong> = <strong>I</strong>nstitut <strong>N</strong>ational de <strong>R</strong>echerche et de <strong>S</strong>√©curit√©
                    <br><em>Organisme qui √©labore des √©chelles d'estimation des risques utilis√©es par les entreprises</em>
                </div>
                <div class="sigle">
                    <strong>EPI</strong> = <strong>√â</strong>quipement de <strong>P</strong>rotection <strong>I</strong>ndividuelle
                    <br><em>Dispositif destin√© √† prot√©ger une personne contre les risques professionnels</em>
                </div>
            </div>

            <div class="instructions-interaction">
                <h5>üì± COMMENT MANIPULER :</h5>
                <p><strong>1.</strong> Cliquez sur une situation professionnelle pour la s√©lectionner</p>
                <p><strong>2.</strong> Cliquez sur les crit√®res d'√©valuation correspondants</p>
                <p><strong>3.</strong> Placez le risque dans la matrice en cliquant sur la case appropri√©e</p>
            </div>

            <!-- S√âLECTION DE SITUATION -->
            <div class="situation-cards">
                <div class="situation-card restaurant" data-situation="restaurant">
                    <h4>Restaurant gastronomique</h4>
                    <p><strong>Situation :</strong> Cuisinier manipulant des couteaux professionnels tranchants pendant le service du soir</p>
                    <p><strong>Danger :</strong> Coupure profonde aux mains</p>
                    <p><strong>Contexte :</strong> Rythme soutenu, stress, fatigue en fin de service</p>
                </div>

                <div class="situation-card chantier" data-situation="chantier">
                    <h4>Chantier de construction</h4>
                    <p><strong>Situation :</strong> Ouvrier travaillant sur toiture sans harnais de s√©curit√©</p>
                    <p><strong>Danger :</strong> Chute de hauteur (4 m√®tres)</p>
                    <p><strong>Contexte :</strong> Exposition quotidienne, toiture glissante par temps humide</p>
                </div>

                <div class="situation-card bureau" data-situation="bureau">
                    <h4>Bureau d'√©tudes</h4>
                    <p><strong>Situation :</strong> Employ√© travaillant 8h/jour sur ordinateur avec √©cran mal positionn√©</p>
                    <p><strong>Danger :</strong> Troubles musculo-squelettiques (TMS)</p>
                    <p><strong>Contexte :</strong> Position assise prolong√©e, mouvements r√©p√©titifs</p>
                </div>
            </div>

            <!-- GRILLE D'√âVALUATION -->
            <div class="grille-evaluation" id="grille-evaluation">
                <h4>‚öñÔ∏è Grille d'√©valuation des risques (norme INRS)</h4>
                
                <!-- GRAVIT√â -->
                <div class="evaluation-section">
                    <h5>üìä 1. Estimation de la gravit√© du dommage</h5>
                    <div class="criteres-grid">
                        <div class="critere-option gravite-1" data-gravite="1">
                            <strong>1 - Faible</strong><br>
                            Accident sans arr√™t de travail<br>
                            <em>Ex: √©gratignure, petite coupure</em>
                        </div>
                        <div class="critere-option gravite-2" data-gravite="2">
                            <strong>2 - Moyenne</strong><br>
                            Accident avec arr√™t de travail<br>
                            <em>Ex: entorse, fracture simple</em>
                        </div>
                        <div class="critere-option gravite-3" data-gravite="3">
                            <strong>3 - Grave</strong><br>
                            Incapacit√© permanente partielle<br>
                            <em>Ex: amputation, handicap</em>
                        </div>
                        <div class="critere-option gravite-4" data-gravite="4">
                            <strong>4 - Tr√®s grave</strong><br>
                            Accident mortel<br>
                            <em>Ex: d√©c√®s</em>
                        </div>
                    </div>
                </div>

                <!-- PROBABILIT√â -->
                <div class="evaluation-section">
                    <h5>üéØ 2. Estimation de la probabilit√© d'occurrence</h5>
                    <div class="criteres-grid">
                        <div class="critere-option prob-1" data-probabilite="1">
                            <strong>1 - Tr√®s improbable</strong><br>
                            Exposition rare et courte<br>
                            √âv√©nement d√©clencheur peu probable
                        </div>
                        <div class="critere-option prob-2" data-probabilite="2">
                            <strong>2 - Improbable</strong><br>
                            Exposition occasionnelle<br>
                            √âv√©nement d√©clencheur possible
                        </div>
                        <div class="critere-option prob-3" data-probabilite="3">
                            <strong>3 - Probable</strong><br>
                            Exposition fr√©quente<br>
                            √âv√©nement d√©clencheur likely
                        </div>
                        <div class="critere-option prob-4" data-probabilite="4">
                            <strong>4 - Tr√®s probable</strong><br>
                            Exposition permanente<br>
                            √âv√©nement d√©clencheur quasi certain
                        </div>
                    </div>
                </div>

                <!-- MATRICE DE RISQUE -->
                <div class="matrice-risque">
                    <h5>üéØ 3. Matrice d'√©valuation du risque</h5>
                    <p>Cliquez sur la case correspondant au croisement gravit√©/probabilit√© :</p>
                    
                    <table class="matrice-table">
                        <thead>
                            <tr>
                                <th>Probabilit√© ‚Üì / Gravit√© ‚Üí</th>
                                <th>1 - Faible</th>
                                <th>2 - Moyenne</th>
                                <th>3 - Grave</th>
                                <th>4 - Tr√®s grave</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <th>1 - Tr√®s improbable</th>
                                <td class="case-evaluation case-priorite-1" data-matrice="1-1">Priorit√© 3</td>
                                <td class="case-evaluation case-priorite-1" data-matrice="1-2">Priorit√© 3</td>
                                <td class="case-evaluation case-priorite-2" data-matrice="1-3">Priorit√© 2</td>
                                <td class="case-evaluation case-priorite-2" data-matrice="1-4">Priorit√© 2</td>
                            </tr>
                            <tr>
                                <th>2 - Improbable</th>
                                <td class="case-evaluation case-priorite-1" data-matrice="2-1">Priorit√© 3</td>
                                <td class="case-evaluation case-priorite-2" data-matrice="2-2">Priorit√© 2</td>
                                <td class="case-evaluation case-priorite-2" data-matrice="2-3">Priorit√© 2</td>
                                <td class="case-evaluation case-priorite-3" data-matrice="2-4">Priorit√© 1</td>
                            </tr>
                            <tr>
                                <th>3 - Probable</th>
                                <td class="case-evaluation case-priorite-2" data-matrice="3-1">Priorit√© 2</td>
                                <td class="case-evaluation case-priorite-2" data-matrice="3-2">Priorit√© 2</td>
                                <td class="case-evaluation case-priorite-3" data-matrice="3-3">Priorit√© 1</td>
                                <td class="case-evaluation case-priorite-3" data-matrice="3-4">Priorit√© 1</td>
                            </tr>
                            <tr>
                                <th>4 - Tr√®s probable</th>
                                <td class="case-evaluation case-priorite-2" data-matrice="4-1">Priorit√© 2</td>
                                <td class="case-evaluation case-priorite-3" data-matrice="4-2">Priorit√© 1</td>
                                <td class="case-evaluation case-priorite-3" data-matrice="4-3">Priorit√© 1</td>
                                <td class="case-evaluation case-priorite-3" data-matrice="4-4">Priorit√© 1</td>
                            </tr>
                        </tbody>
                    </table>

                    <div style="margin-top: 20px; display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
                        <div style="display: flex; align-items: center;">
                            <div style="width: 20px; height: 20px; background: #f8d7da; border: 1px solid #721c24; margin-right: 8px;"></div>
                            <span>Priorit√© 1 : Action imm√©diate</span>
                        </div>
                        <div style="display: flex; align-items: center;">
                            <div style="width: 20px; height: 20px; background: #fff3cd; border: 1px solid #856404; margin-right: 8px;"></div>
                            <span>Priorit√© 2 : Action √† court terme</span>
                        </div>
                        <div style="display: flex; align-items: center;">
                            <div style="width: 20px; height: 20px; background: #d4edda; border: 1px solid #155724; margin-right: 8px;"></div>
                            <span>Priorit√© 3 : Action √† moyen terme</span>
                        </div>
                    </div>
                </div>

                <button class="bouton-validation" id="btn-valider" onclick="validerEvaluation()" disabled>‚úÖ Valider l'√©valuation</button>
            </div>

            <!-- R√âSULTATS FINAUX -->
            <div class="resultats-finaux" id="resultats-finaux">
                <h4>üìä Synth√®se des √©valuations</h4>
                <div id="synthese-content"></div>
            </div>

            <!-- Zone de feedback -->
            <div id="feedback-zone"></div>

            <div class="progress-competences">
                <h4>üìä Progression des comp√©tences</h4>
                <div class="competence-progress">
                    <label>C2 - Appliquer une d√©marche d'analyse</label>
                    <div class="competence-bar">
                        <div class="competence-fill c2" id="progress-c2" style="width: 0%"></div>
                    </div>
                </div>
                <div class="competence-progress">
                    <label>C3 - Expliquer un ph√©nom√®ne</label>
                    <div class="competence-bar">
                        <div class="competence-fill c3" id="progress-c3" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </main>

        <!-- FOOTER RGPD -->
        <div class="rgpd-notice">
            üîí Conformit√© RGPD : Cet exercice respecte votre anonymat.
        </div>
    </div>

    <script>
        let situationSelectionnee = null;
        let graviteSelectionnee = null;
        let probabiliteSelectionnee = null;
        let caseSelectionnee = null;
        let evaluationsCompletes = [];
        
        // Donn√©es de correction
        const correctionsEvaluation = {
            'restaurant': { gravite: 2, probabilite: 3, matrice: '3-2', priorite: 'Priorit√© 2' },
            'chantier': { gravite: 4, probabilite: 4, matrice: '4-4', priorite: 'Priorit√© 1' },
            'bureau': { gravite: 2, probabilite: 4, matrice: '4-2', priorite: 'Priorit√© 1' }
        };

        document.addEventListener('DOMContentLoaded', function() {
            // Gestion s√©lection situation
            document.querySelectorAll('.situation-card').forEach(card => {
                card.addEventListener('click', function() {
                    selectionnerSituation(this);
                });
            });

            // Gestion s√©lection gravit√©
            document.querySelectorAll('[data-gravite]').forEach(option => {
                option.addEventListener('click', function() {
                    selectionnerGravite(this);
                });
            });

            // Gestion s√©lection probabilit√©
            document.querySelectorAll('[data-probabilite]').forEach(option => {
                option.addEventListener('click', function() {
                    selectionnerProbabilite(this);
                });
            });

            // Gestion s√©lection matrice
            document.querySelectorAll('.case-evaluation').forEach(caseElem => {
                caseElem.addEventListener('click', function() {
                    selectionnerCase(this);
                });
            });
        });

        function selectionnerSituation(card) {
            // D√©s√©lectionner l'ancienne
            document.querySelectorAll('.situation-card').forEach(c => c.classList.remove('selected'));
            
            // S√©lectionner la nouvelle
            card.classList.add('selected');
            situationSelectionnee = card.dataset.situation;
            
            // Afficher la grille d'√©valuation
            document.getElementById('grille-evaluation').classList.add('visible');
            
            // R√©initialiser les s√©lections
            resetSelections();
            
            // Scroll vers la grille
            setTimeout(() => {
                document.getElementById('grille-evaluation').scrollIntoView({ behavior: 'smooth' });
            }, 300);
        }

        function selectionnerGravite(option) {
            // D√©s√©lectionner l'ancienne
            document.querySelectorAll('[data-gravite]').forEach(opt => opt.classList.remove('selected'));
            
            // S√©lectionner la nouvelle
            option.classList.add('selected');
            graviteSelectionnee = parseInt(option.dataset.gravite);
            
            checkValidationReady();
        }

        function selectionnerProbabilite(option) {
            // D√©s√©lectionner l'ancienne
            document.querySelectorAll('[data-probabilite]').forEach(opt => opt.classList.remove('selected'));
            
            // S√©lectionner la nouvelle
            option.classList.add('selected');
            probabiliteSelectionnee = parseInt(option.dataset.probabilite);
            
            checkValidationReady();
        }

        function selectionnerCase(caseElem) {
            // D√©s√©lectionner l'ancienne
            document.querySelectorAll('.case-evaluation').forEach(c => c.classList.remove('selected'));
            
            // S√©lectionner la nouvelle
            caseElem.classList.add('selected');
            caseSelectionnee = caseElem.dataset.matrice;
            
            checkValidationReady();
        }

        function resetSelections() {
            graviteSelectionnee = null;
            probabiliteSelectionnee = null;
            caseSelectionnee = null;
            
            document.querySelectorAll('.selected').forEach(elem => {
                if (!elem.classList.contains('situation-card')) {
                    elem.classList.remove('selected');
                }
            });
            
            document.getElementById('btn-valider').disabled = true;
        }

        function checkValidationReady() {
            const btnValider = document.getElementById('btn-valider');
            if (situationSelectionnee && graviteSelectionnee && probabiliteSelectionnee && caseSelectionnee) {
                btnValider.disabled = false;
            } else {
                btnValider.disabled = true;
            }
        }

        function validerEvaluation() {
            const correction = correctionsEvaluation[situationSelectionnee];
            
            let score = 0;
            let erreurs = [];

            // V√©rification gravit√©
            if (graviteSelectionnee === correction.gravite) {
                score++;
            } else {
                erreurs.push({
                    type: 'gravite',
                    utilisateur: graviteSelectionnee,
                    correct: correction.gravite
                });
            }

            // V√©rification probabilit√©
            if (probabiliteSelectionnee === correction.probabilite) {
                score++;
            } else {
                erreurs.push({
                    type: 'probabilite',
                    utilisateur: probabiliteSelectionnee,
                    correct: correction.probabilite
                });
            }

            // V√©rification matrice
            if (caseSelectionnee === correction.matrice) {
                score++;
            } else {
                erreurs.push({
                    type: 'matrice',
                    utilisateur: caseSelectionnee,
                    correct: correction.matrice
                });
            }

            // Enregistrer l'√©valuation
            evaluationsCompletes.push({
                situation: situationSelectionnee,
                score: score,
                erreurs: erreurs
            });

            // Affichage des corrections
            afficherCorrections(erreurs, score);

            // Mise √† jour de la progression
            updateProgress();

            // Proposer la situation suivante ou afficher les r√©sultats finaux
            if (evaluationsCompletes.length < 3) {
                setTimeout(() => {
                    proposerSituationSuivante();
                }, 3000);
            } else {
                setTimeout(() => {
                    afficherResultatsFinaux();
                }, 3000);
            }
        }

        function afficherCorrections(erreurs, score) {
            const feedbackZone = document.getElementById('feedback-zone');
            const situationNom = {
                'restaurant': 'Restaurant gastronomique',
                'chantier': 'Chantier de construction', 
                'bureau': 'Bureau d\'√©tudes'
            }[situationSelectionnee];

            let feedbackHTML = `
                <div class="feedback-card">
                    <h3>üìä R√©sultats pour : ${situationNom}</h3>
                    <p><strong>Score :</strong> ${score}/3 crit√®res correctement √©valu√©s</p>
                    
                    <div class="feedback-explanation">
                        <h4>üí° Comp√©tences C2 & C3 - D√©marche d'analyse et explication</h4>
                        <p>L'√©valuation des risques suit une m√©thodologie rigoureuse :</p>
                        <ol>
                            <li><strong>Gravit√© :</strong> √âvaluer les cons√©quences potentielles sur la sant√©</li>
                            <li><strong>Probabilit√© :</strong> Estimer la fr√©quence d'exposition et la probabilit√© d'occurrence</li>
                            <li><strong>Hi√©rarchisation :</strong> Croiser gravit√© et probabilit√© pour d√©terminer la priorit√© d'action</li>
                        </ol>
                    </div>
            `;

            if (erreurs.length > 0) {
                feedbackHTML += `<div class="correction-explicite">
                    <h4>‚ùå CORRECTIONS</h4>`;
                
                erreurs.forEach(erreur => {
                    const explication = getExplicationEvaluation(erreur.type, situationSelectionnee, erreur.correct);
                    feedbackHTML += `
                        <div style="margin: 15px 0; padding: 15px; background: #fff; border-radius: 8px;">
                            <strong>‚úÖ ${erreur.type.toUpperCase()} - LA BONNE R√âPONSE √âTAIT :</strong><br>
                            <span style="color: #28a745; font-weight: bold;">${getLibelleCorrection(erreur.type, erreur.correct)}</span><br>
                            <div style="background: #fff3cd; padding: 10px; margin-top: 10px; border-radius: 5px;">
                                <strong>üí° EXPLICATION :</strong> ${explication}
                            </div>
                        </div>
                    `;
                });

                feedbackHTML += `</div>`;
            }

            feedbackHTML += `</div>`;
            feedbackZone.innerHTML = feedbackHTML;
            feedbackZone.scrollIntoView({ behavior: 'smooth' });
        }

        function getLibelleCorrection(type, valeur) {
            if (type === 'gravite') {
                const libelles = {1: '1 - Faible', 2: '2 - Moyenne', 3: '3 - Grave', 4: '4 - Tr√®s grave'};
                return libelles[valeur];
            } else if (type === 'probabilite') {
                const libelles = {1: '1 - Tr√®s improbable', 2: '2 - Improbable', 3: '3 - Probable', 4: '4 - Tr√®s probable'};
                return libelles[valeur];
            } else if (type === 'matrice') {
                return `Case ${valeur} de la matrice`;
            }
            return valeur;
        }

        function getExplicationEvaluation(type, situation, valeurCorrecte) {
            const explications = {
                'restaurant': {
                    'gravite': "Une coupure profonde avec un couteau de cuisine peut n√©cessiter des points de suture et un arr√™t de travail (gravit√© moyenne = 2).",
                    'probabilite': "Le stress et la fatigue en fin de service augmentent significativement le risque de coupure (probabilit√© probable = 3).",
                    'matrice': "Le croisement Probabilit√© 3 / Gravit√© 2 donne une priorit√© 2 (action √† court terme n√©cessaire)."
                },
                'chantier': {
                    'gravite': "Une chute de 4 m√®tres sans protection peut √™tre mortelle ou causer des s√©quelles permanentes graves (gravit√© tr√®s grave = 4).",
                    'probabilite': "Travailler quotidiennement sans harnais sur toiture humide rend l'accident quasi certain (probabilit√© tr√®s probable = 4).",
                    'matrice': "Le croisement Probabilit√© 4 / Gravit√© 4 donne la priorit√© 1 maximum (action imm√©diate imp√©rative)."
                },
                'bureau': {
                    'gravit√©': "Les TMS peuvent entra√Æner des arr√™ts de travail prolong√©s et des incapacit√©s (gravit√© moyenne = 2).",
                    'probabilite': "Travailler 8h/jour dans une mauvaise posture rend les TMS tr√®s probables √† terme (probabilit√© tr√®s probable = 4).",
                    'matrice': "Le croisement Probabilit√© 4 / Gravit√© 2 donne une priorit√© 1 (pr√©vention imm√©diate n√©cessaire)."
                }
            };
            
            return explications[situation][type] || '';
        }

        function proposerSituationSuivante() {
            // R√©initialiser pour la prochaine situation
            document.querySelectorAll('.situation-card').forEach(card => {
                card.classList.remove('selected');
                if (evaluationsCompletes.find(eval => eval.situation === card.dataset.situation)) {
                    card.style.opacity = '0.6';
                    card.style.pointerEvents = 'none';
                }
            });
            
            document.getElementById('grille-evaluation').classList.remove('visible');
            situationSelectionnee = null;
            resetSelections();
            
            // Message d'encouragement
            const feedbackZone = document.getElementById('feedback-zone');
            feedbackZone.innerHTML += `
                <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 10px; text-align: center; margin: 20px 0;">
                    <h4>üéØ Situation ${evaluationsCompletes.length}/3 compl√©t√©e !</h4>
                    <p>S√©lectionnez maintenant une autre situation pour continuer l'√©valuation.</p>
                </div>
            `;
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function afficherResultatsFinaux() {
            const scoreTotal = evaluationsCompletes.reduce((total, eval) => total + eval.score, 0);
            const resultatsFinaux = document.getElementById('resultats-finaux');
            const syntheseContent = document.getElementById('synthese-content');
            
            let syntheseHTML = `
                <div style="text-align: center; margin-bottom: 25px;">
                    <h3 style="color: var(--success-pse);">üèÜ √âvaluation termin√©e !</h3>
                    <p><strong>Score global :</strong> ${scoreTotal}/9 (${Math.round(scoreTotal/9*100)}%)</p>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 20px 0;">
            `;

            evaluationsCompletes.forEach((evaluation, index) => {
                const situationNoms = ['Restaurant gastronomique', 'Chantier de construction', 'Bureau d\'√©tudes'];
                const couleur = evaluation.score >= 2 ? '#28a745' : evaluation.score >= 1 ? '#ffc107' : '#dc3545';
                
                syntheseHTML += `
                    <div style="background: white; padding: 15px; border-radius: 10px; border-left: 5px solid ${couleur};">
                        <h5>${situationNoms[index] || 'Situation ' + (index + 1)}</h5>
                        <p><strong>Score :</strong> ${evaluation.score}/3</p>
                        <p><strong>R√©sultat :</strong> ${evaluation.score >= 2 ? '‚úÖ Ma√Ætris√©' : evaluation.score >= 1 ? '‚ö†Ô∏è √Ä am√©liorer' : '‚ùå √Ä retravailler'}</p>
                    </div>
                `;
            });

            syntheseHTML += `
                </div>
                
                <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; border-left: 5px solid #2196f3;">
                    <h4>üéØ Bilan des comp√©tences</h4>
                    <p><strong>C2 - D√©marche d'analyse :</strong> Capacit√© √† appliquer m√©thodiquement les grilles d'√©valuation INRS</p>
                    <p><strong>C3 - Explication des ph√©nom√®nes :</strong> Compr√©hension des liens entre exposition, gravit√© et priorit√© de pr√©vention</p>
                    
                    <div style="background: #fff; padding: 15px; border-radius: 8px; margin-top: 15px;">
                        <h5>üéØ Astuce BAC</h5>
                        <p>L'√©valuation des risques est syst√©matiquement demand√©e aux √©preuves. Ma√Ætrisez la logique Gravit√© √ó Probabilit√© = Priorit√© et sachez justifier vos choix avec des arguments scientifiques pr√©cis.</p>
                    </div>
                </div>
            `;

            syntheseContent.innerHTML = syntheseHTML;
            resultatsFinaux.classList.add('visible');
            resultatsFinaux.scrollIntoView({ behavior: 'smooth' });
        }

        function updateProgress() {
            const scoreTotal = evaluationsCompletes.reduce((total, eval) => total + eval.score, 0);
            const pourcentageC2 = Math.min((scoreTotal / 9) * 100, 100);
            const pourcentageC3 = Math.min(((scoreTotal + evaluationsCompletes.length) / 12) * 100, 100);
            
            document.getElementById('progress-c2').style.width = pourcentageC2 + '%';
            document.getElementById('progress-c3').style.width = pourcentageC3 + '%';
        }
    </script>
</body>
</html>