<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flashcards C11 - Analyse d'une situation de travail</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }
        
        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .btn-back {
            background: rgba(255,255,255,0.1);
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            border: 2px solid rgba(255,255,255,0.2);
        }
        
        .btn-back:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }
        
        .score-bar {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 50px;
        }
        
        .score-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .score-item .icon {
            font-size: 18px;
        }
        
        /* √âcrans */
        .screen {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .screen.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* √âcran d'accueil */
        .welcome-screen {
            text-align: center;
            padding: 30px 0;
        }
        
        .welcome-title {
            font-size: 42px;
            font-weight: 900;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .welcome-subtitle {
            font-size: 18px;
            color: rgba(255,255,255,0.7);
            margin-bottom: 30px;
        }
        
        /* Objectifs */
        .objectifs-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3));
            border: 2px solid rgba(102, 126, 234, 0.5);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            text-align: left;
        }
        
        .objectifs-card h3 {
            font-size: 18px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .objectif-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            font-size: 14px;
            line-height: 1.5;
        }
        
        .objectif-item:last-child {
            border-bottom: none;
        }
        
        .objectif-item .check {
            color: #4CAF50;
            font-size: 18px;
            flex-shrink: 0;
        }
        
        .competences-row {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .comp-badge {
            background: rgba(255,255,255,0.15);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
        }
        
        .comp-badge.c1 { background: rgba(16, 185, 129, 0.3); border: 1px solid #10b981; }
        .comp-badge.c2 { background: rgba(102, 126, 234, 0.3); border: 1px solid #667eea; }
        .comp-badge.c3 { background: rgba(245, 158, 11, 0.3); border: 1px solid #f59e0b; }
        .comp-badge.c4 { background: rgba(239, 68, 68, 0.3); border: 1px solid #ef4444; }
        
        /* Niveaux */
        .niveaux-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 25px;
        }
        
        .niveau-card {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .niveau-card:hover:not(.locked) {
            background: rgba(255,255,255,0.1);
            transform: translateX(5px);
            border-color: rgba(102, 126, 234, 0.5);
        }
        
        .niveau-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .niveau-card.completed {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }
        
        .niveau-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            flex-shrink: 0;
        }
        
        .niveau-card:nth-child(1) .niveau-icon { background: linear-gradient(135deg, #667eea, #764ba2); }
        .niveau-card:nth-child(2) .niveau-icon { background: linear-gradient(135deg, #f093fb, #f5576c); }
        .niveau-card:nth-child(3) .niveau-icon { background: linear-gradient(135deg, #4facfe, #00f2fe); }
        .niveau-card:nth-child(4) .niveau-icon { background: linear-gradient(135deg, #43e97b, #38f9d7); }
        .niveau-card:nth-child(5) .niveau-icon { background: linear-gradient(135deg, #fa709a, #fee140); }
        
        .niveau-info {
            flex: 1;
        }
        
        .niveau-info h4 {
            font-size: 16px;
            margin-bottom: 4px;
        }
        
        .niveau-info p {
            font-size: 12px;
            color: rgba(255,255,255,0.6);
        }
        
        .niveau-progress {
            width: 80px;
            text-align: right;
        }
        
        .niveau-progress .percent {
            font-size: 18px;
            font-weight: 700;
        }
        
        .progress-mini {
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .progress-mini-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        
        .lock-icon {
            font-size: 24px;
            color: rgba(255,255,255,0.3);
        }
        
        /* √âcran de jeu */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .game-title {
            font-size: 20px;
            font-weight: 700;
        }
        
        .game-progress {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-counter {
            font-size: 14px;
            color: rgba(255,255,255,0.7);
        }
        
        .progress-bar {
            width: 150px;
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }
        
        /* Carte */
        .flashcard {
            background: linear-gradient(145deg, #1e1e2f, #2a2a40);
            border-radius: 25px;
            padding: 35px;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            border: 2px solid rgba(255,255,255,0.1);
            position: relative;
            overflow: hidden;
        }
        
        .card-type {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.1);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .card-competence {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
        }
        
        .question-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            text-align: center;
            padding: 20px 0;
        }
        
        .question-text {
            font-size: 22px;
            font-weight: 600;
            line-height: 1.5;
            margin-bottom: 25px;
        }
        
        .question-text .highlight {
            color: #f093fb;
            font-weight: 700;
        }
        
        /* Input mot-cl√© */
        .keyword-input-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        .keyword-input {
            background: rgba(255,255,255,0.1);
            border: 3px solid rgba(255,255,255,0.2);
            border-radius: 15px;
            padding: 18px 25px;
            font-size: 24px;
            font-weight: 700;
            color: white;
            text-align: center;
            width: 100%;
            max-width: 350px;
            font-family: inherit;
            transition: all 0.3s ease;
            text-transform: lowercase;
        }
        
        .keyword-input:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }
        
        .keyword-input::placeholder {
            color: rgba(255,255,255,0.3);
            font-weight: 400;
        }
        
        .hint-text {
            font-size: 14px;
            color: rgba(255,255,255,0.5);
        }
        
        .hint-text strong {
            color: #f093fb;
        }
        
        /* Options QCM */
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
        }
        
        .option-btn {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.15);
            border-radius: 12px;
            padding: 16px 20px;
            color: white;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .option-btn:hover {
            background: rgba(102, 126, 234, 0.2);
            border-color: rgba(102, 126, 234, 0.5);
            transform: translateX(5px);
        }
        
        .option-btn.selected {
            background: rgba(102, 126, 234, 0.3);
            border-color: #667eea;
        }
        
        .option-btn.correct {
            background: rgba(76, 175, 80, 0.3);
            border-color: #4CAF50;
        }
        
        .option-btn.incorrect {
            background: rgba(244, 67, 54, 0.3);
            border-color: #f44336;
        }
        
        .option-letter {
            width: 30px;
            height: 30px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            flex-shrink: 0;
        }
        
        /* Vrai/Faux */
        .vf-container {
            display: flex;
            gap: 20px;
            justify-content: center;
        }
        
        .vf-btn {
            width: 140px;
            height: 80px;
            border-radius: 15px;
            border: 3px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.05);
            color: white;
            font-size: 20px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .vf-btn:hover {
            transform: scale(1.05);
        }
        
        .vf-btn.vrai:hover { background: rgba(76, 175, 80, 0.3); border-color: #4CAF50; }
        .vf-btn.faux:hover { background: rgba(244, 67, 54, 0.3); border-color: #f44336; }
        
        .vf-btn.selected.vrai { background: rgba(76, 175, 80, 0.3); border-color: #4CAF50; }
        .vf-btn.selected.faux { background: rgba(244, 67, 54, 0.3); border-color: #f44336; }
        
        /* Classement */
        .ranking-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
        }
        
        .ranking-item {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.15);
            border-radius: 12px;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: grab;
            transition: all 0.3s ease;
        }
        
        .ranking-item:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .ranking-item.dragging {
            opacity: 0.5;
            transform: scale(1.02);
        }
        
        .ranking-number {
            width: 35px;
            height: 35px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            flex-shrink: 0;
        }
        
        .ranking-text {
            flex: 1;
            font-size: 14px;
        }
        
        .drag-handle {
            color: rgba(255,255,255,0.3);
            font-size: 20px;
        }
        
        /* Boutons action */
        .action-row {
            display: flex;
            gap: 12px;
            margin-top: 25px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 14px 30px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 2px solid rgba(255,255,255,0.2);
        }
        
        .btn-secondary:hover {
            background: rgba(255,255,255,0.15);
        }
        
        .btn-hint {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
            border: 2px solid rgba(245, 158, 11, 0.3);
        }
        
        .btn-hint:hover {
            background: rgba(245, 158, 11, 0.3);
        }
        
        /* Feedback */
        .feedback-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .feedback-overlay.visible {
            display: flex;
            animation: fadeIn 0.3s ease;
        }
        
        .feedback-card {
            background: linear-gradient(145deg, #1e1e2f, #2a2a40);
            border-radius: 25px;
            padding: 35px;
            max-width: 500px;
            width: 100%;
            text-align: center;
            border: 3px solid;
        }
        
        .feedback-card.correct {
            border-color: #4CAF50;
        }
        
        .feedback-card.incorrect {
            border-color: #f44336;
        }
        
        .feedback-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }
        
        .feedback-title {
            font-size: 28px;
            font-weight: 900;
            margin-bottom: 10px;
        }
        
        .feedback-card.correct .feedback-title { color: #4CAF50; }
        .feedback-card.incorrect .feedback-title { color: #f44336; }
        
        .feedback-points {
            font-size: 18px;
            color: #f59e0b;
            margin-bottom: 20px;
        }
        
        .feedback-explanation {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            text-align: left;
            margin-bottom: 20px;
        }
        
        .feedback-explanation h4 {
            font-size: 14px;
            color: #667eea;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .feedback-explanation p {
            font-size: 14px;
            line-height: 1.6;
            color: rgba(255,255,255,0.8);
        }
        
        .keyword-box {
            background: rgba(102, 126, 234, 0.2);
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 10px 15px;
            margin-top: 12px;
            display: inline-block;
        }
        
        .keyword-box span {
            font-weight: 700;
            color: #f093fb;
        }
        
        .tip-box {
            background: rgba(245, 158, 11, 0.1);
            border-left: 4px solid #f59e0b;
            border-radius: 8px;
            padding: 12px 15px;
            margin-top: 15px;
            text-align: left;
        }
        
        .tip-box h5 {
            font-size: 12px;
            color: #f59e0b;
            margin-bottom: 5px;
        }
        
        .tip-box p {
            font-size: 13px;
            color: rgba(255,255,255,0.7);
        }
        
        /* Streak */
        .streak-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #f093fb, #f5576c);
            padding: 20px 40px;
            border-radius: 20px;
            font-size: 24px;
            font-weight: 900;
            z-index: 1001;
            display: none;
            animation: streakPop 0.5s ease;
        }
        
        @keyframes streakPop {
            0% { transform: translate(-50%, -50%) scale(0); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }
        
        /* √âcran r√©sultats */
        .results-screen {
            text-align: center;
            padding: 30px 0;
        }
        
        .results-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }
        
        .results-title {
            font-size: 36px;
            font-weight: 900;
            margin-bottom: 10px;
        }
        
        .results-score {
            font-size: 60px;
            font-weight: 900;
            background: linear-gradient(135deg, #667eea, #764ba2, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 20px 0;
        }
        
        .results-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .stat-item {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px 30px;
            min-width: 120px;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 900;
            color: #667eea;
        }
        
        .stat-label {
            font-size: 12px;
            color: rgba(255,255,255,0.6);
            margin-top: 5px;
        }
        
        .errors-recap {
            background: rgba(244, 67, 54, 0.1);
            border: 2px solid rgba(244, 67, 54, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 25px 0;
            text-align: left;
        }
        
        .errors-recap h4 {
            color: #f44336;
            margin-bottom: 12px;
            font-size: 16px;
        }
        
        .errors-recap ul {
            margin-left: 20px;
            font-size: 14px;
            color: rgba(255,255,255,0.7);
        }
        
        .errors-recap li {
            margin: 8px 0;
        }
        
        /* Confettis */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            top: -10px;
            z-index: 1002;
            animation: confettiFall 3s ease-out forwards;
        }
        
        @keyframes confettiFall {
            to {
                top: 100vh;
                transform: rotate(720deg);
            }
        }
        
        /* Responsive */
        @media (max-width: 600px) {
            .welcome-title { font-size: 32px; }
            .question-text { font-size: 18px; }
            .flashcard { padding: 25px; min-height: 350px; }
            .keyword-input { font-size: 20px; padding: 15px 20px; }
            .vf-container { gap: 12px; }
            .vf-btn { width: 120px; height: 70px; font-size: 16px; }
            .results-score { font-size: 48px; }
        }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div class="container">
        
        <!-- Header -->
        <div class="header">
            <a href="javascript:history.back()" class="btn-back">‚¨ÖÔ∏è Retour</a>
            <div class="score-bar" id="scoreBar">
                <div class="score-item">
                    <span class="icon">‚≠ê</span>
                    <span id="totalPoints">0</span> pts
                </div>
                <div class="score-item">
                    <span class="icon">üî•</span>
                    <span id="currentStreak">0</span>
                </div>
            </div>
        </div>
        
        <!-- √âCRAN ACCUEIL -->
        <div class="screen active" id="homeScreen">
            <div class="welcome-screen">
                <h1 class="welcome-title">üé¥ FLASHCARDS C11</h1>
                <p class="welcome-subtitle">Analyse d'une situation de travail</p>
                
                <div class="objectifs-card">
                    <h3>üéØ Objectifs - √ätre capable de :</h3>
                    <div class="objectif-item">
                        <span class="check">‚úì</span>
                        <span><strong>D√©finir</strong> les notions cl√©s : d√©terminant, effet, travail prescrit/r√©el, t√¢che, activit√©</span>
                    </div>
                    <div class="objectif-item">
                        <span class="check">‚úì</span>
                        <span><strong>Compl√©ter</strong> un sch√©ma de compr√©hension (6 composantes)</span>
                    </div>
                    <div class="objectif-item">
                        <span class="check">‚úì</span>
                        <span><strong>√âtablir</strong> les liens de causalit√© (m√©thode ascendante)</span>
                    </div>
                    <div class="objectif-item">
                        <span class="check">‚úì</span>
                        <span><strong>Proposer</strong> des mesures de pr√©vention adapt√©es (5 niveaux)</span>
                    </div>
                    
                    <div class="competences-row">
                        <span class="comp-badge c1">C1 - Analyser</span>
                        <span class="comp-badge c2">C2 - Mobiliser</span>
                        <span class="comp-badge c3">C3 - Diagnostiquer</span>
                        <span class="comp-badge c4">C4 - Proposer</span>
                    </div>
                </div>
                
                <div class="niveaux-grid">
                    <div class="niveau-card" onclick="startLevel(1)">
                        <div class="niveau-icon">üî§</div>
                        <div class="niveau-info">
                            <h4>Niveau 1 : Vocabulaire</h4>
                            <p>D√©terminant, effet, prescrit, r√©el, t√¢che, activit√©</p>
                        </div>
                        <div class="niveau-progress">
                            <span class="percent" id="level1Percent">0%</span>
                            <div class="progress-mini">
                                <div class="progress-mini-fill" id="level1Bar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="niveau-card" id="level2Card" onclick="startLevel(2)">
                        <div class="niveau-icon">üß©</div>
                        <div class="niveau-info">
                            <h4>Niveau 2 : Le sch√©ma</h4>
                            <p>Les 6 composantes du sch√©ma de compr√©hension</p>
                        </div>
                        <div class="niveau-progress">
                            <span class="percent" id="level2Percent">0%</span>
                            <div class="progress-mini">
                                <div class="progress-mini-fill" id="level2Bar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="niveau-card" id="level3Card" onclick="startLevel(3)">
                        <div class="niveau-icon">üîó</div>
                        <div class="niveau-info">
                            <h4>Niveau 3 : Causalit√©</h4>
                            <p>M√©thode ascendante, fl√®ches, hypoth√®se</p>
                        </div>
                        <div class="niveau-progress">
                            <span class="percent" id="level3Percent">0%</span>
                            <div class="progress-mini">
                                <div class="progress-mini-fill" id="level3Bar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="niveau-card" id="level4Card" onclick="startLevel(4)">
                        <div class="niveau-icon">üõ°Ô∏è</div>
                        <div class="niveau-info">
                            <h4>Niveau 4 : Pr√©vention</h4>
                            <p>5 niveaux, EPC/EPI, formations</p>
                        </div>
                        <div class="niveau-progress">
                            <span class="percent" id="level4Percent">0%</span>
                            <div class="progress-mini">
                                <div class="progress-mini-fill" id="level4Bar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="niveau-card" id="level5Card" onclick="startLevel(5)">
                        <div class="niveau-icon">üèÜ</div>
                        <div class="niveau-info">
                            <h4>Niveau 5 : Quiz final</h4>
                            <p>Tout m√©lang√© - Mode d√©fi !</p>
                        </div>
                        <div class="niveau-progress">
                            <span class="percent" id="level5Percent">0%</span>
                            <div class="progress-mini">
                                <div class="progress-mini-fill" id="level5Bar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- √âCRAN JEU -->
        <div class="screen" id="gameScreen">
            <div class="game-header">
                <h3 class="game-title" id="levelTitle">Niveau 1</h3>
                <div class="game-progress">
                    <span class="card-counter"><span id="currentCard">1</span>/<span id="totalCards">10</span></span>
                    <div class="progress-bar">
                        <div class="progress-fill" id="gameProgress" style="width: 0%"></div>
                    </div>
                </div>
            </div>
            
            <div class="flashcard" id="flashcard">
                <div class="card-competence comp-badge c1" id="cardCompetence">C1</div>
                <div class="card-type" id="cardType">MOT-CL√â</div>
                
                <div class="question-section" id="questionSection">
                    <!-- Contenu dynamique -->
                </div>
                
                <div class="action-row" id="actionRow">
                    <button class="btn btn-hint" onclick="showHint()">üí° Indice</button>
                    <button class="btn btn-primary" id="validateBtn" onclick="validateAnswer()">Valider ‚úì</button>
                </div>
            </div>
        </div>
        
        <!-- √âCRAN R√âSULTATS -->
        <div class="screen" id="resultsScreen">
            <div class="results-screen">
                <div class="results-icon" id="resultsIcon">üéâ</div>
                <h2 class="results-title" id="resultsTitle">Niveau termin√© !</h2>
                <div class="results-score" id="resultsScore">85%</div>
                
                <div class="results-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="correctCount">8</div>
                        <div class="stat-label">Bonnes r√©ponses</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="pointsEarned">+120</div>
                        <div class="stat-label">Points gagn√©s</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="bestStreak">5</div>
                        <div class="stat-label">Meilleur streak</div>
                    </div>
                </div>
                
                <div class="errors-recap" id="errorsRecap">
                    <h4>üìù Notions √† revoir :</h4>
                    <ul id="errorsList"></ul>
                </div>
                
                <div class="action-row">
                    <button class="btn btn-secondary" onclick="goHome()">üè† Accueil</button>
                    <button class="btn btn-primary" id="nextLevelBtn" onclick="nextLevel()">Niveau suivant ‚Üí</button>
                </div>
            </div>
        </div>
        
        <!-- FEEDBACK OVERLAY -->
        <div class="feedback-overlay" id="feedbackOverlay">
            <div class="feedback-card" id="feedbackCard">
                <div class="feedback-icon" id="feedbackIcon">‚úÖ</div>
                <h3 class="feedback-title" id="feedbackTitle">Bravo !</h3>
                <div class="feedback-points" id="feedbackPoints">+10 points</div>
                
                <div class="feedback-explanation" id="feedbackExplanation">
                    <!-- Contenu dynamique -->
                </div>
                
                <button class="btn btn-primary" onclick="nextCard()">Suivant ‚Üí</button>
            </div>
        </div>
        
        <!-- STREAK POPUP -->
        <div class="streak-popup" id="streakPopup"></div>
        
    </div>

    <script>
        // === DONN√âES ===
        let totalPoints = 0;
        let currentStreak = 0;
        let bestStreak = 0;
        let currentLevel = 1;
        let currentCardIndex = 0;
        let levelCorrect = 0;
        let levelPoints = 0;
        let levelErrors = [];
        let levelProgress = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 };
        let hintUsed = false;
        
        // Questions par niveau
        const levels = {
            1: { // Vocabulaire
                title: "Niveau 1 : Vocabulaire",
                competence: "C1",
                cards: [
                    {
                        type: "keyword",
                        question: "Comment appelle-t-on un √©l√©ment qui <span class='highlight'>caract√©rise l'op√©rateur</span> (√¢ge, taille, dipl√¥me) ?",
                        answer: "d√©terminant",
                        hint: "D _ _ _ _ _ _ _ _ _ _ (11 lettres)",
                        explanation: "Un D√âTERMINANT est un √©l√©ment qui caract√©rise soit l'op√©rateur, soit l'entreprise. Il existe AVANT le travail.",
                        keyword: "D√©terminant = caract√©ristique",
                        tip: "Au bac, on te demande souvent de distinguer d√©terminant op√©rateur et d√©terminant entreprise."
                    },
                    {
                        type: "keyword",
                        question: "Comment appelle-t-on une <span class='highlight'>cons√©quence</span> (positive ou n√©gative) du travail r√©el ?",
                        answer: "effet",
                        hint: "E _ _ _ _ (5 lettres)",
                        explanation: "Un EFFET est ce que le travail r√©el PROVOQUE sur l'op√©rateur ou sur l'entreprise.",
                        keyword: "Effet = cons√©quence",
                        tip: "Exemples d'effets : TMS, fatigue, satisfaction, absent√©isme, productivit√©..."
                    },
                    {
                        type: "vf",
                        question: "Le travail <span class='highlight'>prescrit</span> = ce que l'op√©rateur fait r√©ellement.",
                        answer: false,
                        explanation: "FAUX ! Le travail PRESCRIT = ce que l'entreprise DEMANDE. Le travail R√âEL = ce que l'op√©rateur FAIT vraiment.",
                        keyword: "Prescrit = demand√© / R√©el = fait",
                        tip: "Retiens : Prescrit vient de 'prescription' = une consigne, un ordre."
                    },
                    {
                        type: "keyword",
                        question: "Comment appelle-t-on <span class='highlight'>CE QUE</span> fait l'op√©rateur (actions sur les objets) ?",
                        answer: "t√¢che",
                        hint: "T _ _ _ _ (5 lettres)",
                        explanation: "La T√ÇCHE = ce que fait l'op√©rateur (les actions). Ex: soulever un colis, nettoyer une surface.",
                        keyword: "T√¢che = CE QUE (action)",
                        tip: "La t√¢che r√©pond √† la question QUOI ?"
                    },
                    {
                        type: "keyword",
                        question: "Comment appelle-t-on <span class='highlight'>COMMENT</span> l'op√©rateur r√©alise la t√¢che (postures, gestes) ?",
                        answer: "activit√©",
                        hint: "A _ _ _ _ _ _ _ (8 lettres)",
                        explanation: "L'ACTIVIT√â = comment l'op√©rateur fait la t√¢che. Ex: dos courb√©, bras en hauteur, √† genoux.",
                        keyword: "Activit√© = COMMENT (posture)",
                        tip: "L'activit√© r√©pond √† la question COMMENT ?"
                    },
                    {
                        type: "qcm",
                        question: "Que signifie <span class='highlight'>QQOAC</span> ?",
                        options: [
                            "Qui ? Quoi ? O√π ? Avec quoi ? Comment ?",
                            "Quand ? Qui ? O√π ? √Ä qui ? Combien ?",
                            "Que ? Quoi ? O√π ? Avant ? Comme ?",
                            "Qui ? Que ? Ou ? Avant ? Cons√©quence ?"
                        ],
                        answer: 0,
                        explanation: "QQOAC = Qui ? Quoi ? O√π ? Avec quoi ? Comment ? C'est la m√©thode pour recueillir les informations sur une situation de travail.",
                        keyword: "QQOAC = recueil d'informations",
                        tip: "Cette m√©thode s'utilise en 1√®re √©tape, AVANT de remplir le sch√©ma."
                    },
                    {
                        type: "qcm",
                        question: "¬´ Yassine, 24 ans, CAP logistique ¬ª est un exemple de :",
                        options: [
                            "Effet sur l'op√©rateur",
                            "D√©terminant op√©rateur",
                            "D√©terminant entreprise",
                            "Travail prescrit"
                        ],
                        answer: 1,
                        explanation: "L'√¢ge, le dipl√¥me et les caract√©ristiques personnelles sont des D√âTERMINANTS OP√âRATEUR (ce qui caract√©rise la personne).",
                        keyword: "√Çge, dipl√¥me = d√©terminant op√©rateur",
                        tip: "Ce qui caract√©rise l'op√©rateur = d√©terminant op√©rateur."
                    },
                    {
                        type: "qcm",
                        question: "¬´ Entrep√¥t de 75 000 m¬≤, l√®ve-personne, cadence 80 colis/h ¬ª sont des :",
                        options: [
                            "Effets sur l'entreprise",
                            "D√©terminants op√©rateur",
                            "D√©terminants entreprise",
                            "Activit√©s"
                        ],
                        answer: 2,
                        explanation: "Le lieu, le mat√©riel et l'organisation du travail sont des D√âTERMINANTS ENTREPRISE (ce que l'entreprise met √† disposition).",
                        keyword: "Lieu, mat√©riel, cadence = d√©terminant entreprise",
                        tip: "Ce que l'entreprise fournit/impose = d√©terminant entreprise."
                    },
                    {
                        type: "vf",
                        question: "¬´ Lombalgies ¬ª et ¬´ arr√™ts maladie ¬ª sont des <span class='highlight'>effets sur l'op√©rateur</span>.",
                        answer: true,
                        explanation: "VRAI ! Les probl√®mes de sant√© (TMS, fatigue, stress) et leurs cons√©quences (arr√™ts) sont des effets SUR L'OP√âRATEUR.",
                        keyword: "Sant√© = effet op√©rateur",
                        tip: "Tout ce qui touche √† la sant√© de la personne = effet op√©rateur."
                    },
                    {
                        type: "keyword",
                        question: "Comment appelle-t-on la personne qui effectue le travail dans une situation analys√©e ?",
                        answer: "op√©rateur",
                        hint: "O _ _ _ _ _ _ _ _ (9 lettres)",
                        explanation: "L'OP√âRATEUR est la personne qui r√©alise le travail. On l'appelle aussi 'salari√©' ou 'travailleur'.",
                        keyword: "Op√©rateur = travailleur",
                        tip: "Dans le sch√©ma de compr√©hension, on parle toujours d'op√©rateur."
                    }
                ]
            },
            2: { // Sch√©ma
                title: "Niveau 2 : Le sch√©ma",
                competence: "C1",
                cards: [
                    {
                        type: "qcm",
                        question: "Combien de <span class='highlight'>composantes</span> contient le sch√©ma de compr√©hension ?",
                        options: ["4 composantes", "5 composantes", "6 composantes", "8 composantes"],
                        answer: 2,
                        explanation: "Le sch√©ma de compr√©hension contient 6 COMPOSANTES : d√©terminants op√©rateur, d√©terminants entreprise, travail prescrit, travail r√©el (t√¢ches + activit√©s), effets op√©rateur, effets entreprise.",
                        keyword: "6 composantes",
                        tip: "Retiens : 2 d√©terminants + 1 prescrit + 1 r√©el + 2 effets = 6"
                    },
                    {
                        type: "keyword",
                        question: "Dans le sch√©ma, o√π place-t-on l'√¢ge, la taille et le dipl√¥me de l'op√©rateur ?",
                        answer: "d√©terminant",
                        hint: "D _ _ _ _ _ _ _ _ _ _ op√©rateur",
                        explanation: "L'√¢ge, la taille, le dipl√¥me, l'exp√©rience sont des caract√©ristiques de l'op√©rateur = D√âTERMINANTS OP√âRATEUR.",
                        keyword: "Caract√©ristiques personnelles = d√©terminant op√©rateur",
                        tip: "Case en haut √† gauche du sch√©ma."
                    },
                    {
                        type: "keyword",
                        question: "Dans le sch√©ma, o√π place-t-on le mat√©riel, les horaires et l'environnement de travail ?",
                        answer: "d√©terminant",
                        hint: "D _ _ _ _ _ _ _ _ _ _ entreprise",
                        explanation: "Le mat√©riel, l'organisation, l'environnement sont ce que l'entreprise met √† disposition = D√âTERMINANTS ENTREPRISE.",
                        keyword: "Mat√©riel, organisation = d√©terminant entreprise",
                        tip: "Case en haut √† droite du sch√©ma."
                    },
                    {
                        type: "vf",
                        question: "Le <span class='highlight'>travail r√©el</span> comprend les t√¢ches ET les activit√©s.",
                        answer: true,
                        explanation: "VRAI ! Travail r√©el = T√ÇCHES (ce que fait l'op√©rateur) + ACTIVIT√âS (comment il le fait).",
                        keyword: "Travail r√©el = t√¢ches + activit√©s",
                        tip: "Au centre du sch√©ma, la case 'travail r√©el' est divis√©e en deux."
                    },
                    {
                        type: "qcm",
                        question: "¬´ Se pencher dos courb√© pour soulever un colis ¬ª est :",
                        options: [
                            "Un d√©terminant",
                            "Une t√¢che uniquement",
                            "Une t√¢che + une activit√©",
                            "Un effet"
                        ],
                        answer: 2,
                        explanation: "SOULEVER = t√¢che (l'action) / DOS COURB√â = activit√© (la posture). C'est du TRAVAIL R√âEL.",
                        keyword: "Action + posture = travail r√©el",
                        tip: "Quand tu vois une action avec une posture, c'est du travail r√©el."
                    },
                    {
                        type: "keyword",
                        question: "O√π place-t-on ¬´ absent√©isme ¬ª, ¬´ turnover ¬ª, ¬´ co√ªt des AT/MP ¬ª dans le sch√©ma ?",
                        answer: "effet",
                        hint: "E _ _ _ _ entreprise",
                        explanation: "L'absent√©isme, le turnover, les co√ªts sont des cons√©quences pour l'entreprise = EFFETS ENTREPRISE.",
                        keyword: "Co√ªts, absent√©isme = effet entreprise",
                        tip: "Case en bas √† droite du sch√©ma."
                    },
                    {
                        type: "qcm",
                        question: "¬´ Pr√©parer 80 commandes par heure ¬ª est un exemple de :",
                        options: [
                            "Travail prescrit",
                            "Travail r√©el",
                            "Effet op√©rateur",
                            "D√©terminant op√©rateur"
                        ],
                        answer: 0,
                        explanation: "C'est une CONSIGNE donn√©e par l'entreprise = TRAVAIL PRESCRIT (ce que l'entreprise demande).",
                        keyword: "Consigne, objectif = travail prescrit",
                        tip: "Le prescrit vient de la hi√©rarchie, des proc√©dures, des fiches de poste."
                    },
                    {
                        type: "vf",
                        question: "Les <span class='highlight'>effets</span> peuvent √™tre positifs OU n√©gatifs.",
                        answer: true,
                        explanation: "VRAI ! Effet n√©gatif : TMS, stress. Effet positif : satisfaction, comp√©tences acquises, productivit√©.",
                        keyword: "Effet = positif ou n√©gatif",
                        tip: "N'oublie pas les effets positifs dans tes analyses !"
                    }
                ]
            },
            3: { // Causalit√©
                title: "Niveau 3 : Causalit√©",
                competence: "C3",
                cards: [
                    {
                        type: "keyword",
                        question: "Comment s'appelle la m√©thode qui consiste √† partir de l'<span class='highlight'>effet</span> et remonter vers les causes ?",
                        answer: "ascendante",
                        hint: "M√©thode a _ _ _ _ _ _ _ _ _ (10 lettres)",
                        explanation: "La M√âTHODE ASCENDANTE : on PART de l'effet (en bas) et on REMONTE vers les d√©terminants (en haut).",
                        keyword: "Ascendante = du bas vers le haut",
                        tip: "Ascendant = qui monte. On remonte du probl√®me vers les causes."
                    },
                    {
                        type: "qcm",
                        question: "Dans la m√©thode ascendante, quelle est la <span class='highlight'>1√®re question</span> √† se poser ?",
                        options: [
                            "Quels sont les d√©terminants ?",
                            "Quel est le travail prescrit ?",
                            "Quel est l'effet/probl√®me constat√© ?",
                            "Quelle pr√©vention proposer ?"
                        ],
                        answer: 2,
                        explanation: "On COMMENCE par identifier l'EFFET (le probl√®me) : TMS, accident, fatigue...",
                        keyword: "1. Identifier l'effet",
                        tip: "Au bac, le probl√®me est souvent donn√© dans l'√©nonc√©."
                    },
                    {
                        type: "qcm",
                        question: "Apr√®s avoir identifi√© l'effet, que cherche-t-on ensuite ?",
                        options: [
                            "Les mesures de pr√©vention",
                            "Le travail r√©el (t√¢ches/activit√©s) qui provoque cet effet",
                            "Le travail prescrit",
                            "Les effets sur l'entreprise"
                        ],
                        answer: 1,
                        explanation: "√âtape 2 : identifier le TRAVAIL R√âEL qui PROVOQUE l'effet. Quelle t√¢che ? Quelle posture ?",
                        keyword: "2. Trouver le travail r√©el ‚Üí effet",
                        tip: "Question : 'Quelle activit√© provoque ce probl√®me ?'"
                    },
                    {
                        type: "keyword",
                        question: "Quand un effet a PLUSIEURS causes diff√©rentes, on dit que la situation est :",
                        answer: "multifactorielle",
                        hint: "M _ _ _ _ _ _ _ _ _ _ _ _ _ _ (15 lettres)",
                        explanation: "Une situation MULTIFACTORIELLE = plusieurs facteurs/causes combin√©s produisent l'effet.",
                        keyword: "Multi = plusieurs / Factorielle = facteurs",
                        tip: "En r√©alit√©, les situations de travail sont presque toujours multifactorielles."
                    },
                    {
                        type: "vf",
                        question: "Les <span class='highlight'>fl√®ches</span> dans le sch√©ma montrent les liens de causalit√©.",
                        answer: true,
                        explanation: "VRAI ! Les fl√®ches relient les causes aux cons√©quences. Elles montrent le 'chemin' du probl√®me.",
                        keyword: "Fl√®che = lien de cause √† effet",
                        tip: "Au bac, on peut te demander de tracer ces fl√®ches sur le sch√©ma."
                    },
                    {
                        type: "qcm",
                        question: "Compl√®te l'hypoth√®se : ¬´ Il semble que [___] am√®ne l'op√©rateur √† [___] ce qui entra√Æne [___] ¬ª",
                        options: [
                            "effet ‚Üí travail r√©el ‚Üí d√©terminant",
                            "d√©terminant ‚Üí travail r√©el ‚Üí effet",
                            "travail prescrit ‚Üí effet ‚Üí pr√©vention",
                            "pr√©vention ‚Üí d√©terminant ‚Üí effet"
                        ],
                        answer: 1,
                        explanation: "L'hypoth√®se suit la logique : D√âTERMINANT ‚Üí TRAVAIL R√âEL ‚Üí EFFET. C'est le sens de la causalit√©.",
                        keyword: "D√©terminant ‚Üí Travail r√©el ‚Üí Effet",
                        tip: "Formule √† conna√Ætre par c≈ìur pour le bac !"
                    },
                    {
                        type: "keyword",
                        question: "Comment appelle-t-on le lien entre une cause et sa cons√©quence ?",
                        answer: "causalit√©",
                        hint: "Lien de c _ _ _ _ _ _ _ _ (9 lettres)",
                        explanation: "La CAUSALIT√â = la relation cause ‚Üí effet. Analyser, c'est trouver ces liens.",
                        keyword: "Causalit√© = cause ‚Üí effet",
                        tip: "Le sch√©ma de compr√©hension sert √† visualiser ces liens."
                    }
                ]
            },
            4: { // Pr√©vention
                title: "Niveau 4 : Pr√©vention",
                competence: "C4",
                cards: [
                    {
                        type: "qcm",
                        question: "Combien de <span class='highlight'>niveaux de pr√©vention</span> existe-t-il (du + au - efficace) ?",
                        options: ["3 niveaux", "4 niveaux", "5 niveaux", "6 niveaux"],
                        answer: 2,
                        explanation: "5 NIVEAUX : 1. Supprimer 2. R√©duire 3. Protection collective 4. Protection individuelle 5. Formation/Information",
                        keyword: "5 niveaux de pr√©vention",
                        tip: "Du plus efficace (supprimer) au moins efficace (formation)."
                    },
                    {
                        type: "keyword",
                        question: "Quel est le niveau de pr√©vention le PLUS efficace ?",
                        answer: "supprimer",
                        hint: "S _ _ _ _ _ _ _ _ le risque (9 lettres)",
                        explanation: "SUPPRIMER le risque = l'√©liminer totalement. Ex: automatiser une t√¢che dangereuse.",
                        keyword: "Supprimer = √©liminer la source",
                        tip: "C'est l'id√©al mais pas toujours possible."
                    },
                    {
                        type: "keyword",
                        question: "Si on ne peut pas supprimer, on cherche √† _______ le risque.",
                        answer: "r√©duire",
                        hint: "R _ _ _ _ _ _ (7 lettres)",
                        explanation: "R√âDUIRE = diminuer l'exposition au risque. Ex: machine moins bruyante, aide √† la manutention.",
                        keyword: "R√©duire = limiter l'exposition",
                        tip: "Ex: remplacer un produit dangereux par un moins dangereux."
                    },
                    {
                        type: "qcm",
                        question: "Une rambarde de s√©curit√©, un sol antid√©rapant sont des exemples de :",
                        options: [
                            "Protection individuelle (EPI)",
                            "Protection collective (EPC)",
                            "Formation",
                            "Suppression du risque"
                        ],
                        answer: 1,
                        explanation: "Ces √©quipements prot√®gent PLUSIEURS personnes en m√™me temps = PROTECTION COLLECTIVE (EPC).",
                        keyword: "EPC = prot√®ge tout le monde",
                        tip: "EPC = √âquipement de Protection Collective."
                    },
                    {
                        type: "keyword",
                        question: "Casque, gants, chaussures de s√©curit√© sont des :",
                        answer: "epi",
                        hint: "E _ _ (3 lettres) = √âquipement de Protection...",
                        explanation: "EPI = √âquipement de Protection INDIVIDUELLE. Prot√®ge UN seul salari√©.",
                        keyword: "EPI = 1 personne",
                        tip: "EPI = dernier recours car √ßa ne supprime pas le risque."
                    },
                    {
                        type: "vf",
                        question: "La protection <span class='highlight'>collective</span> est PLUS efficace que la protection individuelle.",
                        answer: true,
                        explanation: "VRAI ! EPC prot√®ge tout le monde automatiquement. EPI d√©pend de chaque salari√© (oubli possible).",
                        keyword: "EPC > EPI en efficacit√©",
                        tip: "On met toujours EPC AVANT EPI dans l'ordre de priorit√©."
                    },
                    {
                        type: "keyword",
                        question: "Comment s'appelle la formation gestes et postures pour le secteur sanitaire et social ?",
                        answer: "prap",
                        hint: "P _ _ _ 2S (4 lettres)",
                        explanation: "PRAP 2S = Pr√©vention des Risques li√©s √† l'Activit√© Physique - Secteur Sanitaire et Social. Formation certifi√©e INRS, 28h.",
                        keyword: "PRAP 2S = formation gestes/postures sant√©",
                        tip: "Autres formations : PRAP IBC (industrie), SST (secourisme), CACES (engins)."
                    },
                    {
                        type: "qcm",
                        question: "Dans l'ordre d'efficacit√©, que vient-il APR√àS ¬´ r√©duire le risque ¬ª ?",
                        options: [
                            "Supprimer le risque",
                            "Formation et information",
                            "Protection collective",
                            "Protection individuelle"
                        ],
                        answer: 2,
                        explanation: "Ordre : 1. Supprimer ‚Üí 2. R√©duire ‚Üí 3. Protection COLLECTIVE ‚Üí 4. Protection individuelle ‚Üí 5. Formation",
                        keyword: "Supprimer ‚Üí R√©duire ‚Üí Collective ‚Üí Individuelle ‚Üí Formation",
                        tip: "Moyen mn√©motechnique : SRCIF"
                    },
                    {
                        type: "qcm",
                        question: "Un l√®ve-personne mobile dans un EHPAD est une mesure de :",
                        options: [
                            "Suppression du risque",
                            "R√©duction du risque",
                            "Protection collective",
                            "Formation"
                        ],
                        answer: 1,
                        explanation: "Le l√®ve-personne R√âDUIT les efforts physiques mais ne supprime pas totalement le risque de TMS.",
                        keyword: "Aide technique = r√©duction",
                        tip: "Autres aides : verticalisateur, drap de glisse, lit √† hauteur variable."
                    },
                    {
                        type: "vf",
                        question: "La <span class='highlight'>formation</span> est le niveau de pr√©vention le MOINS efficace.",
                        answer: true,
                        explanation: "VRAI ! La formation seule ne suffit pas. Elle COMPL√àTE les autres mesures mais ne remplace pas le mat√©riel adapt√©.",
                        keyword: "Formation = compl√©ment, pas solution unique",
                        tip: "Au bac, propose TOUJOURS plusieurs niveaux de pr√©vention, pas que la formation."
                    }
                ]
            },
            5: { // Quiz final
                title: "Niveau 5 : Quiz final",
                competence: "C1-C4",
                cards: [] // Sera rempli avec un mix al√©atoire
            }
        };
        
        // G√©n√©rer le niveau 5 (mix)
        function generateLevel5() {
            let allCards = [];
            for (let i = 1; i <= 4; i++) {
                levels[i].cards.forEach(card => {
                    allCards.push({...card, fromLevel: i});
                });
            }
            // M√©langer et prendre 15 cartes
            allCards.sort(() => Math.random() - 0.5);
            levels[5].cards = allCards.slice(0, 15);
        }
        generateLevel5();
        
        // === FONCTIONS ===
        function startLevel(level) {
            currentLevel = level;
            currentCardIndex = 0;
            levelCorrect = 0;
            levelPoints = 0;
            levelErrors = [];
            
            document.getElementById('homeScreen').classList.remove('active');
            document.getElementById('gameScreen').classList.add('active');
            document.getElementById('levelTitle').textContent = levels[level].title;
            document.getElementById('totalCards').textContent = levels[level].cards.length;
            
            showCard();
        }
        
        function showCard() {
            const cards = levels[currentLevel].cards;
            const card = cards[currentCardIndex];
            hintUsed = false;
            
            document.getElementById('currentCard').textContent = currentCardIndex + 1;
            document.getElementById('gameProgress').style.width = ((currentCardIndex / cards.length) * 100) + '%';
            
            // Comp√©tence
            const compBadge = document.getElementById('cardCompetence');
            compBadge.textContent = card.fromLevel ? `C${card.fromLevel}` : levels[currentLevel].competence;
            compBadge.className = 'card-competence comp-badge c' + (card.fromLevel || currentLevel);
            
            // Type de carte
            const typeNames = { keyword: 'MOT-CL√â', qcm: 'QCM', vf: 'VRAI / FAUX' };
            document.getElementById('cardType').textContent = typeNames[card.type] || card.type;
            
            // Contenu
            const questionSection = document.getElementById('questionSection');
            
            if (card.type === 'keyword') {
                questionSection.innerHTML = `
                    <p class="question-text">${card.question}</p>
                    <div class="keyword-input-container">
                        <input type="text" class="keyword-input" id="keywordAnswer" placeholder="√âcris ta r√©ponse..." autocomplete="off">
                        <p class="hint-text" id="hintText">üí° Clique sur "Indice" si besoin</p>
                    </div>
                `;
                document.getElementById('keywordAnswer').addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') validateAnswer();
                });
            }
            else if (card.type === 'qcm') {
                let optionsHTML = card.options.map((opt, i) => `
                    <button class="option-btn" data-index="${i}" onclick="selectOption(this)">
                        <span class="option-letter">${String.fromCharCode(65 + i)}</span>
                        <span>${opt}</span>
                    </button>
                `).join('');
                
                questionSection.innerHTML = `
                    <p class="question-text">${card.question}</p>
                    <div class="options-container">${optionsHTML}</div>
                `;
            }
            else if (card.type === 'vf') {
                questionSection.innerHTML = `
                    <p class="question-text">${card.question}</p>
                    <div class="vf-container">
                        <button class="vf-btn vrai" onclick="selectVF(this, true)">‚úì VRAI</button>
                        <button class="vf-btn faux" onclick="selectVF(this, false)">‚úó FAUX</button>
                    </div>
                `;
            }
        }
        
        function selectOption(btn) {
            document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
        }
        
        function selectVF(btn, value) {
            document.querySelectorAll('.vf-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            btn.dataset.value = value;
        }
        
        function showHint() {
            const card = levels[currentLevel].cards[currentCardIndex];
            if (card.hint) {
                document.getElementById('hintText').innerHTML = `üí° <strong>Indice :</strong> ${card.hint}`;
                hintUsed = true;
            }
        }
        
        function validateAnswer() {
            const card = levels[currentLevel].cards[currentCardIndex];
            let isCorrect = false;
            let userAnswer = '';
            
            if (card.type === 'keyword') {
                userAnswer = document.getElementById('keywordAnswer').value.trim().toLowerCase();
                // Normaliser (accents, etc.)
                const normalize = str => str.normalize('NFD').replace(/[\u0300-\u036f]/g, '').toLowerCase();
                isCorrect = normalize(userAnswer) === normalize(card.answer) || 
                            userAnswer.includes(normalize(card.answer)) ||
                            normalize(card.answer).includes(userAnswer);
            }
            else if (card.type === 'qcm') {
                const selected = document.querySelector('.option-btn.selected');
                if (!selected) { alert('S√©lectionne une r√©ponse'); return; }
                userAnswer = parseInt(selected.dataset.index);
                isCorrect = userAnswer === card.answer;
            }
            else if (card.type === 'vf') {
                const selected = document.querySelector('.vf-btn.selected');
                if (!selected) { alert('S√©lectionne VRAI ou FAUX'); return; }
                userAnswer = selected.dataset.value === 'true';
                isCorrect = userAnswer === card.answer;
            }
            
            showFeedback(isCorrect, card);
        }
        
        function showFeedback(isCorrect, card) {
            const overlay = document.getElementById('feedbackOverlay');
            const feedbackCard = document.getElementById('feedbackCard');
            
            let points = 0;
            if (isCorrect) {
                points = hintUsed ? 5 : 10;
                levelCorrect++;
                currentStreak++;
                if (currentStreak > bestStreak) bestStreak = currentStreak;
                
                // Streak bonus
                if (currentStreak === 3) showStreakPopup('üî• 3 de suite !');
                else if (currentStreak === 5) showStreakPopup('üî•üî• 5 de suite !');
                else if (currentStreak === 10) showStreakPopup('üî•üî•üî• INCROYABLE !');
            } else {
                currentStreak = 0;
                levelErrors.push(card.keyword || card.question.replace(/<[^>]*>/g, '').substring(0, 50) + '...');
            }
            
            levelPoints += points;
            totalPoints += points;
            updateScoreDisplay();
            
            feedbackCard.className = 'feedback-card ' + (isCorrect ? 'correct' : 'incorrect');
            document.getElementById('feedbackIcon').textContent = isCorrect ? '‚úÖ' : '‚ùå';
            document.getElementById('feedbackTitle').textContent = isCorrect ? 
                (currentStreak >= 3 ? 'Excellent ! üî•' : 'Bravo !') : 'Pas tout √† fait...';
            document.getElementById('feedbackPoints').textContent = isCorrect ? `+${points} points` : '0 point';
            document.getElementById('feedbackPoints').style.display = isCorrect ? 'block' : 'none';
            
            document.getElementById('feedbackExplanation').innerHTML = `
                <h4>üìö Explication</h4>
                <p>${card.explanation}</p>
                <div class="keyword-box">üîë <span>${card.keyword}</span></div>
                ${card.tip ? `<div class="tip-box"><h5>üí° Astuce BAC</h5><p>${card.tip}</p></div>` : ''}
            `;
            
            overlay.classList.add('visible');
        }
        
        function showStreakPopup(text) {
            const popup = document.getElementById('streakPopup');
            popup.textContent = text;
            popup.style.display = 'block';
            setTimeout(() => { popup.style.display = 'none'; }, 1500);
        }
        
        function nextCard() {
            document.getElementById('feedbackOverlay').classList.remove('visible');
            currentCardIndex++;
            
            if (currentCardIndex >= levels[currentLevel].cards.length) {
                showResults();
            } else {
                showCard();
            }
        }
        
        function showResults() {
            const total = levels[currentLevel].cards.length;
            const percent = Math.round((levelCorrect / total) * 100);
            
            levelProgress[currentLevel] = Math.max(levelProgress[currentLevel], percent);
            
            document.getElementById('gameScreen').classList.remove('active');
            document.getElementById('resultsScreen').classList.add('active');
            
            document.getElementById('resultsIcon').textContent = percent >= 80 ? 'üéâ' : percent >= 50 ? 'üëç' : 'üí™';
            document.getElementById('resultsTitle').textContent = percent >= 80 ? 'Niveau r√©ussi !' : percent >= 50 ? 'Pas mal !' : 'Continue !';
            document.getElementById('resultsScore').textContent = percent + '%';
            document.getElementById('correctCount').textContent = levelCorrect + '/' + total;
            document.getElementById('pointsEarned').textContent = '+' + levelPoints;
            document.getElementById('bestStreak').textContent = bestStreak;
            
            // Erreurs
            const errorsRecap = document.getElementById('errorsRecap');
            if (levelErrors.length > 0) {
                errorsRecap.style.display = 'block';
                document.getElementById('errorsList').innerHTML = levelErrors.map(e => `<li>${e}</li>`).join('');
            } else {
                errorsRecap.style.display = 'none';
            }
            
            // Confettis si r√©ussi
            if (percent >= 80) {
                createConfetti();
            }
            
            // Bouton niveau suivant
            document.getElementById('nextLevelBtn').style.display = (currentLevel < 5 && percent >= 60) ? 'flex' : 'none';
            
            updateHomeProgress();
        }
        
        function createConfetti() {
            const colors = ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#4CAF50', '#FFD700'];
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 2 + 's';
                confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                document.body.appendChild(confetti);
                setTimeout(() => confetti.remove(), 3000);
            }
        }
        
        function goHome() {
            document.getElementById('resultsScreen').classList.remove('active');
            document.getElementById('gameScreen').classList.remove('active');
            document.getElementById('homeScreen').classList.add('active');
            updateHomeProgress();
        }
        
        function nextLevel() {
            if (currentLevel < 5) {
                startLevel(currentLevel + 1);
                document.getElementById('resultsScreen').classList.remove('active');
            }
        }
        
        function updateScoreDisplay() {
            document.getElementById('totalPoints').textContent = totalPoints;
            document.getElementById('currentStreak').textContent = currentStreak;
        }
        
        function updateHomeProgress() {
            for (let i = 1; i <= 5; i++) {
                document.getElementById(`level${i}Percent`).textContent = levelProgress[i] + '%';
                document.getElementById(`level${i}Bar`).style.width = levelProgress[i] + '%';
            }
        }
        
        // Init
        updateScoreDisplay();
        updateHomeProgress();
    </script>
</body>
</html>
