<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module C.3 - Challenge de Synth√®se Pr√©vention - 1√®re Bac Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=OpenDyslexic:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-pse: #2E86AB;
            --secondary-pse: #A23B72;
            --success-pse: #219653;
            --warning-pse: #F2994A;
            --danger-pse: #EB5757;
            --dark-pse: #2F3542;
            --light-pse: #F1F2F6;
            --accent-pse: #3498DB;
            --purple-pse: #9B59B6;
            --teal-pse: #1ABC9C;
            --gold-pse: #F1C40F;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            line-height: 1.6;
        }

        .dyslexie-font {
            font-family: 'OpenDyslexic', sans-serif;
        }

        /* RESPONSIVE MOBILE-FIRST */
        .container {
            width: 100%;
            max-width: 100vw;
            padding: 15px;
            margin: 0 auto;
        }

        @media (min-width: 768px) {
            .container {
                padding: 20px;
                max-width: 1200px;
            }
        }

        @media (min-width: 1024px) {
            .container {
                padding: 30px;
            }
        }

        /* EN-T√äTE P√âDAGOGIQUE OBLIGATOIRE */
        .cadre-pedagogique {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 3px solid var(--primary-pse);
        }

        .module-info h2 {
            color: var(--primary-pse);
            font-size: 1.3em;
            margin-bottom: 10px;
            text-align: center;
        }

        .objectif {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 5px solid var(--primary-pse);
        }

        .competences-travaillees {
            margin-top: 15px;
        }

        .competences-list {
            list-style: none;
            display: grid;
            gap: 8px;
            margin-top: 10px;
        }

        .competences-list li {
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.9em;
        }

        .competence-c1 { border-left: 5px solid #E74C3C; background: #fef2f2; }
        .competence-c2 { border-left: 5px solid #3498DB; background: #eff6ff; }
        .competence-c3 { border-left: 5px solid #2ECC71; background: #f0fdf4; }
        .competence-c4 { border-left: 5px solid #F39C12; background: #fffbeb; }
        .competence-c5 { border-left: 5px solid #9B59B6; background: #f3f1ff; }
        .competence-c6 { border-left: 5px solid #1ABC9C; background: #f0fdfa; }

        .niveau-cible {
            text-align: center;
            font-weight: 600;
            color: var(--dark-pse);
            margin-top: 15px;
            padding: 10px;
            background: linear-gradient(135deg, #fff3e0, #ffe0b2);
            border-radius: 8px;
        }

        /* CHALLENGE MAIN CONTAINER */
        .challenge-main {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            min-height: 600px;
        }

        /* CHALLENGE HEADER */
        .challenge-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }

        .challenge-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255,255,255,0.05) 10px,
                rgba(255,255,255,0.05) 20px
            );
            animation: shimmer 3s linear infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%); }
            100% { transform: translateX(100%) translateY(100%); }
        }

        .challenge-title {
            font-size: 2em;
            font-weight: 700;
            margin-bottom: 10px;
            position: relative;
            z-index: 2;
        }

        .challenge-subtitle {
            font-size: 1.1em;
            opacity: 0.9;
            position: relative;
            z-index: 2;
        }

        /* DASHBOARD DE PERFORMANCE */
        .performance-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .performance-card {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .performance-card.excellent {
            border-color: var(--success-pse);
            background: linear-gradient(135deg, #e8f5e8, #c8e6c8);
        }

        .performance-card.good {
            border-color: var(--warning-pse);
            background: linear-gradient(135deg, #fff9c4, #fef08a);
        }

        .performance-card.needs-work {
            border-color: var(--danger-pse);
            background: linear-gradient(135deg, #fef2f2, #fecaca);
        }

        .performance-value {
            font-size: 2.5em;
            font-weight: 700;
            color: var(--primary-pse);
            margin-bottom: 10px;
        }

        .performance-label {
            font-weight: 600;
            color: var(--dark-pse);
            margin-bottom: 5px;
        }

        .performance-detail {
            font-size: 0.9em;
            color: #666;
        }

        /* PHASE SYSTEM */
        .phase-container {
            margin: 30px 0;
        }

        .phase-nav {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .phase-tab {
            padding: 12px 20px;
            background: linear-gradient(135deg, #ffffff, #f8fafc);
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            min-width: 120px;
            text-align: center;
        }

        .phase-tab.active {
            background: linear-gradient(135deg, var(--primary-pse), var(--accent-pse));
            color: white;
            border-color: var(--primary-pse);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(46, 134, 171, 0.3);
        }

        .phase-content {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .phase-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* QUIZ EXPERT SYSTEM */
        .quiz-section {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
        }

        .quiz-question {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 5px solid var(--accent-pse);
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .question-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .question-number {
            background: linear-gradient(135deg, var(--primary-pse), var(--accent-pse));
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .question-competence {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 600;
            color: var(--dark-pse);
        }

        .question-text {
            font-size: 1.1em;
            font-weight: 500;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .question-options {
            display: grid;
            gap: 12px;
        }

        .option-card {
            background: linear-gradient(135deg, #ffffff, #f8fafc);
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .option-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }

        .option-card.selected {
            border-color: var(--primary-pse);
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
        }

        .option-card.correct {
            border-color: var(--success-pse);
            background: linear-gradient(135deg, #e8f5e8, #c8e6c8);
        }

        .option-card.incorrect {
            border-color: var(--danger-pse);
            background: linear-gradient(135deg, #fef2f2, #fecaca);
        }

        .option-text {
            font-weight: 500;
        }

        .option-explanation {
            font-size: 0.9em;
            color: #666;
            margin-top: 8px;
            font-style: italic;
        }

        /* CAS PRATIQUE COMPLEXE */
        .case-study {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            padding: 25px;
            border-radius: 12px;
            border-left: 6px solid var(--accent-pse);
            margin: 20px 0;
        }

        .case-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .case-title {
            font-size: 1.4em;
            font-weight: 600;
            color: var(--dark-pse);
            margin-bottom: 10px;
        }

        .case-context {
            font-size: 1em;
            color: #666;
        }

        .case-scenario {
            background: linear-gradient(135deg, #fff9c4, #fef08a);
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid var(--warning-pse);
            margin: 20px 0;
            line-height: 1.8;
        }

        .case-tasks {
            display: grid;
            gap: 15px;
            margin: 20px 0;
        }

        .task-item {
            background: white;
            padding: 18px;
            border-radius: 10px;
            border-left: 4px solid var(--purple-pse);
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .task-number {
            background: var(--purple-pse);
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            margin-right: 10px;
            font-size: 0.9em;
        }

        .task-text {
            display: inline;
            font-weight: 500;
        }

        /* SYST√àME CLIC-S√âLECTION */
        .instructions-interaction {
            background: linear-gradient(135deg, #fff9c4, #fef08a);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 5px solid var(--warning-pse);
        }

        .clickable-element {
            padding: 12px 15px;
            margin: 8px;
            background: linear-gradient(135deg, #ffffff, #f8fafc);
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
            min-width: 120px;
            text-align: center;
            user-select: none;
        }

        .clickable-element:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .clickable-element.selected {
            border: 3px solid var(--warning-pse);
            background: linear-gradient(135deg, #FFA726, #FF9800);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(255, 167, 38, 0.4);
        }

        .clickable-element.correct {
            border: 3px solid var(--success-pse);
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
        }

        .clickable-element.incorrect {
            border: 3px solid var(--danger-pse);
            background: linear-gradient(135deg, #F44336, #C62828);
            color: white;
        }

        .assignment-zone {
            min-height: 60px;
            border: 3px dashed #bdc3c7;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            background: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            cursor: pointer;
            text-align: center;
        }

        .assignment-zone.active {
            border-color: var(--primary-pse);
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
        }

        .assignment-zone.filled {
            border-color: var(--success-pse);
            background: linear-gradient(135deg, #e8f5e8, #c8e6c8);
        }

        /* CORRECTION EXPLICITE OBLIGATOIRE */
        .correction-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }

        .correction-card {
            background: linear-gradient(135deg, #ffffff, #f8fafc);
            border-radius: 15px;
            padding: 25px;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .correction-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .correction-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 15px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            color: white;
        }

        .correction-icon.success {
            background: linear-gradient(135deg, var(--success-pse), #27AE60);
        }

        .correction-icon.error {
            background: linear-gradient(135deg, var(--danger-pse), #C0392B);
        }

        .correction-title {
            font-size: 1.4em;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .bonne-reponse {
            background: linear-gradient(135deg, #e8f5e8, #c8e6c8);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 5px solid var(--success-pse);
        }

        .explication {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 5px solid var(--accent-pse);
        }

        .astuce-bac {
            background: linear-gradient(135deg, #fff9c4, #fef08a);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 5px solid var(--warning-pse);
        }

        /* SYST√àME DE BADGES */
        .badges-section {
            background: linear-gradient(135deg, #f3f1ff, #e8e5ff);
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: center;
        }

        .badges-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .badge-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }

        .badge-card.earned {
            border-color: var(--gold-pse);
            background: linear-gradient(135deg, #fff8e1, #fff3c4);
            transform: scale(1.05);
        }

        .badge-icon {
            font-size: 3em;
            margin-bottom: 15px;
            display: block;
        }

        .badge-card.earned .badge-icon {
            animation: bounce 1s ease-in-out infinite alternate;
        }

        .badge-title {
            font-weight: 600;
            color: var(--dark-pse);
            margin-bottom: 8px;
        }

        .badge-description {
            font-size: 0.9em;
            color: #666;
        }

        .badge-card.earned .badge-description {
            color: #d68910;
            font-weight: 500;
        }

        /* NAVIGATION BUTTONS */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin: 25px 0;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-pse), var(--accent-pse));
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-pse), #27AE60);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning-pse), #E67E22);
            color: white;
        }

        .btn-gold {
            background: linear-gradient(135deg, var(--gold-pse), #F39C12);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* FOOTER RGPD √âPUR√â */
        .rgpd-footer {
            text-align: center;
            padding: 20px;
            color: rgba(255,255,255,0.8);
            font-size: 0.9em;
        }

        /* RESPONSIVE MOBILE */
        @media (max-width: 768px) {
            .performance-dashboard {
                grid-template-columns: 1fr 1fr;
            }
            
            .phase-nav {
                flex-direction: column;
                align-items: center;
            }
            
            .badges-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .correction-card {
                margin: 10px;
                padding: 20px;
            }
        }

        /* ANIMATIONS AVANC√âES */
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% { transform: translate3d(0,0,0); }
            40%, 43% { transform: translate3d(0,-10px,0); }
            70% { transform: translate3d(0,-5px,0); }
            90% { transform: translate3d(0,-2px,0); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        .bounce {
            animation: bounce 1s ease-in-out;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- EN-T√äTE P√âDAGOGIQUE OBLIGATOIRE -->
        <div class="cadre-pedagogique">
            <div class="module-info">
                <h2>Module C.3 : Les acteurs de pr√©vention</h2>
                <div class="objectif">
                    <strong>Objectif :</strong> Identifier les missions des acteurs de pr√©vention internes et externes en milieu professionnel.
                </div>
            </div>
            
            <div class="competences-travaillees">
                <h3>Comp√©tences travaill√©es dans cet exercice :</h3>
                <ul class="competences-list">
                    <li class="competence-c1"><strong>C1</strong> - Traiter une information</li>
                    <li class="competence-c2"><strong>C2</strong> - Appliquer une d√©marche d'analyse dans une situation donn√©e</li>
                    <li class="competence-c3"><strong>C3</strong> - Expliquer un ph√©nom√®ne physiologique, un enjeu environnemental, une disposition r√©glementaire, en lien avec une mesure de pr√©vention</li>
                    <li class="competence-c4"><strong>C4</strong> - Proposer une solution pour r√©soudre un probl√®me</li>
                    <li class="competence-c5"><strong>C5</strong> - Argumenter un choix</li>
                    <li class="competence-c6"><strong>C6</strong> - Communiquer √† l'√©crit et √† l'oral avec une syntaxe claire et un vocabulaire adapt√©</li>
                </ul>
            </div>
            
            <div class="niveau-cible">
                <strong>Niveau :</strong> Bac Pro Premi√®re
            </div>
        </div>

        <!-- CHALLENGE MAIN CONTAINER -->
        <div class="challenge-main">
            <!-- CHALLENGE HEADER -->
            <div class="challenge-header">
                <div class="challenge-title">üèÜ Challenge Final Pr√©vention</div>
                <div class="challenge-subtitle">√âvaluez votre ma√Ætrise compl√®te des acteurs de pr√©vention</div>
            </div>

            <!-- INSTRUCTIONS UTILISATEUR -->
            <div class="instructions-interaction">
                <h5>üéØ D√âFI FINAL :</h5>
                <p><strong>1.</strong> Compl√©tez les 4 phases du challenge : Quiz Expert, Cas Pratique, Synth√®se, Certification 
                <strong>2.</strong> Cliquez pour s√©lectionner vos r√©ponses et valider vos choix 
                <strong>3.</strong> Obtenez vos badges de comp√©tences selon vos performances</p>
            </div>

            <!-- PERFORMANCE DASHBOARD -->
            <div class="performance-dashboard">
                <div class="performance-card" id="score-card">
                    <div class="performance-value" id="total-score">0</div>
                    <div class="performance-label">Score Global</div>
                    <div class="performance-detail" id="score-detail">0/400 points</div>
                </div>
                <div class="performance-card" id="competences-card">
                    <div class="performance-value" id="competences-validated">0/6</div>
                    <div class="performance-label">Comp√©tences</div>
                    <div class="performance-detail">Valid√©es</div>
                </div>
                <div class="performance-card" id="phase-card">
                    <div class="performance-value" id="phase-progress">0/4</div>
                    <div class="performance-label">Phases</div>
                    <div class="performance-detail">Compl√©t√©es</div>
                </div>
                <div class="performance-card" id="badges-card">
                    <div class="performance-value" id="badges-earned">0/5</div>
                    <div class="performance-label">Badges</div>
                    <div class="performance-detail">Obtenus</div>
                </div>
            </div>

            <!-- PHASE NAVIGATION -->
            <div class="phase-nav">
                <div class="phase-tab active" data-phase="1" onclick="switchPhase(1)">
                    üìö Quiz Expert
                </div>
                <div class="phase-tab" data-phase="2" onclick="switchPhase(2)">
                    üè¢ Cas Pratique
                </div>
                <div class="phase-tab" data-phase="3" onclick="switchPhase(3)">
                    üîÑ Synth√®se
                </div>
                <div class="phase-tab" data-phase="4" onclick="switchPhase(4)">
                    üèÜ Certification
                </div>
            </div>

            <!-- PHASE 1: QUIZ EXPERT -->
            <div class="phase-content active" id="phase-1">
                <div class="quiz-section">
                    <h3 style="text-align: center; margin-bottom: 20px; color: var(--dark-pse);">
                        üìö Quiz Expert : Connaissances Approfondies
                    </h3>

                    <!-- Question 1 -->
                    <div class="quiz-question">
                        <div class="question-header">
                            <div class="question-number">1</div>
                            <div class="question-competence">C3</div>
                        </div>
                        <div class="question-text">
                            Dans quelle situation l'inspection du travail peut-elle prendre une d√©cision d'arr√™t d'activit√© ?
                        </div>
                        <div class="question-options">
                            <div class="option-card" data-question="1" data-answer="incorrect" onclick="selectOption(this)">
                                <div class="option-text">En cas de retard dans la d√©claration d'un accident du travail</div>
                            </div>
                            <div class="option-card" data-question="1" data-answer="correct" onclick="selectOption(this)">
                                <div class="option-text">En pr√©sence d'un danger grave et imminent pour les salari√©s</div>
                            </div>
                            <div class="option-card" data-question="1" data-answer="incorrect" onclick="selectOption(this)">
                                <div class="option-text">Lorsque le CSE n'est pas consult√© sur un projet</div>
                            </div>
                        </div>
                    </div>

                    <!-- Question 2 -->
                    <div class="quiz-question">
                        <div class="question-header">
                            <div class="question-number">2</div>
                            <div class="question-competence">C1</div>
                        </div>
                        <div class="question-text">
                            Quelle est la principale diff√©rence entre un SPST et la CARSAT dans leurs missions ?
                        </div>
                        <div class="question-options">
                            <div class="option-card" data-question="2" data-answer="correct" onclick="selectOption(this)">
                                <div class="option-text">Le SPST fait du conseil m√©dical, la CARSAT de la tarification AT/MP</div>
                            </div>
                            <div class="option-card" data-question="2" data-answer="incorrect" onclick="selectOption(this)">
                                <div class="option-text">Le SPST s'occupe des grandes entreprises, la CARSAT des PME</div>
                            </div>
                            <div class="option-card" data-question="2" data-answer="incorrect" onclick="selectOption(this)">
                                <div class="option-text">Le SPST fait du contr√¥le, la CARSAT de la formation</div>
                            </div>
                        </div>
                    </div>

                    <!-- Question 3 -->
                    <div class="quiz-question">
                        <div class="question-header">
                            <div class="question-number">3</div>
                            <div class="question-competence">C2</div>
                        </div>
                        <div class="question-text">
                            Un salari√© comp√©tent peut-il prendre des d√©cisions disciplinaires envers un coll√®gue qui ne respecte pas les consignes de s√©curit√© ?
                        </div>
                        <div class="question-options">
                            <div class="option-card" data-question="3" data-answer="incorrect" onclick="selectOption(this)">
                                <div class="option-text">Oui, il a autorit√© sur la s√©curit√©</div>
                            </div>
                            <div class="option-card" data-question="3" data-answer="correct" onclick="selectOption(this)">
                                <div class="option-text">Non, seul l'employeur a ce pouvoir disciplinaire</div>
                            </div>
                            <div class="option-card" data-question="3" data-answer="incorrect" onclick="selectOption(this)">
                                <div class="option-text">Oui, si le CSE l'y autorise</div>
                            </div>
                        </div>
                    </div>

                    <!-- Question 4 -->
                    <div class="quiz-question">
                        <div class="question-header">
                            <div class="question-number">4</div>
                            <div class="question-competence">C4</div>
                        </div>
                        <div class="question-text">
                            Une entreprise de 200 salari√©s n'a pas de CSE constitu√©. Que peut faire l'inspection du travail ?
                        </div>
                        <div class="question-options">
                            <div class="option-card" data-question="4" data-answer="incorrect" onclick="selectOption(this)">
                                <div class="option-text">Fermer temporairement l'entreprise</div>
                            </div>
                            <div class="option-card" data-question="4" data-answer="correct" onclick="selectOption(this)">
                                <div class="option-text">Mettre en demeure l'employeur d'organiser des √©lections</div>
                            </div>
                            <div class="option-card" data-question="4" data-answer="incorrect" onclick="selectOption(this)">
                                <div class="option-text">Nommer d'office un CSE</div>
                            </div>
                        </div>
                    </div>

                    <!-- Question 5 -->
                    <div class="quiz-question">
                        <div class="question-header">
                            <div class="question-number">5</div>
                            <div class="question-competence">C5</div>
                        </div>
                        <div class="question-text">
                            Pourquoi la CARSAT peut-elle √™tre plus efficace qu'une sanction de l'inspection du travail pour am√©liorer la pr√©vention ?
                        </div>
                        <div class="question-options">
                            <div class="option-card" data-question="5" data-answer="incorrect" onclick="selectOption(this)">
                                <div class="option-text">Elle a plus de pouvoir juridique</div>
                            </div>
                            <div class="option-card" data-question="5" data-answer="correct" onclick="selectOption(this)">
                                <div class="option-text">Elle agit sur l'√©conomique via les cotisations AT/MP</div>
                            </div>
                            <div class="option-card" data-question="5" data-answer="incorrect" onclick="selectOption(this)">
                                <div class="option-text">Elle peut licencier des salari√©s dangereux</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-primary" onclick="validateQuiz()">Valider le Quiz Expert</button>
                </div>
            </div>

            <!-- PHASE 2: CAS PRATIQUE COMPLEXE -->
            <div class="phase-content" id="phase-2">
                <div class="case-study">
                    <div class="case-header">
                        <div class="case-title">üè¢ Cas Pratique Complexe</div>
                        <div class="case-context">Usine agroalimentaire - 80 salari√©s</div>
                    </div>

                    <div class="case-scenario">
                        <strong>CONTEXTE COMPLEXE :</strong><br>
                        L'usine Agro-Plus traverse une crise multiple : 3 accidents graves en 2 mois, taux d'absent√©isme en hausse (15%), plaintes de salari√©s pour troubles musculo-squelettiques, DUERP obsol√®te (4 ans), et tension sociale due √† un plan de restructuration. Le CHSCT historique vient d'√™tre remplac√© par un CSE, mais les √©lus manquent d'exp√©rience. L'inspection du travail a programm√© une visite, la CARSAT menace d'augmenter les cotisations, et le m√©decin du travail alerte sur la d√©gradation des conditions de travail.
                    </div>

                    <div class="case-tasks">
                        <div class="task-item">
                            <span class="task-number">1</span>
                            <span class="task-text">Identifiez les 3 acteurs prioritaires √† mobiliser imm√©diatement</span>
                        </div>
                        <div class="task-item">
                            <span class="task-number">2</span>
                            <span class="task-text">D√©finissez le r√¥le sp√©cifique de chaque acteur dans cette situation</span>
                        </div>
                        <div class="task-item">
                            <span class="task-number">3</span>
                            <span class="task-text">Proposez un plan d'action coordonn√© sur 6 mois</span>
                        </div>
                    </div>

                    <!-- T√¢che 1: Acteurs prioritaires -->
                    <div style="margin: 25px 0;">
                        <h4>T√¢che 1 : Acteurs prioritaires (cliquez pour s√©lectionner 3 acteurs)</h4>
                        <div class="actors-pool" style="margin: 15px 0;">
                            <div class="clickable-element" data-actor="employeur">Employeur</div>
                            <div class="clickable-element" data-actor="cse">CSE</div>
                            <div class="clickable-element" data-actor="salarie-competent">Salari√© comp√©tent</div>
                            <div class="clickable-element" data-actor="medecin-travail">M√©decin du travail</div>
                            <div class="clickable-element" data-actor="inspection">Inspection du travail</div>
                            <div class="clickable-element" data-actor="carsat">CARSAT</div>
                        </div>

                        <div class="assignment-zones">
                            <div class="assignment-zone" data-priority="1">
                                <span>Acteur prioritaire #1 (responsabilit√© directe)</span>
                            </div>
                            <div class="assignment-zone" data-priority="2">
                                <span>Acteur prioritaire #2 (expertise technique)</span>
                            </div>
                            <div class="assignment-zone" data-priority="3">
                                <span>Acteur prioritaire #3 (accompagnement)</span>
                            </div>
                        </div>
                    </div>

                    <!-- T√¢che 2: R√¥les sp√©cifiques -->
                    <div style="margin: 25px 0;">
                        <h4>T√¢che 2 : Missions sp√©cifiques (associez chaque action √† son acteur)</h4>
                        <div class="actions-pool" style="margin: 15px 0;">
                            <div class="clickable-element" data-action="enquete-at">Enqu√™te accidents travail</div>
                            <div class="clickable-element" data-action="refonte-duerp">Refonte DUERP</div>
                            <div class="clickable-element" data-action="visite-poste">Visite postes √† risques</div>
                            <div class="clickable-element" data-action="formation-cse">Formation nouveaux √©lus</div>
                        </div>

                        <div class="assignment-zones">
                            <div class="assignment-zone" data-actor-role="cse">
                                <span>Mission du CSE</span>
                            </div>
                            <div class="assignment-zone" data-actor-role="salarie-competent">
                                <span>Mission du salari√© comp√©tent</span>
                            </div>
                            <div class="assignment-zone" data-actor-role="medecin-travail">
                                <span>Mission du m√©decin du travail</span>
                            </div>
                            <div class="assignment-zone" data-actor-role="carsat">
                                <span>Mission de la CARSAT</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-warning" onclick="validateCaseStudy()">Valider le Cas Pratique</button>
                </div>
            </div>

            <!-- PHASE 3: SYNTH√àSE -->
            <div class="phase-content" id="phase-3">
                <div class="quiz-section">
                    <h3 style="text-align: center; margin-bottom: 20px; color: var(--dark-pse);">
                        üîÑ Synth√®se Finale : Vision Globale
                    </h3>

                    <!-- Synth√®se Question 1 -->
                    <div class="quiz-question">
                        <div class="question-header">
                            <div class="question-number">1</div>
                            <div class="question-competence">C6</div>
                        </div>
                        <div class="question-text">
                            <strong>Analyse de situation :</strong> Un salari√© refuse de porter ses EPI malgr√© les rappels. Il invoque "l'inconfort" et "la perte de temps". Hi√©rarchisez les interventions selon leur efficacit√© :
                        </div>
                        <div class="question-options">
                            <div class="option-card" data-question="s1" data-answer="incorrect" onclick="selectOption(this)">
                                <div class="option-text">1. Sanction / 2. Formation / 3. Am√©lioration EPI</div>
                            </div>
                            <div class="option-card" data-question="s1" data-answer="correct" onclick="selectOption(this)">
                                <div class="option-text">1. Dialogue/formation / 2. Am√©lioration EPI / 3. Sanction si persistance</div>
                            </div>
                            <div class="option-card" data-question="s1" data-answer="incorrect" onclick="selectOption(this)">
                                <div class="option-text">1. Mutation / 2. Am√©lioration EPI / 3. Formation</div>
                            </div>
                        </div>
                    </div>

                    <!-- Synth√®se Question 2 -->
                    <div class="quiz-question">
                        <div class="question-header">
                            <div class="question-number">2</div>
                            <div class="question-competence">C2 + C4</div>
                        </div>
                        <div class="question-text">
                            <strong>Coordination des acteurs :</strong> Suite √† un accident grave, dans quel ordre logique interviennent les acteurs pour une gestion optimale ?
                        </div>
                        <div class="question-options">
                            <div class="option-card" data-question="s2" data-answer="correct" onclick="selectOption(this)">
                                <div class="option-text">1. SST (secours) ‚Üí 2. Employeur (enqu√™te) ‚Üí 3. CSE (enqu√™te) ‚Üí 4. Inspection (contr√¥le)</div>
                            </div>
                            <div class="option-card" data-question="s2" data-answer="incorrect" onclick="selectOption(this)">
                                <div class="option-text">1. Inspection ‚Üí 2. CSE ‚Üí 3. SST ‚Üí 4. Employeur</div>
                            </div>
                            <div class="option-card" data-question="s2" data-answer="incorrect" onclick="selectOption(this)">
                                <div class="option-text">1. Employeur ‚Üí 2. CARSAT ‚Üí 3. SST ‚Üí 4. CSE</div>
                            </div>
                        </div>
                    </div>

                    <!-- Synth√®se Question 3 -->
                    <div class="quiz-question">
                        <div class="question-header">
                            <div class="question-number">3</div>
                            <div class="question-competence">C3 + C5</div>
                        </div>
                        <div class="question-text">
                            <strong>Argumentation experte :</strong> Pourquoi le syst√®me fran√ßais de pr√©vention privil√©gie-t-il la compl√©mentarit√© des acteurs plut√¥t qu'un acteur unique ?
                        </div>
                        <div class="question-options">
                            <div class="option-card" data-question="s3" data-answer="incorrect" onclick="selectOption(this)">
                                <div class="option-text">Pour r√©partir les co√ªts entre plusieurs organismes</div>
                            </div>
                            <div class="option-card" data-question="s3" data-answer="correct" onclick="selectOption(this)">
                                <div class="option-text">Pour combiner expertises compl√©mentaires et contr√¥les crois√©s</div>
                            </div>
                            <div class="option-card" data-question="s3" data-answer="incorrect" onclick="selectOption(this)">
                                <div class="option-text">Pour √©viter les conflits de comp√©tences</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-success" onclick="validateSynthesis()">Valider la Synth√®se</button>
                </div>
            </div>

            <!-- PHASE 4: CERTIFICATION -->
            <div class="phase-content" id="phase-4">
                <div class="badges-section">
                    <h3 style="color: var(--dark-pse); margin-bottom: 20px;">
                        üèÜ Certification des Comp√©tences
                    </h3>
                    
                    <div class="badges-grid">
                        <div class="badge-card" id="badge-knowledge">
                            <div class="badge-icon">üìö</div>
                            <div class="badge-title">Expert Th√©orique</div>
                            <div class="badge-description">Ma√Ætrise les connaissances sur les acteurs</div>
                        </div>
                        
                        <div class="badge-card" id="badge-analysis">
                            <div class="badge-icon">üîç</div>
                            <div class="badge-title">Analyste Confirm√©</div>
                            <div class="badge-description">Analyse efficacement les situations complexes</div>
                        </div>
                        
                        <div class="badge-card" id="badge-synthesis">
                            <div class="badge-icon">üß†</div>
                            <div class="badge-title">Synth√©tiseur Expert</div>
                            <div class="badge-description">Vision globale et coordination des acteurs</div>
                        </div>
                        
                        <div class="badge-card" id="badge-communication">
                            <div class="badge-icon">üí¨</div>
                            <div class="badge-title">Communicateur Professionnel</div>
                            <div class="badge-description">Ma√Ætrise le vocabulaire et l'argumentation</div>
                        </div>
                        
                        <div class="badge-card" id="badge-master">
                            <div class="badge-icon">üëë</div>
                            <div class="badge-title">Ma√Ætre Pr√©venteur</div>
                            <div class="badge-description">Excellence g√©n√©rale sur le module C.3</div>
                        </div>
                    </div>

                    <div class="certification-summary" id="certification-summary" style="margin-top: 30px; display: none;">
                        <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 6px 20px rgba(0,0,0,0.1);">
                            <h4 style="color: var(--dark-pse); margin-bottom: 15px;">üìã Bilan de Certification</h4>
                            <div id="certification-details"></div>
                            <div style="margin-top: 20px; padding: 15px; background: linear-gradient(135deg, #e3f2fd, #bbdefb); border-radius: 8px;">
                                <strong>üí° Conseils pour progresser :</strong>
                                <div id="improvement-tips"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-gold" onclick="generateCertification()" id="certify-btn" disabled>
                        üéì G√©n√©rer ma Certification
                    </button>
                    <button class="btn btn-primary" onclick="restartChallenge()">
                        üîÑ Recommencer le Challenge
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- CORRECTION OVERLAY -->
    <div class="correction-overlay" id="correction-overlay">
        <div class="correction-card">
            <div class="correction-header">
                <div class="correction-icon" id="correction-icon">
                    <span id="correction-icon-text">‚úì</span>
                </div>
                <div class="correction-title" id="correction-title">Titre de la correction</div>
            </div>
            <div class="correction-content" id="correction-content">
                <!-- Contenu dynamique -->
            </div>
            <div class="nav-buttons">
                <button class="btn btn-primary" onclick="closeCorrection()">Continuer</button>
            </div>
        </div>
    </div>

    <!-- FOOTER RGPD √âPUR√â -->
    <div class="rgpd-footer">
        üîí Conformit√© RGPD : Cet exercice respecte votre anonymat.
    </div>

    <script>
        // Variables globales du challenge
        let challengeData = {
            currentPhase: 1,
            scores: {
                quiz: 0,
                caseStudy: 0,
                synthesis: 0,
                total: 0
            },
            competences: {
                c1: false,
                c2: false,
                c3: false,
                c4: false,
                c5: false,
                c6: false
            },
            badges: {
                knowledge: false,
                analysis: false,
                synthesis: false,
                communication: false,
                master: false
            },
            phases: {
                1: false, // Quiz
                2: false, // Cas pratique
                3: false, // Synth√®se
                4: false  // Certification
            },
            answers: {
                quiz: {},
                caseStudy: {},
                synthesis: {}
            }
        };

        // Donn√©es de correction
        const correctAnswers = {
            quiz: {
                1: 'correct', // Danger grave et imminent
                2: 'correct', // SPST conseil m√©dical, CARSAT tarification
                3: 'correct', // Seul employeur a pouvoir disciplinaire
                4: 'correct', // Mettre en demeure pour √©lections CSE
                5: 'correct'  // CARSAT agit sur √©conomique
            },
            caseStudy: {
                priorities: ['employeur', 'medecin-travail', 'cse'],
                roles: {
                    'cse': 'enquete-at',
                    'salarie-competent': 'refonte-duerp',
                    'medecin-travail': 'visite-poste',
                    'carsat': 'formation-cse'
                }
            },
            synthesis: {
                's1': 'correct', // Dialogue/formation puis am√©lioration puis sanction
                's2': 'correct', // SST ‚Üí Employeur ‚Üí CSE ‚Üí Inspection
                's3': 'correct'  // Expertises compl√©mentaires et contr√¥les crois√©s
            }
        };

        // Variables pour le syst√®me clic-s√©lection
        let selectedElement = null;
        let caseStudyProgress = {
            priorityCount: 0,
            assignedRoles: 0
        };

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            initializeChallenge();
            setupEventListeners();
        });

        // Initialisation du challenge
        function initializeChallenge() {
            updatePerformanceDashboard();
            setupClickableElements();
        }

        // Configuration des √©v√©nements
        function setupEventListeners() {
            // Syst√®me clic-s√©lection pour le cas pratique
            document.querySelectorAll('.clickable-element').forEach(element => {
                element.addEventListener('click', handleElementClick);
            });

            document.querySelectorAll('.assignment-zone').forEach(zone => {
                zone.addEventListener('click', handleZoneClick);
            });

            // Gestion clavier pour accessibilit√©
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeCorrection();
                }
            });
        }

        // Changement de phase
        function switchPhase(phaseNum) {
            // V√©rifier si la phase pr√©c√©dente est compl√©t√©e
            if (phaseNum > 1 && !challengeData.phases[phaseNum - 1]) {
                showMessage('Veuillez d\'abord compl√©ter la phase pr√©c√©dente !', 'warning');
                return;
            }

            // Masquer toutes les phases
            document.querySelectorAll('.phase-content').forEach(phase => {
                phase.classList.remove('active');
            });

            // Masquer tous les tabs
            document.querySelectorAll('.phase-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Activer la phase et le tab
            document.getElementById(`phase-${phaseNum}`).classList.add('active');
            document.querySelector(`[data-phase="${phaseNum}"]`).classList.add('active');

            challengeData.currentPhase = phaseNum;

            // Activer le bouton de certification si toutes les phases sont termin√©es
            if (phaseNum === 4 && challengeData.phases[1] && challengeData.phases[2] && challengeData.phases[3]) {
                document.getElementById('certify-btn').disabled = false;
            }
        }

        // S√©lection d'une option de quiz
        function selectOption(optionElement) {
            const questionDiv = optionElement.closest('.quiz-question');
            const options = questionDiv.querySelectorAll('.option-card');
            
            // D√©s√©lectionner les autres options
            options.forEach(option => option.classList.remove('selected'));
            
            // S√©lectionner cette option
            optionElement.classList.add('selected');
            
            // Enregistrer la r√©ponse
            const questionId = optionElement.dataset.question;
            const answer = optionElement.dataset.answer;
            
            if (challengeData.currentPhase === 1) {
                challengeData.answers.quiz[questionId] = answer;
            } else if (challengeData.currentPhase === 3) {
                challengeData.answers.synthesis[questionId] = answer;
            }
        }

        // Validation du quiz expert
        function validateQuiz() {
            let correctCount = 0;
            const totalQuestions = 5;

            // V√©rifier les r√©ponses
            for (let i = 1; i <= totalQuestions; i++) {
                const userAnswer = challengeData.answers.quiz[i];
                const correctAnswer = correctAnswers.quiz[i];
                const questionDiv = document.querySelector(`[data-question="${i}"]`).closest('.quiz-question');
                const options = questionDiv.querySelectorAll('.option-card');

                options.forEach(option => {
                    if (option.dataset.answer === correctAnswer) {
                        option.classList.add('correct');
                    } else if (option.classList.contains('selected')) {
                        option.classList.add('incorrect');
                    }
                });

                if (userAnswer === correctAnswer) {
                    correctCount++;
                }
            }

            // Calcul du score
            challengeData.scores.quiz = Math.round((correctCount / totalQuestions) * 100);
            challengeData.phases[1] = true;

            // Validation des comp√©tences
            if (correctCount >= 4) {
                challengeData.competences.c1 = true;
                challengeData.competences.c2 = true;
                challengeData.competences.c3 = true;
                challengeData.badges.knowledge = true;
            }

            // Afficher le feedback
            showQuizFeedback(correctCount, totalQuestions);
            updatePerformanceDashboard();

            // Activer la phase suivante
            setTimeout(() => {
                document.querySelector('[data-phase="2"]').style.pointerEvents = 'auto';
                document.querySelector('[data-phase="2"]').style.opacity = '1';
            }, 2000);
        }

        // Syst√®me clic-s√©lection pour le cas pratique
        function handleElementClick(e) {
            e.preventDefault();
            
            // D√©s√©lectionner l'√©l√©ment pr√©c√©dent
            if (selectedElement) {
                selectedElement.classList.remove('selected');
            }
            
            // S√©lectionner le nouvel √©l√©ment
            selectedElement = e.target;
            selectedElement.classList.add('selected');
        }

        function handleZoneClick(e) {
            if (!selectedElement) {
                showMessage('S√©lectionnez d\'abord un √©l√©ment √† placer !', 'warning');
                return;
            }

            const zone = e.currentTarget;
            
            // V√©rifier si la zone est d√©j√† occup√©e
            if (zone.classList.contains('filled')) {
                showMessage('Cette zone est d√©j√† occup√©e !', 'warning');
                return;
            }

            // Placement de l'√©l√©ment
            zone.textContent = selectedElement.textContent;
            zone.classList.add('filled');
            zone.dataset.placedElement = selectedElement.dataset.actor || selectedElement.dataset.action;
            
            // Masquer l'√©l√©ment s√©lectionn√©
            selectedElement.style.display = 'none';
            selectedElement.classList.remove('selected');
            selectedElement = null;

            // Effet visuel
            zone.classList.add('bounce');
            setTimeout(() => zone.classList.remove('bounce'), 1000);

            // Compter la progression
            if (zone.dataset.priority) {
                caseStudyProgress.priorityCount++;
            } else if (zone.dataset.actorRole) {
                caseStudyProgress.assignedRoles++;
            }
        }

        // Validation du cas pratique
        function validateCaseStudy() {
            let score = 0;
            let maxScore = 100;

            // V√©rification des priorit√©s (50 points)
            const priorities = ['employeur', 'medecin-travail', 'cse'];
            let priorityScore = 0;
            
            for (let i = 1; i <= 3; i++) {
                const zone = document.querySelector(`[data-priority="${i}"]`);
                const placed = zone.dataset.placedElement;
                const expected = priorities[i-1];
                
                if (placed === expected) {
                    zone.classList.add('correct');
                    priorityScore += 17; // 50/3 ‚âà 17 points par bonne r√©ponse
                } else {
                    zone.classList.add('incorrect');
                }
            }

            // V√©rification des r√¥les (50 points)
            const roles = correctAnswers.caseStudy.roles;
            let roleScore = 0;
            
            Object.keys(roles).forEach(actorRole => {
                const zone = document.querySelector(`[data-actor-role="${actorRole}"]`);
                const placed = zone.dataset.placedElement;
                const expected = roles[actorRole];
                
                if (placed === expected) {
                    zone.classList.add('correct');
                    roleScore += 13; // 50/4 ‚âà 13 points par bonne r√©ponse
                } else {
                    zone.classList.add('incorrect');
                }
            });

            score = priorityScore + roleScore;
            challengeData.scores.caseStudy = score;
            challengeData.phases[2] = true;

            // Validation des comp√©tences
            if (score >= 70) {
                challengeData.competences.c4 = true;
                challengeData.badges.analysis = true;
            }

            // Afficher le feedback
            showCaseStudyFeedback(score, maxScore);
            updatePerformanceDashboard();

            // Activer la phase suivante
            setTimeout(() => {
                document.querySelector('[data-phase="3"]').style.pointerEvents = 'auto';
                document.querySelector('[data-phase="3"]').style.opacity = '1';
            }, 2000);
        }

        // Validation de la synth√®se
        function validateSynthesis() {
            let correctCount = 0;
            const totalQuestions = 3;

            // V√©rifier les r√©ponses
            ['s1', 's2', 's3'].forEach(questionId => {
                const userAnswer = challengeData.answers.synthesis[questionId];
                const correctAnswer = correctAnswers.synthesis[questionId];
                const questionDiv = document.querySelector(`[data-question="${questionId}"]`).closest('.quiz-question');
                const options = questionDiv.querySelectorAll('.option-card');

                options.forEach(option => {
                    if (option.dataset.answer === correctAnswer) {
                        option.classList.add('correct');
                    } else if (option.classList.contains('selected')) {
                        option.classList.add('incorrect');
                    }
                });

                if (userAnswer === correctAnswer) {
                    correctCount++;
                }
            });

            // Calcul du score
            challengeData.scores.synthesis = Math.round((correctCount / totalQuestions) * 100);
            challengeData.phases[3] = true;

            // Validation des comp√©tences
            if (correctCount >= 2) {
                challengeData.competences.c5 = true;
                challengeData.competences.c6 = true;
                challengeData.badges.synthesis = true;
                challengeData.badges.communication = true;
            }

            // Afficher le feedback
            showSynthesisFeedback(correctCount, totalQuestions);
            updatePerformanceDashboard();

            // Activer la certification
            setTimeout(() => {
                document.querySelector('[data-phase="4"]').style.pointerEvents = 'auto';
                document.querySelector('[data-phase="4"]').style.opacity = '1';
                switchPhase(4);
                
                // Calculer le score total et attribuer les badges
                calculateFinalResults();
            }, 2000);
        }

        // Calcul des r√©sultats finaux
        function calculateFinalResults() {
            // Score total
            challengeData.scores.total = Math.round(
                (challengeData.scores.quiz + challengeData.scores.caseStudy + challengeData.scores.synthesis) / 3
            );

            // Badge Master si excellence g√©n√©rale
            if (challengeData.scores.total >= 80) {
                challengeData.badges.master = true;
            }

            // Afficher les badges obtenus
            updateBadgeDisplay();
            updatePerformanceDashboard();
        }

        // Mise √† jour de l'affichage des badges
        function updateBadgeDisplay() {
            Object.keys(challengeData.badges).forEach(badgeId => {
                const badgeElement = document.getElementById(`badge-${badgeId}`);
                if (challengeData.badges[badgeId]) {
                    badgeElement.classList.add('earned');
                    badgeElement.classList.add('bounce');
                    setTimeout(() => badgeElement.classList.remove('bounce'), 1000);
                }
            });
        }

        // G√©n√©ration de la certification
        function generateCertification() {
            const summary = document.getElementById('certification-summary');
            const details = document.getElementById('certification-details');
            const tips = document.getElementById('improvement-tips');

            // Compter les √©l√©ments valid√©s
            const competencesCount = Object.values(challengeData.competences).filter(c => c).length;
            const badgesCount = Object.values(challengeData.badges).filter(b => b).length;

            // D√©tails de la certification
            let detailsHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 15px 0;">
                    <div style="text-align: center; padding: 15px; background: #f8fafc; border-radius: 8px;">
                        <div style="font-size: 1.5em; font-weight: 700; color: var(--primary-pse);">${challengeData.scores.total}%</div>
                        <div>Score Global</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #f8fafc; border-radius: 8px;">
                        <div style="font-size: 1.5em; font-weight: 700; color: var(--success-pse);">${competencesCount}/6</div>
                        <div>Comp√©tences Valid√©es</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #f8fafc; border-radius: 8px;">
                        <div style="font-size: 1.5em; font-weight: 700; color: var(--gold-pse);">${badgesCount}/5</div>
                        <div>Badges Obtenus</div>
                    </div>
                </div>
            `;

            details.innerHTML = detailsHTML;

            // Conseils personnalis√©s
            let tipsHTML = '<ul style="margin: 10px 0; padding-left: 20px;">';
            
            if (challengeData.scores.quiz < 80) {
                tipsHTML += '<li>R√©visez les missions sp√©cifiques de chaque acteur externe.</li>';
            }
            if (challengeData.scores.caseStudy < 70) {
                tipsHTML += '<li>Travaillez la coordination entre les diff√©rents acteurs.</li>';
            }
            if (challengeData.scores.synthesis < 70) {
                tipsHTML += '<li>D√©veloppez votre capacit√© de synth√®se et d\'argumentation.</li>';
            }
            if (!challengeData.badges.master) {
                tipsHTML += '<li>Excellente base ! Continuez √† approfondir pour atteindre l\'excellence.</li>';
            } else {
                tipsHTML += '<li>F√©licitations ! Votre ma√Ætrise du module C.3 est exemplaire.</li>';
            }
            
            tipsHTML += '</ul>';
            tips.innerHTML = tipsHTML;

            summary.style.display = 'block';
            summary.classList.add('fade-in');
            
            challengeData.phases[4] = true;
            updatePerformanceDashboard();
        }

        // Mise √† jour du tableau de bord
        function updatePerformanceDashboard() {
            // Score total
            document.getElementById('total-score').textContent = challengeData.scores.total;
            document.getElementById('score-detail').textContent = 
                `${challengeData.scores.total}/100 points`;

            // Comp√©tences valid√©es
            const competencesCount = Object.values(challengeData.competences).filter(c => c).length;
            document.getElementById('competences-validated').textContent = `${competencesCount}/6`;

            // Phases compl√©t√©es
            const phasesCount = Object.values(challengeData.phases).filter(p => p).length;
            document.getElementById('phase-progress').textContent = `${phasesCount}/4`;

            // Badges obtenus
            const badgesCount = Object.values(challengeData.badges).filter(b => b).length;
            document.getElementById('badges-earned').textContent = `${badgesCount}/5`;

            // Mise √† jour du style des cartes selon les performances
            updateCardStyles();
        }

        // Mise √† jour du style des cartes de performance
        function updateCardStyles() {
            const scoreCard = document.getElementById('score-card');
            const competencesCard = document.getElementById('competences-card');
            const phaseCard = document.getElementById('phase-card');
            const badgesCard = document.getElementById('badges-card');

            // Score
            if (challengeData.scores.total >= 80) {
                scoreCard.className = 'performance-card excellent';
            } else if (challengeData.scores.total >= 60) {
                scoreCard.className = 'performance-card good';
            } else {
                scoreCard.className = 'performance-card needs-work';
            }

            // Comp√©tences
            const competencesCount = Object.values(challengeData.competences).filter(c => c).length;
            if (competencesCount >= 5) {
                competencesCard.className = 'performance-card excellent';
            } else if (competencesCount >= 3) {
                competencesCard.className = 'performance-card good';
            } else {
                competencesCard.className = 'performance-card needs-work';
            }

            // Phases
            const phasesCount = Object.values(challengeData.phases).filter(p => p).length;
            if (phasesCount === 4) {
                phaseCard.className = 'performance-card excellent';
            } else if (phasesCount >= 2) {
                phaseCard.className = 'performance-card good';
            } else {
                phaseCard.className = 'performance-card needs-work';
            }

            // Badges
            const badgesCount = Object.values(challengeData.badges).filter(b => b).length;
            if (badgesCount >= 4) {
                badgesCard.className = 'performance-card excellent';
            } else if (badgesCount >= 2) {
                badgesCard.className = 'performance-card good';
            } else {
                badgesCard.className = 'performance-card needs-work';
            }
        }

        // Affichage des feedback sp√©cialis√©s
        function showQuizFeedback(correct, total) {
            const percentage = Math.round((correct / total) * 100);
            
            showCorrection({
                correct: correct === total,
                title: `Quiz Expert : ${correct}/${total} (${percentage}%)`,
                content: `
                    <div class="bonne-reponse">
                        <strong>üéØ Performance :</strong> ${correct} bonnes r√©ponses sur ${total}
                    </div>
                    <div class="explication">
                        <strong>üí° Comp√©tences valid√©es :</strong><br>
                        ${correct >= 4 ? 'C1, C2, C3 - Excellente ma√Ætrise des connaissances !' : 'R√©vision recommand√©e sur les missions des acteurs'}
                    </div>
                    <div class="astuce-bac">
                        <strong>üéì Astuce BAC :</strong><br>
                        M√©morisez les acronymes : CSE (‚â•11 sal.), SPST (m√©dical), CARSAT (‚Ç¨), IT (contr√¥le)
                    </div>
                `,
                points: challengeData.scores.quiz
            });
        }

        function showCaseStudyFeedback(score, maxScore) {
            const percentage = Math.round((score / maxScore) * 100);
            
            showCorrection({
                correct: score >= 70,
                title: `Cas Pratique : ${score}/${maxScore} points (${percentage}%)`,
                content: `
                    <div class="bonne-reponse">
                        <strong>üè¢ Analyse :</strong> ${score >= 70 ? 'Excellent' : '√Ä am√©liorer'} - Coordination des acteurs
                    </div>
                    <div class="explication">
                        <strong>üí° Points cl√©s :</strong><br>
                        ‚Ä¢ Employeur = responsabilit√© premi√®re<br>
                        ‚Ä¢ M√©decin du travail = expertise sant√©<br>
                        ‚Ä¢ CSE = repr√©sentation salari√©s + enqu√™te
                    </div>
                    <div class="astuce-bac">
                        <strong>üéì Astuce BAC :</strong><br>
                        Dans une situation complexe, toujours identifier QUI a la responsabilit√© l√©gale (employeur) avant les expertises
                    </div>
                `,
                points: score
            });
        }

        function showSynthesisFeedback(correct, total) {
            const percentage = Math.round((correct / total) * 100);
            
            showCorrection({
                correct: correct >= 2,
                title: `Synth√®se : ${correct}/${total} (${percentage}%)`,
                content: `
                    <div class="bonne-reponse">
                        <strong>üß† Vision globale :</strong> ${correct >= 2 ? 'Ma√Ætris√©e' : '√Ä d√©velopper'}
                    </div>
                    <div class="explication">
                        <strong>üí° Principe cl√© :</strong><br>
                        La pr√©vention efficace = dialogue + action technique + sanction en dernier recours
                    </div>
                    <div class="astuce-bac">
                        <strong>üéì Astuce BAC :</strong><br>
                        Chronologie type : SST (urgence) ‚Üí Employeur (enqu√™te/correction) ‚Üí CSE (contr√¥le) ‚Üí Externes (v√©rification)
                    </div>
                `,
                points: challengeData.scores.synthesis
            });
        }

        // Syst√®me de correction g√©n√©rique
        function showCorrection(data) {
            const overlay = document.getElementById('correction-overlay');
            const icon = document.getElementById('correction-icon');
            const iconText = document.getElementById('correction-icon-text');
            const title = document.getElementById('correction-title');
            const content = document.getElementById('correction-content');
            
            // Configuration de l'ic√¥ne
            if (data.correct) {
                icon.className = 'correction-icon success';
                iconText.textContent = '‚úì';
            } else {
                icon.className = 'correction-icon error';
                iconText.textContent = '‚úó';
            }
            
            title.textContent = data.title;
            content.innerHTML = data.content;
            
            overlay.style.display = 'flex';
        }

        function closeCorrection() {
            document.getElementById('correction-overlay').style.display = 'none';
        }

        // Red√©marrage du challenge
        function restartChallenge() {
            if (confirm('√ätes-vous s√ªr de vouloir red√©marrer le challenge ? Toutes vos donn√©es seront perdues.')) {
                // R√©initialiser toutes les donn√©es
                challengeData = {
                    currentPhase: 1,
                    scores: { quiz: 0, caseStudy: 0, synthesis: 0, total: 0 },
                    competences: { c1: false, c2: false, c3: false, c4: false, c5: false, c6: false },
                    badges: { knowledge: false, analysis: false, synthesis: false, communication: false, master: false },
                    phases: { 1: false, 2: false, 3: false, 4: false },
                    answers: { quiz: {}, caseStudy: {}, synthesis: {} }
                };

                // Recharger la page
                location.reload();
            }
        }

        // Fonctions utilitaires
        function showMessage(message, type = 'info') {
            if (type === 'warning') {
                alert('‚ö†Ô∏è ' + message);
            } else {
                alert('‚ÑπÔ∏è ' + message);
            }
        }

        // Configuration de l'accessibilit√©
        function setupClickableElements() {
            document.querySelectorAll('.clickable-element').forEach((element, index) => {
                element.setAttribute('tabindex', '0');
                element.setAttribute('role', 'button');
                element.setAttribute('aria-label', `√âl√©ment ${element.textContent} - Cliquez pour s√©lectionner`);
            });

            document.querySelectorAll('.assignment-zone').forEach((zone, index) => {
                zone.setAttribute('tabindex', '0');
                zone.setAttribute('role', 'button');
                zone.setAttribute('aria-label', `Zone d'assignation - ${zone.textContent}`);
            });

            document.querySelectorAll('.option-card').forEach((option, index) => {
                option.setAttribute('tabindex', '0');
                option.setAttribute('role', 'button');
                option.setAttribute('aria-label', `Option de r√©ponse - ${option.querySelector('.option-text').textContent}`);
            });
        }

        // Gestion du clavier pour l'accessibilit√©
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                if (e.target.classList.contains('clickable-element')) {
                    e.preventDefault();
                    e.target.click();
                } else if (e.target.classList.contains('assignment-zone')) {
                    e.preventDefault();
                    e.target.click();
                } else if (e.target.classList.contains('option-card')) {
                    e.preventDefault();
                    e.target.click();
                }
            }
        });
    </script>
</body>
</html>