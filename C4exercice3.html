<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>PSE — Compétence C4 — Exercice 1</title>
  <style>
:root{
  --bg:#0b1020;
  --card:#111a33;
  --card2:#0f1730;
  --text:#eaf0ff;
  --muted:#b8c4e6;
  --line:rgba(255,255,255,.12);
  --ok:#33d17a;
  --bad:#ff5c7a;
  --warn:#ffd166;
  --accent:#7aa2ff;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:linear-gradient(180deg,#080b17 0%,#0b1020 35%,#070a14 100%);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
a{color:inherit}
.wrap{max-width:980px;margin:0 auto;padding:18px 14px 40px}
.header{
  padding:16px 16px 14px;border:1px solid var(--line);border-radius:18px;
  background:radial-gradient(1200px 350px at 20% 0%, rgba(122,162,255,.22), transparent 55%),
             radial-gradient(900px 320px at 90% 10%, rgba(51,209,122,.15), transparent 55%),
             linear-gradient(180deg, rgba(17,26,51,.92), rgba(15,23,48,.92));
}
.h-top{display:flex;gap:12px;align-items:flex-start;justify-content:space-between;flex-wrap:wrap}
.badge{
  display:inline-flex;align-items:center;gap:8px;
  padding:7px 10px;border-radius:999px;border:1px solid var(--line);
  background:rgba(255,255,255,.04);color:var(--muted);font-size:12.5px
}
.badge b{color:var(--text)}
h1{margin:6px 0 6px;font-size:22px;letter-spacing:.2px}
.sub{margin:0;color:var(--muted);font-size:14px;line-height:1.35}
.grid{display:grid;grid-template-columns:1fr;gap:12px;margin-top:12px}
@media(min-width:840px){.grid{grid-template-columns:1.05fr .95fr}}
.card{
  border:1px solid var(--line);border-radius:18px;background:rgba(17,26,51,.68);
  padding:14px 14px 12px;box-shadow:0 10px 34px rgba(0,0,0,.25)
}
.card h2{margin:0 0 10px;font-size:16px}
.p{margin:0 0 10px;color:var(--muted);line-height:1.45;font-size:14px}
.steps{display:grid;gap:8px;margin:10px 0 0}
.step{
  display:flex;gap:10px;align-items:flex-start;padding:10px;border-radius:14px;border:1px solid var(--line);
  background:rgba(255,255,255,.03)
}
.num{
  width:28px;height:28px;border-radius:9px;border:1px solid var(--line);
  display:grid;place-items:center;color:var(--text);font-weight:700;background:rgba(122,162,255,.12)
}
.step b{display:block;margin-bottom:2px}
.kit{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
.pill{
  display:inline-flex;gap:6px;align-items:center;padding:7px 10px;border-radius:999px;
  border:1px solid var(--line);background:rgba(255,255,255,.03);color:var(--muted);font-size:13px
}
.pill span{color:var(--text);font-weight:650}
hr.sep{border:0;border-top:1px dashed rgba(255,255,255,.15);margin:12px 0}
.ex{margin-top:12px}
.ex-head{display:flex;align-items:flex-start;justify-content:space-between;gap:10px;flex-wrap:wrap}
.ex h3{margin:0;font-size:16px}
.meta{color:var(--muted);font-size:13px}
.box{
  border:1px solid var(--line);border-radius:16px;background:rgba(15,23,48,.65);
  padding:12px;margin-top:10px
}
.q{margin:0 0 10px;font-size:14px;line-height:1.4}
.opts{display:grid;gap:8px}
.opt{
  display:flex;gap:10px;align-items:flex-start;padding:10px;border-radius:14px;border:1px solid var(--line);
  background:rgba(255,255,255,.03)
}
.opt input{margin-top:2px;transform:scale(1.05)}
.opt label{cursor:pointer;display:block}
.btnrow{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
button{
  appearance:none;border:1px solid var(--line);background:rgba(255,255,255,.06);
  color:var(--text);padding:10px 12px;border-radius:14px;font-weight:650;cursor:pointer;
  transition:transform .06s ease, background .15s ease
}
button:active{transform:scale(.98)}
button.primary{background:rgba(122,162,255,.18)}
button.good{background:rgba(51,209,122,.14)}
button.bad{background:rgba(255,92,122,.14)}
.small{font-size:13px;color:var(--muted)}
.feedback{
  margin-top:10px;padding:10px;border-radius:14px;border:1px solid var(--line);
  background:rgba(255,255,255,.03);color:var(--muted);font-size:13.5px;line-height:1.45
}
.feedback b{color:var(--text)}
.scorebar{
  display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;
  padding:10px 12px;border-radius:16px;border:1px solid var(--line);
  background:rgba(255,255,255,.03);margin-top:12px
}
.total{font-weight:800}
.progress{
  flex:1;min-width:170px;height:10px;border-radius:999px;border:1px solid var(--line);
  background:rgba(0,0,0,.25);overflow:hidden
}
.progress > div{height:100%;width:0%;background:linear-gradient(90deg, rgba(122,162,255,.8), rgba(51,209,122,.8))}
.bank{
  display:flex;flex-wrap:wrap;gap:8px;padding:10px;border-radius:14px;border:1px dashed rgba(255,255,255,.18);
  background:rgba(0,0,0,.18);min-height:54px
}
.token{
  user-select:none;touch-action:manipulation;
  display:inline-flex;align-items:center;gap:8px;
  padding:8px 10px;border-radius:999px;border:1px solid var(--line);
  background:rgba(255,255,255,.04);color:var(--text);font-size:13px;font-weight:650;
}
.token[data-selected="true"]{outline:2px solid rgba(122,162,255,.7);background:rgba(122,162,255,.14)}
.dropgrid{display:grid;grid-template-columns:1fr;gap:10px;margin-top:10px}
@media(min-width:720px){.dropgrid{grid-template-columns:1fr 1fr}}
.drop{
  padding:10px;border-radius:14px;border:1px solid var(--line);
  background:rgba(255,255,255,.03);min-height:64px
}
.drop .cap{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:6px}
.drop .cap b{font-size:13px}
.drop .cap span{font-size:12px;color:var(--muted)}
.slot{display:flex;flex-wrap:wrap;gap:8px;min-height:38px}
.note{
  margin-top:10px;padding:10px;border-radius:14px;border:1px solid rgba(255,255,255,.14);
  background:rgba(255,209,102,.08);color:var(--muted);font-size:13.5px;line-height:1.45
}
.note b{color:var(--text)}
textarea, input[type="text"]{
  width:100%;border:1px solid var(--line);background:rgba(0,0,0,.18);
  color:var(--text);padding:10px;border-radius:14px;font-size:14px;line-height:1.4
}
textarea{min-height:92px;resize:vertical}
.footer{margin-top:14px;color:var(--muted);font-size:12.5px;line-height:1.45}
</style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="h-top">
        <div>
          <div class="badge"><b>PSE</b> • Compétence <b>C4</b> • Proposer une solution</div>
          <h1>Entraînement C4 — Santé & Sécurité au travail</h1>
          <p class="sub">Objectif : proposer des mesures concrètes, réalistes et adaptées à la situation (individuelles ou collectives).</p>
        </div>
        <div class="badge">Astuce • Sur smartphone : touche une étiquette, puis touche la zone où tu veux la placer.</div>
      </div>

      <div class="grid">
        <div class="card">
          <h2>Ce que veut dire C4</h2>
          <p class="p">Tu ne dois pas expliquer un phénomène (ça, c’est C3). Tu dois dire <b>quoi faire</b> pour résoudre le problème ou réduire le risque.</p>
          <div class="steps">
            <div class="step"><div class="num">1</div><div><b>Repère le problème</b><div class="small">Quel risque ? Quel besoin ? Quel objectif ?</div></div></div>
            <div class="step"><div class="num">2</div><div><b>Choisis le type d’action</b><div class="small">Individuelle / collective • immédiate / durable</div></div></div>
            <div class="step"><div class="num">3</div><div><b>Formule une action précise</b><div class="small">Verbe d’action + quoi + comment + pour quoi</div></div></div>
          </div>
          <div class="note"><b>C6 (écrit)</b> : phrases complètes, vocabulaire précis, mots de liaison (car, donc, afin de, pour…).</div>
        </div>

        <div class="card">
          <h2>Verbes utiles</h2>
          <div class="kit">
            <div class="pill"><span>Proposer</span> une mesure</div>
            <div class="pill"><span>Préconiser</span> une action</div>
            <div class="pill"><span>Mettre en place</span> un dispositif</div>
            <div class="pill"><span>Aménager</span> un poste</div>
            <div class="pill"><span>Former</span> les salariés</div>
            <div class="pill"><span>Limiter</span> une exposition</div>
          </div>
          <hr class="sep"/>
          <div class="scorebar">
            <div><span class="meta">Score</span> <span class="total"><span id="scoreNow">0</span>/<span id="scoreMax">0</span></span></div>
            <div class="progress" aria-label="progression"><div id="bar"></div></div>
            <div class="meta" id="pct">0%</div>
            <button class="primary" onclick="resetAll()">Recommencer</button>
          </div>
        </div>
      </div>
    </div>

    <div class="card ex" data-ex="ex1">
      <div class="ex-head">
        <h3>Exercice 1 — Sommeil</h3>
        <div class="meta">2 points</div>
      </div>
      <div class="box">
        <p class="q"><b>Situation</b> : tu veux améliorer la qualité de ton sommeil.<br/>
        <b>Consigne</b> : propose <b>2 mesures individuelles</b> (choisis exactement 2).</p>

        <div class="opts">

          <div class="opt">
            <input id="e1_0" type="checkbox" name="ex1" value="exc"/>
            <label for="e1_0">Éviter les produits excitants (café, boissons énergisantes) en fin de journée.</label>
          </div>

          <div class="opt">
            <input id="e1_1" type="checkbox" name="ex1" value="reg"/>
            <label for="e1_1">Se coucher et se lever à des heures régulières.</label>
          </div>

          <div class="opt">
            <input id="e1_2" type="checkbox" name="ex1" value="ecr"/>
            <label for="e1_2">Couper les écrans 1 heure avant de dormir (ou mode nuit + luminosité réduite).</label>
          </div>

          <div class="opt">
            <input id="e1_3" type="checkbox" name="ex1" value="cal"/>
            <label for="e1_3">Faire une activité calme avant le coucher (lecture, respiration, musique douce).</label>
          </div>

          <div class="opt">
            <input id="e1_4" type="checkbox" name="ex1" value="temp"/>
            <label for="e1_4">Dormir dans une chambre fraîche et aérée.</label>
          </div>

          <div class="opt">
            <input id="e1_5" type="checkbox" name="ex1" value="fat"/>
            <label for="e1_5">Se coucher dès les premiers signes de fatigue (bâillements, yeux qui piquent).</label>
          </div>
        </div>

        <div class="btnrow">
          <button class="good" id="btnEx1">Corriger</button>
          <button id="btnEx1Show">Voir la correction</button>
        </div>
        <div class="feedback" id="fbEx1" style="display:none"></div>
      </div>
    </div>

    <div class="card ex" data-ex="ex2">
      <div class="ex-head">
        <h3>Exercice 2 — Prévenir les TMS</h3>
        <div class="meta">2 points</div>
      </div>
      <div class="box">
        <p class="q"><b>Situation</b> : gestes répétitifs + contraintes posturales au travail.<br/>
        <b>Consigne</b> : propose <b>2 mesures</b> pour prévenir l’apparition des TMS (choisis exactement 2).</p>

        <div class="opts">

          <div class="opt">
            <input id="e2_0" type="checkbox" name="ex2" value="auto"/>
            <label for="e2_0">Automatiser une partie des tâches (machines/outils).</label>
          </div>

          <div class="opt">
            <input id="e2_1" type="checkbox" name="ex2" value="pause"/>
            <label for="e2_1">Prévoir des pauses et réduire la durée d’exposition aux gestes répétitifs.</label>
          </div>

          <div class="opt">
            <input id="e2_2" type="checkbox" name="ex2" value="erg"/>
            <label for="e2_2">Aménager le poste de travail (hauteur plan, posture, outils adaptés).</label>
          </div>

          <div class="opt">
            <input id="e2_3" type="checkbox" name="ex2" value="rot"/>
            <label for="e2_3">Varier les tâches (rotation) pour éviter la répétition continue.</label>
          </div>

          <div class="opt">
            <input id="e2_4" type="checkbox" name="ex2" value="prap"/>
            <label for="e2_4">Former à la prévention (PRAP/gestes et postures).</label>
          </div>

          <div class="opt">
            <input id="e2_5" type="checkbox" name="ex2" value="sil"/>
            <label for="e2_5">Travailler en silence total pour éviter le stress.</label>
          </div>
        </div>

        <div class="btnrow">
          <button class="good" id="btnEx2">Corriger</button>
          <button id="btnEx2Show">Voir la correction</button>
        </div>
        <div class="feedback" id="fbEx2" style="display:none"></div>
      </div>
    </div>

    <div class="card ex" data-ex="ex3">
      <div class="ex-head">
        <h3>Exercice 3 — Classer des mesures</h3>
        <div class="meta">4 points</div>
      </div>
      <div class="box">
        <p class="q"><b>Consigne</b> : classe chaque mesure dans la bonne catégorie.<br/>
        <span class="small">Sur smartphone : touche une étiquette (elle se surligne), puis touche une zone pour la déposer. Touche la banque pour la remettre.</span></p>

        <div class="bank" id="bank3">
<div class="token" data-id="t0">Installer une signalétique très visible sur des cuves/produits</div>
<div class="token" data-id="t1">Former les salariés aux risques chimiques et aux procédures</div>
<div class="token" data-id="t2">Porter un masque adapté (EPI) quand c’est nécessaire</div>
<div class="token" data-id="t3">Mettre en place une rotation des tâches</div>
<div class="token" data-id="t4">Prévoir des micro‑pauses régulières</div>
<div class="token" data-id="t5">Aménager la hauteur du plan de travail</div>
<div class="token" data-id="t6">Limiter les écrans avant le coucher</div>
<div class="token" data-id="t7">Rendre la chambre plus sombre (rideaux occultants)</div>
<div class="token" data-id="t8">Automatiser une tâche très répétitive</div>
<div class="token" data-id="t9">Utiliser des outils ergonomiques</div>
        </div>

        <div class="dropgrid" id="drops3">
          <div class="drop" data-key="collectif">
            <div class="cap"><b>Mesures collectives</b><span>organisation / matériel / formation</span></div>
            <div class="slot"></div>
          </div>
          <div class="drop" data-key="individuel">
            <div class="cap"><b>Mesures individuelles</b><span>comportement / EPI</span></div>
            <div class="slot"></div>
          </div>
        </div>

        <div class="btnrow">
          <button class="good" id="btnEx3">Corriger</button>
          <button id="btnEx3Reset">Réinitialiser</button>
          <button id="btnEx3Show">Voir la correction</button>
        </div>
        <div class="feedback" id="fbEx3" style="display:none"></div>
      </div>
    </div>

    <div class="card ex" data-ex="ex4">
      <div class="ex-head">
        <h3>Exercice 4 — Réduire sa consommation d’eau</h3>
        <div class="meta">4 points</div>
      </div>
      <div class="box">
        <p class="q"><b>Consigne</b> : choisis <b>4 mesures individuelles</b> pour réduire ta consommation d’eau (exactement 4).</p>

        <div class="opts">

          <div class="opt">
            <input id="e4_0" type="checkbox" name="ex4" value="douche"/>
            <label for="e4_0">Prendre des douches courtes plutôt que des bains.</label>
          </div>

          <div class="opt">
            <input id="e4_1" type="checkbox" name="ex4" value="plein"/>
            <label for="e4_1">Lancer lave-linge/lave-vaisselle seulement quand ils sont pleins.</label>
          </div>

          <div class="opt">
            <input id="e4_2" type="checkbox" name="ex4" value="eco"/>
            <label for="e4_2">Choisir des appareils économes en eau.</label>
          </div>

          <div class="opt">
            <input id="e4_3" type="checkbox" name="ex4" value="pluie"/>
            <label for="e4_3">Récupérer l’eau de pluie pour l’arrosage.</label>
          </div>

          <div class="opt">
            <input id="e4_4" type="checkbox" name="ex4" value="double"/>
            <label for="e4_4">Installer une chasse d’eau à double commande.</label>
          </div>

          <div class="opt">
            <input id="e4_5" type="checkbox" name="ex4" value="jet"/>
            <label for="e4_5">Laisser couler l’eau en continu pendant le brossage des dents.</label>
          </div>

          <div class="opt">
            <input id="e4_6" type="checkbox" name="ex4" value="rinse"/>
            <label for="e4_6">Rincer la vaisselle sous l’eau en continu sans bac.</label>
          </div>
        </div>

        <div class="btnrow">
          <button class="good" id="btnEx4">Corriger</button>
          <button id="btnEx4Show">Voir la correction</button>
        </div>
        <div class="feedback" id="fbEx4" style="display:none"></div>
      </div>
    </div>

    <div class="footer">
      <div class="badge">Conseil • Une mesure C4 doit être <b>concrète</b> (pas vague), <b>réaliste</b> et <b>adaptée</b> au contexte.</div>
    </div>
  </div>

<script>

const qs = (sel, root=document) => root.querySelector(sel);
const qsa = (sel, root=document) => Array.from(root.querySelectorAll(sel));
const state = { score: 0, max: 0, done: {} };

function setScore(delta){
  state.score += delta;
  state.score = Math.max(0, state.score);
  qs("#scoreNow").textContent = state.score;
  qs("#scoreMax").textContent = state.max;
  const pct = state.max ? Math.round((state.score/state.max)*100) : 0;
  qs("#bar").style.width = pct + "%";
  qs("#pct").textContent = pct + "%";
}

function lock(exId){
  state.done[exId] = true;
  qsa(`[data-ex="${exId}"] button`).forEach(b=> b.disabled = true);
}

function resetAll(){
  location.reload();
}

function unique(arr){ return Array.from(new Set(arr)); }

function normalize(s){
  return (s||"").toLowerCase()
    .normalize("NFD").replace(/[\u0300-\u036f]/g,"")
    .replace(/[^a-z0-9\s'-]/g," ")
    .replace(/\s+/g," ")
    .trim();
}

// Tap-to-place + Drag support
function makeTokenSystem(root){
  let selectedId = null;
  const bank = root.querySelector(".bank");
  const drops = Array.from(root.querySelectorAll(".drop"));

  function setSelected(id){
    selectedId = id;
    root.querySelectorAll(".token").forEach(t=>{
      t.dataset.selected = (t.dataset.id === id) ? "true" : "false";
    });
  }

  function moveTokenTo(tokenEl, targetSlot){
    if(!tokenEl || !targetSlot) return;
    targetSlot.appendChild(tokenEl);
    setSelected(null);
  }

  function findToken(id){ return root.querySelector(`.token[data-id="${id}"]`); }

  root.querySelectorAll(".token").forEach(t=>{
    t.addEventListener("click", ()=>{
      const id = t.dataset.id;
      if(selectedId === id) setSelected(null);
      else setSelected(id);
    }, {passive:true});

    t.draggable = true;
    t.addEventListener("dragstart", (e)=>{
      e.dataTransfer.setData("text/plain", t.dataset.id);
      e.dataTransfer.effectAllowed = "move";
      setSelected(t.dataset.id);
    });
  });

  function handleDropSlot(slot, e){
    e.preventDefault();
    const id = e.dataTransfer ? e.dataTransfer.getData("text/plain") : selectedId;
    if(!id) return;
    const token = findToken(id);
    if(!token) return;
    moveTokenTo(token, slot);
  }

  root.querySelectorAll(".slot").forEach(slot=>{
    slot.addEventListener("click", ()=>{
      if(!selectedId) return;
      const token = findToken(selectedId);
      moveTokenTo(token, slot);
    }, {passive:true});

    slot.addEventListener("dragover", (e)=>{ e.preventDefault(); });
    slot.addEventListener("drop", (e)=> handleDropSlot(slot, e));
  });

  if(bank){
    bank.addEventListener("click", ()=>{
      if(!selectedId) return;
      const token = findToken(selectedId);
      if(token) bank.appendChild(token);
      setSelected(null);
    }, {passive:true});

    bank.addEventListener("dragover", (e)=>{ e.preventDefault(); });
    bank.addEventListener("drop", (e)=>{
      e.preventDefault();
      const id = e.dataTransfer.getData("text/plain");
      const token = findToken(id);
      if(token) bank.appendChild(token);
      setSelected(null);
    });
  }

  return {
    getPlacements(){
      const res = {};
      drops.forEach(d=>{
        const k = d.dataset.key;
        const ids = Array.from(d.querySelectorAll(".token")).map(t=>t.dataset.id);
        res[k] = ids;
      });
      return res;
    },
    reset(){
      if(!bank) return;
      root.querySelectorAll(".token").forEach(t=> bank.appendChild(t));
      setSelected(null);
    }
  };
}


(function init(){
  state.max = 2 + 2 + 4 + 4;
  qs("#scoreMax").textContent = state.max;

  // Ex1
  const ex1 = qs('[data-ex="ex1"]');
  qs("#btnEx1").addEventListener("click", ()=>{
    if(state.done.ex1) return;
    const sel = qsa('input[name="ex1"]', ex1).filter(i=>i.checked).map(i=>i.value);
    const ok = (sel.length===2) && sel.every(v=>["exc","reg","fat"].includes(v));
    const gained = ok ? 2 : 0;
    setScore(gained);
    qs("#fbEx1").style.display="block";
    qs("#fbEx1").innerHTML = ok
      ? "<b>✅ Bravo.</b> Tu as proposé 2 mesures attendues."
      : "<b>❌ Pas encore.</b> Coche exactement 2 mesures attendues : éviter les excitants, horaires réguliers, se coucher dès les signes de fatigue.";
    lock("ex1");
  });
  qs("#btnEx1Show").addEventListener("click", ()=>{
    qs("#fbEx1").style.display="block";
    qs("#fbEx1").innerHTML = "<b>Correction</b> : éviter les produits excitants ; se coucher à heures régulières ; se coucher dès les premiers signes de fatigue.";
  });

  // Ex2
  const ex2 = qs('[data-ex="ex2"]');
  qs("#btnEx2").addEventListener("click", ()=>{
    if(state.done.ex2) return;
    const sel = qsa('input[name="ex2"]', ex2).filter(i=>i.checked).map(i=>i.value);
    const ok = (sel.length===2) && sel.every(v=>["auto","pause","erg","rot","prap"].includes(v)) && !sel.includes("sil");
    const gained = ok ? 2 : 0;
    setScore(gained);
    qs("#fbEx2").style.display="block";
    qs("#fbEx2").innerHTML = ok
      ? "<b>✅ Correct.</b> Tes mesures sont pertinentes pour réduire l’exposition et améliorer l’ergonomie."
      : "<b>❌ À revoir.</b> Choisis exactement 2 mesures de prévention (ex. automatisation, pauses, aménagement, variation des tâches, formation PRAP).";
    lock("ex2");
  });
  qs("#btnEx2Show").addEventListener("click", ()=>{
    qs("#fbEx2").style.display="block";
    qs("#fbEx2").innerHTML = "<b>Correction</b> (exemples) : automatiser ; prévoir des pauses ; aménager le poste ; varier les tâches ; former PRAP.";
  });

  // Ex3 token system
  const ex3 = qs('[data-ex="ex3"]');
  const sys3 = makeTokenSystem(ex3);

  const correct3 = {
    collectif: ["t0","t1","t3","t4","t5","t8","t9"],
    individuel: ["t2","t6","t7"]
  };

  function gradeEx3(){
    const place = sys3.getPlacements();
    const allIds = Object.values(place).flat();
    const uniqAll = unique(allIds);
    let good=0;
    let wrong=0;

    uniqAll.forEach(id=>{
      const inC = (place.collectif || []).includes(id);
      const inI = (place.individuel || []).includes(id);
      if(inC && correct3.collectif.includes(id)) good++;
      else if(inC) wrong++;
      if(inI && correct3.individuel.includes(id)) good++;
      else if(inI) wrong++;
    });

    const raw = Math.max(0, good - wrong);
    const maxRaw = 10;
    const points = Math.round((raw/maxRaw)*4);
    const ok = points>=3;
    return {points, good, wrong, ok};
  }

  qs("#btnEx3").addEventListener("click", ()=>{
    if(state.done.ex3) return;
    const r = gradeEx3();
    setScore(r.points);
    qs("#fbEx3").style.display="block";
    qs("#fbEx3").innerHTML = (r.ok ? "<b>✅ Bien joué.</b> " : "<b>❌ À améliorer.</b> ") +
      "Score exercice : <b>" + r.points + "/4</b>. (Bien placés : " + r.good + " • erreurs : " + r.wrong + ")";
    lock("ex3");
  });
  qs("#btnEx3Reset").addEventListener("click", ()=>{ sys3.reset(); });
  qs("#btnEx3Show").addEventListener("click", ()=>{
    qs("#fbEx3").style.display="block";
    qs("#fbEx3").innerHTML = "<b>Correction</b> :<br/>" +
      "Collectif : signalétique, formation, rotation des tâches, micro‑pauses organisées, aménagement du poste, automatisation, outils ergonomiques.<br/>" +
      "Individuel : porter un masque (EPI), limiter les écrans, rendre la chambre plus sombre.";
  });

  // Ex4
  const ex4 = qs('[data-ex="ex4"]');
  qs("#btnEx4").addEventListener("click", ()=>{
    if(state.done.ex4) return;
    const sel = qsa('input[name="ex4"]', ex4).filter(i=>i.checked).map(i=>i.value);
    const correct = ["douche","plein","eco","pluie","double"];
    const ok = (sel.length===4) && sel.every(v=>correct.includes(v));
    const gained = ok ? 4 : 0;
    setScore(gained);
    qs("#fbEx4").style.display="block";
    qs("#fbEx4").innerHTML = ok
      ? "<b>✅ Parfait.</b> Tu as proposé 4 mesures individuelles adaptées."
      : "<b>❌ Pas encore.</b> Choisis exactement 4 mesures pertinentes (douche courte, machines pleines, appareils économes, eau de pluie, double commande).";
    lock("ex4");
  });
  qs("#btnEx4Show").addEventListener("click", ()=>{
    qs("#fbEx4").style.display="block";
    qs("#fbEx4").innerHTML = "<b>Correction</b> (exemples) : douches courtes ; machines pleines ; appareils économes ; récupérer l’eau de pluie ; chasse d’eau double commande.";
  });

})();
</script>
</body>
</html>
