<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Module D2 - Situation Carla (paysage)</title>
  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --ink:#1f2937;
      --muted:#6b7280;
      --accent:#0f766e;
      --line:#e5e7eb;
      --ok:#16a34a;
      --bad:#dc2626;
      --warn:#b45309;
      --shadow:0 10px 25px rgba(0,0,0,.06);
      --radius:18px;
      --pad:16px;
      --max:1240px;
      --focus:0 0 0 3px rgba(15,118,110,.22);
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --fs: 16.5px;
      --lh: 1.45;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--font);
      font-size:var(--fs);
      line-height:var(--lh);
      color:var(--ink);
      background:linear-gradient(180deg, #fff, var(--bg));
    }
    .wrap{max-width:var(--max); margin:0 auto; padding:18px 14px 26px}

    /* Header compact */
    header{
      display:flex; gap:12px; align-items:flex-start; justify-content:space-between;
      padding:14px 16px; background:var(--card); border:1px solid var(--line);
      border-radius:var(--radius); box-shadow:var(--shadow);
      margin-bottom:12px;
    }
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px; border-radius:999px; border:1px solid var(--line);
      color:var(--muted); background:#fff;
      font-size:13px; font-weight:950;
    }
    h1{margin:8px 0 4px; font-size:22px; line-height:1.2}
    .sub{color:var(--muted); margin:0; font-size:14px}
    .h-right{display:flex; flex-direction:column; gap:10px; align-items:flex-end}
    .btn{
      border:1px solid var(--line); background:#fff; color:var(--ink);
      padding:10px 12px; border-radius:12px; cursor:pointer;
      font-weight:950; font-size:14px;
      box-shadow:0 2px 8px rgba(0,0,0,.04);
      user-select:none;
    }
    .btn:hover{border-color:#d1d5db}
    .btn:focus{outline:none; box-shadow:var(--focus)}
    .btn.primary{background:linear-gradient(180deg, #0f766e, #0b5f58); color:#fff; border-color:#0b5f58}
    .pill{
      font-family:var(--mono);
      padding:6px 10px; border-radius:999px; border:1px solid var(--line);
      background:#fff; color:var(--muted); font-size:13px; font-weight:950;
    }

    /* Layout: situation top center; exercises bottom in two columns (landscape feel) */
    .top{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:var(--pad);
      text-align:center;
    }
    .top h2{
      margin:0 0 10px;
      font-size:18px;
      text-align:left;
    }
    .docBox{
      border:1px solid var(--line);
      border-radius:18px;
      overflow:hidden;
      background:#fff;
      margin:0 auto;
      max-width:1000px;
    }
    .docHead{
      padding:10px 12px;
      background:rgba(17,24,39,.03);
      border-bottom:1px solid var(--line);
      display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap;
      text-align:left;
    }
    .docHead b{font-size:14px}
    .docHead .small{color:var(--muted); font-size:13px}
    .docImg{display:block; width:100%; height:auto}

    .bottom{
      margin-top:12px;
      display:grid;
      grid-template-columns:1fr;
      gap:12px;
    }
    @media (min-width: 980px){
      .bottom{grid-template-columns: 1fr 1fr;}
    }

    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:var(--pad);
      min-width:0;
    }

    .footer{
      margin-top:12px;
      display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap;
    }
    .progress{
      width:100%; height:12px; border-radius:999px;
      background:#eef2f7; overflow:hidden; border:1px solid var(--line);
    }
    .bar{height:100%; width:0%; background:linear-gradient(90deg, #0f766e, #7c2d12)}
    .small{font-size:13px; color:var(--muted)}
    .mono{font-family:var(--mono)}

    .q{
      margin-top:10px;
      border:1px solid var(--line);
      border-radius:18px;
      padding:12px;
      background:linear-gradient(180deg, rgba(17,24,39,.02), rgba(17,24,39,.00));
    }
    .qhead{
      display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;
      margin-bottom:8px;
    }
    .qtitle{font-weight:950}
    .scoreTag{
      font-family:var(--mono);
      font-size:13px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:#fff;
      color:var(--muted);
      font-weight:950;
    }
    .muted{color:var(--muted)}
    .opt{
      display:flex; gap:10px; align-items:flex-start;
      padding:10px; border:1px solid var(--line); border-radius:16px; background:#fff;
      margin:10px 0;
    }
    .opt input{margin-top:3px}
    label{cursor:pointer}

    .row{
      display:grid; grid-template-columns:1fr; gap:10px;
      padding:10px; border:1px solid var(--line); border-radius:16px; background:#fff;
      margin-top:10px;
    }
    @media (min-width: 560px){ .row{grid-template-columns: 1fr 1fr;} }

    input[type="text"]{
      width:100%;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid var(--line);
      background:#fff;
      font-size:15px;
    }
    input:focus{outline:none; box-shadow:var(--focus)}

    .actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
    .tag{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px; border-radius:999px; border:1px solid var(--line);
      background:#fff; font-weight:950; font-size:13px; color:var(--muted);
    }
    .ok{color:var(--ok); border-color:rgba(22,163,74,.3); background:rgba(22,163,74,.06)}
    .bad{color:var(--bad); border-color:rgba(220,38,38,.3); background:rgba(220,38,38,.06)}
    .warnTag{color:var(--warn); border-color:rgba(180,83,9,.3); background:rgba(180,83,9,.06)}
    .feedback{margin-top:10px}
    .fbLine{margin:6px 0; padding:8px 10px; border-radius:14px; border:1px solid var(--line); background:#fff}

    /* Print landscape */
    @media print{
      @page { size: A4 landscape; margin: 10mm; }
      body{background:#fff}
      header, .top, .card{box-shadow:none}
      .btn{display:none}
      .wrap{max-width:none; padding:0}
      .docBox{max-width:none}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div>
        <div class="badge">MODULE D2</div>
        <h1>Situation Carla</h1>
        <p class="sub">Objectif : etre capable d’analyser une situation et d’identifier les elements utiles pour constituer une epargne.</p>
      </div>
      <div class="h-right">
        <div class="pill" id="saveState">Sauvegarde : active</div>
        <button class="btn" type="button" id="btnReset">Reinitialiser</button>
      </div>
    </header>

    <!-- Situation en haut, centre -->
    <section class="top">
      <h2>Situation</h2>
      <div class="docBox">
        <div class="docHead">
          <b>Bande dessinee</b>
          <span class="small">Bande dessinee</span>
        </div>
        <img class="docImg" src="bd-carla-smartphone.jpg" alt="Situation Carla" />
      </div>

      <div class="footer">
        <div style="min-width:220px; flex:1">
          <div class="small">Progression</div>
          <div class="progress" aria-label="progression">
            <div class="bar" id="bar"></div>
          </div>
        </div>
        <div class="pill mono" id="globalScore">Score : 0 / 10</div>
      </div>

      <div class="small" style="margin-top:10px; text-align:left">
        Note finale sur 20 : score auto /10 + points C6 (0 a 10) ajoutes par l’enseignant si besoin.
      </div>
    </section>

    <!-- Exercices en bas -->
    <section class="bottom">
      <div class="card">
        <h2>Analyser la situation</h2>
        <p class="muted" style="margin-top:-4px">Competence C2</p>

        <div class="q" id="q1">
          <div class="qhead">
            <div class="qtitle">1) Identifier le probleme pose dans la situation</div>
            <div class="scoreTag">C2 • 2 pts</div>
          </div>

          <div class="muted">Consigne : Cocher la proposition exacte.</div>

          <div class="opt">
            <input type="radio" name="pb" id="pb1" value="credit" />
            <label for="pb1">Le credit a la consommation.</label>
          </div>

          <div class="opt">
            <input type="radio" name="pb" id="pb2" value="fete" />
            <label for="pb2">L’organisation d’une fete d’anniversaire.</label>
          </div>

          <div class="opt">
            <input type="radio" name="pb" id="pb3" value="epargne" />
            <label for="pb3">La constitution d’une epargne pour financer un achat.</label>
          </div>

          <div class="actions">
            <button class="btn" type="button" data-correct="q1">Corriger</button>
            <span class="tag warnTag" id="q1tag">A faire</span>
          </div>
          <div class="feedback" id="q1fb"></div>
        </div>
      </div>

      <div class="card">
        <h2>Identifier les elements</h2>
        <p class="muted" style="margin-top:-4px">Competence C2</p>

        <div class="q" id="q2">
          <div class="qhead">
            <div class="qtitle">2) Identifier les elements de la situation</div>
            <div class="scoreTag">C2 • 8 pts</div>
          </div>

          <div class="muted">Consigne : Renseigner les rubriques suivantes.</div>

          <div class="row">
            <div>
              <label class="small" for="proj">Projet de Carla</label>
              <input id="proj" type="text" placeholder="Ecrire ici" />
            </div>
            <div>
              <label class="small" for="sal">Montant du salaire mensuel (en €)</label>
              <input id="sal" type="text" inputmode="decimal" placeholder="Ecrire ici" />
            </div>
          </div>

          <div class="row">
            <div>
              <label class="small" for="montant">Montant du projet (en €)</label>
              <input id="montant" type="text" inputmode="decimal" placeholder="Ecrire ici" />
            </div>
            <div>
              <label class="small" for="temps">Temps pour economiser (en mois)</label>
              <input id="temps" type="text" inputmode="numeric" placeholder="Ecrire ici" />
            </div>
          </div>

          <div class="row">
            <div>
              <label class="small" for="epargne">Montant de l’epargne mensuelle a constituer (en €)</label>
              <input id="epargne" type="text" inputmode="decimal" placeholder="Ecrire ici" />
            </div>
            <div class="muted small">
              Aide : epargne mensuelle = montant du projet ÷ nombre de mois.
            </div>
          </div>

          <div class="actions">
            <button class="btn" type="button" data-correct="q2">Corriger</button>
            <button class="btn primary" type="button" id="btnFinal">Calculer le score auto</button>
            <button class="btn" type="button" id="btnExport">Exporter la copie</button>
            <span class="tag warnTag" id="q2tag">A faire</span>
          </div>
          <div class="feedback" id="q2fb"></div>
          <div class="feedback" id="finalFb"></div>
        </div>
      </div>
    </section>
  </div>

  <script>
    const STORE_KEY = "pse_d2_carla_landscape_v2";
    const state = { q1:"", q2:{proj:"", sal:"", montant:"", temps:"", epargne:""} };

    function $(sel, root=document){ return root.querySelector(sel); }
    function $all(sel, root=document){ return [...root.querySelectorAll(sel)]; }

    function save(){
      localStorage.setItem(STORE_KEY, JSON.stringify(state));
      $("#saveState").textContent = "Sauvegarde : active";
      computeProgress();
    }

    function load(){
      const raw = localStorage.getItem(STORE_KEY);
      if(!raw) return;
      try{
        const p = JSON.parse(raw);
        if(p && typeof p === "object"){
          state.q1 = p.q1 || "";
          state.q2 = p.q2 || state.q2;
        }
      }catch(e){}
    }

    function resetAll(){
      localStorage.removeItem(STORE_KEY);
      location.reload();
    }

    function tag(el, kind, text){
      el.className = "tag " + (kind || "");
      el.textContent = text;
    }

    function mkLine(host, text, ok, warn){
      const line = document.createElement("div");
      line.className = "fbLine";
      line.textContent = text;
      if(ok){
        line.style.borderColor = "rgba(22,163,74,.28)";
        line.style.background = "rgba(22,163,74,.06)";
      }else if(warn){
        line.style.borderColor = "rgba(180,83,9,.28)";
        line.style.background = "rgba(180,83,9,.06)";
      }else{
        line.style.borderColor = "rgba(220,38,38,.28)";
        line.style.background = "rgba(220,38,38,.06)";
      }
      host.appendChild(line);
    }

    function normNum(s){
      return (String(s||"")
        .replace(/\s/g,"")
        .replace("€","")
        .replace(",", ".")
        .replace(/[^\d.\-]/g,"")
      );
    }

    function almostEq(a, b){
      const x = Number(a), y = Number(b);
      if(!Number.isFinite(x) || !Number.isFinite(y)) return false;
      return Math.abs(x - y) < 0.01;
    }

    function correctQ1(){
      const fb = $("#q1fb");
      fb.innerHTML = "";
      const ok = state.q1 === "epargne";
      mkLine(fb, ok ? "Correct" : "A revoir", ok, !ok && state.q1);
      const pts = ok ? 2 : 0;
      tag($("#q1tag"), pts===2 ? "ok" : (state.q1 ? "bad" : "warnTag"), `Score : ${pts} / 2`);
      return pts;
    }

    function correctQ2(){
      const fb = $("#q2fb");
      fb.innerHTML = "";
      let pts = 0;

      const proj = (state.q2.proj || "").toLowerCase();
      const hasSmart = /smartphone/.test(proj);
      const hasName = /xgphone/.test(proj);
      const okProj = hasSmart && hasName;
      if(okProj) pts += 2;
      mkLine(fb, okProj ? "Projet : correct" : "Projet : ecrire Acheter un smartphone XGPhone 5", okProj, !okProj && proj);

      const okSal = almostEq(normNum(state.q2.sal), "1375");
      if(okSal) pts += 2;
      mkLine(fb, okSal ? "Salaire mensuel : correct" : "Salaire mensuel : 1375", okSal, !okSal && state.q2.sal);

      const okMont = almostEq(normNum(state.q2.montant), "689");
      if(okMont) pts += 2;
      mkLine(fb, okMont ? "Montant du projet : correct" : "Montant du projet : 689", okMont, !okMont && state.q2.montant);

      const okTemps = almostEq(normNum(state.q2.temps), "5");
      if(okTemps) pts += 1;
      mkLine(fb, okTemps ? "Temps : correct" : "Temps : 5 mois", okTemps, !okTemps && state.q2.temps);

      const okEpar = almostEq(normNum(state.q2.epargne), "137.8");
      if(okEpar) pts += 1;
      mkLine(fb, okEpar ? "Epargne mensuelle : correct" : "Epargne mensuelle : 137,80", okEpar, !okEpar && state.q2.epargne);

      tag($("#q2tag"), pts===8 ? "ok" : (pts>=5 ? "warnTag" : "bad"), `Score : ${pts} / 8`);
      return pts;
    }

    function computeProgress(){
      const q1Done = !!state.q1;
      const q2 = state.q2;
      const q2Done = (q2.proj && q2.sal && q2.montant && q2.temps && q2.epargne);
      const done = [q1Done, q2Done].filter(Boolean).length;
      const pct = Math.round((done/2)*100);
      $("#bar").style.width = pct + "%";
    }

    function updateGlobalScore(){
      const p1 = correctQ1();
      const p2 = correctQ2();
      const total = p1 + p2;
      $("#globalScore").textContent = `Score : ${total} / 10`;
      return total;
    }

    function finalScore(){
      const total = updateGlobalScore();
      const fb = $("#finalFb");
      fb.innerHTML = "";
      const line = document.createElement("div");
      line.className = "fbLine";
      line.style.borderColor = "rgba(15,118,110,.28)";
      line.style.background = "rgba(15,118,110,.06)";
      line.innerHTML = `<b>Score auto</b> : <span class="mono">${total} / 10</span>`;
      fb.appendChild(line);
      computeProgress();
    }

    function exportCopy(){
      const total = updateGlobalScore();
      const lines = [];
      lines.push("MODULE D2 - Situation Carla");
      lines.push("Nom : ____________________   Prenom : ____________________   Classe : __________");
      lines.push("");
      lines.push("1) Probleme (C2) : " + (state.q1 || ""));
      lines.push("");
      lines.push("2) Elements (C2)");
      lines.push("Projet : " + (state.q2.proj || ""));
      lines.push("Salaire mensuel : " + (state.q2.sal || ""));
      lines.push("Montant du projet : " + (state.q2.montant || ""));
      lines.push("Temps : " + (state.q2.temps || ""));
      lines.push("Epargne mensuelle : " + (state.q2.epargne || ""));
      lines.push("");
      lines.push("Total auto : " + total + "/10");
      const blob = new Blob([lines.join("\n")], {type:"text/plain;charset=utf-8"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "copie_d2_situation_carla.txt";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    function init(){
      load();

      $all("input[name='pb']").forEach(r=>{
        r.addEventListener("change", ()=>{
          state.q1 = r.value;
          save();
        });
      });

      const map = {
        proj: $("#proj"),
        sal: $("#sal"),
        montant: $("#montant"),
        temps: $("#temps"),
        epargne: $("#epargne")
      };
      Object.entries(map).forEach(([k, el])=>{
        el.addEventListener("input", ()=>{
          state.q2[k] = el.value;
          save();
        });
      });

      if(state.q1){
        const r = $(`input[name='pb'][value='${state.q1}']`);
        if(r) r.checked = true;
      }
      $("#proj").value = state.q2.proj || "";
      $("#sal").value = state.q2.sal || "";
      $("#montant").value = state.q2.montant || "";
      $("#temps").value = state.q2.temps || "";
      $("#epargne").value = state.q2.epargne || "";

      $("#btnReset").addEventListener("click", resetAll);

      $all("[data-correct]").forEach(b=>{
        b.addEventListener("click", ()=>{
          if(b.dataset.correct==="q1") correctQ1();
          if(b.dataset.correct==="q2") correctQ2();
          $("#globalScore").textContent = `Score : ${correctQ1()+correctQ2()} / 10`;
          computeProgress();
        });
      });

      $("#btnFinal").addEventListener("click", finalScore);
      $("#btnExport").addEventListener("click", exportCopy);

      computeProgress();
      $("#globalScore").textContent = `Score : ${correctQ1()+correctQ2()} / 10`;
    }

    init();
  </script>
</body>
</html>
