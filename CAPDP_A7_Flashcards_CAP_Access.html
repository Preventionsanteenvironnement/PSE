<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Module A7 ‚Äî Flashcards CAP Accessibilit√© ‚Äî PSE</title>
<meta name="description" content="Flashcards Module A7 PSE - Version accessible CAP - Police OpenDyslexic, mode sombre, contraste √©lev√©, lecture vocale">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<style>

/* ‚îÄ‚îÄ‚îÄ OPENDJYLEXIC FONT (Fallback via CDNJS ou system) ‚îÄ‚îÄ‚îÄ */
@font-face {
  font-family: 'OpenDyslexic';
  src: url('https://cdn.jsdelivr.net/npm/open-dyslexic@1.0.3/OpenDyslexic-Regular.otf') format('opentype');
  font-weight: normal;
}
@font-face {
  font-family: 'OpenDyslexic';
  src: url('https://cdn.jsdelivr.net/npm/open-dyslexic@1.0.3/OpenDyslexic-Bold.otf') format('opentype');
  font-weight: bold;
}

/* ‚îÄ‚îÄ‚îÄ RESET ‚îÄ‚îÄ‚îÄ */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
:root {
  /* Light mode (default) */
  --bg: #f0f2f5;
  --surface: #ffffff;
  --surface2: #f4f5f7;
  --border: #d1d5db;
  --text: #1a1a2e;
  --text2: #4b5563;
  --navy: #1B3A5C;
  --teal: #0D7A6E;
  --amber: #D97706;
  --green: #15803D;
  --red: #B91C1C;
  --green-bg: #DCFCE7;
  --red-bg: #FEE2E2;
  --amber-bg: #FEF3C7;
  --radius: 14px;
  --font: 'Nunito', system-ui, sans-serif;
  --font-size: 1.1rem;
  --line-h: 1.75;
  --shadow: 0 4px 20px rgba(0,0,0,.1);
  --btn-h: 52px;
}

/* DARK MODE */
body.dark {
  --bg: #0f1117;
  --surface: #1e2130;
  --surface2: #252837;
  --border: #374151;
  --text: #f1f5f9;
  --text2: #94a3b8;
  --shadow: 0 4px 20px rgba(0,0,0,.4);
}

/* HIGH CONTRAST */
body.contrast {
  --bg: #000000;
  --surface: #000000;
  --surface2: #111111;
  --border: #ffffff;
  --text: #ffffff;
  --text2: #ffff00;
  --navy: #4db6ff;
  --teal: #00ffcc;
  --amber: #ffdd57;
  --green: #66ff66;
  --red: #ff6666;
  --green-bg: #003300;
  --red-bg: #330000;
  --amber-bg: #332200;
}

/* FONT SIZES */
body.zoom-md { --font-size: 1.15rem; }
body.zoom-lg { --font-size: 1.3rem; }
body.zoom-xl { --font-size: 1.55rem; }

/* DYSLEXIC */
body.dyslexic { --font: 'OpenDyslexic', 'Comic Sans MS', cursive; --line-h: 2.0; letter-spacing: 0.05em; word-spacing: 0.15em; }

/* REDUCED MOTION */
@media (prefers-reduced-motion: reduce) { *, *::before, *::after { animation-duration: 0.01ms !important; transition-duration: 0.01ms !important; } }
body.no-motion *, body.no-motion *::before, body.no-motion *::after { animation-duration: 0.01ms !important; transition-duration: 0.01ms !important; }

html { scroll-behavior: smooth; }
body {
  font-family: var(--font);
  font-size: var(--font-size);
  line-height: var(--line-h);
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  transition: background .3s, color .3s;
}

/* ‚îÄ‚îÄ‚îÄ ACCESSIBILITY TOOLBAR ‚îÄ‚îÄ‚îÄ */
.a11y-bar {
  background: var(--navy);
  padding: 8px 14px;
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  align-items: center;
  position: sticky; top: 0; z-index: 200;
  border-bottom: 3px solid var(--amber);
}
.a11y-label {
  font-size: .7rem; font-weight: 800; letter-spacing: 1px;
  color: rgba(255,255,255,.6); text-transform: uppercase; margin-right: 4px;
  flex-shrink: 0;
}
.a11y-btn {
  background: rgba(255,255,255,.12);
  border: 2px solid rgba(255,255,255,.2);
  color: #fff;
  font-family: var(--font);
  font-size: .82rem;
  font-weight: 700;
  padding: 5px 11px;
  border-radius: 6px;
  cursor: pointer;
  transition: all .15s;
  min-height: 36px;
  white-space: nowrap;
}
.a11y-btn:hover { background: rgba(255,255,255,.25); }
.a11y-btn.active { background: var(--amber); border-color: var(--amber); color: #000; }
.a11y-sep { width: 1px; height: 28px; background: rgba(255,255,255,.2); margin: 0 4px; }
.a11y-spacer { flex: 1; }

/* ‚îÄ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ‚îÄ */
.site-header {
  background: var(--navy);
  color: #fff;
  padding: 14px 18px 12px;
  display: flex; align-items: center; gap: 12px;
}
.site-header .logo { font-size: 2rem; }
.site-header h1 { font-size: 1.1rem; font-weight: 900; line-height: 1.2; }
.site-header p { font-size: .82rem; color: rgba(255,255,255,.65); margin-top: 2px; }
.hd-right { margin-left: auto; text-align: right; }
.score-box {
  background: rgba(255,255,255,.12);
  border-radius: 8px;
  padding: 6px 12px;
  font-size: .82rem;
  text-align: center;
}
.score-box .pts { font-size: 1.3rem; font-weight: 900; color: var(--amber); line-height: 1; }
.streak-box {
  display: inline-flex; align-items: center; gap: 4px;
  background: rgba(255,180,0,.2);
  border: 1px solid rgba(255,180,0,.4);
  border-radius: 6px;
  padding: 4px 10px;
  font-size: .88rem; font-weight: 800; color: #FCD34D;
  margin-top: 4px;
}

/* ‚îÄ‚îÄ‚îÄ MAIN LAYOUT ‚îÄ‚îÄ‚îÄ */
.main { max-width: 680px; margin: 0 auto; padding: 18px 14px 80px; }
.section { display: none; }
.section.active { display: block; }

/* ‚îÄ‚îÄ‚îÄ ACCUEIL ‚îÄ‚îÄ‚îÄ */
.hero {
  background: linear-gradient(135deg, var(--navy) 0%, #254d79 100%);
  color: #fff; border-radius: var(--radius);
  padding: 24px 22px; margin-bottom: 20px;
  position: relative; overflow: hidden;
}
.hero::after { content: 'ü•ó'; position: absolute; right: 10px; bottom: -10px; font-size: 80px; opacity: .12; }
.hero-tag { font-size: .65rem; font-weight: 800; letter-spacing: 2px; text-transform: uppercase; color: #FDE68A; margin-bottom: 8px; }
.hero h2 { font-size: 1.35rem; font-weight: 900; line-height: 1.25; margin-bottom: 10px; }
.hero-obj { background: rgba(255,255,255,.1); border-left: 3px solid var(--amber); border-radius: 0 8px 8px 0; padding: 10px 14px; font-size: .92rem; line-height: 1.7; margin-bottom: 12px; }
.comp-row { display: flex; flex-wrap: wrap; gap: 6px; }
.comp-pill { background: rgba(255,255,255,.18); font-size: .7rem; font-weight: 800; padding: 3px 10px; border-radius: 20px; }

.levels-grid { display: flex; flex-direction: column; gap: 12px; margin-bottom: 18px; }
.level-card {
  background: var(--surface);
  border: 2px solid var(--border);
  border-radius: var(--radius);
  padding: 16px 18px;
  cursor: pointer;
  display: flex; align-items: center; gap: 14px;
  transition: all .2s;
  box-shadow: var(--shadow);
}
.level-card:hover { border-color: var(--teal); transform: translateY(-2px); }
.level-card:focus { outline: 3px solid var(--amber); outline-offset: 2px; }
.lc-icon { font-size: 2rem; flex-shrink: 0; width: 52px; height: 52px; display: flex; align-items: center; justify-content: center; border-radius: 12px; }
.lc-body { flex: 1; min-width: 0; }
.lc-num { font-size: .65rem; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; color: var(--text2); margin-bottom: 2px; }
.lc-title { font-size: 1rem; font-weight: 800; color: var(--text); }
.lc-sub { font-size: .82rem; color: var(--text2); margin-top: 1px; }
.lc-prog { margin-top: 8px; display: flex; align-items: center; gap: 8px; }
.prog-bar { flex: 1; height: 6px; background: var(--border); border-radius: 10px; overflow: hidden; }
.prog-fill { height: 100%; border-radius: 10px; background: var(--teal); transition: width .5s ease; }
.prog-pct { font-size: .72rem; font-weight: 700; color: var(--text2); min-width: 28px; text-align: right; }
.lc-badge { font-size: .7rem; font-weight: 800; padding: 3px 8px; border-radius: 6px; flex-shrink: 0; }

/* ACCUEIL TIP BOX */
.tip-box { background: var(--amber-bg); border: 2px solid var(--amber); border-radius: var(--radius); padding: 14px 16px; font-size: .92rem; line-height: 1.65; }
.tip-box strong { color: var(--amber); }
.how-to { display: flex; flex-direction: column; gap: 8px; margin-top: 10px; }
.how-item { display: flex; align-items: center; gap: 10px; font-size: .9rem; }
.how-ic { font-size: 1.3rem; flex-shrink: 0; }

/* ‚îÄ‚îÄ‚îÄ PLAY SCREEN ‚îÄ‚îÄ‚îÄ */
.play-header { background: var(--surface); border-radius: var(--radius); padding: 14px 16px; margin-bottom: 14px; box-shadow: var(--shadow); }
.ph-row { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
.back-btn { background: none; border: 2px solid var(--border); border-radius: 8px; padding: 6px 12px; font-family: var(--font); font-size: .88rem; font-weight: 700; color: var(--text); cursor: pointer; transition: all .15s; display: flex; align-items: center; gap: 5px; }
.back-btn:hover { border-color: var(--navy); background: var(--surface2); }
.lv-badge { background: var(--navy); color: #fff; font-size: .7rem; font-weight: 800; padding: 4px 12px; border-radius: 6px; letter-spacing: .5px; }
.ph-title { font-size: .95rem; font-weight: 800; color: var(--text); margin-bottom: 2px; }
.ph-sub { font-size: .8rem; color: var(--text2); }
.ph-prog { margin-top: 8px; }
.ph-prog-bar { height: 10px; background: var(--border); border-radius: 10px; overflow: hidden; }
.ph-prog-fill { height: 100%; border-radius: 10px; transition: width .4s ease; }
.ph-prog-info { display: flex; justify-content: space-between; font-size: .78rem; color: var(--text2); margin-top: 4px; }

/* ‚îÄ‚îÄ‚îÄ FLASHCARD ‚îÄ‚îÄ‚îÄ */
.card-wrap { perspective: 1200px; }
.card {
  background: var(--surface);
  border: 2px solid var(--border);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  overflow: hidden;
  margin-bottom: 14px;
}
.card-top { padding: 14px 16px 10px; border-bottom: 1px solid var(--border); background: var(--surface2); display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
.ct-type { font-size: .68rem; font-weight: 800; letter-spacing: 1px; text-transform: uppercase; padding: 3px 10px; border-radius: 6px; }
.type-qcm { background: #DBEAFE; color: #1D4ED8; }
.type-vf { background: #EDE9FE; color: #6D28D9; }
.type-kw { background: var(--amber-bg); color: #92400E; }
body.dark .type-qcm { background: #1e3a5f; color: #93c5fd; }
body.dark .type-vf { background: #2d1f4f; color: #c4b5fd; }
body.dark .type-kw { background: #3d2a00; color: #fcd34d; }
body.contrast .type-qcm, body.contrast .type-vf, body.contrast .type-kw { background: #000; border: 2px solid currentColor; }
.ct-comp { font-size: .68rem; font-weight: 800; background: var(--navy); color: #fff; padding: 3px 9px; border-radius: 6px; }
.ct-num { font-size: .75rem; color: var(--text2); margin-left: auto; }

.card-body { padding: 18px 18px 14px; }

/* Question */
.question-text {
  font-size: 1.05em;
  font-weight: 700;
  line-height: var(--line-h);
  color: var(--text);
  margin-bottom: 14px;
}
.question-text .hl {
  background: rgba(217, 119, 6, .18);
  color: var(--amber);
  border-radius: 4px;
  padding: 1px 5px;
  font-weight: 800;
}
body.contrast .question-text .hl { background: #332200; color: #ffdd57; border: 1px solid #ffdd57; }

/* Situation box */
.situ-box {
  background: var(--surface2);
  border-left: 4px solid var(--teal);
  border-radius: 0 8px 8px 0;
  padding: 10px 13px;
  font-size: .9em;
  margin-bottom: 14px;
  color: var(--text2);
  line-height: 1.6;
}
.situ-box strong { color: var(--text); }

/* Keyword box (always shown) */
.kw-box {
  background: var(--navy);
  color: #fff;
  border-radius: 10px;
  padding: 12px 15px;
  margin-bottom: 14px;
  font-size: .88em;
  line-height: 1.6;
}
.kw-box .kw-label { font-size: .65em; font-weight: 800; letter-spacing: 1.5px; text-transform: uppercase; color: rgba(255,255,255,.6); display: block; margin-bottom: 4px; }
.kw-box .kw-text { font-weight: 800; color: #FDE68A; }

/* Hint (always visible for accessibility) */
.hint-box {
  background: var(--surface2);
  border: 1px dashed var(--border);
  border-radius: 8px;
  padding: 8px 12px;
  font-size: .84em;
  color: var(--text2);
  margin-bottom: 12px;
  display: flex; align-items: flex-start; gap: 6px;
}
.hint-box .hint-ic { flex-shrink: 0; font-size: 1.1em; }

/* ‚îÄ‚îÄ‚îÄ QCM OPTIONS ‚îÄ‚îÄ‚îÄ */
.opts { display: flex; flex-direction: column; gap: 10px; }
.opt-btn {
  background: var(--surface);
  border: 2px solid var(--border);
  border-radius: 10px;
  padding: 14px 16px;
  font-family: var(--font);
  font-size: .98em;
  font-weight: 600;
  color: var(--text);
  cursor: pointer;
  text-align: left;
  transition: all .15s;
  display: flex; align-items: center; gap: 10px;
  min-height: var(--btn-h);
  line-height: 1.45;
}
.opt-btn:hover:not([disabled]) { border-color: var(--teal); background: var(--surface2); }
.opt-btn:focus { outline: 3px solid var(--amber); outline-offset: 2px; }
.opt-btn[disabled] { cursor: default; }
.opt-letter { width: 32px; height: 32px; background: var(--surface2); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: .85em; flex-shrink: 0; }
.opt-btn.correct { border-color: var(--green); background: var(--green-bg); color: var(--green); }
.opt-btn.correct .opt-letter { background: var(--green); color: #fff; }
.opt-btn.wrong { border-color: var(--red); background: var(--red-bg); color: var(--red); }
.opt-btn.wrong .opt-letter { background: var(--red); color: #fff; }

/* ‚îÄ‚îÄ‚îÄ VRAI / FAUX ‚îÄ‚îÄ‚îÄ */
.vf-row { display: flex; gap: 12px; }
.vf-btn {
  flex: 1;
  background: var(--surface);
  border: 2px solid var(--border);
  border-radius: 10px;
  padding: 16px;
  font-family: var(--font);
  font-size: 1.1em;
  font-weight: 800;
  color: var(--text);
  cursor: pointer;
  transition: all .15s;
  text-align: center;
  min-height: 64px;
  display: flex; flex-direction: column; align-items: center; gap: 4px;
}
.vf-btn:hover:not([disabled]) { border-color: var(--teal); background: var(--surface2); }
.vf-btn:focus { outline: 3px solid var(--amber); outline-offset: 2px; }
.vf-btn.correct { border-color: var(--green); background: var(--green-bg); color: var(--green); }
.vf-btn.wrong { border-color: var(--red); background: var(--red-bg); color: var(--red); }
.vf-btn .vf-ic { font-size: 1.5rem; }

/* ‚îÄ‚îÄ‚îÄ KEYWORD INPUT ‚îÄ‚îÄ‚îÄ */
.kw-input-wrap { display: flex; gap: 8px; align-items: stretch; }
.kw-input {
  flex: 1;
  background: var(--surface2);
  border: 2px solid var(--border);
  border-radius: 10px;
  padding: 12px 14px;
  font-family: var(--font);
  font-size: 1em;
  color: var(--text);
  min-height: var(--btn-h);
}
.kw-input:focus { outline: 3px solid var(--amber); outline-offset: 0; border-color: var(--amber); }
.kw-input.correct { border-color: var(--green); background: var(--green-bg); color: var(--green); }
.kw-input.wrong { border-color: var(--red); background: var(--red-bg); color: var(--red); }
.kw-validate {
  background: var(--navy);
  color: #fff;
  border: none;
  border-radius: 10px;
  padding: 0 18px;
  font-family: var(--font);
  font-size: .95em;
  font-weight: 800;
  cursor: pointer;
  min-height: var(--btn-h);
  transition: all .15s;
}
.kw-validate:hover { background: #254d79; }
.kw-validate:focus { outline: 3px solid var(--amber); }

/* ‚îÄ‚îÄ‚îÄ FEEDBACK ‚îÄ‚îÄ‚îÄ */
.feedback {
  border-radius: 10px;
  overflow: hidden;
  margin-top: 14px;
  display: none;
}
.feedback.show { display: block; animation: popIn .3s ease; }
@keyframes popIn { from { opacity: 0; transform: scale(.95); } to { opacity: 1; transform: scale(1); } }
body.no-motion .feedback.show { animation: none; }
.fb-status { padding: 12px 16px; display: flex; align-items: center; gap: 10px; font-weight: 800; font-size: 1.05em; }
.fb-ok { background: var(--green-bg); color: var(--green); }
.fb-ko { background: var(--red-bg); color: var(--red); }
.fb-ic { font-size: 1.6rem; flex-shrink: 0; }
.fb-correct-answer { padding: 8px 16px; font-size: .9em; background: rgba(0,0,0,.04); color: var(--text2); border-top: 1px solid var(--border); }
body.dark .fb-correct-answer { background: rgba(255,255,255,.05); }
.fb-expl { padding: 12px 16px; font-size: .92em; line-height: 1.65; color: var(--text); background: var(--surface2); border-top: 1px solid var(--border); }
.fb-expl .expl-label { font-size: .65em; font-weight: 800; letter-spacing: 1px; text-transform: uppercase; color: var(--text2); display: block; margin-bottom: 5px; }
.fb-tip { padding: 8px 14px; font-size: .84em; background: var(--amber-bg); color: #92400E; border-top: 1px solid rgba(217,119,6,.2); display: flex; align-items: flex-start; gap: 7px; }
body.dark .fb-tip { color: #fcd34d; background: #3d2a00; }

/* ‚îÄ‚îÄ‚îÄ CARD ACTIONS ‚îÄ‚îÄ‚îÄ */
.card-actions { display: flex; gap: 10px; margin-top: 4px; flex-wrap: wrap; }
.act-btn {
  background: none;
  border: 2px solid var(--border);
  border-radius: 10px;
  padding: 0 16px;
  font-family: var(--font);
  font-size: .88em;
  font-weight: 800;
  color: var(--text);
  cursor: pointer;
  min-height: 46px;
  transition: all .15s;
  display: flex; align-items: center; gap: 6px;
}
.act-btn:hover { border-color: var(--navy); background: var(--surface2); }
.act-btn:focus { outline: 3px solid var(--amber); }
.act-next { background: var(--teal); border-color: var(--teal); color: #fff; flex: 1; justify-content: center; font-size: 1em; min-height: 52px; }
.act-next:hover { background: #0f9184; border-color: #0f9184; }
.act-skip { color: var(--text2); }

/* READ ALOUD */
.read-btn { background: none; border: none; padding: 0 8px; cursor: pointer; font-size: 1.2rem; color: var(--text2); vertical-align: middle; }
.read-btn:hover { color: var(--teal); }

/* ‚îÄ‚îÄ‚îÄ LEVEL COMPLETE ‚îÄ‚îÄ‚îÄ */
.lc-screen { display: none; }
.lc-screen.active { display: block; }
.lc-trophy { text-align: center; font-size: 4rem; margin: 16px 0 8px; animation: bounce .8s ease; }
@keyframes bounce { 0%,100%{transform:scale(1)}50%{transform:scale(1.2)} }
body.no-motion .lc-trophy { animation: none; }
.lc-title { font-size: 1.5rem; font-weight: 900; color: var(--text); text-align: center; margin-bottom: 4px; }
.lc-pts { font-size: 2.5rem; font-weight: 900; color: var(--amber); text-align: center; }
.lc-stats { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin: 18px 0; }
.lc-stat { background: var(--surface2); border-radius: 10px; padding: 14px 10px; text-align: center; border: 2px solid var(--border); }
.lc-stat-n { font-size: 1.8rem; font-weight: 900; color: var(--text); line-height: 1; }
.lc-stat-l { font-size: .72rem; color: var(--text2); margin-top: 4px; font-weight: 700; text-transform: uppercase; letter-spacing: .5px; }
.lc-errors { background: var(--amber-bg); border: 2px solid var(--amber); border-radius: var(--radius); padding: 14px 16px; margin-bottom: 16px; }
.lc-errors h4 { font-size: .85rem; font-weight: 800; color: #92400E; text-transform: uppercase; letter-spacing: .5px; margin-bottom: 10px; }
.lc-error-item { display: flex; align-items: flex-start; gap: 8px; margin-bottom: 8px; font-size: .9rem; line-height: 1.5; }
.lc-error-item::before { content: '‚Ü©'; color: var(--amber); flex-shrink: 0; font-weight: 900; }
.lc-btns { display: flex; flex-direction: column; gap: 10px; }
.lc-btn { background: var(--surface); border: 2px solid var(--border); border-radius: 10px; padding: 14px 18px; font-family: var(--font); font-size: .98rem; font-weight: 800; color: var(--text); cursor: pointer; text-align: center; transition: all .15s; min-height: 54px; }
.lc-btn:hover { border-color: var(--teal); background: var(--surface2); }
.lc-btn.primary { background: var(--navy); border-color: var(--navy); color: #fff; }
.lc-btn.primary:hover { background: #254d79; }

/* ‚îÄ‚îÄ‚îÄ VISUAL ANCHORS ‚îÄ‚îÄ‚îÄ */
.highlight { background: rgba(217,119,6,.15); color: var(--amber); border-radius: 4px; padding: 1px 5px; font-weight: 800; }
body.contrast .highlight { background: #332200; border: 1px solid var(--amber); }

/* ‚îÄ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ‚îÄ */
@media (max-width: 480px) {
  .a11y-btn { font-size: .74rem; padding: 4px 8px; }
  .lc-stats { grid-template-columns: 1fr 1fr; }
  .vf-row { flex-direction: column; }
  .question-text { font-size: .98em; }
}

</style>
</head>
<body>

<!-- ‚îÄ‚îÄ ACCESSIBILITY TOOLBAR ‚îÄ‚îÄ -->
<div class="a11y-bar" role="toolbar" aria-label="Options d'accessibilit√©">
  <span class="a11y-label">Accessibilit√©</span>

  <button class="a11y-btn active" data-theme="light" onclick="toggleTheme('light')" title="Th√®me clair" aria-pressed="true">‚òÄÔ∏è Clair</button>
  <button class="a11y-btn" data-theme="dark" onclick="toggleTheme('dark')" title="Th√®me sombre" aria-pressed="false">üåô Sombre</button>
  <button class="a11y-btn" data-theme="contrast" onclick="toggleTheme('contrast')" title="Contraste √©lev√©" aria-pressed="false">‚ö° Contraste</button>

  <div class="a11y-sep" aria-hidden="true"></div>

  <button class="a11y-btn" data-a11y="dyslexic" onclick="toggleDyslexic()" title="Police OpenDyslexic" aria-pressed="false">üî† OpenDyslexic</button>

  <div class="a11y-sep" aria-hidden="true"></div>

  <button class="a11y-btn active" data-zoom="md" onclick="setZoom('md')" aria-label="Texte taille normale">A</button>
  <button class="a11y-btn" data-zoom="lg" onclick="setZoom('lg')" aria-label="Texte grande taille">A+</button>
  <button class="a11y-btn" data-zoom="xl" onclick="setZoom('xl')" aria-label="Texte tr√®s grande taille">A++</button>

  <div class="a11y-sep" aria-hidden="true"></div>

  <button class="a11y-btn" data-a11y="motion" onclick="toggleMotion()" aria-pressed="false" title="D√©sactiver les animations">üéûÔ∏è Animations</button>
  <button class="a11y-btn" data-a11y="tts" onclick="toggleTTS()" aria-pressed="false" title="Lecture automatique √† haute voix">üîä Auto-lecture</button>
</div>

<!-- ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ -->
<header class="site-header" role="banner">
  <span class="logo" aria-hidden="true">ü•ó</span>
  <div>
    <h1>Module A7 ‚Äî Version CAP / Accessibilit√©</h1>
    <p>PSE ¬∑ CAP ¬∑ L'alimentation adapt√©e √† son activit√©</p>
  </div>
  <div class="hd-right">
    <div class="score-box" aria-live="polite">
      <div class="pts" id="score-pts">0</div>
      <div style="font-size:.68rem;color:rgba(255,255,255,.6)">points</div>
    </div>
    <div class="streak-box" aria-live="polite">
      üî• <span id="streak-n">0</span>
    </div>
  </div>
</header>

<main class="main" role="main">

  <!-- ‚ïê‚ïê SCREEN HOME ‚ïê‚ïê -->
  <div id="screen-home" class="section active">
    <div class="hero">
      <div class="hero-tag">Module A7 ¬∑ CAP ¬∑ PSE</div>
      <h2>L'alimentation adapt√©e √† son activit√© professionnelle</h2>
      <div class="hero-obj">
        <strong>üéØ Objectif :</strong> Adopter un comportement alimentaire responsable, adapt√© √† mon activit√© professionnelle.
      </div>
      <div class="comp-row">
        <span class="comp-pill">C1 ‚Äî Analyser</span>
        <span class="comp-pill">C2 ‚Äî Appliquer</span>
        <span class="comp-pill">C3 ‚Äî Mettre en relation</span>
        <span class="comp-pill">C5 ‚Äî Proposer</span>
      </div>
    </div>

    <div class="tip-box" style="margin-bottom:18px">
      <strong>üìñ Comment jouer ?</strong>
      <div class="how-to">
        <div class="how-item"><span class="how-ic">üëÜ</span>Clique sur un niveau pour commencer</div>
        <div class="how-item"><span class="how-ic">üÉè</span>Lis la carte, puis r√©ponds √† la question</div>
        <div class="how-item"><span class="how-ic">‚úÖ</span>La correction s'affiche avec une explication</div>
        <div class="how-item"><span class="how-ic">üîä</span>Utilise le bouton son pour lire la question √† voix haute</div>
        <div class="how-item"><span class="how-ic">‚ôø</span>Personnalise l'affichage avec la barre en haut</div>
      </div>
    </div>

    <div class="levels-grid" role="list">


      <div class="level-card" onclick="startLevel(1)" tabindex="0" role="listitem"
           onkeydown="if(event.key==='Enter'||event.key===' ')startLevel(1)"
           aria-label="Commencer Les besoins nutritionnels">
        <div class="lc-icon" style="background:#EBF2FB;color:#1B3A5C;">‚ö°</div>
        <div class="lc-body">
          <div class="lc-num">Niveau 1</div>
          <div class="lc-title">Les besoins nutritionnels</div>
          <div class="lc-sub">√ânerg√©tique, plastique, fonctionnel‚Ä¶</div>
          <div class="lc-prog">
            <div class="prog-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100">
              <div class="prog-fill" id="prog-fill-1" style="background:#1B3A5C"></div>
            </div>
            <span class="prog-pct" id="prog-pct-1">0%</span>
          </div>
        </div>
        <span class="lc-badge" style="background:#EBF2FB;color:#1B3A5C;">C1</span>
      </div>
      <div class="level-card" onclick="startLevel(2)" tabindex="0" role="listitem"
           onkeydown="if(event.key==='Enter'||event.key===' ')startLevel(2)"
           aria-label="Commencer Facteurs de variation des besoins">
        <div class="lc-icon" style="background:#E6F4F2;color:#0D5C50;">üìä</div>
        <div class="lc-body">
          <div class="lc-num">Niveau 2</div>
          <div class="lc-title">Facteurs de variation des besoins</div>
          <div class="lc-sub">Sexe, √¢ge, grossesse, activit√© physique‚Ä¶</div>
          <div class="lc-prog">
            <div class="prog-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100">
              <div class="prog-fill" id="prog-fill-2" style="background:#0D5C50"></div>
            </div>
            <span class="prog-pct" id="prog-pct-2">0%</span>
          </div>
        </div>
        <span class="lc-badge" style="background:#E6F4F2;color:#0D5C50;">C1</span>
      </div>
      <div class="level-card" onclick="startLevel(3)" tabindex="0" role="listitem"
           onkeydown="if(event.key==='Enter'||event.key===' ')startLevel(3)"
           aria-label="Commencer Groupes alimentaires et PNNS">
        <div class="lc-icon" style="background:#EFF6FF;color:#065A82;">ü•¶</div>
        <div class="lc-body">
          <div class="lc-num">Niveau 3</div>
          <div class="lc-title">Groupes alimentaires et PNNS</div>
          <div class="lc-sub">7 groupes, r√®gle assiette, recommandations‚Ä¶</div>
          <div class="lc-prog">
            <div class="prog-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100">
              <div class="prog-fill" id="prog-fill-3" style="background:#065A82"></div>
            </div>
            <span class="prog-pct" id="prog-pct-3">0%</span>
          </div>
        </div>
        <span class="lc-badge" style="background:#EFF6FF;color:#065A82;">C2</span>
      </div>
      <div class="level-card" onclick="startLevel(4)" tabindex="0" role="listitem"
           onkeydown="if(event.key==='Enter'||event.key===' ')startLevel(4)"
           aria-label="Commencer Erreurs alimentaires et cons√©quences">
        <div class="lc-icon" style="background:#FEF3C7;color:#B45309;">‚ö†Ô∏è</div>
        <div class="lc-body">
          <div class="lc-num">Niveau 4</div>
          <div class="lc-title">Erreurs alimentaires et cons√©quences</div>
          <div class="lc-sub">Amina, J√©r√¥me, Katia, David‚Ä¶</div>
          <div class="lc-prog">
            <div class="prog-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100">
              <div class="prog-fill" id="prog-fill-4" style="background:#B45309"></div>
            </div>
            <span class="prog-pct" id="prog-pct-4">0%</span>
          </div>
        </div>
        <span class="lc-badge" style="background:#FEF3C7;color:#B45309;">C2</span>
      </div>
      <div class="level-card" onclick="startLevel(5)" tabindex="0" role="listitem"
           onkeydown="if(event.key==='Enter'||event.key===' ')startLevel(5)"
           aria-label="Commencer Choix alimentaires professionnels">
        <div class="lc-icon" style="background:#EDE9FE;color:#5B21B6;">üíº</div>
        <div class="lc-body">
          <div class="lc-num">Niveau 5</div>
          <div class="lc-title">Choix alimentaires professionnels</div>
          <div class="lc-sub">Ma√ßon, secr√©taire, 3√ó8, David‚Ä¶</div>
          <div class="lc-prog">
            <div class="prog-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100">
              <div class="prog-fill" id="prog-fill-5" style="background:#5B21B6"></div>
            </div>
            <span class="prog-pct" id="prog-pct-5">0%</span>
          </div>
        </div>
        <span class="lc-badge" style="background:#EDE9FE;color:#5B21B6;">C5</span>
      </div>

    </div><!-- /levels-grid -->
  </div><!-- /screen-home -->

  <!-- ‚ïê‚ïê SCREEN PLAY ‚ïê‚ïê -->
  <div id="screen-play" class="section">

    <div class="play-header">
      <div class="ph-row">
        <button class="back-btn" onclick="goHome()" aria-label="Retour √† l'accueil">‚Üê Retour</button>
        <span class="lv-badge" id="ph-lv-badge">Niveau 1</span>
      </div>
      <div class="ph-title" id="ph-title"></div>
      <div class="ph-sub" id="ph-sub"></div>
      <div class="ph-prog">
        <div class="ph-prog-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100">
          <div class="ph-prog-fill" id="ph-prog-fill"></div>
        </div>
        <div class="ph-prog-info">
          <span id="ph-prog-curr">Carte 1</span>
          <span id="ph-prog-total"></span>
        </div>
      </div>
    </div>

    <div class="card" role="article">
      <div class="card-top">
        <span class="ct-type" id="ct-type">QCM</span>
        <span class="ct-comp" id="ct-comp">C1</span>
        <span class="ct-num" id="ct-num">1 / 8</span>
        <button class="read-btn" id="tts-btn" title="Lire √† voix haute" aria-label="Lire la question √† voix haute">üîä</button>
      </div>
      <div class="card-body">
        <!-- Situation -->
        <div class="situ-box" id="card-situ" style="display:none;white-space:pre-line"></div>
        <!-- Keyword always visible -->
        <div class="kw-box">
          <span class="kw-label">üìå Mot-cl√© √† retenir</span>
          <span class="kw-text" id="ct-kw-text"></span>
        </div>
        <!-- Hint always visible -->
        <div class="hint-box">
          <span class="hint-ic">üí°</span>
          <span id="hint-text"></span>
        </div>
        <!-- Question -->
        <p class="question-text" id="card-question"></p>
        <!-- Dynamic content -->
        <div id="card-content"></div>
        <!-- Feedback -->
        <div id="card-feedback" class="feedback" aria-live="polite"></div>
        <!-- Actions -->
        <div id="card-actions" class="card-actions"></div>
      </div>
    </div>

  </div><!-- /screen-play -->

  <!-- ‚ïê‚ïê SCREEN COMPLETE ‚ïê‚ïê -->
  <div id="screen-complete" class="section">
    <div class="card">
      <div class="card-body" style="padding:20px">
        <div class="lc-trophy" id="lc-stars">‚≠ê‚≠ê‚≠ê</div>
        <div class="lc-title">Niveau <span id="lc-level-n">1</span> termin√© !</div>
        <div class="lc-pts" id="lc-pts">0 pts</div>
        <p style="text-align:center;font-size:.95rem;color:var(--text2);margin:8px 0 16px" id="lc-msg"></p>

        <div class="lc-stats">
          <div class="lc-stat">
            <div class="lc-stat-n" id="lc-correct">0</div>
            <div class="lc-stat-l">Bonnes<br>r√©ponses</div>
          </div>
          <div class="lc-stat">
            <div class="lc-stat-n" id="lc-total">8</div>
            <div class="lc-stat-l">Total<br>cartes</div>
          </div>
          <div class="lc-stat">
            <div class="lc-stat-n" id="lc-streak">0</div>
            <div class="lc-stat-l">Meilleure<br>s√©rie üî•</div>
          </div>
        </div>

        <div class="lc-errors" id="lc-errors" style="display:none">
          <h4>üìö √Ä revoir :</h4>
          <div id="lc-error-list"></div>
        </div>

        <div class="lc-btns">
          <button class="lc-btn primary" id="lc-next-btn" onclick="">Niveau suivant ‚Üí</button>
          <button class="lc-btn" onclick="startLevel(currentLevel)">üîÑ Recommencer ce niveau</button>
          <button class="lc-btn" onclick="goHome()">üè† Retour √† l'accueil</button>
        </div>
      </div>
    </div>
  </div><!-- /screen-complete -->

</main>

<script>

const LEVELS = {
  1: {
    title: "Niveau 1 ‚Äî Les besoins nutritionnels",
    short: "Besoins nutritionnels",
    icon: "‚ö°",
    color: "#1B3A5C",
    comp: "C1",
    cards: [
      {
        type: "qcm",
        situ: null,
        q: "Ton corps a besoin de <span class='highlight'>carburant</span> pour fonctionner chaque jour.\nCe carburant s'appelle comment ?",
        opts: ["Besoin plastique", "Besoin √©nerg√©tique", "Besoin fonctionnel", "Besoin hydrique"],
        ans: 1,
        kw: "Besoin √©nerg√©tique = carburant du corps",
        hint: "C'est l'√©nergie dont on a besoin pour bouger, travailler...",
        expl: "Les besoins √âNERG√âTIQUES, c'est le carburant du corps. Comme une voiture a besoin d'essence pour rouler, notre corps a besoin de calories pour fonctionner, se d√©placer et travailler.",
        tip: "M√©mo : √â-P-F ‚Üí √ânerg√©tique, Plastique, Fonctionnel"
      },
      {
        type: "vf",
        situ: null,
        q: "Les besoins <span class='highlight'>plastiques</span> servent √† construire et r√©parer les cellules du corps.",
        opts: null, ans: true,
        kw: "Besoin plastique = construction des cellules",
        hint: "Plastique = comme un mat√©riau de construction...",
        expl: "VRAI ! Les besoins plastiques (b√¢tisseurs) = construction et r√©paration des cellules. Les prot√©ines (viande, poisson, ≈ìufs) couvrent ces besoins. Comme les briques d'une maison !",
        tip: "Plastique = comme brique ou ciment pour b√¢tir les cellules"
      },
      {
        type: "qcm",
        situ: null,
        q: "Quel nutriment couvre principalement les <span class='highlight'>besoins plastiques</span> (construction du corps) ?",
        opts: ["Les glucides (sucres)", "Les prot√©ines (viande, poisson, ≈ìufs)", "Les lipides (graisses)", "Les vitamines"],
        ans: 1,
        kw: "Prot√©ines ‚Üí besoins plastiques",
        hint: "Viande, poisson, ≈ìufs... quel nutriment ?",
        expl: "Les PROT√âINES = mat√©riaux de construction du corps. Sources animales : viandes, poissons, ≈ìufs, fromage. Sources v√©g√©tales : lentilles, pois chiches. Elles r√©parent et fabriquent les muscles.",
        tip: "Pro-t√©ines = pro-construction !"
      },
      {
        type: "qcm",
        situ: null,
        q: "Les vitamines et min√©raux couvrent quel type de besoin nutritionnel ?",
        opts: ["Besoin √©nerg√©tique", "Besoin plastique", "Besoin fonctionnel", "Besoin calorique"],
        ans: 2,
        kw: "Besoin fonctionnel = vitamines et min√©raux",
        hint: "Fonctionnel = pour que tout fonctionne bien dans le corps",
        expl: "Les besoins FONCTIONNELS = apporter vitamines, min√©raux pour que les cellules fonctionnent correctement. Sources : fruits, l√©gumes, produits laitiers. Ils r√©gulent le corps.",
        tip: "Fruits et l√©gumes color√©s ‚Üí vitamines ‚Üí besoins fonctionnels"
      },
      {
        type: "vf",
        situ: null,
        q: "L'organisme a <span class='highlight'>4 types</span> de besoins nutritionnels.",
        opts: null, ans: false,
        kw: "3 besoins : √ânerg√©tique / Plastique / Fonctionnel",
        hint: "C'est plus ou moins que 4 ? M√©mo √â-P-F...",
        expl: "FAUX ! L'organisme a 3 types de besoins seulement : √ânerg√©tiques (carburant), Plastiques (construction), Fonctionnels (vitamines/min√©raux). M√©mo : √â-P-F !",
        tip: "3 besoins comme les 3 couleurs d'un feu : √â-P-F"
      },
      {
        type: "qcm",
        situ: "üçö Le riz et le pain sont des f√©culents.",
        q: "Un repas √† base de riz et de pain couvre principalement quel besoin ?",
        opts: ["Besoin plastique (construction)", "Besoin fonctionnel (vitamines)", "Besoin √©nerg√©tique (carburant)", "Besoin hydrique"],
        ans: 2,
        kw: "F√©culents (riz, pain) ‚Üí besoin √©nerg√©tique",
        hint: "Les f√©culents apportent des glucides = √©nergie...",
        expl: "Le riz et le pain = glucides complexes ‚Üí √âNERGIE durable. Ils couvrent les besoins √©nerg√©tiques. C'est le carburant longue dur√©e du corps (comme l'essence longue distance).",
        tip: "F√©culents = √©nergie lente et durable"
      },
      {
        type: "vf",
        situ: null,
        q: "Les besoins plastiques sont couverts principalement par les <span class='highlight'>prot√©ines</span>.",
        opts: null, ans: true,
        kw: "Prot√©ines = besoins plastiques",
        hint: "Viande, poisson, ≈ìufs = prot√©ines...",
        expl: "VRAI ! Prot√©ines = mat√©riaux de construction. Elles fabriquent et r√©parent les cellules, les muscles, la peau. Sources : viande, poisson, ≈ìufs, l√©gumineuses. Indispensables !",
        tip: "Apr√®s un effort, les muscles se r√©parent gr√¢ce aux prot√©ines"
      },
      {
        type: "qcm",
        situ: "üçä Une orange = vitamine C.",
        q: "Quel aliment couvre principalement un <span class='highlight'>besoin fonctionnel</span> ?",
        opts: ["Un bol de p√¢tes", "Un steak de b≈ìuf", "Une orange", "Un croissant"],
        ans: 2,
        kw: "Orange ‚Üí vitamine C ‚Üí besoin fonctionnel",
        hint: "Vitamines ‚Üí quel aliment ?",
        expl: "L'ORANGE = riche en vitamine C, fibres, min√©raux ‚Üí besoin fonctionnel. Les p√¢tes = √©nergie, le steak = plastique, le croissant = √©nergie surtout. Les fruits = vitamines !",
        tip: "Fruits color√©s ‚Üí vitamines ‚Üí fonctionnel !"
      }
    ]
  },
  2: {
    title: "Niveau 2 ‚Äî Facteurs de variation des besoins",
    short: "Facteurs de variation",
    icon: "üìä",
    color: "#0D5C50",
    comp: "C1",
    cards: [
      {
        type: "qcm",
        situ: null,
        q: "Combien de <span class='highlight'>facteurs</span> font varier les besoins √©nerg√©tiques ?",
        opts: ["2 facteurs", "3 facteurs", "4 facteurs", "5 facteurs"],
        ans: 2,
        kw: "4 facteurs : Sexe / √Çge / Grossesse / Activit√© physique",
        hint: "M√©mo S-A-G-A : Sexe, √Çge, Grossesse, Activit√©",
        expl: "4 FACTEURS de variation : le sexe, l'√¢ge, la grossesse, et l'activit√© physique. Ces 4 √©l√©ments font que chaque personne a besoin d'un nombre diff√©rent de calories par jour.",
        tip: "M√©mo S-A-G-A : Sexe, √Çge, Grossesse, Activit√©"
      },
      {
        type: "qcm",
        situ: "üë§ Bastien (homme, 19 ans) = 2 500 kcal/jour.\nüë§ Lyse (femme, 19 ans) = 1 900 kcal/jour.",
        q: "Quel facteur explique cette diff√©rence de besoins entre Bastien et Lyse ?",
        opts: ["L'√¢ge", "L'activit√© physique", "Le sexe", "La grossesse"],
        ans: 2,
        kw: "Sexe ‚Üí diff√©rence de besoins √©nerg√©tiques",
        hint: "Ils ont le m√™me √¢ge. La diff√©rence est li√©e au...",
        expl: "Le SEXE explique cette diff√©rence : √† √¢ge et activit√© identiques, les hommes ont g√©n√©ralement des besoins plus √©lev√©s car leur masse musculaire est plus importante.",
        tip: "Masse musculaire + grande = + de calories br√ªl√©es"
      },
      {
        type: "vf",
        situ: "‚ö° Steve (15 ans) = 2 600 kcal/jour.\n‚ö° Ga√´tan (52 ans) = 2 350 kcal/jour.",
        q: "Un adolescent de 15 ans a des besoins √©nerg√©tiques <span class='highlight'>plus √©lev√©s</span> qu'un adulte de 52 ans.",
        opts: null, ans: true,
        kw: "Adolescent > adulte √¢g√© en besoins √©nerg√©tiques",
        hint: "L'ado est en croissance = son corps fabrique des cellules...",
        expl: "VRAI ! L'adolescent est en pleine croissance : son corps fabrique de nouvelles cellules en grande quantit√© ‚Üí besoins plus √©lev√©s. Avec l'√¢ge, le m√©tabolisme ralentit.",
        tip: "Croissance = construction = √©nergie. Comme b√¢tir une maison !"
      },
      {
        type: "qcm",
        situ: "üèóÔ∏è Kamel = manutentionnaire (soul√®ve des charges).\nüíª Bruno = agent administratif (assis au bureau).",
        q: "Kamel a besoin de 3 000 kcal/jour. Bruno a besoin de 2 500 kcal/jour.\nQuel facteur explique la diff√©rence ?",
        opts: ["Le sexe", "L'√¢ge", "La grossesse", "L'activit√© physique"],
        ans: 3,
        kw: "Travail physique intense ‚Üí besoins √©nerg√©tiques √©lev√©s",
        hint: "Kamel soul√®ve des charges, Bruno est assis...",
        expl: "L'ACTIVIT√â PHYSIQUE est le facteur. Kamel d√©pense beaucoup d'√©nergie en travaillant physiquement. Plus on bouge et travaille, plus on a besoin de carburant.",
        tip: "Manutentionnaire = 3000 kcal vs administratif = 2500 kcal = 500 kcal de diff√©rence"
      },
      {
        type: "qcm",
        situ: "ü§∞ Sylvie (25 ans) enceinte = 2 250 kcal/jour.\nüë© Cathy (25 ans) non enceinte = 1 900 kcal/jour.",
        q: "Quel facteur explique que Sylvie enceinte ait des besoins plus √©lev√©s que Cathy ?",
        opts: ["Le sexe", "L'√¢ge", "La grossesse", "L'activit√© physique"],
        ans: 2,
        kw: "Grossesse ‚Üí besoins √©nerg√©tiques augmentent",
        hint: "Sylvie nourrit deux personnes : elle et son b√©b√©...",
        expl: "La GROSSESSE augmente les besoins : le corps nourrit deux personnes (la m√®re et le b√©b√©) et fabrique le placenta, le liquide amniotique, les nouveaux tissus du b√©b√©.",
        tip: "Nourrir 2 personnes = plus de carburant n√©cessaire !"
      },
      {
        type: "vf",
        situ: "üèÉ Un sportif de haut niveau et üíº un comptable (m√™me √¢ge, m√™me sexe).",
        q: "Un sportif de haut niveau et un comptable du m√™me √¢ge et sexe ont les <span class='highlight'>m√™mes besoins √©nerg√©tiques</span>.",
        opts: null, ans: false,
        kw: "Activit√© physique ‚Üí grande diff√©rence de besoins",
        hint: "Le sportif bouge beaucoup plus que le comptable...",
        expl: "FAUX ! L'activit√© physique est un facteur majeur. Un sportif peut avoir des besoins 1,5 √† 2 fois sup√©rieurs √† ceux d'une personne s√©dentaire du m√™me profil.",
        tip: "Plus on bouge, plus on br√ªle d'√©nergie = plus on a besoin de calories"
      },
      {
        type: "qcm",
        situ: null,
        q: "Parmi ces √©l√©ments, lequel <span class='highlight'>ne change PAS</span> les besoins √©nerg√©tiques ?",
        opts: ["L'√¢ge", "La couleur des yeux", "La grossesse", "L'activit√© physique"],
        ans: 1,
        kw: "4 vrais facteurs : Sexe, √Çge, Grossesse, Activit√© physique",
        hint: "Les 4 vrais facteurs sont : Sexe, √Çge, Grossesse, Activit√©",
        expl: "La COULEUR DES YEUX n'influence pas les besoins √©nerg√©tiques. Les 4 vrais facteurs sont : sexe, √¢ge, grossesse, activit√© physique. M√©mo : S-A-G-A !",
        tip: "Ni les yeux, ni la taille, ni la nationalit√© n'influencent les besoins !"
      },
      {
        type: "qcm",
        situ: "üèóÔ∏è Kamel = manutentionnaire = 3 000 kcal/jour.\nüíª Bruno = administratif = 2 500 kcal/jour.",
        q: "Quelle est la diff√©rence de besoins en kcal entre Kamel et Bruno ?",
        opts: ["200 kcal", "300 kcal", "500 kcal", "700 kcal"],
        ans: 2,
        kw: "Manutentionnaire ‚àí Administratif = 500 kcal de diff√©rence",
        hint: "3 000 ‚àí 2 500 = ?",
        expl: "500 kcal de diff√©rence ! C'est l'impact de l'activit√© physique. Cette diff√©rence = environ 2 yaourts + 1 banane + 1 tranche de pain en plus par jour.",
        tip: "3000 - 2500 = 500 kcal = une collation compl√®te en plus"
      }
    ]
  },
  3: {
    title: "Niveau 3 ‚Äî Groupes alimentaires et PNNS",
    short: "Groupes alimentaires & PNNS",
    icon: "ü•¶",
    color: "#065A82",
    comp: "C2",
    cards: [
      {
        type: "qcm",
        situ: null,
        q: "Combien de <span class='highlight'>groupes alimentaires</span> existent selon le cours ?",
        opts: ["5 groupes", "6 groupes", "7 groupes", "8 groupes"],
        ans: 2,
        kw: "7 groupes alimentaires",
        hint: "Plus que 5, moins que 9... M√©mo : 7 jours = 7 groupes",
        expl: "7 GROUPES alimentaires : sucres, mati√®res grasses, viandes/poissons/≈ìufs, laitages, l√©gumes/fruits, c√©r√©ales, boissons. Chaque groupe apporte des nutriments diff√©rents.",
        tip: "7 groupes comme les 7 jours de la semaine !"
      },
      {
        type: "qcm",
        situ: "üçû Pain, riz, p√¢tes = c√©r√©ales et d√©riv√©s.",
        q: "Quel groupe alimentaire apporte principalement des <span class='highlight'>glucides complexes et des fibres</span> ?",
        opts: ["Viandes, poissons, ≈ìufs", "Lait et produits laitiers", "C√©r√©ales et d√©riv√©s (pain, riz, p√¢tes)", "L√©gumes et fruits"],
        ans: 2,
        kw: "C√©r√©ales ‚Üí glucides complexes + fibres",
        hint: "Pain, riz, p√¢tes = quel groupe ?",
        expl: "C√âR√âALES ET D√âRIV√âS = glucides complexes + fibres. √ânergie durable et progressive. En version compl√®te (riz complet, pain complet) = encore plus de fibres pour le transit.",
        tip: "Pain, p√¢tes, riz = carburant longue dur√©e du corps"
      },
      {
        type: "qcm",
        situ: "üá´üá∑ Le PNNS = Programme National Nutrition Sant√©.",
        q: "Que signifie l'abr√©viation <span class='highlight'>PNNS</span> ?",
        opts: ["Programme Nutritif National de Sant√©", "Programme National Nutrition Sant√©", "Plan Nutritionnel National de Sant√©", "Programme Nutritionnel pour Nourrir Sainement"],
        ans: 1,
        kw: "PNNS = Programme National Nutrition Sant√©",
        hint: "P = Programme, N = National, N = Nutrition, S = Sant√©",
        expl: "PNNS = Programme National Nutrition Sant√©. C'est un programme de l'√âtat fran√ßais qui donne des recommandations alimentaires pour am√©liorer la sant√© de toute la population.",
        tip: "Le PNNS = l'√âtat qui conseille : mangez mieux pour vivre mieux !"
      },
      {
        type: "qcm",
        situ: "üçΩÔ∏è R√®gle de l'assiette : 3 parties.",
        q: "Quelle fraction de l'assiette les <span class='highlight'>l√©gumes</span> doivent-ils occuper ?",
        opts: ["¬º de l'assiette", "‚Öì de l'assiette", "¬Ω de l'assiette", "¬æ de l'assiette"],
        ans: 2,
        kw: "Assiette = ¬Ω l√©gumes + ¬º f√©culents + ¬º prot√©ines",
        hint: "La moiti√© de l'assiette = les l√©gumes...",
        expl: "¬Ω L√âGUMES + ¬º f√©culents + ¬º prot√©ines. Les l√©gumes occupent la moiti√© car ils apportent vitamines, min√©raux et fibres essentiels. + 1 laitage + 1 fruit + eau.",
        tip: "M√©mo : moiti√© verte (l√©gumes), quart blanc (f√©culent), quart rose (prot√©ines)"
      },
      {
        type: "vf",
        situ: "üêü Le PNNS parle du poisson...",
        q: "Le PNNS recommande de consommer du poisson <span class='highlight'>3 fois</span> par semaine.",
        opts: null, ans: false,
        kw: "Poisson = 2√ó/semaine dont 1 poisson gras",
        hint: "Le PNNS dit 2 fois ou 3 fois ?",
        expl: "FAUX ! Le PNNS recommande 2 fois par semaine dont 1 poisson gras (saumon, sardines, maquereau). Le poisson gras est riche en om√©ga-3 bons pour le c≈ìur.",
        tip: "2 fois = lundi poisson maigre, vendredi poisson gras !"
      },
      {
        type: "qcm",
        situ: "üçéü•¶üçã Fruits et l√©gumes...",
        q: "Selon le PNNS, combien de portions de <span class='highlight'>fruits et l√©gumes</span> par jour minimum ?",
        opts: ["3 portions", "4 portions", "5 portions", "7 portions"],
        ans: 2,
        kw: "5 fruits et l√©gumes par jour (PNNS)",
        hint: "C'est le slogan connu : ¬´ Mangez au moins ... ¬ª",
        expl: "5 PORTIONS par jour minimum ! Slogan du PNNS : ¬´ Mangez au moins 5 fruits et l√©gumes par jour ¬ª. Ils apportent vitamines, min√©raux, fibres et antioxydants.",
        tip: "Slogan PNNS : ¬´ 5 fruits et l√©gumes par jour ¬ª"
      },
      {
        type: "qcm",
        situ: "ü•ì La charcuterie est riche en sel et graisses.",
        q: "Selon le PNNS, quelle est la quantit√© maximale de <span class='highlight'>charcuterie</span> par semaine ?",
        opts: ["500 g par semaine", "300 g par semaine", "150 g par semaine", "50 g par semaine"],
        ans: 2,
        kw: "Charcuterie : max 150 g/semaine (PNNS)",
        hint: "C'est environ 3-4 tranches de jambon...",
        expl: "150 g de charcuterie par semaine maximum selon le PNNS. La charcuterie est trop riche en sel et graisses satur√©es. Elle augmente les risques cardiovasculaires √† long terme.",
        tip: "150 g = environ 3-4 tranches de jambon par semaine seulement"
      },
      {
        type: "vf",
        situ: null,
        q: "Le rythme alimentaire conseill√© est de <span class='highlight'>5 repas</span> par jour.",
        opts: null, ans: false,
        kw: "3 √† 4 repas/jour conseill√©s (PNNS)",
        hint: "Le PNNS dit 3-4 ou 5-6 repas ?",
        expl: "FAUX ! Le PNNS recommande 3 √† 4 repas par jour : petit-d√©jeuner, d√©jeuner, go√ªter (optionnel) et d√Æner. Multiplier les prises favorise le grignotage.",
        tip: "3-4 vrais repas valent mieux que 5-6 petites prises d√©sorganis√©es"
      },
      {
        type: "qcm",
        situ: "ü´í Huiles v√©g√©tales = bonnes ou mauvaises pour la sant√© ?",
        q: "Les huiles recommand√©es en priorit√© par le PNNS sont :",
        opts: ["Huile de palme et huile d'arachide", "Huile de tournesol et huile de ma√Øs", "Huile d'olive, colza, noix", "Beurre et margarine"],
        ans: 2,
        kw: "Huiles conseill√©es : olive / colza / noix",
        hint: "Olive, colza et noix = riches en bons acides gras...",
        expl: "Olive, colza, noix = riches en bons acides gras (om√©ga-3 et om√©ga-9). L'huile de palme est trop riche en graisses satur√©es = mauvais pour le c≈ìur √† long terme.",
        tip: "Huiles v√©g√©tales non tropicales = bonnes pour le c≈ìur !"
      }
    ]
  },
  4: {
    title: "Niveau 4 ‚Äî Erreurs alimentaires et cons√©quences",
    short: "Erreurs alimentaires",
    icon: "‚ö†Ô∏è",
    color: "#92400E",
    comp: "C2",
    cards: [
      {
        type: "qcm",
        situ: "üë© Amina saute son petit-d√©jeuner tous les matins.\n‚Üí Vers 10h, elle ressent un gros coup de fatigue.",
        q: "Quelle est la cause de la fatigue d'Amina vers 10h ?",
        opts: ["Elle a trop dormi", "Hypoglyc√©mie : taux de sucre sanguin trop bas", "Elle mange trop au d√Æner", "Elle boit trop d'eau le matin"],
        ans: 1,
        kw: "Sauter le petit-d√©jeuner ‚Üí hypoglyc√©mie (manque de sucre) vers 10h",
        hint: "Sans petit-d√©j, le corps manque de carburant...",
        expl: "HYPOGLYC√âMIE = chute du taux de sucre dans le sang. Sans petit-d√©jeuner, le corps n'a plus de carburant le matin ‚Üí fatigue, difficult√©s de concentration, maux de t√™te.",
        tip: "Hypo = trop peu / glyc√©mie = sucre dans le sang. Le corps est en panne s√®che !"
      },
      {
        type: "vf",
        situ: "üç´ü•î Barres chocolat√©es + chips entre les repas...",
        q: "Grignoter des barres chocolat√©es et des chips entre les repas est une <span class='highlight'>bonne habitude</span> alimentaire.",
        opts: null, ans: false,
        kw: "Grignotage = mauvaise habitude alimentaire",
        hint: "Est-ce que les barres choco et chips sont bonnes pour la sant√© ?",
        expl: "FAUX ! Le grignotage = calories vides + sucres rapides + graisses satur√©es. Cela perturbe le rythme des repas et favorise la prise de poids, le cholest√©rol et le diab√®te √† terme.",
        tip: "Barres choco + chips ‚Üí √©nergie rapide puis chute ‚Üí encore + fatigu√© !"
      },
      {
        type: "qcm",
        situ: "üë® J√©r√¥me mange beaucoup de pizzas, chips et barres chocolat√©es.\n‚Üí Sa prise de sang r√©v√®le un probl√®me.",
        q: "J√©r√¥me consomme trop d'aliments gras. Sa prise de sang r√©v√®le un exc√®s de :",
        opts: ["Vitamine C", "Cholest√©rol", "Glucose (sucre)", "Prot√©ines"],
        ans: 1,
        kw: "Trop de graisses satur√©es ‚Üí exc√®s de cholest√©rol",
        hint: "Cho... (un terme m√©dical li√© aux graisses dans le sang)",
        expl: "CHOLEST√âROL en exc√®s = r√©sultat d'une alimentation trop riche en graisses satur√©es (pizza, chips). √Ä long terme, risque de maladies cardiovasculaires (c≈ìur, art√®res).",
        tip: "Cholest√©rol LDL (mauvais) se d√©pose dans les art√®res ‚Üí danger !"
      },
      {
        type: "qcm",
        situ: "üë© Katia ne mange jamais de fruits ni de l√©gumes.\n‚Üí Elle souffre de constipation.",
        q: "Katia manque de fruits et l√©gumes. Quelle en est la principale cons√©quence digestive ?",
        opts: ["Exc√®s de cholest√©rol", "Hypoglyc√©mie", "Constipation et carence en vitamine C", "Hypertension"],
        ans: 2,
        kw: "Pas de fruits/l√©gumes ‚Üí constipation + carence vitamine C",
        hint: "Les fruits et l√©gumes apportent des fibres pour le transit...",
        expl: "Pas de fruits/l√©gumes ‚Üí manque de FIBRES ‚Üí constipation + manque de VITAMINE C ‚Üí carence ‚Üí syst√®me immunitaire affaibli. Les fruits et l√©gumes sont indispensables !",
        tip: "Fibres = r√©gulent le transit intestinal. Sans fibres = constipation."
      },
      {
        type: "vf",
        situ: "üìã David travaille en 3√ó8 (matin, apr√®s-midi, nuit en rotation).",
        q: "Les mauvaises habitudes alimentaires de David peuvent provoquer une prise de poids et de l'<span class='highlight'>hypertension</span>.",
        opts: null, ans: true,
        kw: "Mauvaise alimentation ‚Üí prise de poids + hypertension",
        hint: "Trop de sel et de graisses ‚Üí pression art√©rielle...",
        expl: "VRAI ! Une alimentation trop riche en sel, graisses et sucres peut provoquer une prise de poids et une hypertension art√©rielle (tension trop √©lev√©e). Le m√©decin de David le confirme.",
        tip: "Sel en exc√®s ‚Üí r√©tention d'eau ‚Üí hypertension ‚Üí risque cardiovasculaire"
      },
      {
        type: "qcm",
        situ: "ü©∫ Consultation m√©dicale de David :\n‚Üí Prise de 10 kg, tension trop √©lev√©e.",
        q: "Si David ne change pas ses habitudes, le m√©decin redoute qu'il d√©veloppe :",
        opts: ["Une allergie alimentaire", "Un diab√®te et des maladies cardiovasculaires", "De l'ost√©oporose", "Une carence en fer"],
        ans: 1,
        kw: "Mauvaise alimentation ‚Üí risques : diab√®te + maladies cardiovasculaires",
        hint: "Trop de sucres rapides et de graisses ‚Üí deux maladies graves...",
        expl: "DIAB√àTE (trop de sucres rapides) et MALADIES CARDIOVASCULAIRES (trop de graisses/sel). Le m√©decin de David lui dit qu'il risque ces deux maladies avant 40 ans si rien ne change.",
        tip: "Diab√®te = taux de sucre sanguin chroniquement trop √©lev√©"
      },
      {
        type: "vf",
        situ: "‚è∞ David travaille en 3√ó8 et mange 6 fois par jour.",
        q: "6 prises alimentaires par jour comme David, c'est <span class='highlight'>conforme</span> aux recommandations du PNNS.",
        opts: null, ans: false,
        kw: "PNNS recommande 3 √† 4 repas/jour seulement",
        hint: "Le PNNS recommande 3 √† 4 repas... David en fait 6...",
        expl: "FAUX ! Le PNNS recommande 3 √† 4 repas par jour. David en fait 6, dont beaucoup la nuit avec des aliments trop gras ou sucr√©s. C'est une erreur alimentaire importante.",
        tip: "Plus de prises = pas forc√©ment mieux si la qualit√© est mauvaise !"
      },
      {
        type: "qcm",
        situ: null,
        q: "Quelle maladie correspond √† un taux de <span class='highlight'>sucre sanguin</span> chroniquement trop √©lev√© ?",
        opts: ["L'hypertension", "Le cholest√©rol", "Le diab√®te", "La constipation"],
        ans: 2,
        kw: "Diab√®te = taux de sucre sanguin (glyc√©mie) trop √©lev√©",
        hint: "Dia-b√®te ‚Üí li√© au sucre dans le sang...",
        expl: "Le DIAB√àTE = hyperglyc√©mie chronique (glyc√©mie trop haute). Il peut √™tre caus√© par trop de sucres rapides sur la dur√©e. Cons√©quences : fatigue, probl√®mes cardiaques, r√©naux, oculaires.",
        tip: "Glyc√©mie = taux de sucre / Diab√®te = glyc√©mie trop haute de fa√ßon prolong√©e"
      }
    ]
  },
  5: {
    title: "Niveau 5 ‚Äî Choix alimentaires professionnels",
    short: "Choix professionnels",
    icon: "üíº",
    color: "#5B21B6",
    comp: "C5",
    cards: [
      {
        type: "qcm",
        situ: "üèóÔ∏è Ma√ßon = travail physique intense, pause 30 min.\nüíª Secr√©taire = travail s√©dentaire, pause 1 heure.",
        q: "Quel professionnel a les besoins √©nerg√©tiques les plus <span class='highlight'>√©lev√©s</span> ?",
        opts: ["La secr√©taire", "Le ma√ßon", "Ils ont les m√™mes besoins", "Cela d√©pend de leur √¢ge"],
        ans: 1,
        kw: "Travail physique intense ‚Üí besoins √©nerg√©tiques plus √©lev√©s",
        hint: "Plus on fait un travail physique, plus on d√©pense d'√©nergie...",
        expl: "Le MA√áON a les besoins les plus √©lev√©s : travail physique intense = grande d√©pense d'√©nergie. La secr√©taire (s√©dentaire) d√©pense moins d'√©nergie ‚Üí besoins plus mod√©r√©s.",
        tip: "Activit√© physique = facteur principal des besoins √©nerg√©tiques"
      },
      {
        type: "qcm",
        situ: "üèóÔ∏è Le ma√ßon : 30 minutes de pause seulement.",
        q: "Le ma√ßon n'a que 30 min de pause. Quel repas est le plus adapt√© √† son activit√© physique ?",
        opts: ["Sandwich saucisses + bi√®re", "Salade de p√¢tes au poulet + eau", "Chips + soda", "Pizza livr√©e"],
        ans: 1,
        kw: "Ma√ßon : repas rapide, nourrissant, sans alcool (p√¢tes + prot√©ines + eau)",
        hint: "Rapide, nourrissant, sans alcool... lequel ?",
        expl: "Salade de p√¢tes au poulet + eau = repas rapide, nourrissant (glucides + prot√©ines) et sans alcool. Adapt√© aux besoins √©lev√©s du ma√ßon et √† sa courte pause de 30 min.",
        tip: "Alcool au travail = interdit. Glucides + prot√©ines = √©nergie durable."
      },
      {
        type: "vf",
        situ: "üåô David travaille de nuit. Il rentre chez lui √† 8h du matin.",
        q: "Un travailleur de nuit doit prendre un repas <span class='highlight'>tr√®s copieux</span> juste avant de se coucher.",
        opts: null, ans: false,
        kw: "Travailleur de nuit : repas l√©ger avant de dormir",
        hint: "Un repas trop lourd avant de dormir est difficile √† dig√©rer...",
        expl: "FAUX ! Avant de dormir, il faut manger L√âGER pour ne pas perturber le sommeil. Le gros repas doit √™tre pris avant la prise de poste (avant 20h). Au retour = repas l√©ger.",
        tip: "Gros repas avant de dormir ‚Üí mauvaise digestion ‚Üí mauvais sommeil"
      },
      {
        type: "qcm",
        situ: "üåô David au travail : pause de nuit vers 2h du matin.",
        q: "Lors de sa pause de nuit, que doit consommer David en priorit√© ?",
        opts: ["Des barres chocolat√©es et du caf√©", "Des fruits frais, un yaourt et de l'eau", "Une pizza et un soda", "Du pain blanc et de la charcuterie"],
        ans: 1,
        kw: "Pause de nuit : fruits frais + yaourt + eau (√©nergie progressive, pas de sucres rapides)",
        hint: "La nuit = √©viter les sucres rapides qui donnent un coup de fouet puis une chute...",
        expl: "Fruits frais, yaourt, eau = √©nergie progressive + prot√©ines sans alourdir. Les barres chocolat√©es ‚Üí sucres rapides ‚Üí coup de fouet puis chute = encore plus fatigu√© apr√®s.",
        tip: "Nuit = collation l√©g√®re et nutritive, pas de sucres rapides !"
      },
      {
        type: "qcm",
        situ: "üç∫ Avant de prendre son poste de nuit, David boit une bi√®re.",
        q: "L'alcool est-il adapt√© avant un poste de travail ?",
        opts: ["Oui, √ßa donne de l'√©nergie", "Non, il r√©duit la vigilance et les r√©flexes", "Oui, mais seulement en petite quantit√©", "√áa d√©pend du type de travail"],
        ans: 1,
        kw: "Alcool avant le travail = interdit (r√©duit vigilance et r√©flexes)",
        hint: "L'alcool r√©duit la vigilance et les r√©flexes...",
        expl: "L'alcool r√©duit les R√âFLEXES et la VIGILANCE. Avant un poste de travail (surtout physique ou en machine), c'est dangereux. Risque d'accident du travail augment√©. C'est une ERREUR de David.",
        tip: "Alcool = danger au travail quelle que soit la quantit√©"
      },
      {
        type: "vf",
        situ: "üíª La secr√©taire : 1h de pause, travail s√©dentaire.",
        q: "La secr√©taire doit manger autant que le ma√ßon car ils ont tous les deux besoin d'√©nergie.",
        opts: null, ans: false,
        kw: "Secr√©taire s√©dentaire = besoins √©nerg√©tiques mod√©r√©s",
        hint: "Le ma√ßon fait un travail physique, la secr√©taire est assise...",
        expl: "FAUX ! La secr√©taire travaille assise ‚Üí besoins mod√©r√©s. Elle doit adapter ses repas √† son activit√© s√©dentaire. Un repas trop calorique sans d√©pense physique = prise de poids.",
        tip: "Adapter son alimentation √† son activit√© = objectif du module A7 !"
      },
      {
        type: "qcm",
        situ: "üåô David a chang√© ses habitudes :\n‚Üí Repas √©quilibr√© avant le poste\n‚Üí Collation l√©g√®re la nuit\n‚Üí Repas l√©ger au retour",
        q: "En adoptant ces nouvelles habitudes, David va :",
        opts: ["Devenir moins performant au travail", "Am√©liorer sa sant√© et ses performances au travail", "Prendre encore plus de poids", "N'avoir aucun changement notable"],
        ans: 1,
        kw: "Alimentation adapt√©e ‚Üí meilleure sant√© + meilleures performances professionnelles",
        hint: "Une bonne alimentation am√©liore l'√©nergie et la sant√©...",
        expl: "Une alimentation ADAPT√âE √† son activit√© professionnelle am√©liore l'√©nergie, la concentration, les performances et la sant√© sur le long terme. C'est l'objectif du module A7 !",
        tip: "Bien manger = mieux travailler ET mieux vivre !"
      },
      {
        type: "qcm",
        situ: null,
        q: "Quel est l'objectif principal du <span class='highlight'>module A7</span> en PSE ?",
        opts: ["Calculer les calories de chaque aliment", "Adopter un comportement alimentaire responsable adapt√© √† son activit√© professionnelle", "Apprendre √† cuisiner des repas √©quilibr√©s", "Conna√Ætre toutes les vitamines par c≈ìur"],
        ans: 1,
        kw: "Objectif A7 : comportement alimentaire responsable adapt√© √† l'activit√© professionnelle",
        hint: "C'est li√© √† l'alimentation et au travail professionnel...",
        expl: "L'objectif est d'adopter un COMPORTEMENT ALIMENTAIRE RESPONSABLE adapt√© √† son activit√© professionnelle. Pas juste conna√Ætre les aliments, mais les ADAPTER √† son m√©tier.",
        tip: "Module A7 = alimentation + travail = comportement responsable"
      }
    ]
  }
};


// ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let totalPoints = 0;
let currentStreak = 0;
let bestStreak = 0;
let currentLevel = 1;
let currentCardIndex = 0;
let levelCorrect = 0;
let levelErrors = [];
let levelProgress = {1:0, 2:0, 3:0, 4:0, 5:0};
let answered = false;

// ‚îÄ‚îÄ NAVIGATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showScreen(id) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  window.scrollTo(0,0);
}

function goHome() { showScreen('screen-home'); }

function startLevel(n) {
  currentLevel = n;
  currentCardIndex = 0;
  levelCorrect = 0;
  levelErrors = [];
  answered = false;
  showScreen('screen-play');
  renderPlayHeader();
  renderCard();
}

// ‚îÄ‚îÄ HEADER RENDERING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderPlayHeader() {
  const lv = LEVELS[currentLevel];
  document.getElementById('ph-lv-badge').textContent = `Niveau ${currentLevel}`;
  document.getElementById('ph-title').textContent = lv.title;
  document.getElementById('ph-sub').textContent = `Comp√©tence : ${lv.comp} ‚Äî ${lv.cards.length} cartes`;
  document.getElementById('ph-prog-fill').style.background = lv.color;
  updatePlayProgress();
}

function updatePlayProgress() {
  const lv = LEVELS[currentLevel];
  const pct = ((currentCardIndex) / lv.cards.length) * 100;
  document.getElementById('ph-prog-fill').style.width = pct + '%';
  document.getElementById('ph-prog-curr').textContent = `Carte ${currentCardIndex + 1}`;
  document.getElementById('ph-prog-total').textContent = `${lv.cards.length} cartes`;
  document.getElementById('score-pts').textContent = totalPoints;
  document.getElementById('streak-n').textContent = currentStreak;
}

// ‚îÄ‚îÄ CARD RENDERING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderCard() {
  const lv = LEVELS[currentLevel];
  if (currentCardIndex >= lv.cards.length) { showLevelComplete(); return; }

  const card = lv.cards[currentCardIndex];
  answered = false;
  updatePlayProgress();

  const types = { qcm: 'QCM', vf: 'Vrai / Faux', keyword: 'R√©ponse courte' };
  const typeClasses = { qcm: 'type-qcm', vf: 'type-vf', keyword: 'type-kw' };

  document.getElementById('ct-type').textContent = types[card.type] || card.type;
  document.getElementById('ct-type').className = 'ct-type ' + (typeClasses[card.type] || 'type-kw');
  document.getElementById('ct-comp').textContent = lv.comp;
  document.getElementById('ct-num').textContent = `${currentCardIndex + 1} / ${lv.cards.length}`;

  // Situation
  const situEl = document.getElementById('card-situ');
  if (card.situ) {
    situEl.style.display = 'block';
    situEl.textContent = card.situ;
  } else {
    situEl.style.display = 'none';
  }

  // Keyword
  document.getElementById('ct-kw-text').textContent = card.kw;

  // Hint
  document.getElementById('hint-text').textContent = card.hint;

  // Question
  document.getElementById('card-question').innerHTML = card.q.replace(/\n/g, '<br>');

  // Feedback reset
  const fb = document.getElementById('card-feedback');
  fb.className = 'feedback';
  fb.innerHTML = '';

  // Actions
  document.getElementById('card-actions').innerHTML = '';

  // Content
  const content = document.getElementById('card-content');
  content.innerHTML = '';

  if (card.type === 'qcm') {
    content.innerHTML = renderQCM(card);
  } else if (card.type === 'vf') {
    content.innerHTML = renderVF(card);
  } else if (card.type === 'keyword') {
    content.innerHTML = renderKeyword(card);
  }

  // TTS button
  document.getElementById('tts-btn').onclick = () => {
    if ('speechSynthesis' in window) {
      window.speechSynthesis.cancel();
      const situ = card.situ ? card.situ + '. ' : '';
      const text = situ + card.q.replace(/<[^>]+>/g,'').replace(/\n/g, '. ');
      const utt = new SpeechSynthesisUtterance(text);
      utt.lang = 'fr-FR'; utt.rate = 0.9;
      // Try to find French voice
      const voices = speechSynthesis.getVoices();
      const fr = voices.find(v => v.lang.startsWith('fr'));
      if (fr) utt.voice = fr;
      window.speechSynthesis.speak(utt);
    }
  };
}

function renderQCM(card) {
  const letters = ['A','B','C','D'];
  return '<div class="opts">' + card.opts.map((o, i) =>
    `<button class="opt-btn" onclick="answerQCM(${i})" tabindex="0" aria-label="Option ${letters[i]} : ${o}">
      <span class="opt-letter">${letters[i]}</span>
      <span>${o}</span>
    </button>`
  ).join('') + '</div>';
}

function renderVF(card) {
  return `<div class="vf-row">
    <button class="vf-btn" onclick="answerVF(true)" tabindex="0" aria-label="Vrai">
      <span class="vf-ic">‚úÖ</span>Vrai
    </button>
    <button class="vf-btn" onclick="answerVF(false)" tabindex="0" aria-label="Faux">
      <span class="vf-ic">‚ùå</span>Faux
    </button>
  </div>`;
}

function renderKeyword(card) {
  return `<div class="kw-input-wrap">
    <input class="kw-input" id="kw-in" type="text" placeholder="Tapez votre r√©ponse ici‚Ä¶" 
      autocomplete="off" autocorrect="off" spellcheck="false"
      onkeydown="if(event.key==='Enter')submitKeyword()"
      aria-label="Votre r√©ponse" />
    <button class="kw-validate" onclick="submitKeyword()">Valider ‚Üí</button>
  </div>`;
}

// ‚îÄ‚îÄ ANSWER HANDLERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function answerQCM(chosen) {
  if (answered) return;
  answered = true;
  const card = LEVELS[currentLevel].cards[currentCardIndex];
  const ok = chosen === card.ans;
  const btns = document.querySelectorAll('.opt-btn');
  btns.forEach(b => b.disabled = true);
  btns[chosen].classList.add(ok ? 'correct' : 'wrong');
  if (!ok) btns[card.ans].classList.add('correct');
  processAnswer(ok, card);
}

function answerVF(chosen) {
  if (answered) return;
  answered = true;
  const card = LEVELS[currentLevel].cards[currentCardIndex];
  const ok = chosen === card.ans;
  const btns = document.querySelectorAll('.vf-btn');
  btns.forEach(b => b.disabled = true);
  btns[chosen ? 0 : 1].classList.add(ok ? 'correct' : 'wrong');
  if (!ok) btns[card.ans ? 0 : 1].classList.add('correct');
  processAnswer(ok, card);
}

function submitKeyword() {
  if (answered) return;
  const inp = document.getElementById('kw-in');
  if (!inp) return;
  const val = inp.value.trim().toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'');
  const card = LEVELS[currentLevel].cards[currentCardIndex];
  const correct = card.ans.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'');
  const ok = val.length > 0 && (correct.includes(val) || val.includes(correct) || levenshtein(val, correct) <= 2);
  inp.disabled = true;
  inp.classList.add(ok ? 'correct' : 'wrong');
  if (!ok) {
    const wrap = inp.closest('.kw-input-wrap');
    const hint = document.createElement('p');
    hint.style.cssText = 'margin-top:8px;font-size:.9em;color:var(--text2);';
    hint.textContent = '‚úçÔ∏è R√©ponse attendue : ' + card.ans;
    wrap.after(hint);
  }
  processAnswer(ok, card);
}

function levenshtein(a, b) {
  if (a.length === 0) return b.length;
  if (b.length === 0) return a.length;
  const m = [];
  for (let i = 0; i <= b.length; i++) { m[i] = [i]; }
  for (let j = 0; j <= a.length; j++) { m[0][j] = j; }
  for (let i = 1; i <= b.length; i++) {
    for (let j = 1; j <= a.length; j++) {
      m[i][j] = b[i-1] === a[j-1] ? m[i-1][j-1] : Math.min(m[i-1][j-1]+1, m[i][j-1]+1, m[i-1][j]+1);
    }
  }
  return m[b.length][a.length];
}

function processAnswer(ok, card) {
  if (ok) {
    levelCorrect++;
    currentStreak++;
    if (currentStreak > bestStreak) bestStreak = currentStreak;
    const pts = 100 + (currentStreak > 2 ? 50 : 0);
    totalPoints += pts;
  } else {
    currentStreak = 0;
    levelErrors.push(card.kw);
  }
  document.getElementById('score-pts').textContent = totalPoints;
  document.getElementById('streak-n').textContent = currentStreak;
  showFeedback(ok, card);
  showNextBtn();
}

// ‚îÄ‚îÄ FEEDBACK ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showFeedback(ok, card) {
  const fb = document.getElementById('card-feedback');
  fb.innerHTML = `
    <div class="fb-status ${ok ? 'fb-ok' : 'fb-ko'}">
      <span class="fb-ic">${ok ? 'üéâ' : 'üòï'}</span>
      <span>${ok ? 'Bonne r√©ponse !' : 'Pas tout √† fait...'}</span>
      ${ok && currentStreak > 2 ? `<span style="margin-left:auto;background:var(--amber);color:#000;padding:3px 10px;border-radius:6px;font-size:.82em;">üî• S√©rie de ${currentStreak} !</span>` : ''}
    </div>
    <div class="fb-expl">
      <em class="expl-label">üìö Explication</em>
      ${card.expl}
    </div>
    <div class="fb-tip">
      <span>üí°</span>
      <span>${card.tip}</span>
    </div>`;
  fb.classList.add('show');

  // TTS feedback
  if ('speechSynthesis' in window) {
    const text = (ok ? 'Bonne r√©ponse. ' : 'Pas tout √† fait. ') + card.expl.replace(/<[^>]+>/g,'');
    // Delayed to let user see the visual first
    setTimeout(() => {
      const utt = new SpeechSynthesisUtterance(text);
      utt.lang = 'fr-FR'; utt.rate = 0.9;
      const voices = speechSynthesis.getVoices();
      const fr = voices.find(v => v.lang.startsWith('fr'));
      if (fr) utt.voice = fr;
      // Only auto-speak if user chose TTS mode
      if (document.body.classList.contains('tts-auto')) {
        window.speechSynthesis.speak(utt);
      }
    }, 200);
  }
}

function showNextBtn() {
  const actions = document.getElementById('card-actions');
  actions.innerHTML = `<button class="act-btn act-next" onclick="nextCard()">
    Carte suivante ‚Üí
  </button>
  <button class="act-btn act-skip" onclick="skipCard()">Passer</button>`;
}

function nextCard() {
  window.speechSynthesis && window.speechSynthesis.cancel();
  currentCardIndex++;
  const lv = LEVELS[currentLevel];
  levelProgress[currentLevel] = Math.round((currentCardIndex / lv.cards.length) * 100);
  updateHomeProgress();
  renderCard();
}

function skipCard() {
  window.speechSynthesis && window.speechSynthesis.cancel();
  currentCardIndex++;
  renderCard();
}

// ‚îÄ‚îÄ LEVEL COMPLETE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showLevelComplete() {
  showScreen('screen-complete');
  const lv = LEVELS[currentLevel];
  const pct = Math.round((levelCorrect / lv.cards.length) * 100);
  document.getElementById('lc-level-n').textContent = currentLevel;
  document.getElementById('lc-pts').textContent = totalPoints + ' pts';
  document.getElementById('lc-correct').textContent = levelCorrect;
  document.getElementById('lc-total').textContent = lv.cards.length;
  document.getElementById('lc-streak').textContent = bestStreak;

  // Stars
  const stars = pct >= 90 ? '‚≠ê‚≠ê‚≠ê' : pct >= 60 ? '‚≠ê‚≠ê' : '‚≠ê';
  document.getElementById('lc-stars').textContent = stars;

  // Message
  const msg = pct >= 90 ? 'Excellent ! Vous ma√Ætrisez parfaitement ce niveau !' :
               pct >= 60 ? 'Bien jou√© ! Quelques points √† revoir.' :
               'Continuez √† travailler, vous y arriverez !';
  document.getElementById('lc-msg').textContent = msg;

  // Errors
  const errDiv = document.getElementById('lc-errors');
  if (levelErrors.length > 0) {
    errDiv.style.display = 'block';
    document.getElementById('lc-error-list').innerHTML = levelErrors.map(e =>
      `<div class="lc-error-item">${e}</div>`
    ).join('');
  } else {
    errDiv.style.display = 'none';
  }

  // Next level
  const nextBtn = document.getElementById('lc-next-btn');
  if (currentLevel < 5) {
    nextBtn.style.display = 'block';
    nextBtn.textContent = `Niveau ${currentLevel + 1} ‚Üí`;
    nextBtn.onclick = () => startLevel(currentLevel + 1);
  } else {
    nextBtn.style.display = 'none';
  }

  levelProgress[currentLevel] = 100;
  updateHomeProgress();
}

// ‚îÄ‚îÄ HOME PROGRESS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function updateHomeProgress() {
  for (let i = 1; i <= 5; i++) {
    const fill = document.getElementById(`prog-fill-${i}`);
    const pct = document.getElementById(`prog-pct-${i}`);
    if (fill) fill.style.width = (levelProgress[i] || 0) + '%';
    if (pct) pct.textContent = (levelProgress[i] || 0) + '%';
  }
}

// ‚îÄ‚îÄ ACCESSIBILITY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const A11Y = {
  theme: 'light', // light | dark | contrast
  font: 'normal', // normal | dyslexic
  zoom: 'md',     // md | lg | xl
  motion: true,   // true = animations
  tts: false,     // auto TTS
};

function toggleTheme(mode) {
  document.body.classList.remove('dark','contrast');
  if (mode !== 'light') document.body.classList.add(mode);
  A11Y.theme = mode;
  document.querySelectorAll('.a11y-btn[data-theme]').forEach(b => {
    b.classList.toggle('active', b.dataset.theme === mode);
  });
  saveA11Y();
}

function toggleDyslexic() {
  A11Y.font = A11Y.font === 'dyslexic' ? 'normal' : 'dyslexic';
  document.body.classList.toggle('dyslexic', A11Y.font === 'dyslexic');
  document.querySelector('[data-a11y="dyslexic"]').classList.toggle('active', A11Y.font === 'dyslexic');
  saveA11Y();
}

function setZoom(z) {
  document.body.classList.remove('zoom-md','zoom-lg','zoom-xl');
  if (z !== 'md') document.body.classList.add('zoom-' + z);
  A11Y.zoom = z;
  document.querySelectorAll('.a11y-btn[data-zoom]').forEach(b => {
    b.classList.toggle('active', b.dataset.zoom === z);
  });
  saveA11Y();
}

function toggleMotion() {
  A11Y.motion = !A11Y.motion;
  document.body.classList.toggle('no-motion', !A11Y.motion);
  document.querySelector('[data-a11y="motion"]').classList.toggle('active', !A11Y.motion);
  document.querySelector('[data-a11y="motion"]').textContent = A11Y.motion ? 'üéûÔ∏è Animations' : '‚è∏Ô∏è Sans anim.';
  saveA11Y();
}

function toggleTTS() {
  A11Y.tts = !A11Y.tts;
  document.body.classList.toggle('tts-auto', A11Y.tts);
  const btn = document.querySelector('[data-a11y="tts"]');
  btn.classList.toggle('active', A11Y.tts);
  btn.textContent = A11Y.tts ? 'üîä Auto-lecture ON' : 'üîä Auto-lecture';
  saveA11Y();
}

function saveA11Y() {
  try { localStorage.setItem('a11y_a7cap', JSON.stringify(A11Y)); } catch(e) {}
}

function loadA11Y() {
  try {
    const s = localStorage.getItem('a11y_a7cap');
    if (!s) return;
    const d = JSON.parse(s);
    if (d.theme) toggleTheme(d.theme);
    if (d.font === 'dyslexic') toggleDyslexic();
    if (d.zoom) setZoom(d.zoom);
    if (!d.motion) toggleMotion();
    if (d.tts) toggleTTS();
  } catch(e) {}
}

// Load voices for TTS
if ('speechSynthesis' in window) {
  speechSynthesis.onvoiceschanged = () => {};
  speechSynthesis.getVoices();
}

window.addEventListener('DOMContentLoaded', () => {
  loadA11Y();
  updateHomeProgress();
});

</script>
</body>
</html>