<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R√©vision PSE ‚Äì Commande Musculaire (CAP)</title>
    <style>
        :root {
            --main-bg: #f5f5f5;
            --page-bg: #ffffff;
            --primary-color: #3f51b5; 
            --secondary-color: #00bcd4; 
            --highlight-color: #e8eaf6; 
            --text-color: #333333;
            --exercise-bg: #fafafa;
            --success-color: #4caf50;
            --danger-color: #f44336;
        }

        * { box-sizing: border-box; }

        body {
            font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: var(--main-bg);
            color: var(--text-color);
        }

        .container {
            width: 95%;
            max-width: 900px;
            margin: 20px auto;
            background-color: var(--page-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        h1, h2, h3 {
            color: var(--primary-color);
            border-bottom: 2px dashed var(--highlight-color);
            padding-bottom: 10px;
            margin-top: 20px;
            font-weight: 800;
        }

        h1 {
            text-align: center;
            font-size: 1.5rem;
            line-height: 1.3;
        }

        /* === OBJECTIF BOX === */
        .box-objectif {
            background: linear-gradient(135deg, #c8e6c9, #a5d6a7);
            border-left: 4px solid var(--success-color);
            padding: 16px;
            border-radius: 0 12px 12px 0;
            margin-bottom: 16px;
        }
        .box-objectif h3 {
            color: #2e7d32;
            margin: 0 0 8px;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: none;
            padding: 0;
        }
        .box-objectif p {
            margin: 0;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        /* === COMP√âTENCES BOX === */
        .box-competences {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 4px solid var(--primary-color);
            padding: 16px;
            border-radius: 0 12px 12px 0;
            margin-bottom: 20px;
        }
        .box-competences h3 {
            color: #1565c0;
            margin: 0 0 12px;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: none;
            padding: 0;
        }
        .comp-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .comp-list li {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 6px 0;
            font-size: 0.85rem;
        }
        .comp-tag {
            background: var(--primary-color);
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 700;
            flex-shrink: 0;
        }

        .btn {
            display: block;
            width: 100%;
            padding: 14px 20px;
            background: linear-gradient(135deg, var(--secondary-color), #0097a7);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1rem;
            text-align: center;
            transition: all 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 188, 212, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--primary-color);
        }

        /* === Introduction === */
        .introduction {
            margin-bottom: 20px;
            padding: 16px;
            background-color: var(--highlight-color);
            border-left: 6px solid var(--primary-color);
            border-radius: 0 12px 12px 0;
        }

        .introduction h2 {
            margin-top: 0;
            border: none;
            padding: 0;
        }

        .concept-box {
            background-color: var(--page-bg);
            border: 2px solid var(--primary-color);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .concept-box ol, .concept-box ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .concept-box li {
            margin-bottom: 8px;
        }

        /* === Exercises === */
        .exercise {
            background-color: var(--exercise-bg);
            padding: 16px;
            margin-bottom: 16px;
            border-radius: 12px;
            border: 1px solid #e0e0e0;
        }

        .consigne {
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--primary-color);
            font-size: 1rem;
            line-height: 1.5;
        }

        .reponse-area {
            margin-top: 10px;
            padding: 10px;
            background-color: var(--page-bg);
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        .competence-badge {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
            margin-top: 10px;
        }

        /* === QCM Options === */
        .qcm-option {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 12px;
            background: white;
            border: 2px solid transparent;
            border-radius: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .qcm-option:hover {
            background: #e3f2fd;
            border-color: var(--secondary-color);
        }

        .qcm-option.selected {
            background: #e0f7fa;
            border-color: var(--secondary-color);
        }

        .qcm-option input[type="radio"] {
            margin-top: 2px;
            accent-color: var(--secondary-color);
            transform: scale(1.2);
        }

        /* === Select === */
        select {
            padding: 8px 12px;
            border: 2px solid var(--secondary-color);
            border-radius: 8px;
            background: white;
            font-size: 0.95rem;
            color: var(--text-color);
            cursor: pointer;
            min-width: 120px;
        }

        /* === Drag and Drop === */
        .drag-source {
            min-height: 50px;
            background-color: #f5f5f5;
            padding: 12px;
            border-radius: 10px;
            border: 2px dashed #bbb;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .drag-item {
            background: linear-gradient(135deg, var(--secondary-color), #0097a7);
            color: white;
            padding: 10px 14px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            user-select: none;
            transition: all 0.2s;
            touch-action: manipulation;
        }

        .drag-item:active {
            transform: scale(0.95);
        }

        .drag-item.selected {
            background: var(--primary-color);
            box-shadow: 0 4px 12px rgba(63, 81, 181, 0.4);
        }

        .drag-item.used {
            opacity: 0.4;
            pointer-events: none;
        }

        .drop-zone-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .drop-row {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 12px;
            background: #fafafa;
            border-radius: 10px;
        }

        @media (min-width: 600px) {
            .drop-row {
                flex-direction: row;
                align-items: center;
            }
            .drop-row-label {
                flex: 0 0 50%;
            }
            .drop-row-targets {
                flex: 1;
            }
        }

        .drop-row-label {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 0.9rem;
        }

        .drop-row-targets {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .drop-target {
            min-width: 100px;
            min-height: 40px;
            padding: 8px;
            border: 2px dashed var(--primary-color);
            border-radius: 10px;
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.85rem;
        }

        .drop-target:hover {
            background: #e3f2fd;
        }

        .drop-target.has-item {
            border-style: solid;
            background: #e8f5e9;
        }

        /* === Sortable List === */
        .sortable-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sortable-item {
            padding: 12px 15px;
            margin-bottom: 8px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .sortable-item .number {
            background: rgba(255,255,255,0.3);
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
        }

        .sortable-item.selected {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .sortable-item[data-value="1"] { background: #81c784; color: white; }
        .sortable-item[data-value="2"] { background: #4caf50; color: white; }
        .sortable-item[data-value="3"] { background: #388e3c; color: white; }
        .sortable-item[data-value="4"] { background: #2e7d32; color: white; }

        .sort-hint {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 10px;
            padding: 8px;
            background: #fff3e0;
            border-radius: 8px;
        }

        /* === Correction === */
        .score-display {
            font-size: 2rem;
            text-align: center;
            font-weight: 800;
            padding: 20px;
            color: var(--primary-color);
            border: 4px solid var(--primary-color);
            border-radius: 16px;
            background-color: var(--highlight-color);
            margin-bottom: 20px;
        }

        .recap-item {
            padding: 15px;
            border-left: 4px solid var(--secondary-color);
            background-color: #fafafa;
            margin-bottom: 12px;
            border-radius: 0 10px 10px 0;
        }

        .recap-item strong {
            color: var(--primary-color);
        }

        .correct-answer-text {
            color: var(--success-color);
            font-weight: 600;
            display: block;
            margin-top: 8px;
        }

        .wrong-answer-text {
            color: var(--danger-color);
            font-style: italic;
        }

        .review-section {
            background: #fff3e0;
            padding: 16px;
            border-radius: 12px;
            margin-top: 20px;
        }

        .review-section h2 {
            margin-top: 0;
            border: none;
            padding: 0;
            color: #e65100;
        }

        .review-section ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .review-section li {
            margin-bottom: 10px;
            line-height: 1.5;
        }

        /* === Sigle Box === */
        .sigle-box {
            background: #e8f5e9;
            border: 1px dashed var(--success-color);
            padding: 12px;
            border-radius: 10px;
            margin-top: 15px;
            font-size: 0.85rem;
        }
        .sigle-box strong {
            color: #2e7d32;
        }
        .keyword {
            background: rgba(0, 188, 212, 0.2);
            padding: 2px 6px;
            border-radius: 4px;
            color: #00838f;
            font-weight: 600;
        }

        .text-center { text-align: center; }
        .hidden { display: none; }

        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }

        @media (min-width: 500px) {
            .btn-group {
                flex-direction: row;
            }
            .btn-group .btn {
                flex: 1;
            }
        }

        /* === Mobile Hint === */
        .mobile-hint {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 10px 12px;
            border-radius: 0 8px 8px 0;
            margin-bottom: 15px;
            font-size: 0.85rem;
            color: #1565c0;
        }

        @media (min-width: 768px) {
            .mobile-hint {
                display: none;
            }
        }

        /* === Responsive === */
        @media (max-width: 600px) {
            .container {
                padding: 15px;
                margin: 10px auto;
            }
            
            h1 {
                font-size: 1.3rem;
            }

            .exercise {
                padding: 14px;
            }

            .consigne {
                font-size: 0.95rem;
            }

            .drag-item {
                font-size: 0.8rem;
                padding: 8px 12px;
            }

            select {
                width: 100%;
                margin: 5px 0;
            }

            .score-display {
                font-size: 1.6rem;
                padding: 15px;
            }

            .sortable-item {
                padding: 10px 12px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>

<!-- ===== PAGE 1 : ACCUEIL ===== -->
<div id="page1" class="container">
    <h1>üß† R√©vision PSE ‚Äì Commande Nerveuse du Muscle</h1>
    <p style="text-align:center; color: var(--primary-color); font-weight: 600;">CAP ‚Äì Module A3</p>

    <div class="box-objectif">
        <h3>üéØ Objectif ‚Äì √ätre capable de :</h3>
        <p>D√©crire le <strong>circuit de la commande nerveuse</strong> du muscle (cerveau ‚Üí moelle √©pini√®re ‚Üí nerf moteur ‚Üí muscle) et identifier les <strong>r√©actions du corps √† l'effort</strong> physique.</p>
    </div>

    <div class="box-competences">
        <h3>üìö Comp√©tences travaill√©es</h3>
        <ul class="comp-list">
            <li><span class="comp-tag">C2</span> Appliquer une d√©marche d'analyse (identifier, ordonner les √©tapes)</li>
            <li><span class="comp-tag">C3</span> Expliquer un ph√©nom√®ne physiologique en lien avec la pr√©vention</li>
            <li><span class="comp-tag">C4</span> Proposer une solution pour r√©soudre un probl√®me li√© √† la sant√©</li>
        </ul>
    </div>

    <section class="introduction">
        <h2>üìñ Rappel : Circuit du Message Moteur</h2>
        <p>La contraction musculaire est command√©e par un <strong>message nerveux moteur</strong> qui part du cerveau.</p>
        <div class="concept-box">
            <p><strong>Les 4 √©tapes du circuit :</strong></p>
            <ol>
                <li><strong>Cerveau</strong> ‚Üí envoie l'ordre de contraction</li>
                <li><strong>Moelle √©pini√®re</strong> ‚Üí transmet le message (voie centrale)</li>
                <li><strong>Nerf moteur</strong> ‚Üí conduit le message vers le muscle</li>
                <li><strong>Muscle</strong> ‚Üí re√ßoit l'ordre et se contracte</li>
            </ol>
        </div>
        <p style="margin-top:15px"><strong>‚ö° R√©actions du corps √† l'effort :</strong></p>
        <ul>
            <li>‚Üë <strong>Fr√©quence cardiaque</strong> (pouls)</li>
            <li>‚Üë <strong>Fr√©quence respiratoire</strong></li>
            <li>‚Üë <strong>Temp√©rature</strong> corporelle</li>
        </ul>
    </section>

    <div class="text-center">
        <button class="btn" onclick="goToPage('quiz')">üöÄ Commencer l'auto-√©valuation</button>
        <p style="margin-top: 10px; font-size: 0.85rem; color: #666;">10 questions interactives</p>
    </div>
</div>

<!-- ===== PAGE 2 : QUIZ ===== -->
<div id="page2" class="container hidden">
    <h1>üìù Auto-√âvaluation</h1>

    <div class="mobile-hint">
        üì± <strong>Sur mobile :</strong> Touche un √©l√©ment pour le s√©lectionner, puis touche la zone cible. Pour le classement, touche deux √©l√©ments pour les √©changer.
    </div>

    <!-- Q1 -->
    <div id="q1" class="exercise">
        <div class="consigne">1. üß† <strong>Associer</strong> les √©l√©ments du syst√®me nerveux √† leur r√¥le :</div>
        
        <div class="drag-source" id="q1-source">
            <div class="drag-item" data-id="q1-a" data-value="cerveau">Cerveau</div>
            <div class="drag-item" data-id="q1-b" data-value="moelle">Moelle √âpini√®re</div>
            <div class="drag-item" data-id="q1-c" data-value="nerf">Nerf Moteur</div>
        </div>

        <div class="drop-zone-container">
            <div class="drop-row">
                <div class="drop-row-label">Centre de d√©cision :</div>
                <div class="drop-row-targets">
                    <div class="drop-target" data-target="q1-t1" data-correct="cerveau"></div>
                </div>
            </div>
            <div class="drop-row">
                <div class="drop-row-label">Voie centrale (corps) :</div>
                <div class="drop-row-targets">
                    <div class="drop-target" data-target="q1-t2" data-correct="moelle"></div>
                </div>
            </div>
            <div class="drop-row">
                <div class="drop-row-label">Conduit vers le muscle :</div>
                <div class="drop-row-targets">
                    <div class="drop-target" data-target="q1-t3" data-correct="nerf"></div>
                </div>
            </div>
        </div>
        <span class="competence-badge">C2</span>
    </div>

    <!-- Q2 -->
    <div id="q2" class="exercise">
        <div class="consigne">2. ‚û°Ô∏è <strong>Classer</strong> les √©tapes du message nerveux dans l'ordre (1 = d√©but) :</div>
        <div class="sort-hint">üí° Touche deux √©l√©ments pour les √©changer de place</div>
        <ul class="sortable-list" id="q2-sortable">
            <li class="sortable-item" data-value="1" data-order="2"><span class="number">?</span> Moelle √©pini√®re</li>
            <li class="sortable-item" data-value="2" data-order="1"><span class="number">?</span> Cerveau envoie l'ordre</li>
            <li class="sortable-item" data-value="3" data-order="4"><span class="number">?</span> Muscle se contracte</li>
            <li class="sortable-item" data-value="4" data-order="3"><span class="number">?</span> Nerf moteur</li>
        </ul>
        <span class="competence-badge">C2</span>
    </div>

    <!-- Q3 -->
    <div id="q3" class="exercise">
        <div class="consigne">3. ‚úèÔ∏è <strong>Compl√©ter</strong> : Le cerveau est l'organe qui 
            <select id="q3-select-1">
                <option value="">-- choisir --</option>
                <option value="envoie">envoie</option>
                <option value="recoit">re√ßoit</option>
            </select> 
            le message nerveux moteur. Le muscle 
            <select id="q3-select-2">
                <option value="">-- choisir --</option>
                <option value="relache">se rel√¢che</option>
                <option value="contracte">se contracte</option>
            </select> 
            en r√©ponse.
        </div>
        <span class="competence-badge">C3</span>
    </div>

    <!-- Q4 -->
    <div id="q4" class="exercise">
        <div class="consigne">4. üî≠ <strong>Identifier</strong> ce qui n'est PAS une r√©action imm√©diate √† l'effort :</div>
        <div class="reponse-area">
            <label class="qcm-option"><input type="radio" name="q4" value="cardiaque"> Augmentation de la fr√©quence cardiaque</label>
            <label class="qcm-option"><input type="radio" name="q4" value="respiratoire"> Augmentation de la fr√©quence respiratoire</label>
            <label class="qcm-option"><input type="radio" name="q4" value="poids"> Perte de poids imm√©diate</label>
            <label class="qcm-option"><input type="radio" name="q4" value="temperature"> Augmentation de la temp√©rature</label>
        </div>
        <span class="competence-badge">C2</span>
    </div>

    <!-- Q5 -->
    <div id="q5" class="exercise">
        <div class="consigne">5. üî¢ <strong>Associer</strong> chaque mesure √† sa d√©finition :</div>
        
        <div class="drag-source" id="q5-source">
            <div class="drag-item" data-id="q5-a" data-value="pouls">Fr√©quence Cardiaque</div>
            <div class="drag-item" data-id="q5-b" data-value="respi">Fr√©quence Respiratoire</div>
        </div>

        <div class="drop-zone-container">
            <div class="drop-row">
                <div class="drop-row-label">Battements du c≈ìur / minute :</div>
                <div class="drop-row-targets">
                    <div class="drop-target" data-target="q5-t1" data-correct="pouls"></div>
                </div>
            </div>
            <div class="drop-row">
                <div class="drop-row-label">Inspirations / minute :</div>
                <div class="drop-row-targets">
                    <div class="drop-target" data-target="q5-t2" data-correct="respi"></div>
                </div>
            </div>
        </div>
        <span class="competence-badge">C2</span>
    </div>

    <!-- Q6 -->
    <div id="q6" class="exercise">
        <div class="consigne">6. ü§ï <strong>Proposer</strong> la mesure de pr√©vention pour √©viter un malaise cardiaque :</div>
        <div class="reponse-area">
            <label class="qcm-option"><input type="radio" name="q6" value="echauffement"> R√©aliser un √©chauffement progressif avant l'effort</label>
            <label class="qcm-option"><input type="radio" name="q6" value="etirement"> Faire des √©tirements intenses pendant l'effort</label>
            <label class="qcm-option"><input type="radio" name="q6" value="eau"> Boire de grandes quantit√©s d'eau tr√®s froide</label>
        </div>
        <span class="competence-badge">C4</span>
    </div>

    <!-- Q7 -->
    <div id="q7" class="exercise">
        <div class="consigne">7. üß¨ <strong>Compl√©ter</strong> : Le muscle re√ßoit le message par le 
            <select id="q7-select-1">
                <option value="">-- choisir --</option>
                <option value="nerf">nerf moteur</option>
                <option value="moelle">moelle √©pini√®re</option>
            </select>, 
            ce qui provoque sa 
            <select id="q7-select-2">
                <option value="">-- choisir --</option>
                <option value="contraction">contraction</option>
                <option value="isolation">isolation</option>
            </select>.
        </div>
        <span class="competence-badge">C3</span>
    </div>

    <!-- Q8 -->
    <div id="q8" class="exercise">
        <div class="consigne">8. üå°Ô∏è <strong>Expliquer</strong> pourquoi la fr√©quence cardiaque augmente √† l'effort :</div>
        <div class="reponse-area">
            <label class="qcm-option"><input type="radio" name="q8" value="oxygene"> Pour apporter plus d'oxyg√®ne aux muscles en activit√©</label>
            <label class="qcm-option"><input type="radio" name="q8" value="detendre"> Pour d√©tendre le c≈ìur et r√©duire le stress</label>
            <label class="qcm-option"><input type="radio" name="q8" value="graisse"> Pour br√ªler plus rapidement les graisses</label>
        </div>
        <span class="competence-badge">C3</span>
    </div>

    <!-- Q9 -->
    <div id="q9" class="exercise">
        <div class="consigne">9. ü©π <strong>Proposer</strong> une mesure pour √©viter une blessure apr√®s un effort intense :</div>
        <div class="reponse-area">
            <label class="qcm-option"><input type="radio" name="q9" value="repos"> Arr√™t brutal et repos imm√©diat</label>
            <label class="qcm-option"><input type="radio" name="q9" value="recuperation"> Phase de r√©cup√©ration progressive (retour au calme)</label>
            <label class="qcm-option"><input type="radio" name="q9" value="effort"> Poursuivre l'effort jusqu'√† √©puisement</label>
        </div>
        <span class="competence-badge">C4</span>
    </div>

    <!-- Q10 -->
    <div id="q10" class="exercise">
        <div class="consigne">10. üö¶ <strong>Expliquer</strong> le r√¥le principal du Cerveau dans la commande musculaire :</div>
        <div class="reponse-area">
            <label class="qcm-option"><input type="radio" name="q10" value="stockage"> Stocker l'√©nergie n√©cessaire √† la contraction</label>
            <label class="qcm-option"><input type="radio" name="q10" value="commande"> √âmettre l'ordre de contraction (message nerveux moteur)</label>
            <label class="qcm-option"><input type="radio" name="q10" value="circulation"> Assurer la circulation du message dans le nerf</label>
        </div>
        <span class="competence-badge">C3</span>
    </div>

    <div class="btn-group">
        <button class="btn" onclick="submitQuiz()">‚úÖ Voir la correction</button>
        <button class="btn btn-secondary" onclick="resetQuiz()">üîÑ R√©initialiser</button>
    </div>
</div>

<!-- ===== PAGE 3 : CORRECTION ===== -->
<div id="page3" class="container hidden">
    <h1>üìä Correction</h1>
    
    <div id="score-display" class="score-display"></div>

    <div id="recap-list"></div>

    <div class="sigle-box">
        <strong>üí° √Ä RETENIR :</strong><br>
        ‚Ä¢ Circuit : <span class="keyword">Cerveau</span> ‚Üí <span class="keyword">Moelle √©pini√®re</span> ‚Üí <span class="keyword">Nerf moteur</span> ‚Üí <span class="keyword">Muscle</span><br>
        ‚Ä¢ Le cerveau <span class="keyword">envoie</span> l'ordre, le muscle <span class="keyword">se contracte</span><br>
        ‚Ä¢ R√©actions √† l'effort : ‚Üë <span class="keyword">fr√©quence cardiaque</span>, ‚Üë <span class="keyword">fr√©quence respiratoire</span>, ‚Üë <span class="keyword">temp√©rature</span><br>
        ‚Ä¢ Pr√©vention : <span class="keyword">√©chauffement avant</span>, <span class="keyword">r√©cup√©ration apr√®s</span>
    </div>

    <div class="review-section" id="review-section">
        <h2>üìö Points √† revoir</h2>
        <ul id="review-list"></ul>
    </div>

    <div class="btn-group">
        <button class="btn btn-secondary" onclick="goToPage('quiz')">üîÑ Recommencer</button>
        <button class="btn" onclick="goToPage('intro')">üè† Retour √† l'accueil</button>
    </div>
</div>

<script>
// === DATA ===
const answers = {
    q3: { select1: 'envoie', select2: 'contracte' },
    q4: 'poids',
    q6: 'echauffement',
    q7: { select1: 'nerf', select2: 'contraction' },
    q8: 'oxygene',
    q9: 'recuperation',
    q10: 'commande'
};

const dragAnswers = {
    q1: { 'q1-t1': 'cerveau', 'q1-t2': 'moelle', 'q1-t3': 'nerf' },
    q5: { 'q5-t1': 'pouls', 'q5-t2': 'respi' }
};

// Q2 correct order: Cerveau(2) ‚Üí Moelle(1) ‚Üí Nerf(4) ‚Üí Muscle(3)
const sortCorrectOrder = [2, 1, 4, 3];

const explanations = {
    q1: "Cerveau = d√©cision, Moelle = voie centrale, Nerf moteur = conduit vers muscle.",
    q2: "Ordre : Cerveau ‚Üí Moelle √©pini√®re ‚Üí Nerf moteur ‚Üí Muscle se contracte.",
    q3: "Le cerveau ENVOIE l'ordre, le muscle SE CONTRACTE en r√©ponse.",
    q4: "La perte de poids n'est PAS une r√©action imm√©diate (les autres oui).",
    q5: "Fr√©quence cardiaque = battements/min, Fr√©quence respiratoire = inspirations/min.",
    q6: "L'√©chauffement progressif pr√©pare le corps et r√©duit les risques.",
    q7: "Le nerf moteur transmet le message, provoquant la contraction.",
    q8: "Le c≈ìur acc√©l√®re pour apporter plus d'oxyg√®ne aux muscles actifs.",
    q9: "La r√©cup√©ration progressive permet au corps de s'adapter en douceur.",
    q10: "Le cerveau √©met l'ordre de contraction (centre de d√©cision)."
};

let selectedDragItem = null;
let selectedSortItem = null;

// === NAVIGATION ===
function goToPage(page) {
    document.getElementById('page1').classList.add('hidden');
    document.getElementById('page2').classList.add('hidden');
    document.getElementById('page3').classList.add('hidden');

    if (page === 'intro') {
        document.getElementById('page1').classList.remove('hidden');
    } else if (page === 'quiz') {
        document.getElementById('page2').classList.remove('hidden');
        initInteractions();
    } else if (page === 'correction') {
        document.getElementById('page3').classList.remove('hidden');
    }
    window.scrollTo(0, 0);
}

// === INTERACTIONS ===
function initInteractions() {
    // QCM click handlers
    document.querySelectorAll('.qcm-option').forEach(opt => {
        opt.onclick = function() {
            const parent = this.closest('.reponse-area');
            parent.querySelectorAll('.qcm-option').forEach(o => o.classList.remove('selected'));
            this.classList.add('selected');
            this.querySelector('input').checked = true;
        };
    });

    // Drag items - tap to select
    document.querySelectorAll('.drag-item').forEach(item => {
        item.onclick = function(e) {
            e.stopPropagation();
            
            if (this.classList.contains('used')) return;

            // If already in a drop zone, return to source
            if (this.closest('.drop-target')) {
                const sourceId = this.dataset.id.split('-')[0] + '-source';
                const dropTarget = this.closest('.drop-target');
                document.getElementById(sourceId).appendChild(this);
                dropTarget.classList.remove('has-item');
                this.classList.remove('used');
                return;
            }

            // Toggle selection
            if (selectedDragItem === this) {
                this.classList.remove('selected');
                selectedDragItem = null;
            } else {
                document.querySelectorAll('.drag-item').forEach(i => i.classList.remove('selected'));
                this.classList.add('selected');
                selectedDragItem = this;
            }
        };
    });

    // Drop targets - tap to drop
    document.querySelectorAll('.drop-target').forEach(target => {
        target.onclick = function() {
            if (!selectedDragItem) return;

            // If target already has item, return it to source
            const existingItem = this.querySelector('.drag-item');
            if (existingItem) {
                const sourceId = existingItem.dataset.id.split('-')[0] + '-source';
                document.getElementById(sourceId).appendChild(existingItem);
                existingItem.classList.remove('used');
            }

            // Place selected item
            this.innerHTML = '';
            this.appendChild(selectedDragItem);
            this.classList.add('has-item');
            selectedDragItem.classList.remove('selected');
            selectedDragItem.classList.add('used');
            selectedDragItem = null;
        };
    });

    // Sortable list - tap to swap
    initSortable();
}

function initSortable() {
    const list = document.getElementById('q2-sortable');
    if (!list) return;

    updateSortNumbers();

    list.querySelectorAll('.sortable-item').forEach(item => {
        item.onclick = function() {
            if (selectedSortItem === this) {
                this.classList.remove('selected');
                selectedSortItem = null;
            } else if (selectedSortItem) {
                // Swap items
                const parent = this.parentNode;
                const items = Array.from(parent.children);
                const idx1 = items.indexOf(selectedSortItem);
                const idx2 = items.indexOf(this);

                if (idx1 < idx2) {
                    parent.insertBefore(this, selectedSortItem);
                } else {
                    parent.insertBefore(selectedSortItem, this.nextSibling);
                }

                selectedSortItem.classList.remove('selected');
                selectedSortItem = null;
                updateSortNumbers();
            } else {
                document.querySelectorAll('.sortable-item').forEach(i => i.classList.remove('selected'));
                this.classList.add('selected');
                selectedSortItem = this;
            }
        };
    });
}

function updateSortNumbers() {
    const list = document.getElementById('q2-sortable');
    if (!list) return;
    list.querySelectorAll('.sortable-item').forEach((item, idx) => {
        item.querySelector('.number').textContent = idx + 1;
    });
}

// === RESET ===
function resetQuiz() {
    // Reset radios
    document.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false);
    document.querySelectorAll('.qcm-option').forEach(o => o.classList.remove('selected'));

    // Reset selects
    document.querySelectorAll('select').forEach(s => s.selectedIndex = 0);

    // Reset drag & drop
    document.querySelectorAll('.drop-target').forEach(target => {
        const item = target.querySelector('.drag-item');
        if (item) {
            const sourceId = item.dataset.id.split('-')[0] + '-source';
            document.getElementById(sourceId).appendChild(item);
            item.classList.remove('used', 'selected');
        }
        target.classList.remove('has-item');
    });

    // Reset sortable - restore initial shuffled order
    const list = document.getElementById('q2-sortable');
    if (list) {
        const initialOrder = [
            { value: 1, text: 'Moelle √©pini√®re' },
            { value: 2, text: "Cerveau envoie l'ordre" },
            { value: 3, text: 'Muscle se contracte' },
            { value: 4, text: 'Nerf moteur' }
        ];
        list.innerHTML = '';
        initialOrder.forEach(data => {
            const li = document.createElement('li');
            li.className = 'sortable-item';
            li.dataset.value = data.value;
            li.innerHTML = `<span class="number">?</span> ${data.text}`;
            list.appendChild(li);
        });
        initSortable();
    }

    selectedDragItem = null;
    selectedSortItem = null;
}

// === SUBMIT ===
function submitQuiz() {
    let score = 0;
    let total = 10;
    let recapHTML = '';
    let reviewPoints = [];

    // Q1 - Drag
    let q1Score = 0;
    document.querySelectorAll('[data-target^="q1-t"]').forEach(target => {
        const item = target.querySelector('.drag-item');
        const correct = target.dataset.correct;
        if (item && item.dataset.value === correct) q1Score++;
    });
    if (q1Score === 3) score++;
    else reviewPoints.push('Q1 : ' + explanations.q1);
    recapHTML += makeRecap(1, 'C2', q1Score === 3, explanations.q1);

    // Q2 - Sort
    const sortList = document.getElementById('q2-sortable');
    let q2ok = false;
    if (sortList) {
        const userOrder = Array.from(sortList.children).map(li => parseInt(li.dataset.value));
        q2ok = JSON.stringify(userOrder) === JSON.stringify(sortCorrectOrder);
    }
    if (q2ok) score++; else reviewPoints.push('Q2 : ' + explanations.q2);
    recapHTML += makeRecap(2, 'C2', q2ok, explanations.q2);

    // Q3 - Select
    const q3s1 = document.getElementById('q3-select-1').value;
    const q3s2 = document.getElementById('q3-select-2').value;
    const q3ok = q3s1 === answers.q3.select1 && q3s2 === answers.q3.select2;
    if (q3ok) score++; else reviewPoints.push('Q3 : ' + explanations.q3);
    recapHTML += makeRecap(3, 'C3', q3ok, explanations.q3);

    // Q4 - Radio
    const q4val = document.querySelector('input[name="q4"]:checked')?.value;
    const q4ok = q4val === answers.q4;
    if (q4ok) score++; else reviewPoints.push('Q4 : ' + explanations.q4);
    recapHTML += makeRecap(4, 'C2', q4ok, explanations.q4);

    // Q5 - Drag
    let q5Score = 0;
    document.querySelectorAll('[data-target^="q5-t"]').forEach(target => {
        const item = target.querySelector('.drag-item');
        const correct = target.dataset.correct;
        if (item && item.dataset.value === correct) q5Score++;
    });
    if (q5Score === 2) score++;
    else reviewPoints.push('Q5 : ' + explanations.q5);
    recapHTML += makeRecap(5, 'C2', q5Score === 2, explanations.q5);

    // Q6, Q8, Q9, Q10 - Radio
    [6, 8, 9, 10].forEach(n => {
        const val = document.querySelector(`input[name="q${n}"]:checked`)?.value;
        const ok = val === answers['q' + n];
        if (ok) score++; else reviewPoints.push(`Q${n} : ` + explanations['q' + n]);
        const comp = [6, 9].includes(n) ? 'C4' : 'C3';
        recapHTML += makeRecap(n, comp, ok, explanations['q' + n]);
    });

    // Q7 - Select
    const q7s1 = document.getElementById('q7-select-1').value;
    const q7s2 = document.getElementById('q7-select-2').value;
    const q7ok = q7s1 === answers.q7.select1 && q7s2 === answers.q7.select2;
    if (q7ok) score++; else reviewPoints.push('Q7 : ' + explanations.q7);
    recapHTML += makeRecap(7, 'C3', q7ok, explanations.q7);

    // Display
    const pct = Math.round((score / total) * 100);
    let level = '';
    if (pct >= 80) level = 'üèÜ Excellent !';
    else if (pct >= 60) level = 'üëç Bien !';
    else if (pct >= 40) level = 'üìö √Ä consolider';
    else level = '‚ö†Ô∏è √Ä reprendre';

    document.getElementById('score-display').innerHTML = `${score} / ${total} (${pct}%)<br><span style="font-size:1rem">${level}</span>`;
    document.getElementById('recap-list').innerHTML = recapHTML;

    const reviewList = document.getElementById('review-list');
    if (reviewPoints.length === 0) {
        document.getElementById('review-section').style.display = 'none';
    } else {
        document.getElementById('review-section').style.display = 'block';
        reviewList.innerHTML = reviewPoints.map(p => `<li>${p}</li>`).join('');
    }

    goToPage('correction');
}

function makeRecap(num, comp, ok, expl) {
    const status = ok ? '‚úÖ Correct' : '‚ùå Incorrect';
    const cls = ok ? 'correct-answer-text' : 'wrong-answer-text';
    return `
        <div class="recap-item">
            <strong>Question ${num}</strong> <span class="competence-badge">${comp}</span><br>
            <span class="${cls}">${status}</span>
            <span class="correct-answer-text" style="font-weight:normal; color: #555;">${expl}</span>
        </div>
    `;
}

// === INIT ===
window.onload = () => goToPage('intro');
</script>

</body>
</html>
