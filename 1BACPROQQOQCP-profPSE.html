<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<title>QQOQCP ‚Äì Entra√Ænement Bac Pro (Version Finale)</title>
<style>
  :root{
    --bg:#0f172a; --text:#f1f5f9; --muted:#94a3b8; 
    --line:rgba(255,255,255,.12);
    --c1:#8b5cf6; --c2:#3b82f6; --c3:#06b6d4; --c4:#10b981; --c5:#f59e0b; --err:#ef4444;
    --shadow:0 12px 30px rgba(0,0,0,.45); --radius:20px;
    --font-ui: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:var(--font-ui); color:var(--text);
    background:var(--bg); padding:16px; padding-bottom:100px;
    background-image: 
      radial-gradient(at 0% 0%, rgba(139,92,246,0.15) 0px, transparent 50%),
      radial-gradient(at 100% 0%, rgba(59,130,246,0.15) 0px, transparent 50%),
      radial-gradient(at 100% 100%, rgba(16,185,129,0.1) 0px, transparent 50%);
    background-attachment: fixed;
    overflow-x:hidden;
  }
  
  .wrap{max-width:1200px; margin:0 auto; display:grid; gap:20px}
  
  .header{ display:flex; flex-wrap:wrap; gap:16px; align-items:stretch; }
  .hero{
    flex:2 1 500px; border:1px solid var(--line); border-radius:var(--radius);
    background:rgba(255,255,255,.03); backdrop-filter:blur(10px);
    padding:20px; box-shadow:var(--shadow); position:relative; overflow:hidden;
  }
  .hero h1{margin:0 0 8px 0; font-size:1.5rem; background:linear-gradient(90deg, #fff, #cbd5e1); -webkit-background-clip:text; -webkit-text-fill-color: transparent;}
  
  .chips{display:flex; gap:8px; flex-wrap:wrap; margin-top:12px}
  .chip{
    padding:6px 12px; border-radius:99px; font-size:0.8rem; font-weight:700;
    border:1px solid var(--line); background:rgba(255,255,255,.05); display:flex; align-items:center; gap:6px;
  }
  
  .hud{
    flex:1 1 300px; border:1px solid var(--line); border-radius:var(--radius);
    background:rgba(15,23,42,.6); padding:16px; display:flex; flex-direction:column; gap:12px;
    justify-content:center;
  }
  .hud-row{display:flex; justify-content:space-between; align-items:center; font-weight:700; font-size:0.9rem}
  .progress-track{ height:8px; background:rgba(255,255,255,.1); border-radius:99px; overflow:hidden; }
  .progress-fill{
    height:100%; width:0%; background:linear-gradient(90deg, var(--c1), var(--c3));
    transition:width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .main-grid{ display:grid; grid-template-columns:1fr; gap:20px; }
  @media(min-width: 900px){
    .main-grid{ grid-template-columns: 1fr 380px; align-items:start; }
    #ProfPSEPanel{ position:sticky; top:20px; }
  }

  .card{
    border:1px solid var(--line); border-radius:var(--radius);
    background:rgba(30,41,59,.6); padding:20px; box-shadow:var(--shadow);
    transition: transform 0.2s, border-color 0.2s;
  }
  
  /* Inputs */
  .login-area{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
  input[type="text"], textarea{
    background:rgba(0,0,0,.3); border:1px solid var(--line); color:white;
    padding:12px 16px; border-radius:12px; outline:none; font-family:inherit; font-weight:500;
    flex:1; min-width:200px; transition:0.2s;
  }
  input[type="text"]:focus, textarea:focus{ border-color:var(--c3); box-shadow:0 0 0 3px rgba(6,182,212,.2); }
  
  /* Textarea sp√©cifique pour la r√©ponse */
  textarea {
    width: 100%; min-height: 100px; resize: vertical; font-size: 1rem; line-height: 1.5;
  }

  .btn{
    border:none; padding:12px 20px; border-radius:12px; font-weight:700; cursor:pointer;
    font-family:inherit; transition:all 0.2s; display:inline-flex; align-items:center; justify-content:center; gap:8px;
    box-shadow:0 4px 12px rgba(0,0,0,.2);
  }
  .btn-primary{ background:linear-gradient(135deg, var(--c2), var(--c1)); color:white; }
  .btn-primary:hover{ filter:brightness(1.1); transform:translateY(-1px); }
  
  .btn-success{ background:linear-gradient(135deg, var(--c4), #059669); color:#022c22; }
  .btn-danger{ background:rgba(239,68,68,0.2); border:1px solid var(--err); color:#fca5a5; }

  .stepper{display:flex; gap:6px; margin-bottom:16px}
  .step{ width:30px; height:6px; border-radius:4px; background:rgba(255,255,255,.1); transition:0.3s; }
  .step.active{ background:var(--c3); box-shadow:0 0 10px var(--c3); }
  .step.done{ background:var(--c4); }

  .q-tag{
    display:inline-flex; align-items:center; gap:8px; padding:6px 12px;
    border-radius:99px; background:rgba(6,182,212,.1); color:var(--c3);
    font-weight:800; font-size:0.8rem; margin-bottom:12px; border:1px solid rgba(6,182,212,.2);
  }

  .situation-box{
    background:rgba(0,0,0,.2); border-radius:16px; padding:16px; border:1px solid var(--line);
    margin-bottom:16px; display:grid; gap:16px;
  }
  @media(min-width:600px){ .situation-box{grid-template-columns: 2fr 1fr;} }
  
  /* --- CORRECTION ICI : Meilleur affichage du texte --- */
  .sit-text{ 
    line-height:1.6; 
    font-size:0.95rem; 
    white-space: pre-line; /* Conserve les paragraphes mais remplit les lignes */
    text-align: justify;   /* Aligne le texte proprement */
  }
  
  .sit-img{
    width:100%; height:200px; object-fit:cover; border-radius:12px; 
    border:1px solid var(--line); background:#000;
  }

  .prompt{
    font-size:1.1rem; font-weight:700; margin-bottom:16px; display:flex; gap:12px; align-items:start;
    background:rgba(255,255,255,.03); padding:16px; border-radius:16px; border-left:4px solid var(--c5);
  }

  /* Correction Panel */
  .correction-box {
    margin-top:20px; padding:20px; border-radius:16px; background:rgba(16,185,129,0.05);
    border:1px solid rgba(16,185,129,0.3); display:none; animation: slideDown 0.4s ease;
  }
  .model-answer { font-weight:700; color:#6ee7b7; margin-bottom:10px; font-size:1.05rem; }
  .keywords-list { font-size:0.9rem; color:var(--muted); margin-bottom:16px; }
  .redac-tip { 
    background:rgba(245,158,11,0.1); border-left:3px solid var(--c5); padding:10px; 
    font-size:0.85rem; color:#fcd34d; margin-bottom:20px; border-radius:4px;
  }
  .eval-buttons { display:flex; gap:12px; flex-wrap:wrap; }

  .ProfPSE-card{ display:flex; flex-direction:column; gap:16px; }
  .ProfPSE-visual{
    position:relative; width:100%; aspect-ratio:1/1; 
    border-radius:24px; overflow:hidden; border:1px solid var(--line);
    background:linear-gradient(135deg, rgba(255,255,255,.1), rgba(0,0,0,.2));
    margin:0 auto; box-shadow:0 10px 30px rgba(0,0,0,.3);
  }
  .ProfPSE-img{ width:100%; height:100%; object-fit:cover; transition:transform 0.5s ease; }
  .ProfPSE-bubble{
    background:rgba(255,255,255,.05); border:1px solid var(--line); border-radius:16px;
    padding:16px; position:relative;
  }
  .ProfPSE-bubble::before{
    content:""; position:absolute; top:-8px; left:50%; transform:translateX(-50%) rotate(45deg);
    width:16px; height:16px; background:inherit; border-top:1px solid var(--line); border-left:1px solid var(--line);
  }
  .ProfPSE-name{ font-size:0.8rem; text-transform:uppercase; letter-spacing:1px; color:var(--muted); margin-bottom:6px; font-weight:900; }
  .ProfPSE-msg{ font-weight:600; line-height:1.5; color:#fff; }

  /* M√©mo */
  .memo-card {
    background: rgba(15, 23, 42, 0.8); border:1px solid var(--line); border-radius:16px;
    padding:16px; margin-bottom:20px;
  }
  .memo-title {
    margin:0 0 12px 0; font-size:1.1rem; color:var(--text); text-align:center; 
    border-bottom:1px solid var(--line); padding-bottom:8px;
  }
  .memo-list { display:grid; gap:8px; }
  .memo-row {
    display:flex; align-items:baseline; gap:10px; font-size:0.9rem;
    padding:8px; background:rgba(255,255,255,0.03); border-radius:8px;
  }
  .tag-q {
    padding:4px 8px; border-radius:6px; font-weight:800; color:white; font-size:0.8rem;
    min-width:70px; text-align:center; display:inline-block; box-shadow:0 2px 4px rgba(0,0,0,0.3);
  }

  @keyframes slideDown{ from{opacity:0; transform:translateY(-10px)} to{opacity:1; transform:translateY(0)} }
  .pop { animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
  @keyframes pop { 0%{transform:scale(0.9)} 50%{transform:scale(1.02)} 100%{transform:scale(1)} }

  #confetti{ position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:999; }
  #finalScreen{ text-align:center; padding:40px 20px; display:none; }
  .big-score{ font-size:3rem; font-weight:900; margin:10px 0; background:linear-gradient(to right, var(--c4), var(--c3)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
  
</style>
</head>
<body>

<canvas id="confetti"></canvas>

<div class="wrap">
  
  <div class="header">
    <div class="hero">
      <h1>QQOQCP ‚Äì Entra√Ænement Bac Pro</h1>
      <p style="color:var(--muted); margin:0">Analyse & R√©daction : Construire ses r√©ponses</p>
      <div class="chips">
        <span class="chip" style="color:var(--c1)">‚óè M√©thodologie</span>
        <span class="chip" style="color:var(--c2)">‚óè Comp√©tence C2</span>
        <span class="chip" style="color:var(--c4)">‚óè Auto-√âvaluation</span>
      </div>
    </div>
    
    <div class="hud">
      <div class="hud-row">
        <span>Progression</span>
        <span id="txtProg">0 / 7</span>
      </div>
      <div class="progress-track"><div id="bar" class="progress-fill"></div></div>
      <div class="hud-row" style="margin-top:10px">
        <span style="color:var(--muted)">Score</span>
        <span id="txtScore" style="color:#fff; font-size:1.2rem">0</span>
      </div>
    </div>
  </div>

  <div class="card" id="loginCard">
    <h3 style="margin-top:0">Pret a t'entrainer ?</h3>
    <div class="login-area">
      <div id="display-pseudo" style="font-size:1.3rem; font-weight:bold; color:var(--accent); padding:10px 0;"></div>
      <button class="btn btn-primary" id="startBtn">Demarrer</button>
    </div>
  </div>

  <div class="main-grid" id="gameGrid" style="display:none">
    
    <div>
      <div class="card" id="qCard">
        <div class="stepper" id="stepper"></div>
        
        <div id="gameContent">
          <div class="q-tag" id="qTag">Tag</div>
          <h2 id="qTitle" style="margin:0 0 16px 0; font-size:1.4rem">Titre Question</h2>
          
          <div class="situation-box">
            <div class="sit-text" id="qText">Texte situation...</div>
            <img id="qImg" class="sit-img" src="" alt="Situation" onerror="this.style.display='none'">
          </div>

          <div class="prompt">
            <span style="color:var(--c5)">?</span>
            <span id="qPrompt">La question...</span>
          </div>

          <div id="inputZone">
            <textarea id="userAnswer" placeholder="R√©dige ta r√©ponse ici... (Fais une phrase compl√®te)"></textarea>
            <div style="margin-top:16px; display:flex; justify-content:flex-end">
              <button class="btn btn-primary" id="btnCheck">V√©rifier ma r√©ponse</button>
            </div>
          </div>

          <div id="correctionZone" class="correction-box">
            <div style="font-size:0.8rem; text-transform:uppercase; color:var(--muted); margin-bottom:4px">R√©ponse attendue (Mod√®le)</div>
            <div class="model-answer" id="modelAns">...</div>
            
            <div class="keywords-list" id="keywords">...</div>
            
            <div class="redac-tip" id="redacTip">...</div>

            <div style="border-top:1px solid rgba(255,255,255,0.1); margin-top:16px; padding-top:16px">
              <p style="margin:0 0 10px 0; font-weight:700">Ta r√©ponse correspond-elle (sens et mots-cl√©s) ?</p>
              <div class="eval-buttons">
                <button class="btn btn-success" id="btnYes">Oui, c'est bon</button>
                <button class="btn btn-danger" id="btnNo">Non, c'est incomplet</button>
              </div>
            </div>
          </div>

        </div>

        <div id="finalScreen">
          <h2>Session termin√©e !</h2>
          <div class="big-score" id="finalScoreVal">0/7</div>
          <p id="finalMsg" style="color:var(--muted); margin-bottom:30px">Analyse...</p>
          <button class="btn btn-primary" onclick="location.reload()">Rejouer</button>
        </div>
      </div>
    </div>

    <div id="ProfPSEPanel">
      
      <div class="memo-card">
        <h3 class="memo-title">M√©mo QQOQCP</h3>
        <div class="memo-list">
          <div class="memo-row">
            <span class="tag-q" style="background:#dc2626">Quoi ?</span>
            <span>Nature du probl√®me</span>
          </div>
          <div class="memo-row">
            <span class="tag-q" style="background:#ea580c">Qui ?</span>
            <span>Personnes concern√©es</span>
          </div>
          <div class="memo-row">
            <span class="tag-q" style="background:#b91c1c">O√π ?</span>
            <span>Lieu du probl√®me</span>
          </div>
          <div class="memo-row">
            <span class="tag-q" style="background:#7c3aed">Quand ?</span>
            <span>Moment / Dur√©e</span>
          </div>
          <div class="memo-row">
            <span class="tag-q" style="background:#2563eb">Comment ?</span>
            <span>Cause / Mani√®re</span>
          </div>
          <div class="memo-row">
            <span class="tag-q" style="background:#16a34a">Pourquoi ?</span>
            <span>Cons√©quence / Enjeu</span>
          </div>
        </div>
      </div>

      <div class="card ProfPSE-card">
        <div class="ProfPSE-visual">
          <img id="ProfPSEAvatar" class="ProfPSE-img" src="avatar-neutral.png" alt="Julie">
        </div>
        <div class="ProfPSE-bubble">
          <div class="ProfPSE-name">Coach Prof PSE</div>
          <div class="ProfPSE-msg" id="ProfPSEText">Bonjour ! Ici on ne coche plus, on r√©dige. Pr√™t ?</div>
        </div>
      </div>
      
    </div>

  </div>

</div>

<script>
/* --- CONFIG & DATA --- */
const AVATARS = {
  neutral: "avatar-neutral.png",
  happy: "avatar-bravo.png",    
  think: "avatar-reflechir.png",
  warn: "avatar-attention.png"
};

const QUESTIONS = [
  /* --- DOCUMENT 1 : L√âA --- */
  {
    title: "Situation 1 : Accident de L√©a",
    tag: "Le Probl√®me",
    text: `L√©a, titulaire d‚Äôun bac pro M√©tiers du commerce et de la vente, travaille dans un hypermarch√© employant 135 salari√©s. √Ä 10 heures, le 4 novembre, elle se rend en salle de pause. Cette salle est situ√©e au sous-sol et accessible par un escalier interne en colima√ßon. Lorsque L√©a descend l‚Äôescalier, elle heurte des cartons stock√©s sur les deux derni√®res marches, perd l‚Äô√©quilibre et chute. Avant l‚Äôarriv√©e des secours, L√©a est prise en charge par le SST. Suite √† cet accident du travail, elle pr√©sente une double fracture du tibia qui n√©cessite un arr√™t de travail de 40 jours.`,
    img: "situation-lea.jpg",
    prompt: "Formulez le probl√®me pos√© dans la situation.",
    model: "C'est un accident du travail suite √† une double fracture du tibia.",
    keys: "Mots-cl√©s : Accident du travail, fracture.",
    tip: "Conseil : Commence ta phrase par un groupe nominal (ex: 'Un accident...')."
  },
  {
    title: "Situation 1 : Accident de L√©a",
    tag: "Comment ?",
    text: `L√©a, titulaire d‚Äôun bac pro M√©tiers du commerce et de la vente, travaille dans un hypermarch√© employant 135 salari√©s. √Ä 10 heures, le 4 novembre, elle se rend en salle de pause. Cette salle est situ√©e au sous-sol et accessible par un escalier interne en colima√ßon. Lorsque L√©a descend l‚Äôescalier, elle heurte des cartons stock√©s sur les deux derni√®res marches, perd l‚Äô√©quilibre et chute. Avant l‚Äôarriv√©e des secours, L√©a est prise en charge par le SST. Suite √† cet accident du travail, elle pr√©sente une double fracture du tibia qui n√©cessite un arr√™t de travail de 40 jours.`,
    img: "situation-lea.jpg",
    prompt: "De quelle mani√®re cela s'est-il pass√© ?",
    model: "En descendant l'escalier, elle heurte des cartons stock√©s sur les deux derni√®res marches.",
    keys: "Mots-cl√©s : Descendant, heurte, cartons stock√©s.",
    tip: "Conseil : D√©cris l'action pr√©cise qui a caus√© la chute."
  },
  {
    title: "Situation 1 : Accident de L√©a",
    tag: "Quand ?",
    text: `L√©a, titulaire d‚Äôun bac pro M√©tiers du commerce et de la vente, travaille dans un hypermarch√© employant 135 salari√©s. √Ä 10 heures, le 4 novembre, elle se rend en salle de pause. Cette salle est situ√©e au sous-sol et accessible par un escalier interne en colima√ßon. Lorsque L√©a descend l‚Äôescalier, elle heurte des cartons stock√©s sur les deux derni√®res marches, perd l‚Äô√©quilibre et chute. Avant l‚Äôarriv√©e des secours, L√©a est prise en charge par le SST. Suite √† cet accident du travail, elle pr√©sente une double fracture du tibia qui n√©cessite un arr√™t de travail de 40 jours.`,
    img: "situation-lea.jpg",
    prompt: "Quand cela s'est-il pass√© (Date et Heure) ?",
    model: "Cela s'est pass√© √† 10 heures, le 4 novembre.",
    keys: "Mots-cl√©s : 10 heures, 4 novembre.",
    tip: "Conseil : Cherche bien l'horaire pr√©cis et la date dans le texte."
  },

  /* --- DOCUMENT 2 : LE STRESS --- */
  {
    title: "Situation 2 : Le Stress",
    tag: "Qui ?",
    text: `Selon une √©tude [...], plus de la moiti√© des Fran√ßais (60 %) ont √©prouv√© une augmentation de leur niveau de stress au cours des six derniers mois. Un chiffre qui est encore plus important chez les femmes (68 %), mais aussi chez les jeunes de moins de 35 ans (66 %). Parmi ces derniers, la tranche d‚Äô√¢ge des 18-24 ans est d‚Äôailleurs la plus expos√©e au stress (70 %). La situation sanitaire, mais aussi leur inqui√©tude face √† leur avenir et celui de leurs enfants, ont √©t√© les principaux facteurs de ce sentiment d‚Äôanxi√©t√©. Une anxi√©t√© qui va souvent de pair avec une baisse de la qualit√© du sommeil.`,
    img: "situation-stress.jpg",
    prompt: "Quelles sont les personnes concern√©es par le probl√®me (en g√©n√©ral) ?",
    model: "Ce sont plus de la moiti√© des Fran√ßais (60 %) qui sont concern√©s.",
    keys: "Mots-cl√©s : Plus de la moiti√©, Fran√ßais, 60%.",
    tip: "Conseil : N'oublie pas de citer le pourcentage global donn√© au d√©but du texte."
  },
  {
    title: "Situation 2 : Le Stress",
    tag: "Quoi / Causes",
    text: `Selon une √©tude [...], plus de la moiti√© des Fran√ßais (60 %) ont √©prouv√© une augmentation de leur niveau de stress au cours des six derniers mois. Un chiffre qui est encore plus important chez les femmes (68 %), mais aussi chez les jeunes de moins de 35 ans (66 %). Parmi ces derniers, la tranche d‚Äô√¢ge des 18-24 ans est d‚Äôailleurs la plus expos√©e au stress (70 %). La situation sanitaire, mais aussi leur inqui√©tude face √† leur avenir et celui de leurs enfants, ont √©t√© les principaux facteurs de ce sentiment d‚Äôanxi√©t√©. Une anxi√©t√© qui va souvent de pair avec une baisse de la qualit√© du sommeil.`,
    img: "situation-stress.jpg",
    prompt: "Quelles sont les causes du probl√®me ?",
    model: "Les causes sont la situation sanitaire et l'inqui√©tude des Fran√ßais face √† leur avenir.",
    keys: "Mots-cl√©s : Situation sanitaire, inqui√©tude, avenir.",
    tip: "Conseil : Rel√®ve les deux causes principales cit√©es √† la fin du texte."
  },

  /* --- DOCUMENT 3 : LE BRUIT --- */
  {
    title: "Situation 3 : Le Bruit",
    tag: "O√π ?",
    text: `Pr√®s de 70 % des Fran√ßais se d√©clarent g√™n√©s par le bruit, en particulier dans les villes o√π il constitue l‚Äôune des principales sources de plaintes des habitants. De simple d√©sagr√©ment, il peut devenir une r√©elle source de stress constituant alors un probl√®me de sant√© portant atteinte √† la qualit√© de vie.
Le co√ªt social du bruit en France a m√™me √©t√© √©valu√© par l‚ÄôADEME √† pr√®s de 147 milliards d‚Äôeuros par an !
L‚Äôorganisme humain ne s‚Äôhabitue pas au bruit. Si nous connaissons depuis longtemps les effets des niveaux sonores √©lev√©s sur le syst√®me auditif, nous savons maintenant que m√™me des bruits de faible intensit√© peuvent nuire au bien-√™tre des individus et avoir des r√©percussions sur leur sant√©.`,
    img: "situation-bruit.jpg",
    prompt: "O√π le probl√®me se pose-t-il principalement ?",
    model: "Le probl√®me se pose en particulier dans les villes.",
    keys: "Mots-cl√©s : Villes.",
    tip: "Conseil : Rep√®re le lieu g√©ographique cit√© d√®s la premi√®re phrase."
  },
  {
    title: "Situation 3 : Le Bruit",
    tag: "Pourquoi / Cons√©quences",
    text: `Pr√®s de 70 % des Fran√ßais se d√©clarent g√™n√©s par le bruit, en particulier dans les villes o√π il constitue l‚Äôune des principales sources de plaintes des habitants. De simple d√©sagr√©ment, il peut devenir une r√©elle source de stress constituant alors un probl√®me de sant√© portant atteinte √† la qualit√© de vie.
Le co√ªt social du bruit en France a m√™me √©t√© √©valu√© par l‚ÄôADEME √† pr√®s de 147 milliards d‚Äôeuros par an !
L‚Äôorganisme humain ne s‚Äôhabitue pas au bruit. Si nous connaissons depuis longtemps les effets des niveaux sonores √©lev√©s sur le syst√®me auditif, nous savons maintenant que m√™me des bruits de faible intensit√© peuvent nuire au bien-√™tre des individus et avoir des r√©percussions sur leur sant√©.`,
    img: "situation-bruit.jpg",
    prompt: "Quelles sont les cons√©quences du probl√®me (Pourquoi faut-il le r√©gler) ?",
    model: "Le bruit est source de stress, nuit √† la sant√© et au bien-√™tre, et engendre un co√ªt social √©lev√©.",
    keys: "Mots-cl√©s : Stress, sant√©, bien-√™tre, co√ªt social.",
    tip: "Conseil : Cherche les impacts sur la sant√© et l'√©conomie (co√ªt)."
  },

  /* --- DOCUMENT 4 : PANNEAUX --- */
  {
    title: "Situation 4 : Les Panneaux",
    tag: "O√π ?",
    text: `Avec 564 000 accidents de travail et 89 000 maladies professionnelles, tous les employeurs sont contraints par le Code du travail d‚Äôafficher un certain nombre d‚Äôinformations pour assurer la s√©curit√© des salari√©s afin de pr√©venir tous risques professionnels (Consignes de s√©curit√© sur un chantier ) (Consignes de s√©curit√© pour
l‚Äôutilisation d‚Äôune scie circulaire)`,
    img: "situation-panneaux.jpg",
    prompt: "O√π ces consignes doivent-elles √™tre mises en place ?",
    model: "Elles doivent √™tre affich√©es en entreprise (ou √©tablissement de formation) car c'est une obligation de l'employeur.",
    keys: "Mots-cl√©s : Entreprise, employeur, Code du travail.",
    tip: "Conseil : Justifie ta r√©ponse en citant le cadre l√©gal (Code du travail)."
  }
];

/* --- STATE --- */
/* PSEUDO AUTO (RGPD) */
const PSEUDOS = [
    "Panda üêº","Etoile ‚≠ê","Fusee üöÄ","Diamant üíé","Tigre üêØ","Dragon üêâ",
    "Licorne ü¶Ñ","Phoenix üî•","Ninja ü•∑","Robot ü§ñ","Koala üê®","Dauphin üê¨",
    "Aigle ü¶Ö","Papillon ü¶ã","Lion ü¶Å","Comete ‚òÑÔ∏è","Eclair ‚ö°","Flocon ‚ùÑÔ∏è",
    "Soleil ‚òÄÔ∏è","Lune üåô","Galaxie üåå","Hibou ü¶â","Renard ü¶ä","Tornade üå™Ô∏è",
    "Volcan üåã","Cristal üí†","Trefle üçÄ","Cerise üçí","Arc-en-ciel üåà","Pingouin üêß"
];
const myPseudo = PSEUDOS[Math.floor(Math.random() * PSEUDOS.length)];
document.getElementById('display-pseudo').textContent = myPseudo;

let state = { idx: 0, score: 0, name: "" };

/* --- UI HELPERS --- */
const $ = (id) => document.getElementById(id);
const setAvatar = (mood) => {
  const img = $("ProfPSEAvatar");
  if(AVATARS[mood]) img.src = AVATARS[mood];
};

const speak = (msg, mood="neutral") => {
  $("ProfPSEText").textContent = msg;
  setAvatar(mood);
};

/* --- GAME LOGIC --- */
function init(){
  $("loginCard").style.display = "block";
  $("gameGrid").style.display = "none";
}

function startGame(){
  state.name = myPseudo;
  $("loginCard").style.display = "none";
  $("gameGrid").style.display = "grid";
  loadQuestion();
}

function loadQuestion(){
  if(state.idx >= QUESTIONS.length){ showFinal(); return; }
  const q = QUESTIONS[state.idx];
  
  // UI Reset
  $("qTitle").textContent = q.title; $("qTag").textContent = q.tag;
  $("qText").textContent = q.text; $("qImg").src = q.img; $("qPrompt").textContent = q.prompt;
  
  // Reset Inputs & Panels
  $("userAnswer").value = "";
  $("userAnswer").disabled = false;
  $("inputZone").style.display = "block";
  $("correctionZone").style.display = "none";
  $("qImg").style.display = "block";
  
  updateHUD();
  if(state.idx === 0) speak(`Salut ${state.name} ! Lis bien TOUT le texte pour r√©pondre.`, "neutral");
  else speak("√Ä toi de chercher dans le texte !", "neutral");
}

/* √âtape 1 : L'√©l√®ve clique sur "V√©rifier" */
function checkAnswer(){
  const userTxt = $("userAnswer").value.trim();
  if(userTxt.length < 5){
    speak("Ta r√©ponse est trop courte ! Fais une phrase.", "warn");
    return;
  }

  // Affichage de la correction
  const q = QUESTIONS[state.idx];
  $("userAnswer").disabled = true; // On bloque la zone
  $("btnCheck").style.display = "none"; // On cache le bouton v√©rifier
  
  $("modelAns").textContent = q.model;
  $("keywords").textContent = q.keys;
  $("redacTip").textContent = q.tip;
  
  $("correctionZone").style.display = "block"; // Affiche le panneau vert
  
  speak("Compare ta r√©ponse avec la mienne. As-tu trouv√© les √©l√©ments dans le texte ?", "think");
}

/* √âtape 2 : L'√©l√®ve s'auto-√©value */
function selfEval(isCorrect){
  if(isCorrect){
    state.score++;
    speak("Super ! L'honn√™tet√© paie.", "happy");
    $("qCard").classList.add("pop"); setTimeout(()=>$("qCard").classList.remove("pop"), 500);
  } else {
    speak("Pas grave, relis bien le texte la prochaine fois.", "neutral");
  }
  
  // Reset bouton check pour la prochaine
  $("btnCheck").style.display = "inline-block";
  nextQ();
}

function nextQ(){ state.idx++; loadQuestion(); }

function updateHUD(){
  $("txtScore").textContent = state.score; $("txtProg").textContent = `${state.idx}/${QUESTIONS.length}`;
  $("bar").style.width = `${(state.idx / QUESTIONS.length)*100}%`;
  const st = $("stepper"); st.innerHTML = "";
  for(let i=0; i<QUESTIONS.length; i++){ st.innerHTML += `<div class="step ${i===state.idx ? "active" : (i<state.idx ? "done" : "")}"></div>`; }
}

function showFinal(){
  $("gameContent").style.display = "none"; $("finalScreen").style.display = "block";
  $("finalScoreVal").textContent = `${state.score} / ${QUESTIONS.length}`;
  const pct = state.score / QUESTIONS.length;
  let msg = "";
  if(pct > 0.8) { msg = "Excellent ! Tu es pr√™t pour le Bac Pro."; speak("Super analyse de texte ! Tu g√®res !", "happy"); launchConfetti(); }
  else { msg = "Bon entra√Ænement. Essaie d'√™tre plus pr√©cis avec les infos du texte."; speak("Bien jou√© !", "happy"); }
  $("finalMsg").textContent = msg;
}

function launchConfetti() {
  const canvas = document.getElementById('confetti');
  const ctx = canvas.getContext('2d');
  canvas.width = window.innerWidth; canvas.height = window.innerHeight;
  const pieces = [];
  for(let i=0; i<100; i++){ pieces.push({ x: Math.random()*canvas.width, y: Math.random()*canvas.height - canvas.height, color: `hsl(${Math.random()*360}, 100%, 50%)`, size: Math.random()*8+4, speed: Math.random()*3+2 }); }
  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    pieces.forEach(p => { ctx.fillStyle = p.color; ctx.fillRect(p.x, p.y, p.size, p.size); p.y += p.speed; if(p.y > canvas.height) p.y = -10; });
    requestAnimationFrame(draw);
  }
  draw(); setTimeout(()=>cancelAnimationFrame(draw), 5000);
}

$("startBtn").addEventListener("click", startGame);
$("prenom").addEventListener("keydown", (e)=>{ if(e.key==="Enter") startGame() });
$("btnCheck").addEventListener("click", checkAnswer);
$("btnYes").addEventListener("click", ()=>selfEval(true));
$("btnNo").addEventListener("click", ()=>selfEval(false));

init();
</script>
</body>
</html>