<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R√©vision A.6 - Infections Sexuellement Transmissibles - Bac Pro Premi√®re</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
            transition: all 0.3s ease;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }
        
        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .btn-back {
            background: rgba(255,255,255,0.1);
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            border: 2px solid rgba(255,255,255,0.2);
            cursor: pointer;
        }
        
        .btn-back:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }
        
        .score-bar {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 50px;
        }
        
        .score-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .score-item .icon {
            font-size: 18px;
        }
        
        /* √âcrans */
        .screen {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .screen.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* √âcran d'accueil */
        .welcome-screen {
            text-align: center;
            padding: 30px 0;
        }
        
        .welcome-title {
            font-size: 42px;
            font-weight: 900;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #ff9a9e, #fecfef, #fecfef);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .welcome-subtitle {
            font-size: 18px;
            color: rgba(255,255,255,0.7);
            margin-bottom: 30px;
        }
        
        /* Objectifs */
        .objectifs-card {
            background: linear-gradient(135deg, rgba(255, 154, 158, 0.3), rgba(254, 207, 239, 0.3));
            border: 2px solid rgba(255, 154, 158, 0.5);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            text-align: left;
        }
        
        .objectifs-card h3 {
            font-size: 18px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .objectif-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            font-size: 14px;
            line-height: 1.5;
        }
        
        .objectif-item:last-child {
            border-bottom: none;
        }
        
        .objectif-item .check {
            color: #4CAF50;
            font-size: 18px;
            flex-shrink: 0;
        }
        
        .competences-row {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .comp-badge {
            background: rgba(255,255,255,0.15);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
        }
        
        .comp-badge.c1 { background: rgba(16, 185, 129, 0.3); border: 1px solid #10b981; }
        .comp-badge.c2 { background: rgba(102, 126, 234, 0.3); border: 1px solid #667eea; }
        .comp-badge.c3 { background: rgba(245, 158, 11, 0.3); border: 1px solid #f59e0b; }
        .comp-badge.c4 { background: rgba(239, 68, 68, 0.3); border: 1px solid #ef4444; }
        .comp-badge.c5 { background: rgba(168, 85, 247, 0.3); border: 1px solid #a855f7; }
        .comp-badge.c6 { background: rgba(34, 197, 94, 0.3); border: 1px solid #22c55e; }
        
        /* Niveaux */
        .niveaux-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 25px;
        }
        
        .niveau-card {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .niveau-card:hover:not(.locked) {
            background: rgba(255,255,255,0.1);
            transform: translateX(5px);
            border-color: rgba(255, 154, 158, 0.5);
        }
        
        .niveau-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .niveau-card.completed {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }
        
        .niveau-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #ff9a9e, #fecfef);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            flex-shrink: 0;
        }
        
        .niveau-info {
            flex: 1;
        }
        
        .niveau-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 3px;
        }
        
        .niveau-desc {
            font-size: 13px;
            color: rgba(255,255,255,0.7);
            margin-bottom: 8px;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: width 0.5s ease;
        }
        
        .niveau-stats {
            text-align: right;
            font-size: 12px;
        }
        
        .niveau-percent {
            font-weight: 700;
            font-size: 18px;
            color: #4CAF50;
        }
        
        /* √âcran de jeu */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 15px 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
        }
        
        .level-title {
            font-size: 20px;
            font-weight: 700;
        }
        
        .card-counter {
            font-size: 14px;
            color: rgba(255,255,255,0.8);
        }
        
        .card-container {
            background: rgba(255,255,255,0.95);
            color: #333;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .keyword-badge {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            display: inline-block;
            margin-bottom: 20px;
        }
        
        .question-section h3 {
            font-size: 18px;
            margin-bottom: 20px;
            color: #333;
        }
        
        .keyword-input {
            width: 100%;
            padding: 15px;
            border: 3px solid #e0e0e0;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            background: #f8f9fa;
            transition: all 0.3s ease;
        }
        
        .keyword-input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
        }
        
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .option-btn {
            background: #f8f9fa;
            border: 3px solid #e0e0e0;
            border-radius: 15px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 14px;
            text-align: left;
        }
        
        .option-btn:hover {
            background: #e3f2fd;
            border-color: #667eea;
        }
        
        .option-btn.selected {
            background: #667eea;
            border-color: #667eea;
            color: white;
        }
        
        .option-letter {
            width: 30px;
            height: 30px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 12px;
            flex-shrink: 0;
        }
        
        .option-btn.selected .option-letter {
            background: white;
            color: #667eea;
        }
        
        .vf-container {
            display: flex;
            gap: 15px;
        }
        
        .vf-btn {
            flex: 1;
            padding: 20px;
            border: 3px solid #e0e0e0;
            border-radius: 15px;
            background: #f8f9fa;
            cursor: pointer;
            font-weight: 700;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .vf-btn.vrai:hover, .vf-btn.vrai.selected {
            background: #4CAF50;
            border-color: #4CAF50;
            color: white;
        }
        
        .vf-btn.faux:hover, .vf-btn.faux.selected {
            background: #f44336;
            border-color: #f44336;
            color: white;
        }
        
        .actions-row {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 120px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #667eea;
            border: 2px solid #667eea;
        }
        
        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }
        
        .hint-box {
            background: #fff3cd;
            border: 1px solid #ffd700;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            font-size: 14px;
            color: #856404;
        }
        
        /* Overlay de feedback - FOND OPAQUE OBLIGATOIRE */
        .feedback-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8); /* OPAQUE comme requis */
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .feedback-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        
        .feedback-card {
            background: linear-gradient(135deg, #2a2a3e, #1e1e2f); /* FOND OPAQUE OBLIGATOIRE */
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            color: white;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            transform: scale(0.8);
            transition: all 0.3s ease;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .feedback-overlay.visible .feedback-card {
            transform: scale(1);
        }
        
        .feedback-card.correct {
            border: 3px solid #4CAF50;
        }
        
        .feedback-card.incorrect {
            border: 3px solid #f44336;
        }
        
        .feedback-header {
            margin-bottom: 20px;
        }
        
        .feedback-icon {
            font-size: 48px;
            margin-bottom: 10px;
            display: block;
        }
        
        .feedback-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .feedback-points {
            font-size: 16px;
            color: #4CAF50;
            font-weight: 600;
        }
        
        .feedback-explanation {
            background: rgba(255,255,255,0.1); /* Opaque suffisant pour lisibilit√© */
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
        }
        
        .feedback-explanation h4 {
            margin-bottom: 10px;
            color: #4CAF50;
        }
        
        .keyword-box {
            background: rgba(102, 126, 234, 0.3);
            border: 1px solid #667eea;
            border-radius: 10px;
            padding: 10px;
            margin: 15px 0;
            font-weight: 600;
            color: #667eea;
        }
        
        .tip-box {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .tip-box h5 {
            color: #ffc107;
            margin-bottom: 8px;
        }
        
        .btn-continue {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }
        
        .btn-continue:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        /* √âcran de r√©sultats */
        .results-screen {
            text-align: center;
            padding: 20px 0;
        }
        
        .results-icon {
            font-size: 80px;
            margin-bottom: 20px;
            display: block;
        }
        
        .results-title {
            font-size: 32px;
            font-weight: 900;
            margin-bottom: 10px;
        }
        
        .results-score {
            font-size: 48px;
            font-weight: 900;
            color: #4CAF50;
            margin-bottom: 20px;
        }
        
        .results-stats {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
        }
        
        .stats-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .stats-row:last-child {
            border-bottom: none;
        }
        
        .stat-label {
            font-size: 14px;
            color: rgba(255,255,255,0.8);
        }
        
        .stat-value {
            font-size: 16px;
            font-weight: 700;
        }
        
        .errors-recap {
            background: rgba(244, 67, 54, 0.1);
            border: 1px solid #f44336;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: left;
        }
        
        .errors-recap h4 {
            color: #f44336;
            margin-bottom: 15px;
        }
        
        .errors-list {
            list-style: none;
        }
        
        .errors-list li {
            padding: 5px 0;
            font-size: 14px;
            color: rgba(255,255,255,0.9);
        }
        
        .results-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .results-actions .btn {
            flex: 1;
            min-width: 150px;
        }
        
        /* Popup streak */
        .streak-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, #ff6b6b, #feca57);
            color: white;
            padding: 20px 30px;
            border-radius: 50px;
            font-size: 24px;
            font-weight: 900;
            z-index: 1001;
            animation: streakPop 1.5s ease;
            display: none;
        }
        
        @keyframes streakPop {
            0% { transform: translate(-50%, -50%) scale(0); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }
        
        /* Confettis */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #ff6b6b;
            animation: confetti-fall 3s linear;
            z-index: 999;
        }
        
        @keyframes confetti-fall {
            to {
                transform: translateY(100vh) rotate(360deg);
            }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .welcome-title {
                font-size: 32px;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
            }
            
            .score-bar {
                width: 100%;
                justify-content: center;
            }
            
            .vf-container {
                flex-direction: column;
            }
            
            .actions-row {
                flex-direction: column;
            }
            
            .results-actions {
                flex-direction: column;
            }
            
            .feedback-card {
                margin: 20px;
                width: calc(100% - 40px);
                padding: 20px;
            }
        }
        
        @media (max-width: 480px) {
            .welcome-title {
                font-size: 28px;
            }
            
            .card-container {
                padding: 20px;
            }
            
            .streak-popup {
                font-size: 18px;
                padding: 15px 25px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <button class="btn-back" onclick="goHome()">‚Üê Accueil</button>
            <div class="score-bar">
                <div class="score-item">
                    <span class="icon">üèÜ</span>
                    <span id="totalPoints">0</span>
                </div>
                <div class="score-item">
                    <span class="icon">üî•</span>
                    <span id="currentStreak">0</span>
                </div>
            </div>
        </div>

        <!-- √âcran d'accueil -->
        <div class="screen active" id="homeScreen">
            <div class="welcome-screen">
                <h1 class="welcome-title">ü¶† Module A.6</h1>
                <p class="welcome-subtitle">Infections Sexuellement Transmissibles</p>
                
                <!-- Objectifs -->
                <div class="objectifs-card">
                    <h3>üéØ Objectifs du module</h3>
                    <div class="objectif-item">
                        <span class="check">‚úì</span>
                        <span>Adopter un comportement responsable pour pr√©venir les IST</span>
                    </div>
                    <div class="objectif-item">
                        <span class="check">‚úì</span>
                        <span>Identifier les voies de transmission des principales IST</span>
                    </div>
                    <div class="objectif-item">
                        <span class="check">‚úì</span>
                        <span>Conna√Ætre les moyens de pr√©vention et de d√©pistage</span>
                    </div>
                    <div class="objectif-item">
                        <span class="check">‚úì</span>
                        <span>Expliquer l'√©volution du VIH vers le SIDA</span>
                    </div>
                    <div class="competences-row">
                        <span class="comp-badge c1">C1 - Traiter une information</span>
                        <span class="comp-badge c2">C2 - Appliquer une d√©marche d'analyse</span>
                        <span class="comp-badge c3">C3 - Expliquer un ph√©nom√®ne</span>
                        <span class="comp-badge c4">C4 - Proposer une solution</span>
                        <span class="comp-badge c5">C5 - Argumenter un choix</span>
                        <span class="comp-badge c6">C6 - Communiquer</span>
                    </div>
                </div>
                
                <!-- Niveaux -->
                <div class="niveaux-grid">
                    <div class="niveau-card" onclick="startLevel(1)">
                        <div class="niveau-icon">ü¶†</div>
                        <div class="niveau-info">
                            <div class="niveau-title">Niveau 1 - G√©n√©ralit√©s IST</div>
                            <div class="niveau-desc">D√©finitions et caract√©ristiques de base</div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="level1Bar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="niveau-stats">
                            <div class="niveau-percent" id="level1Percent">0%</div>
                        </div>
                    </div>
                    
                    <div class="niveau-card" onclick="startLevel(2)">
                        <div class="niveau-icon">üîó</div>
                        <div class="niveau-info">
                            <div class="niveau-title">Niveau 2 - Voies de transmission</div>
                            <div class="niveau-desc">Comment se propagent les IST</div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="level2Bar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="niveau-stats">
                            <div class="niveau-percent" id="level2Percent">0%</div>
                        </div>
                    </div>
                    
                    <div class="niveau-card" onclick="startLevel(3)">
                        <div class="niveau-icon">ü©∫</div>
                        <div class="niveau-info">
                            <div class="niveau-title">Niveau 3 - Sympt√¥mes & Cons√©quences</div>
                            <div class="niveau-desc">Signes d'alerte et complications</div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="level3Bar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="niveau-stats">
                            <div class="niveau-percent" id="level3Percent">0%</div>
                        </div>
                    </div>
                    
                    <div class="niveau-card" onclick="startLevel(4)">
                        <div class="niveau-icon">üõ°Ô∏è</div>
                        <div class="niveau-info">
                            <div class="niveau-title">Niveau 4 - Pr√©vention</div>
                            <div class="niveau-desc">Moyens de protection efficaces</div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="level4Bar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="niveau-stats">
                            <div class="niveau-percent" id="level4Percent">0%</div>
                        </div>
                    </div>
                    
                    <div class="niveau-card" onclick="startLevel(5)">
                        <div class="niveau-icon">üè•</div>
                        <div class="niveau-info">
                            <div class="niveau-title">Niveau 5 - D√©pistage & Traitement</div>
                            <div class="niveau-desc">Tests et prise en charge m√©dicale</div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="level5Bar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="niveau-stats">
                            <div class="niveau-percent" id="level5Percent">0%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- √âcran de jeu -->
        <div class="screen" id="gameScreen">
            <div class="game-header">
                <div class="level-title" id="levelTitle">Niveau 1</div>
                <div class="card-counter" id="cardCounter">1/10</div>
            </div>
            
            <div class="card-container">
                <div class="keyword-badge" id="keywordBadge">Mot-cl√©</div>
                <div class="question-section" id="questionSection">
                    <!-- Contenu dynamique -->
                </div>
                <div class="hint-box" id="hintText" style="display: none;"></div>
                
                <div class="actions-row">
                    <button class="btn btn-secondary" onclick="showHint()">üí° Indice</button>
                    <button class="btn btn-primary" onclick="validateAnswer()">‚úì Valider</button>
                </div>
            </div>
        </div>

        <!-- √âcran de r√©sultats -->
        <div class="screen" id="resultsScreen">
            <div class="results-screen">
                <span class="results-icon" id="resultsIcon">üéâ</span>
                <h2 class="results-title" id="resultsTitle">Niveau r√©ussi !</h2>
                <div class="results-score" id="resultsScore">85%</div>
                
                <div class="results-stats">
                    <div class="stats-row">
                        <span class="stat-label">Bonnes r√©ponses</span>
                        <span class="stat-value" id="correctCount">8/10</span>
                    </div>
                    <div class="stats-row">
                        <span class="stat-label">Points gagn√©s</span>
                        <span class="stat-value" id="pointsEarned">+75</span>
                    </div>
                    <div class="stats-row">
                        <span class="stat-label">Meilleure s√©rie</span>
                        <span class="stat-value" id="bestStreak">5</span>
                    </div>
                </div>
                
                <div class="errors-recap" id="errorsRecap" style="display: none;">
                    <h4>üìù Points √† revoir</h4>
                    <ul class="errors-list" id="errorsList"></ul>
                </div>
                
                <div class="results-actions">
                    <button class="btn btn-secondary" onclick="goHome()">üè† Accueil</button>
                    <button class="btn btn-primary" id="nextLevelBtn" onclick="nextLevel()" style="display: none;">üéØ Niveau suivant</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Overlay de feedback -->
    <div class="feedback-overlay" id="feedbackOverlay">
        <div class="feedback-card" id="feedbackCard">
            <div class="feedback-header">
                <span class="feedback-icon" id="feedbackIcon">‚úÖ</span>
                <h3 class="feedback-title" id="feedbackTitle">Bravo !</h3>
                <p class="feedback-points" id="feedbackPoints">+10 points</p>
            </div>
            <div class="feedback-explanation" id="feedbackExplanation">
                <!-- Contenu dynamique -->
            </div>
            <button class="btn-continue" onclick="nextCard()">Continuer ‚Üí</button>
        </div>
    </div>

    <!-- Popup streak -->
    <div class="streak-popup" id="streakPopup"></div>

    <script>
        // √âtat du jeu
        let currentLevel = 1;
        let currentCardIndex = 0;
        let levelProgress = [0, 0, 0, 0, 0, 0]; // Index 0 non utilis√©
        let totalPoints = 0;
        let currentStreak = 0;
        let bestStreak = 0;
        let hintUsed = false;
        
        // Variables par niveau
        let levelPoints = 0;
        let levelCorrect = 0;
        let levelErrors = [];
        
        // Donn√©es des niveaux
        const levels = {
            1: {
                title: "Niveau 1 - G√©n√©ralit√©s IST",
                icon: "ü¶†",
                cards: [
                    {
                        type: "keyword",
                        keyword: "IST",
                        question: "Que signifie le sigle <strong>IST</strong> ?",
                        answer: "infection sexuellement transmissible",
                        explanation: "IST signifie Infection Sexuellement Transmissible. Ce sont des infections caus√©es par des micro-organismes qui se transmettent principalement lors des rapports sexuels.",
                        tip: "Au BAC : Distinguer IST (terme actuel) de MST (ancien terme). Les IST incluent toutes les voies de transmission, pas seulement sexuelle.",
                        hint: "R√©fl√©chis aux mots : Infection, Sexuellement, Transmissible"
                    },
                    {
                        type: "qcm",
                        keyword: "Micro-organismes",
                        question: "Quels types de micro-organismes peuvent causer des IST ?",
                        options: [
                            "Seulement des virus",
                            "Bact√©ries, virus, parasites et champignons",
                            "Uniquement des bact√©ries",
                            "Seulement des parasites"
                        ],
                        answer: 1,
                        explanation: "Les IST peuvent √™tre caus√©es par diff√©rents types de micro-organismes : bact√©ries (syphilis, chlamydia), virus (VIH, herp√®s), parasites (trichomonas) et champignons (candidose).",
                        tip: "Au BAC : Conna√Ætre les exemples d'IST pour chaque type de micro-organisme.",
                        hint: "Pense √† la diversit√© des agents pathog√®nes"
                    },
                    {
                        type: "vf",
                        keyword: "Sympt√¥mes",
                        question: "Toutes les IST provoquent des sympt√¥mes visibles imm√©diatement.",
                        answer: false,
                        explanation: "FAUX. Beaucoup d'IST sont asymptomatiques, c'est-√†-dire qu'elles ne pr√©sentent pas de sympt√¥mes visibles, surtout au d√©but. C'est pourquoi le d√©pistage est crucial.",
                        tip: "Au BAC : Insister sur le caract√®re souvent asymptomatique des IST, ce qui favorise leur transmission.",
                        hint: "Pense au VIH et √† la phase asymptomatique"
                    },
                    {
                        type: "keyword",
                        keyword: "Asymptomatique",
                        question: "Comment appelle-t-on une infection qui ne pr√©sente pas de sympt√¥mes apparents ?",
                        answer: "asymptomatique",
                        explanation: "Une infection asymptomatique est une infection qui ne pr√©sente pas de signes ou sympt√¥mes visibles. La personne est infect√©e mais ne le sait pas forc√©ment.",
                        tip: "Au BAC : Ce terme est fondamental pour expliquer la propagation des IST.",
                        hint: "Commence par 'a' et signifie 'sans sympt√¥me'"
                    },
                    {
                        type: "qcm",
                        keyword: "Pr√©valence",
                        question: "D'apr√®s les donn√©es fran√ßaises, quelle tendance observe-t-on pour les IST bact√©riennes ?",
                        options: [
                            "Elles diminuent r√©guli√®rement",
                            "Elles sont en forte augmentation",
                            "Elles restent stables",
                            "Elles ont disparu"
                        ],
                        answer: 1,
                        explanation: "Les IST bact√©riennes (syphilis, chlamydia, gonococcie) sont en forte augmentation en France, principalement due √† la diminution de l'usage du pr√©servatif.",
                        tip: "Au BAC : Conna√Ætre les tendances √©pid√©miologiques actuelles des IST en France.",
                        hint: "Consulte les donn√©es r√©centes de Sant√© publique France"
                    }
                ]
            },
            2: {
                title: "Niveau 2 - Voies de transmission",
                icon: "üîó",
                cards: [
                    {
                        type: "qcm",
                        keyword: "Transmission",
                        question: "Quelles sont les trois principales voies de transmission du VIH ?",
                        options: [
                            "A√©rienne, digestive, cutan√©e",
                            "Sexuelle, sanguine, materno-f≈ìtale",
                            "Salivaire, urinaire, respiratoire",
                            "Tactile, auditive, visuelle"
                        ],
                        answer: 1,
                        explanation: "Le VIH se transmet par trois voies principales : sexuelle (la plus fr√©quente), sanguine (transfusion, seringues) et materno-f≈ìtale (de la m√®re √† l'enfant).",
                        tip: "Au BAC : Toujours citer ces trois voies pour le VIH, c'est incontournable.",
                        hint: "Pense aux fluides corporels qui contiennent le virus"
                    },
                    {
                        type: "vf",
                        keyword: "Pr√©servatif",
                        question: "Le pr√©servatif prot√®ge contre toutes les IST.",
                        answer: true,
                        explanation: "VRAI. Correctement utilis√©, le pr√©servatif (masculin ou f√©minin) est le seul moyen de protection qui prot√®ge contre toutes les IST lors des rapports sexuels.",
                        tip: "Au BAC : Le pr√©servatif est la protection universelle contre les IST.",
                        hint: "C'est une barri√®re physique"
                    },
                    {
                        type: "keyword",
                        keyword: "Materno-f≈ìtale",
                        question: "Comment appelle-t-on la transmission d'une infection de la m√®re √† son enfant ?",
                        answer: "materno-f≈ìtale",
                        explanation: "La transmission materno-f≈ìtale (ou verticale) d√©signe la transmission d'une infection de la m√®re √† son enfant, pendant la grossesse, l'accouchement ou l'allaitement.",
                        tip: "Au BAC : Aussi appel√©e transmission verticale, par opposition √† horizontale (entre individus).",
                        hint: "Transmission de la m√®re au f≈ìtus"
                    },
                    {
                        type: "qcm",
                        keyword: "Pr√©vention",
                        question: "Quelle IST peut √™tre pr√©venue par un vaccin ?",
                        options: [
                            "Syphilis",
                            "VIH/SIDA",
                            "H√©patite B et Papillomavirus",
                            "Chlamydia"
                        ],
                        answer: 2,
                        explanation: "L'h√©patite B et le papillomavirus (HPV) peuvent √™tre pr√©venus par vaccination. Ces vaccins sont recommand√©s avant le d√©but de l'activit√© sexuelle.",
                        tip: "Au BAC : Distinguer pr√©vention par vaccin (h√©patite B, HPV) et pr√©vention par pr√©servatif (toutes les IST).",
                        hint: "Pense aux vaccins disponibles"
                    },
                    {
                        type: "vf",
                        keyword: "Salive",
                        question: "Le VIH peut se transmettre par un baiser avec √©change de salive.",
                        answer: false,
                        explanation: "FAUX. Le VIH ne se transmet pas par la salive. La concentration du virus dans la salive est trop faible pour permettre une transmission.",
                        tip: "Au BAC : Conna√Ætre les modes de transmission ET de non-transmission du VIH.",
                        hint: "La salive contient des enzymes qui d√©truisent le virus"
                    }
                ]
            },
            3: {
                title: "Niveau 3 - Sympt√¥mes & Cons√©quences",
                icon: "ü©∫",
                cards: [
                    {
                        type: "keyword",
                        keyword: "SIDA",
                        question: "Que signifie le sigle <strong>SIDA</strong> ?",
                        answer: "syndrome d'immunod√©ficience acquise",
                        explanation: "SIDA signifie Syndrome d'ImmunoD√©ficience Acquise. C'est le stade avanc√© de l'infection par le VIH o√π le syst√®me immunitaire est tr√®s affaibli.",
                        tip: "Au BAC : Distinguer s√©ropositivit√© VIH (phase asymptomatique) et SIDA (phase symptomatique).",
                        hint: "Syndrome - Immuno - D√©ficience - Acquise"
                    },
                    {
                        type: "qcm",
                        keyword: "Lymphocytes T4",
                        question: "Quelles cellules le VIH attaque-t-il principalement ?",
                        options: [
                            "Les globules rouges",
                            "Les lymphocytes T4",
                            "Les plaquettes",
                            "Les neurones"
                        ],
                        answer: 1,
                        explanation: "Le VIH attaque principalement les lymphocytes T4 (CD4), cellules essentielles du syst√®me immunitaire. Leur destruction progressive affaiblit les d√©fenses de l'organisme.",
                        tip: "Au BAC : Expliquer pourquoi l'attaque des T4 rend vuln√©rable aux infections opportunistes.",
                        hint: "Ce sont des cellules de d√©fense immunitaire"
                    },
                    {
                        type: "vf",
                        keyword: "St√©rilit√©",
                        question: "Certaines IST non trait√©es peuvent provoquer une st√©rilit√©.",
                        answer: true,
                        explanation: "VRAI. Des IST comme la chlamydia ou la gonococcie, si elles ne sont pas trait√©es, peuvent provoquer des complications conduisant √† la st√©rilit√© chez l'homme et la femme.",
                        tip: "Au BAC : Insister sur l'importance du traitement pr√©coce pour √©viter les complications.",
                        hint: "Pense aux complications des IST bact√©riennes"
                    },
                    {
                        type: "keyword",
                        keyword: "Chancre",
                        question: "Comment s'appelle la l√©sion indolore qui caract√©rise le premier stade de la syphilis ?",
                        answer: "chancre",
                        explanation: "Le chancre est une ulc√©ration indolore qui appara√Æt au point de contact lors de la contamination par la syphilis. Il dispara√Æt spontan√©ment m√™me sans traitement.",
                        tip: "Au BAC : Le caract√®re indolore du chancre explique pourquoi la syphilis passe souvent inaper√ßue.",
                        hint: "Ulc√©ration indolore du premier stade"
                    },
                    {
                        type: "qcm",
                        keyword: "Infections opportunistes",
                        question: "Que sont les infections opportunistes dans le cadre du SIDA ?",
                        options: [
                            "Des infections qui gu√©rissent seules",
                            "Des infections qui profitent de l'affaiblissement immunitaire",
                            "Des infections sexuellement transmissibles",
                            "Des infections sans gravit√©"
                        ],
                        answer: 1,
                        explanation: "Les infections opportunistes sont des infections qui 'profitent' de l'affaiblissement du syst√®me immunitaire pour se d√©velopper. Elles sont normalement contr√¥l√©es chez une personne saine.",
                        tip: "Au BAC : Expliquer le lien entre baisse des T4 et vuln√©rabilit√© aux infections opportunistes.",
                        hint: "Elles saisissent l'opportunit√© d'un syst√®me immunitaire affaibli"
                    }
                ]
            },
            4: {
                title: "Niveau 4 - Pr√©vention",
                icon: "üõ°Ô∏è",
                cards: [
                    {
                        type: "qcm",
                        keyword: "Pr√©servatifs gratuits",
                        question: "Depuis 2023, qui peut b√©n√©ficier de pr√©servatifs gratuits en pharmacie ?",
                        options: [
                            "Toute la population",
                            "Les moins de 26 ans",
                            "Seulement les √©tudiants",
                            "Les plus de 18 ans"
                        ],
                        answer: 1,
                        explanation: "Depuis janvier 2023, les moins de 26 ans peuvent obtenir gratuitement des pr√©servatifs en pharmacie, sans ordonnance, pour favoriser la pr√©vention des IST.",
                        tip: "Au BAC : Mesure r√©cente de sant√© publique √† conna√Ætre.",
                        hint: "Mesure cibl√©e sur les jeunes adultes"
                    },
                    {
                        type: "vf",
                        keyword: "D√©pistage",
                        question: "Le d√©pistage fait partie int√©grante de la pr√©vention des IST.",
                        answer: true,
                        explanation: "VRAI. Le d√©pistage permet de d√©tecter une infection m√™me asymptomatique, d'initier un traitement pr√©coce et d'√©viter la transmission √† d'autres partenaires.",
                        tip: "Au BAC : Le d√©pistage est une pr√©vention secondaire (apr√®s contamination possible).",
                        hint: "D√©tecter pour mieux traiter et prot√©ger"
                    },
                    {
                        type: "keyword",
                        keyword: "CeGIDD",
                        question: "Que signifie le sigle <strong>CeGIDD</strong> ?",
                        answer: "centre gratuit d'information de d√©pistage et de diagnostic",
                        explanation: "CeGIDD signifie Centre Gratuit d'Information, de D√©pistage et de Diagnostic. Ces centres offrent d√©pistage gratuit, conseil et accompagnement pour les IST.",
                        tip: "Au BAC : Structure cl√© de la politique de sant√© publique pour les IST.",
                        hint: "Centre - Gratuit - Information - D√©pistage - Diagnostic"
                    },
                    {
                        type: "qcm",
                        keyword: "Pr√©vention primaire",
                        question: "Quel est le moyen de pr√©vention primaire le plus efficace contre les IST ?",
                        options: [
                            "Les antibiotiques",
                            "Le d√©pistage r√©gulier",
                            "L'usage syst√©matique du pr√©servatif",
                            "La pilule contraceptive"
                        ],
                        answer: 2,
                        explanation: "L'usage syst√©matique du pr√©servatif est le moyen de pr√©vention primaire le plus efficace car il emp√™che la contamination lors des rapports sexuels.",
                        tip: "Au BAC : Distinguer pr√©vention primaire (√©viter la contamination) et secondaire (d√©pistage).",
                        hint: "Protection avant contamination"
                    },
                    {
                        type: "vf",
                        keyword: "Communication",
                        question: "Communiquer avec son partenaire sur les IST fait partie de la pr√©vention.",
                        answer: true,
                        explanation: "VRAI. La communication permet d'aborder le d√©pistage, l'usage du pr√©servatif et l'historique m√©dical. C'est un √©l√©ment essentiel de la pr√©vention.",
                        tip: "Au BAC : La pr√©vention des IST est aussi comportementale et relationnelle.",
                        hint: "Parler c'est aussi se prot√©ger"
                    }
                ]
            },
            5: {
                title: "Niveau 5 - D√©pistage & Traitement",
                icon: "üè•",
                cards: [
                    {
                        type: "keyword",
                        keyword: "Fen√™tre s√©rologique",
                        question: "Comment appelle-t-on la p√©riode entre la contamination et la d√©tection des anticorps ?",
                        answer: "fen√™tre s√©rologique",
                        explanation: "La fen√™tre s√©rologique est la p√©riode durant laquelle une personne infect√©e n'est pas encore d√©tectable par les tests s√©rologiques, mais peut d√©j√† transmettre l'infection.",
                        tip: "Au BAC : Expliquer pourquoi il faut r√©p√©ter les tests apr√®s une prise de risque.",
                        hint: "P√©riode o√π les anticorps ne sont pas encore d√©tectables"
                    },
                    {
                        type: "qcm",
                        keyword: "TROD",
                        question: "Que signifie TROD dans le contexte du d√©pistage VIH ?",
                        options: [
                            "Test Rapide d'Orientation Diagnostique",
                            "Traitement Rapide d'Origine Diverse",
                            "Test de R√©f√©rence Obligatoire et D√©finitif",
                            "Technique de Recherche d'Organismes Dangereux"
                        ],
                        answer: 0,
                        explanation: "TROD signifie Test Rapide d'Orientation Diagnostique. Il permet d'avoir un r√©sultat en 30 minutes mais doit √™tre confirm√© par un test de laboratoire si positif.",
                        tip: "Au BAC : Distinguer TROD (rapide) et test de confirmation (laboratoire).",
                        hint: "Test rapide en 30 minutes"
                    },
                    {
                        type: "vf",
                        keyword: "Traitement curatif",
                        question: "Toutes les IST peuvent √™tre gu√©ries d√©finitivement par un traitement.",
                        answer: false,
                        explanation: "FAUX. Les IST bact√©riennes peuvent √™tre gu√©ries par antibiotiques, mais les IST virales (VIH, herp√®s) ne peuvent √™tre que trait√©es, pas gu√©ries d√©finitivement.",
                        tip: "Au BAC : Distinguer traitement curatif (bact√©ries) et traitement antiviral (virus).",
                        hint: "Les virus r√©sistent mieux que les bact√©ries"
                    },
                    {
                        type: "keyword",
                        keyword: "TPE",
                        question: "Que signifie <strong>TPE</strong> en cas de prise de risque VIH ?",
                        answer: "traitement post-exposition",
                        explanation: "TPE signifie Traitement Post-Exposition. C'est un traitement d'urgence √† prendre dans les 48h apr√®s une prise de risque pour r√©duire le risque d'infection VIH.",
                        tip: "Au BAC : Traitement d'urgence √† conna√Ætre, efficace si pris rapidement.",
                        hint: "Traitement apr√®s exposition au risque"
                    },
                    {
                        type: "qcm",
                        keyword: "D√©pistage anonyme",
                        question: "O√π peut-on se faire d√©pister anonymement et gratuitement ?",
                        options: [
                            "Uniquement chez son m√©decin traitant",
                            "Dans un CeGIDD ou un centre de sant√© sexuelle",
                            "Seulement dans les h√¥pitaux priv√©s",
                            "Uniquement en laboratoire"
                        ],
                        answer: 1,
                        explanation: "Les CeGIDD et centres de sant√© sexuelle proposent un d√©pistage anonyme et gratuit, sans avance de frais ni prescription m√©dicale.",
                        tip: "Au BAC : L'anonymat l√®ve l'obstacle psychologique au d√©pistage.",
                        hint: "Centres sp√©cialis√©s dans la pr√©vention"
                    }
                ]
            }
        };
        
        function startLevel(level) {
            if (level > 1 && levelProgress[level - 1] < 60) {
                alert('Termine le niveau pr√©c√©dent avec au moins 60% pour d√©bloquer ce niveau !');
                return;
            }
            
            currentLevel = level;
            currentCardIndex = 0;
            levelPoints = 0;
            levelCorrect = 0;
            levelErrors = [];
            hintUsed = false;
            
            document.getElementById('homeScreen').classList.remove('active');
            document.getElementById('gameScreen').classList.add('active');
            
            document.getElementById('levelTitle').textContent = levels[level].title;
            showCard();
        }
        
        function showCard() {
            const card = levels[currentLevel].cards[currentCardIndex];
            const total = levels[currentLevel].cards.length;
            
            document.getElementById('cardCounter').textContent = `${currentCardIndex + 1}/${total}`;
            document.getElementById('keywordBadge').textContent = card.keyword;
            document.getElementById('hintText').style.display = 'none';
            document.getElementById('hintText').innerHTML = '';
            hintUsed = false;
            
            const questionSection = document.getElementById('questionSection');
            
            if (card.type === 'keyword') {
                questionSection.innerHTML = `
                    <h3>${card.question}</h3>
                    <input type="text" class="keyword-input" id="keywordAnswer" placeholder="Tape ta r√©ponse ici..." maxlength="100">
                `;
                
                // Focus sur l'input et validation avec Enter
                setTimeout(() => {
                    const input = document.getElementById('keywordAnswer');
                    input.focus();
                    input.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') validateAnswer();
                    });
                }, 100);
            }
            else if (card.type === 'qcm') {
                let optionsHTML = card.options.map((opt, i) => `
                    <button class="option-btn" data-index="${i}" onclick="selectOption(this)">
                        <span class="option-letter">${String.fromCharCode(65 + i)}</span>
                        <span>${opt}</span>
                    </button>
                `).join('');
                
                questionSection.innerHTML = `
                    <h3>${card.question}</h3>
                    <div class="options-container">${optionsHTML}</div>
                `;
            }
            else if (card.type === 'vf') {
                questionSection.innerHTML = `
                    <h3>${card.question}</h3>
                    <div class="vf-container">
                        <button class="vf-btn vrai" onclick="selectVF(this, true)">‚úì VRAI</button>
                        <button class="vf-btn faux" onclick="selectVF(this, false)">‚úó FAUX</button>
                    </div>
                `;
            }
        }
        
        function selectOption(btn) {
            document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
        }
        
        function selectVF(btn, value) {
            document.querySelectorAll('.vf-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            btn.dataset.value = value;
        }
        
        function showHint() {
            const card = levels[currentLevel].cards[currentCardIndex];
            if (card.hint) {
                const hintBox = document.getElementById('hintText');
                hintBox.innerHTML = `üí° <strong>Indice :</strong> ${card.hint}`;
                hintBox.style.display = 'block';
                hintUsed = true;
            }
        }
        
        function validateAnswer() {
            const card = levels[currentLevel].cards[currentCardIndex];
            let isCorrect = false;
            let userAnswer = '';
            
            if (card.type === 'keyword') {
                userAnswer = document.getElementById('keywordAnswer').value.trim().toLowerCase();
                // Normaliser les accents
                const normalize = str => str.normalize('NFD').replace(/[\u0300-\u036f]/g, '').toLowerCase();
                const normalizedUser = normalize(userAnswer);
                const normalizedCorrect = normalize(card.answer);
                
                isCorrect = normalizedUser === normalizedCorrect || 
                            normalizedUser.includes(normalizedCorrect) ||
                            normalizedCorrect.includes(normalizedUser) ||
                            // Variantes sp√©cifiques
                            (normalizedCorrect.includes('infection') && normalizedUser.includes('ist')) ||
                            (normalizedCorrect.includes('syndrome') && normalizedUser.includes('sida'));
            }
            else if (card.type === 'qcm') {
                const selected = document.querySelector('.option-btn.selected');
                if (!selected) { 
                    alert('‚ö†Ô∏è S√©lectionne une r√©ponse avant de valider !'); 
                    return; 
                }
                userAnswer = parseInt(selected.dataset.index);
                isCorrect = userAnswer === card.answer;
            }
            else if (card.type === 'vf') {
                const selected = document.querySelector('.vf-btn.selected');
                if (!selected) { 
                    alert('‚ö†Ô∏è S√©lectionne VRAI ou FAUX avant de valider !'); 
                    return; 
                }
                userAnswer = selected.dataset.value === 'true';
                isCorrect = userAnswer === card.answer;
            }
            
            showFeedback(isCorrect, card);
        }
        
        function showFeedback(isCorrect, card) {
            const overlay = document.getElementById('feedbackOverlay');
            const feedbackCard = document.getElementById('feedbackCard');
            
            let points = 0;
            if (isCorrect) {
                points = hintUsed ? 5 : 10;
                levelCorrect++;
                currentStreak++;
                if (currentStreak > bestStreak) bestStreak = currentStreak;
                
                // Bonus de s√©rie
                if (currentStreak === 3) showStreakPopup('üî• 3 de suite !');
                else if (currentStreak === 5) showStreakPopup('üî•üî• 5 de suite !');
                else if (currentStreak === 10) showStreakPopup('üî•üî•üî• INCROYABLE !');
            } else {
                currentStreak = 0;
                levelErrors.push(card.keyword || card.question.replace(/<[^>]*>/g, '').substring(0, 50) + '...');
            }
            
            levelPoints += points;
            totalPoints += points;
            updateScoreDisplay();
            
            feedbackCard.className = 'feedback-card ' + (isCorrect ? 'correct' : 'incorrect');
            document.getElementById('feedbackIcon').textContent = isCorrect ? '‚úÖ' : '‚ùå';
            document.getElementById('feedbackTitle').textContent = isCorrect ? 
                (currentStreak >= 3 ? 'Excellent ! üî•' : 'Bravo !') : 'Pas tout √† fait...';
            document.getElementById('feedbackPoints').textContent = isCorrect ? `+${points} points` : '0 point';
            document.getElementById('feedbackPoints').style.display = isCorrect ? 'block' : 'none';
            
            document.getElementById('feedbackExplanation').innerHTML = `
                <h4>üìö Explication</h4>
                <p>${card.explanation}</p>
                <div class="keyword-box">üîë <span>${card.keyword}</span></div>
                ${card.tip ? `<div class="tip-box"><h5>üí° Astuce BAC</h5><p>${card.tip}</p></div>` : ''}
            `;
            
            overlay.classList.add('visible');
        }
        
        function showStreakPopup(text) {
            const popup = document.getElementById('streakPopup');
            popup.textContent = text;
            popup.style.display = 'block';
            setTimeout(() => { popup.style.display = 'none'; }, 1500);
        }
        
        function nextCard() {
            document.getElementById('feedbackOverlay').classList.remove('visible');
            currentCardIndex++;
            
            if (currentCardIndex >= levels[currentLevel].cards.length) {
                showResults();
            } else {
                showCard();
            }
        }
        
        function showResults() {
            const total = levels[currentLevel].cards.length;
            const percent = Math.round((levelCorrect / total) * 100);
            
            levelProgress[currentLevel] = Math.max(levelProgress[currentLevel], percent);
            
            document.getElementById('gameScreen').classList.remove('active');
            document.getElementById('resultsScreen').classList.add('active');
            
            document.getElementById('resultsIcon').textContent = percent >= 80 ? 'üéâ' : percent >= 50 ? 'üëç' : 'üí™';
            document.getElementById('resultsTitle').textContent = percent >= 80 ? 'Niveau r√©ussi !' : percent >= 50 ? 'Pas mal !' : 'Continue !';
            document.getElementById('resultsScore').textContent = percent + '%';
            document.getElementById('correctCount').textContent = levelCorrect + '/' + total;
            document.getElementById('pointsEarned').textContent = '+' + levelPoints;
            document.getElementById('bestStreak').textContent = bestStreak;
            
            // R√©cap des erreurs
            const errorsRecap = document.getElementById('errorsRecap');
            if (levelErrors.length > 0) {
                errorsRecap.style.display = 'block';
                document.getElementById('errorsList').innerHTML = levelErrors.map(e => `<li>üìù ${e}</li>`).join('');
            } else {
                errorsRecap.style.display = 'none';
            }
            
            // Confettis si excellent
            if (percent >= 80) {
                createConfetti();
            }
            
            // Bouton niveau suivant
            const nextBtn = document.getElementById('nextLevelBtn');
            if (currentLevel < 5 && percent >= 60) {
                nextBtn.style.display = 'flex';
                nextBtn.textContent = `üéØ Niveau ${currentLevel + 1}`;
            } else {
                nextBtn.style.display = 'none';
            }
            
            updateHomeProgress();
        }
        
        function createConfetti() {
            const colors = ['#667eea', '#764ba2', '#f093fb', '#ff9a9e', '#fecfef', '#FFD700'];
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 2 + 's';
                confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                document.body.appendChild(confetti);
                setTimeout(() => confetti.remove(), 3000);
            }
        }
        
        function goHome() {
            document.getElementById('resultsScreen').classList.remove('active');
            document.getElementById('gameScreen').classList.remove('active');
            document.getElementById('homeScreen').classList.add('active');
            updateHomeProgress();
        }
        
        function nextLevel() {
            if (currentLevel < 5) {
                startLevel(currentLevel + 1);
                document.getElementById('resultsScreen').classList.remove('active');
            }
        }
        
        function updateScoreDisplay() {
            document.getElementById('totalPoints').textContent = totalPoints;
            document.getElementById('currentStreak').textContent = currentStreak;
        }
        
        function updateHomeProgress() {
            for (let i = 1; i <= 5; i++) {
                const percentElement = document.getElementById(`level${i}Percent`);
                const barElement = document.getElementById(`level${i}Bar`);
                if (percentElement && barElement) {
                    percentElement.textContent = levelProgress[i] + '%';
                    barElement.style.width = levelProgress[i] + '%';
                }
                
                // Verrouillage des niveaux
                const card = document.querySelector(`.niveau-card:nth-child(${i})`);
                if (i > 1 && levelProgress[i-1] < 60) {
                    card.classList.add('locked');
                } else {
                    card.classList.remove('locked');
                }
                
                if (levelProgress[i] >= 80) {
                    card.classList.add('completed');
                }
            }
        }
        
        // Initialisation
        updateScoreDisplay();
        updateHomeProgress();
        
        // Gestion du clavier
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const overlay = document.getElementById('feedbackOverlay');
                if (overlay.classList.contains('visible')) {
                    nextCard();
                }
            }
        });
    </script>
</body>
</html>