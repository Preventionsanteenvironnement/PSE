<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Les Courses de Enzo - Limite 60‚Ç¨</title>
  <style>
    :root{
      --bg:#e0f7fa;
      --wallet:#00897b;
      --basket:#ff7043;
      --item-bg:#ffffff;
      --ok:#2e7d32;
      --ko:#c62828;
      --warn:#ef6c00;
    }

    body{
      font-family:Arial,sans-serif;
      background-color:var(--bg);
      margin:0;
      padding:20px;
      display:flex;
      flex-direction:column;
      align-items:center;
      overflow-x:hidden;
    }

    h1{margin:0 0 12px 0;text-align:center;color:#004d40}

    .wallet-panel{
      background:var(--wallet);
      color:white;
      padding:18px;
      border-radius:15px;
      width:90%;
      max-width:650px;
      text-align:center;
      box-shadow:0 4px 6px rgba(0,0,0,0.2);
      margin-bottom:15px;
      display:flex;
      justify-content:space-around;
      align-items:center;
      gap:15px;
      flex-wrap:wrap;
    }

    .wallet-icon{font-size:3rem}
    .wallet-info{font-size:1.2rem;font-weight:bold}
    .limit-display{font-size:2.2rem;background:rgba(0,0,0,0.2);padding:5px 15px;border-radius:10px;display:inline-block}

    .controls{
      display:flex;
      gap:12px;
      margin-bottom:18px;
      flex-wrap:wrap;
      justify-content:center;
    }

    button{
      padding:12px 18px;
      font-size:1.1rem;
      cursor:pointer;
      border:none;
      border-radius:999px;
      color:white;
      display:flex;
      align-items:center;
      gap:10px;
      box-shadow:0 4px 0 rgba(0,0,0,0.2);
      user-select:none;
      touch-action:manipulation;
    }
    button:active{transform:translateY(4px);box-shadow:none}
    .audio-btn{background:#e91e63}
    .sound-btn{background:#2c3e50}
    .reset-btn{background:#607d8b}

    .game-area{
      display:flex;
      justify-content:center;
      gap:22px;
      width:100%;
      max-width:1200px;
      flex-wrap:wrap;
    }

    .panel{
      background:white;
      border-radius:15px;
      padding:14px;
      width:45%;
      min-width:300px;
      min-height:420px;
      box-sizing:border-box;
      display:flex;
      flex-direction:column;
      box-shadow:0 2px 6px rgba(0,0,0,0.08);
    }

    .shelf{
      border:5px solid #ccc;
    }

    .basket{
      border:5px solid var(--basket);
      position:relative;
    }

    .panel-title{
      width:100%;
      text-align:center;
      font-weight:bold;
      font-size:1.4rem;
      margin:4px 0 10px 0;
      color:#555;
      user-select:none;
    }

    .drop-surface{
      flex-grow:1;
      width:100%;
      display:flex;
      flex-wrap:wrap;
      align-content:flex-start;
      justify-content:center;
      gap:10px;
      padding:6px;
      border-radius:12px;
      border:2px dashed rgba(0,0,0,0.12);
      background:rgba(255,255,255,0.6);
    }

    .drop-surface.drag-over{
      background:rgba(0,0,0,0.04);
      border-color:rgba(0,0,0,0.25);
    }

    .basket-calc{
      margin-top:12px;
      width:100%;
      background:#eee;
      padding:14px;
      border-radius:12px;
      text-align:center;
      box-sizing:border-box;
      border:1px solid #d0d0d0;
    }

    .calc-input{
      width:120px;
      padding:10px;
      font-size:1.4rem;
      text-align:center;
      border:3px solid #ccc;
      border-radius:8px;
      font-weight:bold;
    }

    .mini{
      display:flex;
      justify-content:center;
      gap:16px;
      flex-wrap:wrap;
      margin-top:10px;
      font-weight:bold;
      color:#333;
    }
    .mini span{
      background:white;
      border:1px solid rgba(0,0,0,0.12);
      border-radius:999px;
      padding:6px 12px;
      display:inline-block;
      min-width:140px;
    }

    .feedback-msg{
      margin-top:10px;
      font-weight:bold;
      font-size:1.15rem;
      min-height:1.5em;
    }

    .item{
      background:var(--item-bg);
      border:2px solid #999;
      border-radius:12px;
      padding:10px;
      width:120px;
      height:120px;
      cursor:grab;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      box-shadow:2px 2px 5px rgba(0,0,0,0.1);
      transition:transform 0.1s, border-color 0.1s;
      user-select:none;
      touch-action:none;
    }
    .item:active{cursor:grabbing;transform:scale(1.06)}
    .item.selected{
      border-color:#000;
      transform:scale(1.05);
    }
    .item-icon{font-size:3rem;line-height:1}
    .item-name{font-weight:bold;margin:6px 0 4px 0;text-align:center}
    .item-price{background:#333;color:white;padding:2px 10px;border-radius:999px;font-weight:bold}

    @media (max-width:900px){
      .panel{width:100%;min-width:0}
    }
  </style>
</head>
<body>

  <h1>üõí Les Courses de Enzo</h1>

  <div class="wallet-panel">
    <div class="wallet-icon">üí∂</div>
    <div class="wallet-info">
      Enzo a en tout :<br>
      <span class="limit-display" id="limit-txt">60 ‚Ç¨</span>
    </div>
  </div>

  <div class="controls">
    <button class="audio-btn" onclick="lireConsigne()">üîä Consigne</button>
    <button class="sound-btn" id="btn-sound" onclick="toggleSound()">üîà Son : ON</button>
    <button class="reset-btn" onclick="location.reload()">üîÑ Recommencer</button>
  </div>

  <div class="game-area">

    <div class="panel shelf" id="rayon">
      <div class="panel-title">üè™ LE RAYON</div>
      <div class="drop-surface" id="rayon-surface" data-zone="rayon"></div>
    </div>

    <div class="panel basket" id="caddie">
      <div class="panel-title">üõí MON CADDIE</div>

      <div class="drop-surface" id="caddie-surface" data-zone="caddie"></div>

      <div class="basket-calc">
        <div style="font-size:1.2rem;font-weight:bold;">Combien √ßa co√ªte ?</div>
        <div style="margin-top:10px;">
          <input type="number" id="total-input" class="calc-input" inputmode="numeric" pattern="[0-9]*" placeholder="?"> ‚Ç¨
        </div>

        <button onclick="verifierTotal()" style="margin:12px auto 6px auto;background:var(--basket);">‚úÖ V√©rifier</button>

        <div class="mini">
          <span>Total r√©el : <strong id="real-total">0</strong> ‚Ç¨</span>
          <span>Reste : <strong id="remain">60</strong> ‚Ç¨</span>
        </div>

        <div id="feedback" class="feedback-msg"></div>
      </div>
    </div>

  </div>

<script>
  const produits = [
    { id:"p1", name:"Pizza", icon:"üçï", price:10 },
    { id:"p2", name:"Poulet", icon:"üçó", price:15 },
    { id:"p3", name:"Lait", icon:"ü•õ", price:5 },
    { id:"p4", name:"Bonbons", icon:"üç¨", price:5 },
    { id:"p5", name:"Jeu Vid√©o", icon:"üéÆ", price:40 },
    { id:"p6", name:"Baskets", icon:"üëü", price:30 },
    { id:"p7", name:"Pomme", icon:"üçé", price:2 },
    { id:"p8", name:"Coca", icon:"ü•§", price:3 }
  ];

  const LIMITE = 60;

  let selectedItem = null;
  let soundEnabled = true;

  function toggleSound(){
    soundEnabled = !soundEnabled;
    const btn = document.getElementById("btn-sound");
    btn.textContent = soundEnabled ? "üîà Son : ON" : "üîá Son : OFF";
    try{ if(!soundEnabled && window.speechSynthesis) window.speechSynthesis.cancel(); }catch(e){}
  }

  function speak(txt){
    if(!soundEnabled) return;
    try{
      if(!window.speechSynthesis) return;
      window.speechSynthesis.cancel();
      const msg = new SpeechSynthesisUtterance(txt);
      msg.lang = "fr-FR";
      window.speechSynthesis.speak(msg);
    }catch(e){}
  }

  function lireConsigne(){
    speak("Enzo a 60 euros. Choisis des objets dans le rayon et mets-les dans le caddie. Ensuite, fais le total. Attention, tu ne dois pas d√©passer 60 euros.");
  }

  function safeInt(v){
    const n = parseInt(v, 10);
    return Number.isFinite(n) ? n : null;
  }

  function clearFeedback(){
    const input = document.getElementById("total-input");
    input.value = "";
    input.style.border = "3px solid #ccc";
    document.getElementById("feedback").textContent = "";
  }

  function setFeedback(text, type){
    const fb = document.getElementById("feedback");
    fb.textContent = text;
    if(type === "ok") fb.style.color = getComputedStyle(document.documentElement).getPropertyValue("--ok");
    else if(type === "warn") fb.style.color = getComputedStyle(document.documentElement).getPropertyValue("--warn");
    else fb.style.color = getComputedStyle(document.documentElement).getPropertyValue("--ko");
  }

  function getRealTotal(){
    const items = document.getElementById("caddie-surface").querySelectorAll(".item");
    let total = 0;
    items.forEach(it => total += parseInt(it.dataset.price, 10));
    return total;
  }

  function refreshMini(){
    const total = getRealTotal();
    document.getElementById("real-total").textContent = total;
    document.getElementById("remain").textContent = (LIMITE - total);
    document.getElementById("limit-txt").textContent = LIMITE + " ‚Ç¨";
  }

  function deselect(){
    if(selectedItem){
      selectedItem.classList.remove("selected");
      selectedItem = null;
    }
  }

  function select(el){
    deselect();
    selectedItem = el;
    el.classList.add("selected");
  }

  function moveToZone(el, zoneId){
    const zone = document.getElementById(zoneId);
    zone.appendChild(el);
    deselect();
    clearFeedback();
    refreshMini();
    if(zoneId === "caddie-surface") speak("Ajout√© au caddie.");
  }

  function init(){
    const rayonSurface = document.getElementById("rayon-surface");

    produits.forEach(prod=>{
      const div = document.createElement("div");
      div.className = "item";
      div.id = prod.id;
      div.draggable = true;
      div.dataset.price = prod.price;
      div.dataset.name = prod.name;

      div.innerHTML = `
        <span class="item-icon">${prod.icon}</span>
        <span class="item-name">${prod.name}</span>
        <span class="item-price">${prod.price} ‚Ç¨</span>
      `;

      div.addEventListener("dragstart", (e)=>{
        e.dataTransfer.setData("text/plain", div.id);
        select(div);
      });

      div.addEventListener("click", ()=>{
        if(selectedItem === div){
          speak(prod.name + ", " + prod.price + " euros");
        }else{
          select(div);
        }
      });

      rayonSurface.appendChild(div);
    });

    setupDropZone(document.getElementById("rayon-surface"));
    setupDropZone(document.getElementById("caddie-surface"));

    document.getElementById("rayon").addEventListener("click", ()=>{
      if(selectedItem) moveToZone(selectedItem, "rayon-surface");
    });

    document.getElementById("caddie").addEventListener("click", (e)=>{
      if(e.target.closest(".basket-calc")) return;
      if(selectedItem) moveToZone(selectedItem, "caddie-surface");
    });

    refreshMini();
  }

  function setupDropZone(zone){
    zone.addEventListener("dragover", (e)=>{
      e.preventDefault();
      zone.classList.add("drag-over");
    });

    zone.addEventListener("dragleave", ()=>{
      zone.classList.remove("drag-over");
    });

    zone.addEventListener("drop", (e)=>{
      e.preventDefault();
      zone.classList.remove("drag-over");
      const id = e.dataTransfer.getData("text/plain");
      const el = document.getElementById(id);
      if(!el) return;

      zone.appendChild(el);
      deselect();
      clearFeedback();
      refreshMini();

      if(zone.id === "caddie-surface") speak("Ajout√© au caddie.");
    });
  }

  function verifierTotal(){
    const vraiTotal = getRealTotal();
    const inputField = document.getElementById("total-input");
    const inputEleve = safeInt(inputField.value);

    if(inputEleve === null){
      inputField.style.border = "3px solid red";
      setFeedback("√âcris un nombre.", "ko");
      speak("√âcris un nombre.");
      return;
    }

    if(inputEleve !== vraiTotal){
      inputField.style.border = "3px solid red";
      setFeedback("‚ö†Ô∏è Erreur de calcul. R√©essaie avec la calculatrice.", "ko");
      speak("Erreur de calcul. Recompte bien.");
      return;
    }

    if(vraiTotal > LIMITE){
      inputField.style.border = "3px solid orange";
      setFeedback("‚õî STOP ! " + vraiTotal + " ‚Ç¨, c'est trop cher. Tu as seulement 60 ‚Ç¨. Enl√®ve un article.", "warn");
      speak("Stop ! C'est trop cher. Enl√®ve un article.");
      return;
    }

    inputField.style.border = "3px solid green";
    setFeedback("‚úÖ Bravo ! " + vraiTotal + " ‚Ç¨, tu peux payer.", "ok");
    speak("Bravo ! Tu as assez d'argent.");
  }

  init();
</script>

</body>
</html>
