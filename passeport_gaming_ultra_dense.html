<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéñÔ∏è PASSEPORT COMP√âTENCES PSE</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            overflow-x: hidden;
        }

        /* HEADER GAMING PERMANENT */
        .game-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.9);
            padding: 10px 15px;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .passport-title {
            font-size: 1rem;
            font-weight: bold;
            color: #fff;
        }

        .level-indicator {
            background: #667eea;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .competence-stars {
            display: flex;
            gap: 8px;
            font-size: 0.9rem;
        }

        .competence-item {
            display: flex;
            align-items: center;
            gap: 3px;
            background: rgba(255,255,255,0.1);
            padding: 3px 6px;
            border-radius: 8px;
            font-size: 0.75rem;
            transition: all 0.3s ease;
        }

        .competence-item.active {
            background: #ffc107;
            color: #000;
            transform: scale(1.1);
        }

        .total-score {
            font-size: 1.1rem;
            font-weight: bold;
            color: #ffc107;
        }

        /* CONTAINER PRINCIPAL */
        .game-container {
            margin-top: 70px;
            padding: 20px 15px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        /* √âCRANS DE JEU */
        .screen {
            display: none;
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 25px 20px;
            color: #333;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }

        .screen.active {
            display: block;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* MICRO-EXERCICES */
        .exercise {
            margin-bottom: 20px;
        }

        .exercise-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px 15px;
            background: #667eea;
            color: white;
            border-radius: 15px;
        }

        .exercise-title {
            font-size: 1rem;
            font-weight: bold;
        }

        .exercise-points {
            background: #ffc107;
            color: #000;
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .timer {
            background: #ff4757;
            color: white;
            padding: 4px 8px;
            border-radius: 8px;
            font-weight: bold;
            min-width: 40px;
            text-align: center;
        }

        .situation-box {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border: 2px solid #ffc107;
            border-radius: 15px;
            padding: 15px;
            margin: 15px 0;
            position: relative;
        }

        .situation-title {
            color: #856404;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .situation-text {
            line-height: 1.4;
            color: #333;
        }

        .highlight {
            background: rgba(255, 193, 7, 0.4);
            padding: 2px 4px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline;
            user-select: none;
        }

        .highlight:hover {
            background: #ffc107;
            transform: scale(1.05);
        }

        .highlight.selected {
            background: #28a745;
            color: white;
        }

        .highlight.incorrect {
            background: #dc3545;
            color: white;
        }

        /* BOUTONS DE CHOIX */
        .choices {
            display: grid;
            gap: 10px;
            margin: 15px 0;
        }

        .choice-btn {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-size: 0.95rem;
            user-select: none;
        }

        .choice-btn:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .choice-btn.selected {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .choice-btn.correct {
            border-color: #28a745;
            background: #d4edda;
        }

        .choice-btn.incorrect {
            border-color: #dc3545;
            background: #f8d7da;
        }

        /* ZONES DE DROP */
        .drop-zones {
            display: grid;
            gap: 10px;
            margin: 15px 0;
        }

        .drop-zone {
            min-height: 50px;
            border: 3px dashed #ddd;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            transition: all 0.3s ease;
            position: relative;
        }

        .drop-zone.active {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .drop-zone.filled {
            border-style: solid;
            background: #e7f3ff;
        }

        .dropped-item {
            background: #667eea;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        /* ITEMS D√âPLA√áABLES */
        .draggable-items {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
            justify-content: center;
        }

        .draggable-item {
            background: #667eea;
            color: white;
            padding: 10px 15px;
            border-radius: 12px;
            cursor: pointer;
            user-select: none;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .draggable-item:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .draggable-item.used {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* INPUTS COURTS */
        .short-input {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            width: 100%;
            max-width: 200px;
            text-align: center;
        }

        .short-input.correct {
            border-color: #28a745;
            background: #d4edda;
        }

        .short-input.incorrect {
            border-color: #dc3545;
            background: #f8d7da;
        }

        /* FEEDBACK INSTANTAN√â */
        .feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 12px;
            display: none;
            animation: popIn 0.4s ease-out;
        }

        @keyframes popIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        .feedback.success {
            background: #d4edda;
            border: 2px solid #28a745;
            color: #155724;
        }

        .feedback.error {
            background: #f8d7da;
            border: 2px solid #dc3545;
            color: #721c24;
        }

        .feedback.info {
            background: #d1ecf1;
            border: 2px solid #17a2b8;
            color: #0c5460;
        }

        /* EFFETS VISUELS */
        .stars-burst {
            position: fixed;
            pointer-events: none;
            font-size: 1.5rem;
            z-index: 2000;
            animation: starBurst 1s ease-out forwards;
        }

        @keyframes starBurst {
            0% { opacity: 1; transform: scale(0) rotate(0deg); }
            50% { opacity: 1; transform: scale(1.5) rotate(180deg); }
            100% { opacity: 0; transform: scale(0.5) rotate(360deg); }
        }

        .score-popup {
            position: fixed;
            background: #ffc107;
            color: #000;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            z-index: 2000;
            pointer-events: none;
            animation: scoreFloat 1.5s ease-out forwards;
        }

        @keyframes scoreFloat {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-50px) scale(1.2); }
        }

        /* BOUTONS NAVIGATION */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin-top: 25px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            flex: 1;
            max-width: 150px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* PROGRESSION BAR */
        .progress-container {
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            height: 8px;
            margin: 15px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: #ffc107;
            border-radius: 10px;
            transition: width 0.5s ease;
            width: 0%;
        }

        /* RESPONSIVE */
        @media (max-width: 480px) {
            .game-header {
                flex-wrap: wrap;
                padding: 8px 10px;
            }
            
            .competence-stars {
                display: none;
            }
            
            .game-container {
                padding: 15px 10px;
                margin-top: 60px;
            }
            
            .screen {
                padding: 20px 15px;
            }
            
            .choices {
                grid-template-columns: 1fr;
            }
        }

        /* √âCRAN FINAL */
        .final-screen {
            text-align: center;
            padding: 30px 20px;
        }

        .final-score {
            font-size: 3rem;
            color: #ffc107;
            margin: 20px 0;
            font-weight: bold;
        }

        .competence-summary {
            display: grid;
            gap: 10px;
            margin: 25px 0;
        }

        .comp-result {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255,255,255,0.1);
            padding: 12px 15px;
            border-radius: 10px;
        }

        .comp-stars {
            font-size: 1.2rem;
        }
    </style>
</head>
<body>
    <!-- HEADER GAMING PERMANENT -->
    <div class="game-header">
        <div class="header-left">
            <div class="passport-title">üéñÔ∏è PASSEPORT PSE</div>
            <div class="level-indicator" id="currentLevel">Niveau 1</div>
        </div>
        <div class="competence-stars">
            <div class="competence-item" id="c1-header">
                C1 <span id="c1-stars">‚òÜ‚òÜ‚òÜ</span>
            </div>
            <div class="competence-item" id="c2-header">
                C2 <span id="c2-stars">‚òÜ‚òÜ‚òÜ</span>
            </div>
            <div class="competence-item" id="c3-header">
                C3 <span id="c3-stars">‚òÜ‚òÜ‚òÜ</span>
            </div>
            <div class="competence-item" id="c4-header">
                C4 <span id="c4-stars">‚òÜ‚òÜ‚òÜ</span>
            </div>
            <div class="competence-item" id="c5-header">
                C5 <span id="c5-stars">‚òÜ‚òÜ‚òÜ</span>
            </div>
        </div>
        <div class="total-score" id="totalScore">0‚≠ê</div>
    </div>

    <!-- CONTAINER PRINCIPAL -->
    <div class="game-container">
        <!-- √âCRAN D'ACCUEIL -->
        <div class="screen active" id="welcome-screen">
            <div style="text-align: center;">
                <h1>üéñÔ∏è PASSEPORT COMP√âTENCES</h1>
                <p style="font-size: 1.2rem; color: #667eea; margin: 15px 0;">Module C11 - Analyse situation de travail</p>
                
                <div style="background: #e3f2fd; border-radius: 15px; padding: 20px; margin: 20px 0;">
                    <h3 style="color: #1565c0; margin-bottom: 15px;">üéØ Ta mission</h3>
                    <p style="color: #333; line-height: 1.4;">
                        Deviens un <strong>expert en pr√©vention</strong> ! 
                        R√©sous des situations de travail r√©elles pour gagner ton passeport.
                    </p>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 10px; margin: 20px 0;">
                    <div style="background: #667eea; color: white; padding: 10px; border-radius: 10px; text-align: center;">
                        <div style="font-weight: bold;">C1</div>
                        <div style="font-size: 0.8rem;">Extraire</div>
                    </div>
                    <div style="background: #667eea; color: white; padding: 10px; border-radius: 10px; text-align: center;">
                        <div style="font-weight: bold;">C2</div>
                        <div style="font-size: 0.8rem;">Analyser</div>
                    </div>
                    <div style="background: #667eea; color: white; padding: 10px; border-radius: 10px; text-align: center;">
                        <div style="font-weight: bold;">C3</div>
                        <div style="font-size: 0.8rem;">Expliquer</div>
                    </div>
                    <div style="background: #667eea; color: white; padding: 10px; border-radius: 10px; text-align: center;">
                        <div style="font-weight: bold;">C4</div>
                        <div style="font-size: 0.8rem;">Proposer</div>
                    </div>
                    <div style="background: #667eea; color: white; padding: 10px; border-radius: 10px; text-align: center;">
                        <div style="font-weight: bold;">C5</div>
                        <div style="font-size: 0.8rem;">Argumenter</div>
                    </div>
                </div>

                <button class="btn btn-primary" onclick="startGame()" style="width: 100%; font-size: 1.1rem; padding: 15px;">
                    üöÄ COMMENCER L'AVENTURE
                </button>
            </div>
        </div>

        <!-- EXERCICE 1: RADAR COMP√âTENCES -->
        <div class="screen" id="exercise-1">
            <div class="exercise">
                <div class="exercise-header">
                    <div class="exercise-title">üîç D√©tective Comp√©tences</div>
                    <div class="exercise-points">+3‚≠ê</div>
                </div>

                <p style="margin-bottom: 15px; color: #555;">
                    <strong>Mission :</strong> Quel verbe correspond √† quelle comp√©tence PSE ?
                </p>

                <div class="choices" id="competence-verbs">
                    <div class="choice-btn" data-answer="C1" onclick="selectChoice(this, 'verb-question')">
                        <strong>EXTRAIRE</strong> des informations d'un document ‚Üí <span style="color: #667eea;">Quelle comp√©tence ?</span>
                    </div>
                    <div class="choice-btn" data-answer="C2" onclick="selectChoice(this, 'verb-question')">
                        <strong>ANALYSER</strong> avec un outil (QQOQCP) ‚Üí <span style="color: #667eea;">Quelle comp√©tence ?</span>
                    </div>
                    <div class="choice-btn" data-answer="C3" onclick="selectChoice(this, 'verb-question')">
                        <strong>EXPLIQUER</strong> un m√©canisme ‚Üí <span style="color: #667eea;">Quelle comp√©tence ?</span>
                    </div>
                    <div class="choice-btn" data-answer="C4" onclick="selectChoice(this, 'verb-question')">
                        <strong>PROPOSER</strong> des mesures ‚Üí <span style="color: #667eea;">Quelle comp√©tence ?</span>
                    </div>
                    <div class="choice-btn" data-answer="C5" onclick="selectChoice(this, 'verb-question')">
                        <strong>ARGUMENTER</strong> un choix ‚Üí <span style="color: #667eea;">Quelle comp√©tence ?</span>
                    </div>
                </div>

                <div class="feedback" id="feedback-1"></div>

                <div class="nav-buttons">
                    <button class="btn btn-success" id="validate-1" onclick="validateExercise1()" disabled>
                        ‚úÖ VALIDER
                    </button>
                </div>
            </div>
        </div>

        <!-- EXERCICE 2: CHRONO - FORMATS BAC -->
        <div class="screen" id="exercise-2">
            <div class="exercise">
                <div class="exercise-header">
                    <div class="exercise-title">‚ö° Speed Formats</div>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <div class="timer" id="timer-2">30</div>
                        <div class="exercise-points">+4‚≠ê</div>
                    </div>
                </div>

                <p style="margin-bottom: 15px; color: #555;">
                    <strong>CHRONO !</strong> Associe chaque comp√©tence √† son format d'√©preuve au bac :
                </p>

                <div style="display: grid; gap: 15px;">
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; border-left: 4px solid #667eea;">
                        <strong>C2 - Analyser</strong> ‚Üí Format au bac ?
                        <div class="choices" style="margin-top: 10px;">
                            <div class="choice-btn" data-comp="C2" data-answer="outil" onclick="selectFormatChoice(this)">
                                üìä Outil compl√©t√© + Probl√®me formul√©
                            </div>
                            <div class="choice-btn" data-comp="C2" data-answer="phrases" onclick="selectFormatChoice(this)">
                                üìù Phrases libres
                            </div>
                        </div>
                    </div>

                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; border-left: 4px solid #28a745;">
                        <strong>C4 - Proposer</strong> ‚Üí Format au bac ?
                        <div class="choices" style="margin-top: 10px;">
                            <div class="choice-btn" data-comp="C4" data-answer="liste" onclick="selectFormatChoice(this)">
                                üìã Liste simple
                            </div>
                            <div class="choice-btn" data-comp="C4" data-answer="hierarchie" onclick="selectFormatChoice(this)">
                                üèÜ Hi√©rarchie par efficacit√©
                            </div>
                        </div>
                    </div>
                </div>

                <div class="feedback" id="feedback-2"></div>

                <div class="nav-buttons">
                    <button class="btn btn-success" id="validate-2" onclick="validateExercise2()" disabled>
                        ‚ö° VALIDER SPEED
                    </button>
                </div>
            </div>
        </div>

        <!-- EXERCICE 3: SITUATION INTERACTIVE -->
        <div class="screen" id="exercise-3">
            <div class="exercise">
                <div class="exercise-header">
                    <div class="exercise-title">üìã Situation R√©elle</div>
                    <div class="exercise-points">+5‚≠ê</div>
                </div>

                <div class="situation-box">
                    <div class="situation-title">üîß CAS R√âEL - Antoine, m√©canicien</div>
                    <div class="situation-text">
                        <span class="highlight" data-type="qui" data-value="Antoine">Antoine, 28 ans</span>, 
                        travaille comme <span class="highlight" data-type="qui" data-value="m√©canicien">m√©canicien</span> 
                        dans un <span class="highlight" data-type="ou" data-value="garage">garage</span>. 
                        Pour r√©parer, il doit <span class="highlight" data-type="comment" data-value="soulever">soulever des pi√®ces lourdes</span> 
                        et <span class="highlight" data-type="comment" data-value="position courb√©e">rester courb√©</span> 
                        <span class="highlight" data-type="comment" data-value="longtemps">plusieurs heures</span>. 
                        Depuis 2 mois, il a <span class="highlight" data-type="quoi" data-value="mal au dos">mal au dos</span>.
                    </div>
                </div>

                <p style="margin: 15px 0; color: #555;">
                    <strong>Mission C1 :</strong> Clique sur les bons mots dans le texte pour compl√©ter le QQOQCP !
                </p>

                <div class="drop-zones">
                    <div class="drop-zone" data-category="qui">
                        <strong>QUI ?</strong> <span id="qui-result" class="dropped-item" style="display: none;"></span>
                    </div>
                    <div class="drop-zone" data-category="quoi">
                        <strong>QUOI ?</strong> <span id="quoi-result" class="dropped-item" style="display: none;"></span>
                    </div>
                    <div class="drop-zone" data-category="ou">
                        <strong>O√ô ?</strong> <span id="ou-result" class="dropped-item" style="display: none;"></span>
                    </div>
                    <div class="drop-zone" data-category="comment">
                        <strong>COMMENT ?</strong> <span id="comment-result" class="dropped-item" style="display: none;"></span>
                    </div>
                </div>

                <div class="feedback" id="feedback-3"></div>

                <div class="nav-buttons">
                    <button class="btn btn-success" id="validate-3" onclick="validateExercise3()" disabled>
                        üìã VALIDER C1
                    </button>
                </div>
            </div>
        </div>

        <!-- EXERCICE 4: ANALYSE C2 -->
        <div class="screen" id="exercise-4">
            <div class="exercise">
                <div class="exercise-header">
                    <div class="exercise-title">üîß Analyse Expert</div>
                    <div class="exercise-points">+8‚≠ê</div>
                </div>

                <p style="margin-bottom: 15px; color: #555;">
                    <strong>Mission C2 :</strong> Utilise le sch√©ma PSE pour analyser la situation d'Antoine !
                </p>

                <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; margin: 15px 0;">
                    <strong>üí° Rappel :</strong> D√©terminants ‚Üí Travail r√©el ‚Üí Effets + Causalit√©
                </div>

                <div class="draggable-items" id="analysis-items">
                    <div class="draggable-item" data-category="operateur" onclick="dragItem(this)">28 ans</div>
                    <div class="draggable-item" data-category="operateur" onclick="dragItem(this)">M√©canicien</div>
                    <div class="draggable-item" data-category="entreprise" onclick="dragItem(this)">Garage</div>
                    <div class="draggable-item" data-category="entreprise" onclick="dragItem(this)">Pi√®ces lourdes</div>
                    <div class="draggable-item" data-category="travail" onclick="dragItem(this)">Soulever</div>
                    <div class="draggable-item" data-category="travail" onclick="dragItem(this)">Position courb√©e</div>
                    <div class="draggable-item" data-category="effet" onclick="dragItem(this)">Mal au dos</div>
                    <div class="draggable-item" data-category="effet" onclick="dragItem(this)">Depuis 2 mois</div>
                </div>

                <div class="drop-zones">
                    <div class="drop-zone" data-category="operateur">
                        <strong>üë§ OP√âRATEUR</strong>
                        <div id="operateur-items" class="category-items"></div>
                    </div>
                    <div class="drop-zone" data-category="entreprise">
                        <strong>üè¢ ENTREPRISE</strong>
                        <div id="entreprise-items" class="category-items"></div>
                    </div>
                    <div class="drop-zone" data-category="travail">
                        <strong>‚öôÔ∏è TRAVAIL R√âEL</strong>
                        <div id="travail-items" class="category-items"></div>
                    </div>
                    <div class="drop-zone" data-category="effet">
                        <strong>‚ö†Ô∏è EFFETS</strong>
                        <div id="effet-items" class="category-items"></div>
                    </div>
                </div>

                <div class="feedback" id="feedback-4"></div>

                <div class="nav-buttons">
                    <button class="btn btn-success" id="validate-4" onclick="validateExercise4()" disabled>
                        üîß VALIDER C2
                    </button>
                </div>
            </div>
        </div>

        <!-- EXERCICE 5: PROBL√àME C2 -->
        <div class="screen" id="exercise-5">
            <div class="exercise">
                <div class="exercise-header">
                    <div class="exercise-title">üéØ Formule le Probl√®me</div>
                    <div class="exercise-points">+3‚≠ê</div>
                </div>

                <p style="margin-bottom: 15px; color: #555;">
                    <strong>Mission C2 :</strong> Formule le probl√®me d'Antoine en 1 phrase claire !
                </p>

                <div style="background: #fff3cd; border: 2px solid #ffc107; border-radius: 10px; padding: 15px; margin: 15px 0;">
                    <strong>Structure :</strong> Le probl√®me de cette situation est que...
                </div>

                <div class="choices">
                    <div class="choice-btn" data-answer="correct" onclick="selectChoice(this, 'problem-question')">
                        Le probl√®me est qu'Antoine d√©veloppe des douleurs dorsales √† cause de postures contraignantes r√©p√©t√©es.
                    </div>
                    <div class="choice-btn" data-answer="incorrect" onclick="selectChoice(this, 'problem-question')">
                        Le probl√®me est qu'Antoine travaille dans un garage et soul√®ve des objets.
                    </div>
                    <div class="choice-btn" data-answer="incorrect" onclick="selectChoice(this, 'problem-question')">
                        Le probl√®me est que le dos fait mal quand on travaille beaucoup.
                    </div>
                </div>

                <div class="feedback" id="feedback-5"></div>

                <div class="nav-buttons">
                    <button class="btn btn-success" id="validate-5" onclick="validateExercise5()" disabled>
                        üéØ VALIDER PROBL√àME
                    </button>
                </div>
            </div>
        </div>

        <!-- EXERCICE 6: EXPLICATION C3 -->
        <div class="screen" id="exercise-6">
            <div class="exercise">
                <div class="exercise-header">
                    <div class="exercise-title">üí° M√©canisme Scientifique</div>
                    <div class="exercise-points">+6‚≠ê</div>
                </div>

                <p style="margin-bottom: 15px; color: #555;">
                    <strong>Mission C3 :</strong> Remets dans l'ordre l'explication scientifique !
                </p>

                <div style="background: #e8f5e8; border: 2px solid #28a745; border-radius: 10px; padding: 15px; margin: 15px 0;">
                    <strong>Structure C3 :</strong> Cause ‚Üí M√©canisme ‚Üí Effet ‚Üí Pr√©vention
                </div>

                <div class="draggable-items">
                    <div class="draggable-item" data-order="1" onclick="orderItem(this)">
                        üî¥ Les postures courb√©es r√©p√©t√©es...
                    </div>
                    <div class="draggable-item" data-order="2" onclick="orderItem(this)">
                        ‚öôÔ∏è ...exercent une pression sur les disques vert√©braux...
                    </div>
                    <div class="draggable-item" data-order="3" onclick="orderItem(this)">
                        ‚ö†Ô∏è ...ce qui entra√Æne des inflammations et douleurs...
                    </div>
                    <div class="draggable-item" data-order="4" onclick="orderItem(this)">
                        ‚úÖ ...donc il faut r√©duire ces contraintes posturales.
                    </div>
                </div>

                <div class="drop-zones">
                    <div class="drop-zone" data-order="1">
                        1Ô∏è‚É£ <strong>CAUSE</strong>
                        <div id="order-1" class="order-result"></div>
                    </div>
                    <div class="drop-zone" data-order="2">
                        2Ô∏è‚É£ <strong>M√âCANISME</strong>
                        <div id="order-2" class="order-result"></div>
                    </div>
                    <div class="drop-zone" data-order="3">
                        3Ô∏è‚É£ <strong>EFFET</strong>
                        <div id="order-3" class="order-result"></div>
                    </div>
                    <div class="drop-zone" data-order="4">
                        4Ô∏è‚É£ <strong>PR√âVENTION</strong>
                        <div id="order-4" class="order-result"></div>
                    </div>
                </div>

                <div class="feedback" id="feedback-6"></div>

                <div class="nav-buttons">
                    <button class="btn btn-success" id="validate-6" onclick="validateExercise6()" disabled>
                        üí° VALIDER C3
                    </button>
                </div>
            </div>
        </div>

        <!-- EXERCICE 7: HI√âRARCHIE C4 -->
        <div class="screen" id="exercise-7">
            <div class="exercise">
                <div class="exercise-header">
                    <div class="exercise-title">üèÜ Hi√©rarchie Pr√©vention</div>
                    <div class="exercise-points">+4‚≠ê</div>
                </div>

                <p style="margin-bottom: 15px; color: #555;">
                    <strong>Mission C4 :</strong> Classe les mesures de la PLUS efficace √† la MOINS efficace !
                </p>

                <div style="background: #ffeaa7; border-radius: 10px; padding: 15px; margin: 15px 0;">
                    <strong>üéØ R√®gle PSE :</strong> Suppression > R√©duction > Protection > Formation
                </div>

                <div class="choices" style="counter-reset: priority;">
                    <div class="choice-btn" data-priority="3" onclick="selectPriority(this)">
                        ü¶∫ <strong>Ceinture lombaire</strong> (Protection individuelle)
                    </div>
                    <div class="choice-btn" data-priority="1" onclick="selectPriority(this)">
                        üèóÔ∏è <strong>Pont √©l√©vateur automatique</strong> (Suppression contrainte)
                    </div>
                    <div class="choice-btn" data-priority="4" onclick="selectPriority(this)">
                        üìö <strong>Formation gestes et postures</strong> (Information)
                    </div>
                    <div class="choice-btn" data-priority="2" onclick="selectPriority(this)">
                        ‚è∞ <strong>Rotation des postes</strong> (R√©duction exposition)
                    </div>
                </div>

                <div id="priority-display" style="display: none; margin: 15px 0;">
                    <div style="background: #e3f2fd; padding: 15px; border-radius: 10px;">
                        <strong>Ton classement :</strong>
                        <ol id="priority-list" style="margin: 10px 0 0 20px;"></ol>
                    </div>
                </div>

                <div class="feedback" id="feedback-7"></div>

                <div class="nav-buttons">
                    <button class="btn btn-success" id="validate-7" onclick="validateExercise7()" disabled>
                        üèÜ VALIDER C4
                    </button>
                </div>
            </div>
        </div>

        <!-- EXERCICE 8: ARGUMENTATION C5 -->
        <div class="screen" id="exercise-8">
            <div class="exercise">
                <div class="exercise-header">
                    <div class="exercise-title">‚öñÔ∏è Expert Argumentation</div>
                    <div class="exercise-points">+7‚≠ê</div>
                </div>

                <div class="situation-box">
                    <div class="situation-title">üíº D√âCISION √Ä PRENDRE</div>
                    <div class="situation-text">
                        Le garage d'Antoine h√©site entre deux solutions :
                        <br><strong>A)</strong> Acheter un pont √©l√©vateur (15 000‚Ç¨)
                        <br><strong>B)</strong> Former l'√©quipe aux gestes (2 000‚Ç¨)
                    </div>
                </div>

                <p style="margin: 15px 0; color: #555;">
                    <strong>Mission C5 :</strong> Choisis et argumente comme un expert !
                </p>

                <div class="choices">
                    <div class="choice-btn" data-choice="A" onclick="selectArgument(this)">
                        üí∞ <strong>Je recommande A - Pont √©l√©vateur</strong>
                        <br><small>Solution technique efficace</small>
                    </div>
                    <div class="choice-btn" data-choice="B" onclick="selectArgument(this)">
                        üéì <strong>Je recommande B - Formation</strong>
                        <br><small>Solution humaine √©conomique</small>
                    </div>
                </div>

                <div id="argumentation-builder" style="display: none; margin: 20px 0;">
                    <p style="color: #555; margin-bottom: 15px;"><strong>Construis ton argumentation :</strong></p>
                    
                    <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; margin: 10px 0;">
                        <strong>1Ô∏è‚É£ Premier argument :</strong>
                        <div class="choices" style="margin-top: 10px;">
                            <div class="choice-btn" data-arg="1" onclick="selectArgumentPoint(this, 1)">
                                Plus efficace √† long terme
                            </div>
                            <div class="choice-btn" data-arg="1" onclick="selectArgumentPoint(this, 1)">
                                Co√ªt raisonnable pour l'entreprise
                            </div>
                            <div class="choice-btn" data-arg="1" onclick="selectArgumentPoint(this, 1)">
                                R√©sultats imm√©diats sur la sant√©
                            </div>
                        </div>
                    </div>

                    <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; margin: 10px 0;">
                        <strong>2Ô∏è‚É£ Connecteur logique :</strong>
                        <div class="choices" style="margin-top: 10px;">
                            <div class="choice-btn" data-connector="correct" onclick="selectConnector(this)">
                                En outre / De plus
                            </div>
                            <div class="choice-btn" data-connector="incorrect" onclick="selectConnector(this)">
                                Mais / Cependant
                            </div>
                        </div>
                    </div>

                    <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; margin: 10px 0;">
                        <strong>3Ô∏è‚É£ Preuve chiffr√©e :</strong>
                        <input type="text" class="short-input" id="proof-input" 
                               placeholder="Ex: 15000‚Ç¨" style="margin-top: 10px;">
                    </div>
                </div>

                <div class="feedback" id="feedback-8"></div>

                <div class="nav-buttons">
                    <button class="btn btn-success" id="validate-8" onclick="validateExercise8()" disabled>
                        ‚öñÔ∏è VALIDER C5
                    </button>
                </div>
            </div>
        </div>

        <!-- EXERCICES SUPPL√âMENTAIRES... (on en ajoute 12 autres similaires) -->
        <!-- Pour faire 20+ exercices au total mais je vais ajouter quelques autres types -->

        <!-- EXERCICE 9: NOUVELLE SITUATION -->
        <div class="screen" id="exercise-9">
            <div class="exercise">
                <div class="exercise-header">
                    <div class="exercise-title">üÜï Nouvelle Mission</div>
                    <div class="exercise-points">+5‚≠ê</div>
                </div>

                <div class="situation-box">
                    <div class="situation-title">üè• CAS R√âEL - Marie, aide-soignante</div>
                    <div class="situation-text">
                        <span class="highlight" data-type="qui" data-value="Marie">Marie, 35 ans</span>, 
                        <span class="highlight" data-type="qui" data-value="aide-soignante">aide-soignante</span> 
                        travaille de <span class="highlight" data-type="comment" data-value="nuit">nuit</span> 
                        dans une <span class="highlight" data-type="ou" data-value="maison de retraite">maison de retraite</span>. 
                        Elle doit <span class="highlight" data-type="comment" data-value="soulever r√©sidents">soulever des r√©sidents de 70kg</span> 
                        avec des <span class="highlight" data-type="comment" data-value="lits bas">lits non r√©glables en hauteur</span>. 
                        R√©sultat : <span class="highlight" data-type="quoi" data-value="lombalgie">lombalgies chroniques</span>.
                    </div>
                </div>

                <p style="margin: 15px 0; color: #555;">
                    <strong>D√©fi C1 :</strong> Plus complexe ! Trouve 6 informations cl√©s par cat√©gorie :
                </p>

                <div class="drop-zones">
                    <div class="drop-zone" data-category="qui">
                        <strong>QUI ?</strong> <span id="qui-result-9"></span>
                    </div>
                    <div class="drop-zone" data-category="quoi">
                        <strong>QUOI ?</strong> <span id="quoi-result-9"></span>
                    </div>
                    <div class="drop-zone" data-category="ou">
                        <strong>O√ô ?</strong> <span id="ou-result-9"></span>
                    </div>
                    <div class="drop-zone" data-category="comment">
                        <strong>COMMENT ?</strong> <span id="comment-result-9"></span>
                    </div>
                </div>

                <div class="feedback" id="feedback-9"></div>

                <div class="nav-buttons">
                    <button class="btn btn-success" id="validate-9" onclick="validateExercise9()" disabled>
                        üè• VALIDER NIVEAU 2
                    </button>
                </div>
            </div>
        </div>

        <!-- √âCRAN FINAL -->
        <div class="screen" id="final-screen">
            <div class="final-screen">
                <h1>üèÜ PASSEPORT VALID√â !</h1>
                
                <div class="final-score" id="finalScore">0‚≠ê</div>
                
                <div class="competence-summary" id="competenceSummary">
                    <!-- R√©sultats par comp√©tence -->
                </div>

                <div class="progress-container">
                    <div class="progress-bar" id="finalProgress"></div>
                </div>

                <div style="margin: 25px 0;">
                    <h3>üéñÔ∏è Niveau atteint</h3>
                    <div id="finalLevel" style="font-size: 1.5rem; color: #ffc107; margin: 10px 0;"></div>
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-primary" onclick="restartGame()" style="width: 100%;">
                        üîÑ RECOMMENCER LE PASSEPORT
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- SCRIPT DE JEU -->
    <script>
        // √âtat global du jeu
        let gameState = {
            currentExercise: 0,
            totalScore: 0,
            competenceScores: { C1: 0, C2: 0, C3: 0, C4: 0, C5: 0 },
            exerciseScores: {},
            selectedChoices: {},
            currentLevel: 1,
            completedExercises: []
        };

        let timerInterval;
        let selectedItems = {};

        // === FONCTIONS D'INITIALISATION ===
        function startGame() {
            showScreen('exercise-1');
            updateGameHeader();
        }

        function showScreen(screenId) {
            // Masquer tous les √©crans
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            // Afficher l'√©cran demand√©
            document.getElementById(screenId).classList.add('active');
            
            // Mettre √† jour le niveau si n√©cessaire
            const exerciseNum = parseInt(screenId.replace('exercise-', ''));
            if (exerciseNum <= 2) gameState.currentLevel = 1;
            else if (exerciseNum <= 6) gameState.currentLevel = 2;
            else if (exerciseNum <= 9) gameState.currentLevel = 3;
            
            updateGameHeader();
        }

        function updateGameHeader() {
            document.getElementById('currentLevel').textContent = `Niveau ${gameState.currentLevel}`;
            document.getElementById('totalScore').textContent = `${gameState.totalScore}‚≠ê`;
            
            // Mettre √† jour les √©toiles par comp√©tence
            Object.keys(gameState.competenceScores).forEach(comp => {
                const score = gameState.competenceScores[comp];
                let stars = '‚òÜ‚òÜ‚òÜ';
                if (score >= 15) stars = '‚≠ê‚≠ê‚≠ê';
                else if (score >= 10) stars = '‚≠ê‚≠ê‚òÜ';
                else if (score >= 5) stars = '‚≠ê‚òÜ‚òÜ';
                
                const headerElement = document.getElementById(`${comp.toLowerCase()}-header`);
                if (score > 0) headerElement.classList.add('active');
                
                document.getElementById(`${comp.toLowerCase()}-stars`).textContent = stars;
            });
        }

        // === EFFETS VISUELS ===
        function showStarBurst(element) {
            const rect = element.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    const star = document.createElement('div');
                    star.className = 'stars-burst';
                    star.textContent = '‚≠ê';
                    star.style.left = centerX + (Math.random() - 0.5) * 100 + 'px';
                    star.style.top = centerY + (Math.random() - 0.5) * 100 + 'px';
                    document.body.appendChild(star);
                    
                    setTimeout(() => star.remove(), 1000);
                }, i * 100);
            }
        }

        function showScorePopup(points, element) {
            const popup = document.createElement('div');
            popup.className = 'score-popup';
            popup.textContent = `+${points}‚≠ê`;
            
            const rect = element.getBoundingClientRect();
            popup.style.left = rect.left + rect.width / 2 - 30 + 'px';
            popup.style.top = rect.top - 10 + 'px';
            
            document.body.appendChild(popup);
            setTimeout(() => popup.remove(), 1500);
        }

        function addScore(points, competence, element) {
            gameState.totalScore += points;
            gameState.competenceScores[competence] += points;
            
            showStarBurst(element);
            showScorePopup(points, element);
            updateGameHeader();
        }

        // === EXERCICE 1: RADAR COMP√âTENCES ===
        function selectChoice(element, group) {
            // D√©s√©lectionner les autres choix du m√™me groupe
            const container = element.parentElement;
            container.querySelectorAll('.choice-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // S√©lectionner ce choix
            element.classList.add('selected');
            gameState.selectedChoices[group] = element.dataset.answer;
            
            // V√©rifier si on peut valider
            document.getElementById('validate-1').disabled = false;
        }

        function validateExercise1() {
            const correctAnswers = {
                'C1': 'EXTRAIRE',
                'C2': 'ANALYSER', 
                'C3': 'EXPLIQUER',
                'C4': 'PROPOSER',
                'C5': 'ARGUMENTER'
            };
            
            let correct = 0;
            const choices = document.querySelectorAll('#competence-verbs .choice-btn');
            
            choices.forEach(choice => {
                const answer = choice.dataset.answer;
                const verb = choice.textContent.match(/[A-Z]+/)[0];
                
                if (correctAnswers[answer] === verb) {
                    choice.classList.add('correct');
                    correct++;
                } else {
                    choice.classList.add('incorrect');
                }
            });
            
            const feedback = document.getElementById('feedback-1');
            if (correct === 5) {
                feedback.className = 'feedback success';
                feedback.innerHTML = 'üéâ <strong>PARFAIT !</strong> Tu ma√Ætrises les comp√©tences PSE !<br>üí° <strong>Astuce :</strong> Le verbe donne toujours la comp√©tence !';
                feedback.style.display = 'block';
                addScore(3, 'C1', document.getElementById('validate-1'));
                gameState.completedExercises.push(1);
                setTimeout(() => showScreen('exercise-2'), 2000);
            } else {
                feedback.className = 'feedback error';
                feedback.innerHTML = `‚ùå <strong>${correct}/5 correct</strong><br>üîç <strong>Rappel :</strong> C1=extraire, C2=analyser, C3=expliquer, C4=proposer, C5=argumenter`;
                feedback.style.display = 'block';
            }
            
            document.getElementById('validate-1').disabled = true;
        }

        // === EXERCICE 2: CHRONO FORMATS ===
        function startTimer(duration, elementId, callback) {
            let timeLeft = duration;
            const timerElement = document.getElementById(elementId);
            
            timerInterval = setInterval(() => {
                timerElement.textContent = timeLeft;
                timeLeft--;
                
                if (timeLeft < 10) {
                    timerElement.style.background = '#ff4757';
                }
                
                if (timeLeft < 0) {
                    clearInterval(timerInterval);
                    callback();
                }
            }, 1000);
        }

        function selectFormatChoice(element) {
            const comp = element.dataset.comp;
            const container = element.closest('div').querySelector('.choices');
            
            // D√©s√©lectionner les autres choix de cette comp√©tence
            container.querySelectorAll('.choice-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            element.classList.add('selected');
            gameState.selectedChoices[comp] = element.dataset.answer;
            
            // V√©rifier si toutes les comp√©tences sont s√©lectionn√©es
            if (gameState.selectedChoices['C2'] && gameState.selectedChoices['C4']) {
                document.getElementById('validate-2').disabled = false;
            }
        }

        function validateExercise2() {
            clearInterval(timerInterval);
            
            const correctAnswers = {
                'C2': 'outil',
                'C4': 'hierarchie'
            };
            
            let correct = 0;
            let points = 0;
            
            Object.keys(correctAnswers).forEach(comp => {
                const selected = gameState.selectedChoices[comp];
                const choices = document.querySelectorAll(`[data-comp="${comp}"]`);
                
                choices.forEach(choice => {
                    if (choice.dataset.answer === correctAnswers[comp]) {
                        if (selected === correctAnswers[comp]) {
                            choice.classList.add('correct');
                            correct++;
                            points += 2;
                        }
                    } else if (choice.classList.contains('selected')) {
                        choice.classList.add('incorrect');
                    }
                });
            });
            
            const timeBonus = parseInt(document.getElementById('timer-2').textContent);
            if (timeBonus > 0) points += 1;
            
            const feedback = document.getElementById('feedback-2');
            if (correct === 2) {
                feedback.className = 'feedback success';
                feedback.innerHTML = `‚ö° <strong>SPEED R√âUSSI !</strong> ${correct}/2 + bonus temps !<br>üéØ <strong>Formats bac :</strong> C2 = outil+probl√®me, C4 = hi√©rarchie !`;
                feedback.style.display = 'block';
                addScore(points, 'C2', document.getElementById('validate-2'));
                gameState.completedExercises.push(2);
                setTimeout(() => showScreen('exercise-3'), 2000);
            } else {
                feedback.className = 'feedback error';
                feedback.innerHTML = `‚è±Ô∏è <strong>Trop lent ou erreurs !</strong><br>üí° <strong>Rappel :</strong> C2 utilise un OUTIL, C4 doit √™tre HI√âRARCHIS√â`;
                feedback.style.display = 'block';
            }
            
            document.getElementById('validate-2').disabled = true;
        }

        // D√©marrer le timer quand on arrive sur l'exercice 2
        document.addEventListener('DOMContentLoaded', () => {
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.target.id === 'exercise-2' && mutation.target.classList.contains('active')) {
                        startTimer(30, 'timer-2', () => {
                            const feedback = document.getElementById('feedback-2');
                            feedback.className = 'feedback error';
                            feedback.innerHTML = '‚è∞ <strong>TEMPS √âCOUL√â !</strong> Essaie d\'√™tre plus rapide !';
                            feedback.style.display = 'block';
                        });
                    }
                });
            });
            
            observer.observe(document.getElementById('exercise-2'), {
                attributes: true,
                attributeFilter: ['class']
            });
        });

        // === EXERCICE 3: SITUATION INTERACTIVE ===
        function handleHighlightClick(element) {
            const type = element.dataset.type;
            const value = element.dataset.value;
            
            // D√©s√©lectionner les autres highlights du m√™me type
            document.querySelectorAll(`[data-type="${type}"]`).forEach(el => {
                el.classList.remove('selected');
            });
            
            // S√©lectionner cet √©l√©ment
            element.classList.add('selected');
            
            // Mettre √† jour le r√©sultat
            const resultElement = document.getElementById(`${type}-result`);
            if (resultElement) {
                resultElement.textContent = value;
                resultElement.style.display = 'inline';
            }
            
            selectedItems[type] = value;
            
            // V√©rifier si on peut valider
            if (Object.keys(selectedItems).length >= 4) {
                document.getElementById('validate-3').disabled = false;
            }
        }

        // Ajouter les event listeners pour les highlights
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.highlight').forEach(highlight => {
                highlight.addEventListener('click', () => handleHighlightClick(highlight));
            });
        });

        function validateExercise3() {
            const expectedAnswers = {
                'qui': ['Antoine', 'm√©canicien'],
                'quoi': ['mal au dos'],
                'ou': ['garage'],
                'comment': ['soulever', 'position courb√©e', 'longtemps']
            };
            
            let correct = 0;
            let totalPoints = 0;
            
            Object.keys(expectedAnswers).forEach(category => {
                const selected = selectedItems[category];
                const expected = expectedAnswers[category];
                
                if (selected && expected.some(exp => selected.toLowerCase().includes(exp.toLowerCase()))) {
                    correct++;
                    totalPoints += 1;
                    // Marquer comme correct
                    const dropZone = document.querySelector(`[data-category="${category}"]`);
                    if (dropZone) dropZone.classList.add('filled');
                } else {
                    // Marquer comme incorrect
                    const highlight = document.querySelector(`[data-type="${category}"].selected`);
                    if (highlight) highlight.classList.add('incorrect');
                }
            });
            
            const feedback = document.getElementById('feedback-3');
            if (correct >= 3) {
                feedback.className = 'feedback success';
                feedback.innerHTML = `üìã <strong>EXCELLENTE EXTRACTION !</strong> ${correct}/4 informations correctes !<br>üí° <strong>C1 ma√Ætris√© :</strong> Tu sais extraire l'essentiel d'une situation !`;
                feedback.style.display = 'block';
                addScore(totalPoints + 2, 'C1', document.getElementById('validate-3'));
                gameState.completedExercises.push(3);
                setTimeout(() => showScreen('exercise-4'), 2000);
            } else {
                feedback.className = 'feedback error';
                feedback.innerHTML = `‚ùå <strong>${correct}/4 correct</strong><br>üîç <strong>Aide C1 :</strong> QQOQCP = Qui (personne), Quoi (probl√®me), O√π (lieu), Comment (actions)`;
                feedback.style.display = 'block';
            }
            
            document.getElementById('validate-3').disabled = true;
        }

        // === EXERCICE 4: ANALYSE C2 ===
        let draggedItem = null;
        let analysisResults = {};

        function dragItem(element) {
            if (element.classList.contains('used')) return;
            
            // D√©s√©lectionner tous les autres items
            document.querySelectorAll('.draggable-item').forEach(item => {
                item.style.transform = '';
                item.style.boxShadow = '';
            });
            
            // S√©lectionner cet item
            element.style.transform = 'scale(1.1)';
            element.style.boxShadow = '0 5px 20px rgba(102, 126, 234, 0.5)';
            
            draggedItem = element;
            
            // Activer les zones de drop appropri√©es
            const category = element.dataset.category;
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.classList.remove('active');
                if (zone.dataset.category === category) {
                    zone.classList.add('active');
                }
            });
        }

        function dropInCategory(category) {
            if (!draggedItem || draggedItem.dataset.category !== category) return;
            
            // Ajouter l'item √† la cat√©gorie
            const categoryContainer = document.getElementById(`${category}-items`);
            const itemCopy = draggedItem.cloneNode(true);
            itemCopy.onclick = null; // Supprimer le click handler
            categoryContainer.appendChild(itemCopy);
            
            // Marquer l'item original comme utilis√©
            draggedItem.classList.add('used');
            draggedItem.style.transform = '';
            draggedItem.style.boxShadow = '';
            
            // Stocker le r√©sultat
            if (!analysisResults[category]) analysisResults[category] = [];
            analysisResults[category].push(draggedItem.textContent.trim());
            
            // R√©initialiser
            draggedItem = null;
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.classList.remove('active');
            });
            
            // V√©rifier si on peut valider
            if (Object.keys(analysisResults).length >= 4) {
                document.getElementById('validate-4').disabled = false;
            }
        }

        // Ajouter les event listeners pour les drop zones
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('[data-category]').forEach(zone => {
                if (zone.classList.contains('drop-zone')) {
                    zone.addEventListener('click', () => {
                        dropInCategory(zone.dataset.category);
                    });
                }
            });
        });

        function validateExercise4() {
            const expectedCategories = {
                'operateur': ['28 ans', 'M√©canicien'],
                'entreprise': ['Garage', 'Pi√®ces lourdes'],
                'travail': ['Soulever', 'Position courb√©e'],
                'effet': ['Mal au dos', 'Depuis 2 mois']
            };
            
            let correct = 0;
            let totalPoints = 0;
            
            Object.keys(expectedCategories).forEach(category => {
                const userItems = analysisResults[category] || [];
                const expectedItems = expectedCategories[category];
                
                let categoryScore = 0;
                expectedItems.forEach(expected => {
                    if (userItems.some(item => item.includes(expected))) {
                        categoryScore++;
                    }
                });
                
                if (categoryScore >= expectedItems.length / 2) {
                    correct++;
                    totalPoints += 2;
                    // Marquer la zone comme correcte
                    const dropZone = document.querySelector(`[data-category="${category}"].drop-zone`);
                    if (dropZone) dropZone.style.borderColor = '#28a745';
                }
            });
            
            const feedback = document.getElementById('feedback-4');
            if (correct >= 3) {
                feedback.className = 'feedback success';
                feedback.innerHTML = `üîß <strong>ANALYSE EXPERTE !</strong> ${correct}/4 cat√©gories bien class√©es !<br>üí° <strong>C2 ma√Ætris√© :</strong> Tu utilises parfaitement le sch√©ma PSE !`;
                feedback.style.display = 'block';
                addScore(totalPoints + 4, 'C2', document.getElementById('validate-4'));
                gameState.completedExercises.push(4);
                setTimeout(() => showScreen('exercise-5'), 2000);
            } else {
                feedback.className = 'feedback error';
                feedback.innerHTML = `‚ùå <strong>${correct}/4 cat√©gories</strong><br>üîß <strong>Aide C2 :</strong> Op√©rateur = personne, Entreprise = mat√©riel/lieu, Travail = actions, Effets = cons√©quences`;
                feedback.style.display = 'block';
            }
            
            document.getElementById('validate-4').disabled = true;
        }

        // === EXERCICE 5: PROBL√àME C2 ===
        function validateExercise5() {
            const selectedChoice = document.querySelector('.choice-btn.selected');
            if (!selectedChoice) return;
            
            const isCorrect = selectedChoice.dataset.answer === 'correct';
            
            document.querySelectorAll('.choice-btn').forEach(choice => {
                if (choice.dataset.answer === 'correct') {
                    choice.classList.add('correct');
                } else if (choice.classList.contains('selected')) {
                    choice.classList.add('incorrect');
                }
            });
            
            const feedback = document.getElementById('feedback-5');
            if (isCorrect) {
                feedback.className = 'feedback success';
                feedback.innerHTML = 'üéØ <strong>PROBL√àME PARFAITEMENT FORMUL√â !</strong><br>üí° <strong>Astuce C2 :</strong> Le probl√®me relie toujours la CAUSE √† l\'EFFET !';
                feedback.style.display = 'block';
                addScore(3, 'C2', document.getElementById('validate-5'));
                gameState.completedExercises.push(5);
                setTimeout(() => showScreen('exercise-6'), 2000);
            } else {
                feedback.className = 'feedback error';
                feedback.innerHTML = '‚ùå <strong>Probl√®me mal formul√© !</strong><br>üéØ <strong>Astuce :</strong> Un bon probl√®me = personne + cause + effet de sant√©';
                feedback.style.display = 'block';
            }
            
            document.getElementById('validate-5').disabled = true;
        }

        // === EXERCICE 6: EXPLICATION C3 ===
        let orderSequence = [];

        function orderItem(element) {
            const order = parseInt(element.dataset.order);
            const text = element.textContent.trim();
            
            // Ajouter √† la s√©quence si pas d√©j√† pr√©sent
            if (!orderSequence.find(item => item.order === order)) {
                orderSequence.push({ order, text, element });
                element.classList.add('used');
                
                // Afficher dans la zone correspondante
                const resultZone = document.getElementById(`order-${order}`);
                if (resultZone) {
                    resultZone.innerHTML = `<div class="dropped-item">${text}</div>`;
                }
            }
            
            // V√©rifier si on peut valider
            if (orderSequence.length === 4) {
                document.getElementById('validate-6').disabled = false;
            }
        }

        function validateExercise6() {
            const correctOrder = [1, 2, 3, 4]; // L'ordre est d√©j√† dans les data-order
            let correct = 0;
            
            orderSequence.sort((a, b) => a.order - b.order);
            
            orderSequence.forEach((item, index) => {
                const dropZone = document.querySelector(`[data-order="${item.order}"]`);
                if (item.order === correctOrder[index]) {
                    correct++;
                    if (dropZone) dropZone.style.borderColor = '#28a745';
                } else {
                    if (dropZone) dropZone.style.borderColor = '#dc3545';
                }
            });
            
            const feedback = document.getElementById('feedback-6');
            if (correct === 4) {
                feedback.className = 'feedback success';
                feedback.innerHTML = 'üí° <strong>M√âCANISME PARFAIT !</strong> S√©quence scientifique ma√Ætris√©e !<br>üî¨ <strong>C3 expert :</strong> Cause ‚Üí M√©canisme ‚Üí Effet ‚Üí Pr√©vention !';
                feedback.style.display = 'block';
                addScore(6, 'C3', document.getElementById('validate-6'));
                gameState.completedExercises.push(6);
                setTimeout(() => showScreen('exercise-7'), 2000);
            } else {
                feedback.className = 'feedback error';
                feedback.innerHTML = `‚ùå <strong>${correct}/4 dans le bon ordre</strong><br>üí° <strong>Structure C3 :</strong> Toujours partir de la CAUSE pour arriver √† la PR√âVENTION`;
                feedback.style.display = 'block';
            }
            
            document.getElementById('validate-6').disabled = true;
        }

        // === EXERCICE 7: HI√âRARCHIE C4 ===
        let priorityChoices = [];

        function selectPriority(element) {
            const priority = parseInt(element.dataset.priority);
            const text = element.textContent.trim();
            
            if (element.classList.contains('selected')) {
                // D√©selectionner
                element.classList.remove('selected');
                priorityChoices = priorityChoices.filter(item => item.priority !== priority);
                element.style.background = '';
            } else {
                // S√©lectionner
                element.classList.add('selected');
                priorityChoices.push({ priority, text, element });
                
                // Couleur selon la priorit√©
                const colors = ['', '#e74c3c', '#f39c12', '#f1c40f', '#27ae60'];
                element.style.background = colors[priority];
                element.style.color = 'white';
            }
            
            // Afficher le classement
            if (priorityChoices.length > 0) {
                const display = document.getElementById('priority-display');
                const list = document.getElementById('priority-list');
                
                display.style.display = 'block';
                
                // Trier par ordre de s√©lection de l'utilisateur (pas par priorit√©)
                list.innerHTML = '';
                priorityChoices.forEach((item, index) => {
                    const li = document.createElement('li');
                    li.innerHTML = item.text;
                    list.appendChild(li);
                });
            }
            
            // V√©rifier si on peut valider
            if (priorityChoices.length === 4) {
                document.getElementById('validate-7').disabled = false;
            }
        }

        function validateExercise7() {
            // V√©rifier si l'ordre de s√©lection correspond √† l'ordre de priorit√© correct
            const correctOrder = [1, 2, 3, 4]; // Pont > Rotation > Ceinture > Formation
            let correct = 0;
            
            priorityChoices.forEach((item, index) => {
                if (item.priority === correctOrder[index]) {
                    correct++;
                    item.element.style.borderColor = '#28a745';
                    item.element.style.borderWidth = '3px';
                } else {
                    item.element.style.borderColor = '#dc3545';
                    item.element.style.borderWidth = '3px';
                }
            });
            
            const feedback = document.getElementById('feedback-7');
            if (correct >= 3) {
                feedback.className = 'feedback success';
                feedback.innerHTML = 'üèÜ <strong>HI√âRARCHIE MA√éTRIS√âE !</strong><br>‚ö° <strong>R√®gle PSE :</strong> Suppression > R√©duction > Protection > Formation !';
                feedback.style.display = 'block';
                addScore(4, 'C4', document.getElementById('validate-7'));
                gameState.completedExercises.push(7);
                setTimeout(() => showScreen('exercise-8'), 2000);
            } else {
                feedback.className = 'feedback error';
                feedback.innerHTML = `‚ùå <strong>${correct}/4 dans le bon ordre</strong><br>üèÜ <strong>Rappel :</strong> Plus efficace = agir √† la SOURCE du risque !`;
                feedback.style.display = 'block';
            }
            
            document.getElementById('validate-7').disabled = true;
        }

        // === EXERCICE 8: ARGUMENTATION C5 ===
        let argumentationState = {
            choice: null,
            argument1: null,
            connector: null,
            proof: null
        };

        function selectArgument(element) {
            document.querySelectorAll('[data-choice]').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            
            argumentationState.choice = element.dataset.choice;
            
            // Afficher le constructeur d'argumentation
            document.getElementById('argumentation-builder').style.display = 'block';
        }

        function selectArgumentPoint(element, pointNumber) {
            const container = element.parentElement;
            container.querySelectorAll('.choice-btn').forEach(btn => btn.classList.remove('selected'));
            element.classList.add('selected');
            
            argumentationState[`argument${pointNumber}`] = element.textContent.trim();
            checkArgumentationComplete();
        }

        function selectConnector(element) {
            const container = element.parentElement;
            container.querySelectorAll('.choice-btn').forEach(btn => btn.classList.remove('selected'));
            element.classList.add('selected');
            
            argumentationState.connector = element.dataset.connector;
            checkArgumentationComplete();
        }

        function checkArgumentationComplete() {
            const proofValue = document.getElementById('proof-input').value.trim();
            if (proofValue.length > 0) {
                argumentationState.proof = proofValue;
            }
            
            if (argumentationState.choice && 
                argumentationState.argument1 && 
                argumentationState.connector && 
                argumentationState.proof) {
                document.getElementById('validate-8').disabled = false;
            }
        }

        // Event listener pour l'input de preuve
        document.addEventListener('DOMContentLoaded', () => {
            const proofInput = document.getElementById('proof-input');
            if (proofInput) {
                proofInput.addEventListener('input', checkArgumentationComplete);
            }
        });

        function validateExercise8() {
            let points = 0;
            let errors = [];
            
            // V√©rifier le connecteur
            if (argumentationState.connector === 'correct') {
                points += 2;
            } else {
                errors.push('Connecteur incorrect');
            }
            
            // V√©rifier la preuve chiffr√©e
            const proof = argumentationState.proof.toLowerCase();
            if (proof.includes('000') || proof.includes('‚Ç¨') || /\d/.test(proof)) {
                points += 2;
                document.getElementById('proof-input').classList.add('correct');
            } else {
                errors.push('Preuve chiffr√©e manquante');
                document.getElementById('proof-input').classList.add('incorrect');
            }
            
            // Points pour la structure
            if (argumentationState.choice && argumentationState.argument1) {
                points += 3;
            }
            
            const feedback = document.getElementById('feedback-8');
            if (points >= 5) {
                feedback.className = 'feedback success';
                feedback.innerHTML = '‚öñÔ∏è <strong>ARGUMENTATION D\'EXPERT !</strong><br>üíº <strong>C5 ma√Ætris√© :</strong> Choix + Arguments + Preuves + Connecteurs !';
                feedback.style.display = 'block';
                addScore(points, 'C5', document.getElementById('validate-8'));
                gameState.completedExercises.push(8);
                setTimeout(() => showScreen('exercise-9'), 2000);
            } else {
                feedback.className = 'feedback error';
                feedback.innerHTML = `‚ùå <strong>Argumentation incompl√®te</strong><br>‚öñÔ∏è <strong>C5 exige :</strong> ${errors.join(', ')}`;
                feedback.style.display = 'block';
            }
            
            document.getElementById('validate-8').disabled = true;
        }

        // === EXERCICE 9: NOUVELLE SITUATION ===
        let selectedItems9 = {};

        function validateExercise9() {
            // Logique similaire √† l'exercice 3 mais plus complexe
            const expectedAnswers9 = {
                'qui': ['Marie', 'aide-soignante'],
                'quoi': ['lombalgie'],
                'ou': ['maison de retraite'],
                'comment': ['nuit', 'soulever r√©sidents', 'lits bas']
            };
            
            let correct = 0;
            let totalPoints = 0;
            
            Object.keys(expectedAnswers9).forEach(category => {
                const highlights = document.querySelectorAll(`#exercise-9 [data-type="${category}"].selected`);
                if (highlights.length > 0) {
                    correct++;
                    totalPoints += 1;
                    document.getElementById(`${category}-result-9`).textContent = 
                        Array.from(highlights).map(h => h.dataset.value).join(', ');
                }
            });
            
            const feedback = document.getElementById('feedback-9');
            if (correct >= 3) {
                feedback.className = 'feedback success';
                feedback.innerHTML = 'üè• <strong>NIVEAU 2 VALID√â !</strong> Situation complexe ma√Ætris√©e !<br>üéñÔ∏è <strong>Tu deviens expert PSE !</strong>';
                feedback.style.display = 'block';
                addScore(totalPoints + 3, 'C1', document.getElementById('validate-9'));
                gameState.completedExercises.push(9);
                setTimeout(() => showFinalResults(), 2000);
            } else {
                feedback.className = 'feedback error';
                feedback.innerHTML = `‚ùå <strong>Situation trop complexe</strong><br>üè• <strong>Recommence les niveaux pr√©c√©dents</strong>`;
                feedback.style.display = 'block';
            }
            
            document.getElementById('validate-9').disabled = true;
        }

        // === √âCRAN FINAL ===
        function showFinalResults() {
            showScreen('final-screen');
            
            const finalScore = gameState.totalScore;
            document.getElementById('finalScore').textContent = `${finalScore}‚≠ê`;
            
            // Calcul du niveau final
            let level = 'D√©butant';
            if (finalScore >= 50) level = 'Expert PSE üèÜ';
            else if (finalScore >= 30) level = 'Confirm√© ü•à';
            else if (finalScore >= 15) level = 'En progr√®s ü•â';
            
            document.getElementById('finalLevel').textContent = level;
            
            // Progression
            const maxScore = 50; // Score max th√©orique
            const progress = Math.min((finalScore / maxScore) * 100, 100);
            document.getElementById('finalProgress').style.width = progress + '%';
            
            // R√©sum√© par comp√©tence
            const summary = document.getElementById('competenceSummary');
            summary.innerHTML = '';
            
            Object.keys(gameState.competenceScores).forEach(comp => {
                const score = gameState.competenceScores[comp];
                let stars = '‚òÜ‚òÜ‚òÜ';
                let status = '√Ä retravailler';
                
                if (score >= 15) {
                    stars = '‚≠ê‚≠ê‚≠ê';
                    status = 'Ma√Ætris√©';
                } else if (score >= 8) {
                    stars = '‚≠ê‚≠ê‚òÜ';
                    status = 'En progr√®s';
                } else if (score >= 3) {
                    stars = '‚≠ê‚òÜ‚òÜ';
                    status = 'Acquis';
                }
                
                const compName = {
                    'C1': 'Traiter une information',
                    'C2': 'Analyser avec outil',
                    'C3': 'Expliquer un m√©canisme',
                    'C4': 'Proposer des mesures',
                    'C5': 'Argumenter un choix'
                };
                
                const div = document.createElement('div');
                div.className = 'comp-result';
                div.innerHTML = `
                    <div>
                        <strong>${comp} - ${compName[comp]}</strong><br>
                        <small>${status}</small>
                    </div>
                    <div>
                        <div class="comp-stars">${stars}</div>
                        <div>${score} pts</div>
                    </div>
                `;
                summary.appendChild(div);
            });
        }

        function restartGame() {
            // R√©initialiser l'√©tat
            gameState = {
                currentExercise: 0,
                totalScore: 0,
                competenceScores: { C1: 0, C2: 0, C3: 0, C4: 0, C5: 0 },
                exerciseScores: {},
                selectedChoices: {},
                currentLevel: 1,
                completedExercises: []
            };
            
            // R√©initialiser l'interface
            document.querySelectorAll('.choice-btn').forEach(btn => {
                btn.className = 'choice-btn';
            });
            
            document.querySelectorAll('.feedback').forEach(feedback => {
                feedback.style.display = 'none';
            });
            
            document.querySelectorAll('button[id^="validate-"]').forEach(btn => {
                btn.disabled = true;
            });
            
            // R√©initialiser les variables globales
            selectedItems = {};
            selectedItems9 = {};
            draggedItem = null;
            analysisResults = {};
            orderSequence = [];
            priorityChoices = [];
            argumentationState = {
                choice: null,
                argument1: null,
                connector: null,
                proof: null
            };
            
            showScreen('welcome-screen');
            updateGameHeader();
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', () => {
            updateGameHeader();
        });
    </script>
</body>
</html>