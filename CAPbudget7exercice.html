<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exercice PSE : G√©rer son Budget</title>
    <style>
        :root { --primary: #2563eb; --success: #16a34a; --error: #dc2626; --bg: #f1f5f9; }
        body { font-family: sans-serif; background: var(--bg); padding: 20px; color: #1e293b; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .cours { background: #eff6ff; border-left: 5px solid var(--primary); padding: 15px; border-radius: 8px; margin-bottom: 25px; }
        .situation-card { border: 2px solid #e2e8f0; border-radius: 12px; padding: 15px; margin-bottom: 20px; }
        .situation-header { font-weight: bold; color: var(--primary); margin-bottom: 10px; font-size: 1.1rem; }
        .options { display: flex; flex-direction: column; gap: 8px; }
        .option-btn { padding: 12px; border: 2px solid #cbd5e1; border-radius: 8px; background: white; cursor: pointer; text-align: left; font-size: 1rem; }
        .option-btn:hover { border-color: var(--primary); }
        .option-btn.selected { background: #dbeafe; border-color: var(--primary); }
        .option-btn.correct { background: var(--success); color: white; border-color: var(--success); }
        .option-btn.wrong { background: var(--error); color: white; border-color: var(--error); }
        .btn-submit { width: 100%; padding: 18px; background: var(--primary); color: white; border: none; border-radius: 10px; font-size: 1.2rem; font-weight: bold; cursor: pointer; margin-top: 20px; }
        #resultat { display: none; margin-top: 25px; text-align: center; font-size: 1.5rem; font-weight: bold; padding: 20px; border-radius: 10px; background: #f8fafc; }

        /* ‚úÖ Ajustements techniques (sans modifier le contenu p√©dagogique) */
        * { box-sizing: border-box; }
        html, body { margin: 0; padding: 0; }
        body { padding: 20px; }
        .container { width: 100%; max-width: 800px; }
        .option-btn, .btn-submit { -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
        .option-btn { width: 100%; }
        ul { padding-left: 20px; }
        p { overflow-wrap: anywhere; }

        @media (max-width: 600px) {
            body { padding: 12px; }
            .container { padding: 16px; border-radius: 12px; }
            .situation-card { padding: 12px; }
            .situation-header { font-size: 1.05rem; }
            .btn-submit { padding: 16px; font-size: 1.1rem; }
            #resultat { font-size: 1.25rem; padding: 14px; }
        }
    </style>
</head>
<body>

<div class="container">
    <header style="text-align:center; margin-bottom:20px;">
        <h1>L'√©tat de mon Budget</h1>
    </header>

    <section class="cours">
        <strong>Rappel simple :</strong>
        <ul>
            <li><strong>Exc√©dentaire :</strong> On gagne plus qu'on ne d√©pense. On peut √©pargner.</li>
            <li><strong>√âquilibr√© :</strong> Les d√©penses sont environ √©gales aux revenus. On finit √† 0.</li>
            <li><strong>D√©ficitaire :</strong> Les d√©penses sont sup√©rieures aux revenus. On manque d'argent.</li>
        </ul>
    </section>

    <div id="quiz">
        <div class="situation-card" data-correct="excedentaire">
            <div class="situation-header">Situation 1 : No√©mie</div>
            <p>Elle a pay√© toutes ses charges. √Ä la fin du mois, elle met 25 ‚Ç¨ sur son livret d'√©pargne.</p>
            <div class="options">
                <button class="option-btn" data-value="excedentaire">Budget Exc√©dentaire</button>
                <button class="option-btn" data-value="equilibre">Budget √âquilibr√©</button>
                <button class="option-btn" data-value="deficitaire">Budget D√©ficitaire</button>
            </div>
        </div>

        <div class="situation-card" data-correct="deficitaire">
            <div class="situation-header">Situation 2 : Coumba</div>
            <p>Elle d√©pense sans compter. Elle n'a plus assez d'argent pour payer ses derni√®res factures.</p>
            <div class="options">
                <button class="option-btn" data-value="excedentaire">Budget Exc√©dentaire</button>
                <button class="option-btn" data-value="equilibre">Budget √âquilibr√©</button>
                <button class="option-btn" data-value="deficitaire">Budget D√©ficitaire</button>
            </div>
        </div>

        <div class="situation-card" data-correct="equilibre">
            <div class="situation-header">Situation 3 : Tristan</div>
            <p>Il a utilis√© tout son salaire. Il finit le mois avec exactement 0 ‚Ç¨ sur son compte.</p>
            <div class="options">
                <button class="option-btn" data-value="excedentaire">Budget Exc√©dentaire</button>
                <button class="option-btn" data-value="equilibre">Budget √âquilibr√©</button>
                <button class="option-btn" data-value="deficitaire">Budget D√©ficitaire</button>
            </div>
        </div>

        <div class="situation-card" data-correct="excedentaire">
            <div class="situation-header">Situation 4 : Marc</div>
            <p>Marc gagne 1 500 ‚Ç¨ par mois. Ses d√©penses totales s'√©l√®vent √† 1 200 ‚Ç¨.</p>
            <div class="options">
                <button class="option-btn" data-value="excedentaire">Budget Exc√©dentaire</button>
                <button class="option-btn" data-value="equilibre">Budget √âquilibr√©</button>
                <button class="option-btn" data-value="deficitaire">Budget D√©ficitaire</button>
            </div>
        </div>

        <div class="situation-card" data-correct="deficitaire">
            <div class="situation-header">Situation 5 : L√©a</div>
            <p>L√©a per√ßoit 800 ‚Ç¨ d'aides. Son loyer et ses courses co√ªtent 950 ‚Ç¨. Elle est √† d√©couvert.</p>
            <div class="options">
                <button class="option-btn" data-value="excedentaire">Budget Exc√©dentaire</button>
                <button class="option-btn" data-value="equilibre">Budget √âquilibr√©</button>
                <button class="option-btn" data-value="deficitaire">Budget D√©ficitaire</button>
            </div>
        </div>

        <div class="situation-card" data-correct="equilibre">
            <div class="situation-header">Situation 6 : Yassine</div>
            <p>Yassine gagne 1 200 ‚Ç¨. Ses d√©penses sont de 1 198 ‚Ç¨. Il lui reste 2 ‚Ç¨, ce qui est presque nul.</p>
            <div class="options">
                <button class="option-btn" data-value="excedentaire">Budget Exc√©dentaire</button>
                <button class="option-btn" data-value="equilibre">Budget √âquilibr√©</button>
                <button class="option-btn" data-value="deficitaire">Budget D√©ficitaire</button>
            </div>
        </div>
    </div>

    <button class="btn-submit" id="valider">V√âRIFIER MES R√âPONSES</button>
    <div id="resultat"></div>
</div>

<script>
    document.querySelectorAll('.option-btn').forEach(btn => {
        btn.onclick = function() {
            const parent = this.closest('.situation-card');
            parent.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
            this.classList.add('selected');
        };
    });

    document.getElementById('valider').onclick = function() {
        if (this.disabled) return;
        this.disabled = true;
        this.style.opacity = '0.85';
        this.style.cursor = 'not-allowed';

        let score = 0;
        const situations = document.querySelectorAll('.situation-card');

        situations.forEach(card => {
            const selected = card.querySelector('.option-btn.selected');
            const correct = card.getAttribute('data-correct');

            card.querySelectorAll('.option-btn').forEach(btn => {
                btn.style.pointerEvents = 'none';
                if (btn.getAttribute('data-value') === correct) {
                    btn.classList.add('correct');
                } else if (btn.classList.contains('selected')) {
                    btn.classList.add('wrong');
                }
            });
            if (selected && selected.getAttribute('data-value') === correct) { score++; }
        });

        const final = document.getElementById('resultat');
        final.style.display = 'block';
        final.innerHTML = "Ton score : " + score + " / " + situations.length;
        this.style.display = 'none';
    };
</script>

</body>
    <script type="module">
    // 1. Importation des outils Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

    // 2. Configuration (La cl√© de ton projet devoirs-pse)
    const firebaseConfig = {
        apiKey: "AIzaSyAWdCMvOiAJln3eT9LIAQD3RWJUD0lQcLI",
        authDomain: "devoirs-pse.firebaseapp.com",
        projectId: "devoirs-pse",
        storageBucket: "devoirs-pse.appspot.com",
        messagingSenderId: "614730413904",
        appId: "1:614730413904:web:a5dd478af5de30f6bede55"
    };

    // 3. Initialisation
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // 4. R√©cup√©ration automatique du Nom et du Support
    // Il prend ce qui est √©crit dans la balise <title> tout en haut
    let nomPage = document.title;
    
    // S√©curit√© : si tu as oubli√© le titre, il prend le nom du fichier (ex: index.html)
    if (!nomPage || nomPage === "") {
        nomPage = window.location.pathname.split("/").pop();
    }

    // D√©tection Mobile ou Ordinateur
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    const support = isMobile ? "Mobile" : "Ordinateur";

    // 5. Envoi vers Firebase
    async function envoyerLaVisite() {
        try {
            await addDoc(collection(db, "statistiques_usage"), {
                page: nomPage,
                device: support,
                timestamp: serverTimestamp(), // Enregistre l'heure exacte pour tes stats Jour/Nuit
                date: new Date().toISOString()
            });
            console.log("üöÄ Statistique envoy√©e : " + nomPage + " (" + support + ")");
        } catch (e) {
            console.error("Erreur lors de l'envoi de la stat :", e);
        }
    }

    // Ex√©cution imm√©diate au chargement de la page
    envoyerLaVisite();
</script>
</body>
</html>
