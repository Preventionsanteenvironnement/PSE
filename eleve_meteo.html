<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ma MÃ©tÃ©o CPS</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f8f9fa; text-align: center; padding: 20px; color: #333; max-width: 500px; margin: 0 auto; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 15px; text-align: left; }
        h3 { margin: 0 0 15px 0; color: #444; font-size: 1.1rem; display: flex; align-items: center; }
        .icon-title { margin-right: 10px; font-size: 1.2rem; }

        /* BATTERIE (Ton ancien design) */
        input[type=range] { width: 100%; height: 8px; border-radius: 5px; background: #ddd; outline: none; -webkit-appearance: none; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; width: 24px; height: 24px; border-radius: 50%; background: #2ecc71; cursor: pointer; border: 2px solid white; box-shadow: 0 1px 3px rgba(0,0,0,0.3); }
        #energie-val { float: right; font-weight: bold; color: #2ecc71; }

        /* MÃ‰TÃ‰O */
        .emoji-scroll { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; justify-content: space-between; }
        .emoji-btn { font-size: 28px; background: #f4f4f4; border-radius: 50%; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; cursor: pointer; flex-shrink: 0; border: 2px solid transparent; transition: 0.2s; }
        .emoji-btn.selected { border-color: #3498db; background: #e3f2fd; transform: scale(1.1); }

        /* POSTURE (Ton ancien design) */
        .social-btn { display: block; width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #eee; border-radius: 8px; background: white; color: #555; text-align: left; transition: 0.2s; cursor: pointer; }
        .social-btn.selected { background: #333; color: white; border-color: #333; }
        .subtext { font-size: 0.8em; display: block; opacity: 0.7; font-weight: normal; margin-top: 2px; }

        /* NOUVEAU : LES DÃ‰FIS */
        .defi-item { background: #f1f8e9; padding: 10px; border-radius: 8px; margin-bottom: 8px; cursor: pointer; border: 2px solid transparent; font-size: 0.95rem; display: flex; align-items: center;}
        .defi-item.selected { background: #c8e6c9; border-color: #2e7d32; font-weight: bold; }
        .defi-icon { margin-right: 10px; font-size: 1.2rem; }

        /* BOUTON ENVOI */
        #send-btn { background: #2ecc71; color: white; padding: 15px; border: none; border-radius: 12px; font-size: 18px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; box-shadow: 0 4px 6px rgba(46, 204, 113, 0.3); }
        #pseudo { width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="form-screen">
        <div class="card">
            <h3>ğŸ‘¤ Qui es-tu ?</h3>
            <input type="text" id="pseudo" placeholder="Ton PrÃ©nom">
        </div>

        <div class="card">
            <h3>ğŸ”‹ Ton Ã‰nergie <span id="energie-val">70%</span></h3>
            <input type="range" id="range-energie" min="0" max="100" value="70" oninput="updateEnergie(this.value)">
        </div>

        <div class="card">
            <h3>â›… Ta MÃ©tÃ©o</h3>
            <div class="emoji-scroll">
                <div class="emoji-btn" onclick="selectEmoji(this, 'ğŸ¤©')">ğŸ¤©</div>
                <div class="emoji-btn" onclick="selectEmoji(this, 'ğŸ™‚')">ğŸ™‚</div>
                <div class="emoji-btn" onclick="selectEmoji(this, 'ğŸ˜')">ğŸ˜</div>
                <div class="emoji-btn" onclick="selectEmoji(this, 'ğŸ˜´')">ğŸ˜´</div>
                <div class="emoji-btn" onclick="selectEmoji(this, 'ğŸ˜¡')">ğŸ˜¡</div>
            </div>
        </div>

        <div class="card">
            <h3>ğŸ¯ Ton Besoin (Posture)</h3>
            <div class="social-btn" id="btn-solo" onclick="selectSocial('solo')">ğŸ§ Solo <span class="subtext">Concentration max</span></div>
            <div class="social-btn" id="btn-help" onclick="selectSocial('help')">ğŸ¤ Entraide <span class="subtext">Besoin d'un coup de main</span></div>
            <div class="social-btn" id="btn-talk" onclick="selectSocial('talk')">ğŸ—£ï¸ Oral <span class="subtext">Je veux participer</span></div>
        </div>

        <div class="card">
            <h3>ğŸš€ Mon DÃ©fi du cours</h3>
            <div class="defi-item" onclick="selectDefi(this, 'Je lÃ¨ve la main pour demander de l\'aide')"><span class="defi-icon">âœ‹</span>Je lÃ¨ve la main pour l'aide</div>
            <div class="defi-item" onclick="selectDefi(this, 'Je me mets au travail sans attendre')"><span class="defi-icon">ğŸš€</span>Je dÃ©marre sans attendre</div>
            <div class="defi-item" onclick="selectDefi(this, 'J\'Ã©coute la consigne jusqu\'au bout')"><span class="defi-icon">ğŸ‘‚</span>J'Ã©coute la consigne</div>
            <div class="defi-item" onclick="selectDefi(this, 'Je reste concentrÃ©(e) sur mon exercice')"><span class="defi-icon">ğŸ¯</span>Je reste concentrÃ©(e)</div>
            <div class="defi-item" onclick="selectDefi(this, 'Je corrige mon attitude dÃ¨s la 1Ã¨re remarque')"><span class="defi-icon">âš¡</span>Je corrige mon attitude</div>
            <div class="defi-item" onclick="selectDefi(this, 'Je reste zen et positif(ve)')"><span class="defi-icon">ğŸ§˜</span>Je reste zen et positif(ve)</div>
        </div>

        <button id="send-btn" onclick="envoyer()">Valider</button>
    </div>

    <div id="success-screen" class="hidden" style="margin-top:50px;">
        <h1 style="font-size:3rem;">ğŸ‘</h1>
        <h2>C'est notÃ© !</h2>
        <p>Regarde le tableau du prof.</p>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // TA CLÃ‰ CORRIGÃ‰E
        const firebaseConfig = {
            apiKey: "AIzaSyAWdCMvOiAJln3eT9LIAQD3RWJUD0lQcLI",
            authDomain: "devoirs-pse.firebaseapp.com",
            projectId: "devoirs-pse",
            storageBucket: "devoirs-pse.firebasestorage.app",
            messagingSenderId: "614730413904",
            appId: "1:614730413904:web:a5dd478af5de30f6bede55",
            measurementId: "G-7R9N0JL6GG"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let selectedEmo = "";
        let selectedSoc = "";
        let selectedDefi = "";

        window.updateEnergie = (val) => {
            document.getElementById("energie-val").innerText = val + "%";
            // Changement couleur dynamique
            const color = val < 30 ? "#e74c3c" : (val < 60 ? "#f1c40f" : "#2ecc71");
            document.getElementById("energie-val").style.color = color;
        }

        window.selectEmoji = (el, emoji) => {
            document.querySelectorAll('.emoji-btn').forEach(b => b.classList.remove('selected'));
            el.classList.add('selected');
            selectedEmo = emoji;
        }

        window.selectSocial = (type) => {
            document.querySelectorAll('.social-btn').forEach(b => b.classList.remove('selected'));
            document.getElementById('btn-'+type).classList.add('selected');
            selectedSoc = type;
        }

        window.selectDefi = (el, text) => {
            document.querySelectorAll('.defi-item').forEach(b => b.classList.remove('selected'));
            el.classList.add('selected');
            selectedDefi = text;
        }

        window.envoyer = async function() {
            const pseudo = document.getElementById("pseudo").value;
            const energie = document.getElementById("range-energie").value;

            if(!pseudo) return alert("Mets ton prÃ©nom !");
            if(!selectedEmo) return alert("Choisis ta mÃ©tÃ©o !");
            if(!selectedDefi) return alert("Choisis un dÃ©fi !");

            const btn = document.getElementById("send-btn");
            btn.innerText = "Envoi...";
            btn.disabled = true;

            try {
                // On envoie tout dans la collection "meteo_finale"
                await addDoc(collection(db, "meteo_finale"), {
                    pseudo: pseudo,
                    energie: energie,
                    emotion: selectedEmo,
                    social: selectedSoc || "solo", // Par dÃ©faut solo si pas choisi
                    defi: selectedDefi,
                    timestamp: Date.now()
                });
                document.getElementById("form-screen").classList.add("hidden");
                document.getElementById("success-screen").classList.remove("hidden");
            } catch (e) {
                alert("Erreur API : " + e.message);
                btn.disabled = false;
                btn.innerText = "RÃ©essayer";
            }
        }
    </script>
</body>
</html>