<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ma M√©t√©o CPS</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f8f9fa; text-align: center; padding: 20px; color: #333; max-width: 500px; margin: 0 auto; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 15px; text-align: left; }
        h3 { margin: 0 0 15px 0; color: #444; font-size: 1.1rem; display: flex; align-items: center; }
        .icon-title { margin-right: 10px; font-size: 1.2rem; }

        /* SURNOM */
        input[type="text"] { width: 100%; padding: 12px; border: 2px solid #eee; border-radius: 8px; font-size: 16px; box-sizing: border-box; }

        /* SLIDER BATTERIE */
        input[type=range] { width: 100%; height: 8px; border-radius: 5px; background: #ddd; outline: none; -webkit-appearance: none; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; width: 24px; height: 24px; border-radius: 50%; background: #2ecc71; cursor: pointer; border: 2px solid white; box-shadow: 0 1px 3px rgba(0,0,0,0.3); }
        #energie-val { float: right; font-weight: bold; color: #2ecc71; }

        /* EMOJIS */
        .emoji-scroll { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; }
        .emoji-btn { font-size: 28px; background: #f4f4f4; border-radius: 50%; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; cursor: pointer; flex-shrink: 0; border: 2px solid transparent; transition: 0.2s; }
        .emoji-btn.selected { border-color: #3498db; background: #e3f2fd; transform: scale(1.1); }

        /* POSTURE */
        .social-btn { display: block; width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #eee; border-radius: 8px; background: white; color: #555; text-align: left; transition: 0.2s; cursor: pointer; }
        .social-btn:active { transform: scale(0.98); }
        .social-btn.selected { background: #333; color: white; border-color: #333; }
        .subtext { font-size: 0.8em; display: block; opacity: 0.7; font-weight: normal; margin-top: 2px; }

        /* BOUTON ENVOI */
        #send-btn { background: #2ecc71; color: white; padding: 15px; border: none; border-radius: 12px; font-size: 18px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; box-shadow: 0 4px 6px rgba(46, 204, 113, 0.3); }
        
        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="form-screen">
        <div style="margin-bottom: 20px;">
            <h1 style="margin:0; font-size:1.5rem;">Check-in CPS üöÄ</h1>
            <p style="margin:5px 0; color:#888; font-size:0.9rem;">Pr√™t pour le cours ?</p>
        </div>

        <div class="card">
            <h3><span class="icon-title">üë§</span> Qui es-tu ?</h3>
            <input type="text" id="pseudo" placeholder="Ton Surnom ou Initiales (ex: Mike)">
        </div>

        <div class="card">
            <h3><span class="icon-title">üîã</span> Ton √ânergie <span id="energie-val">70%</span></h3>
            <input type="range" id="range-energie" min="0" max="100" value="70" oninput="updateEnergie(this.value)">
        </div>

        <div class="card">
            <h3><span class="icon-title">‚õÖ</span> Ta M√©t√©o</h3>
            <div class="emoji-scroll">
                <div class="emoji-btn" onclick="selectEmoji(this, 'ü§©')">ü§©</div>
                <div class="emoji-btn" onclick="selectEmoji(this, 'üôÇ')">üôÇ</div>
                <div class="emoji-btn" onclick="selectEmoji(this, 'üòê')">üòê</div>
                <div class="emoji-btn" onclick="selectEmoji(this, 'ü•±')">ü•±</div>
                <div class="emoji-btn" onclick="selectEmoji(this, 'ü§Ø')">ü§Ø</div>
                <div class="emoji-btn" onclick="selectEmoji(this, 'üò°')">üò°</div>
                <div class="emoji-btn" onclick="selectEmoji(this, 'üò∞')">üò∞</div>
            </div>
        </div>

        <div class="card">
            <h3><span class="icon-title">üéØ</span> Ton Besoin</h3>
            <div class="social-btn" id="btn-solo" onclick="selectSocial('solo')">
                üéß Focus Solo
                <span class="subtext">J'ai besoin de calme pour me concentrer.</span>
            </div>
            <div class="social-btn" id="btn-help" onclick="selectSocial('help')">
                ü§ù Entraide / Duo
                <span class="subtext">Je veux travailler avec quelqu'un.</span>
            </div>
            <div class="social-btn" id="btn-talk" onclick="selectSocial('talk')">
                üó£Ô∏è Participation
                <span class="subtext">Je suis chaud pour participer √† l'oral !</span>
            </div>
        </div>

        <button id="send-btn" onclick="envoyer()">Envoyer</button>
    </div>

    <div id="success-screen" class="hidden" style="margin-top:100px;">
        <h1 style="font-size:3rem;">üëç</h1>
        <h2>Bien re√ßu !</h2>
        <p>Regarde le tableau pour voir la tendance de la classe.</p>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyAWdCMvOiAJln3eT9LIAQD3RWJUD0lQcLI",
            authDomain: "devoirs-pse.firebaseapp.com",
            projectId: "devoirs-pse",
            storageBucket: "devoirs-pse.firebasestorage.app",
            messagingSenderId: "614730413904",
            appId: "1:614730413904:web:a5dd478af5de30f6bede55",
            measurementId: "G-7R9N0JL6GG"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let selectedEmo = "";
        let selectedSoc = "";

        window.updateEnergie = (val) => {
            document.getElementById("energie-val").innerText = val + "%";
            const color = val < 30 ? "#e74c3c" : (val < 60 ? "#f1c40f" : "#2ecc71");
            document.getElementById("energie-val").style.color = color;
        }

        window.selectEmoji = (el, emoji) => {
            document.querySelectorAll('.emoji-btn').forEach(b => b.classList.remove('selected'));
            el.classList.add('selected');
            selectedEmo = emoji;
        }

        window.selectSocial = (type) => {
            document.querySelectorAll('.social-btn').forEach(b => b.classList.remove('selected'));
            document.getElementById('btn-'+type).classList.add('selected');
            selectedSoc = type;
        }

        window.envoyer = async function() {
            const pseudo = document.getElementById("pseudo").value;
            const energie = document.getElementById("range-energie").value;

            if(!pseudo) return alert("Mets au moins un surnom ou tes initiales !");
            if(!selectedEmo) return alert("Choisis ta m√©t√©o !");
            if(!selectedSoc) return alert("Choisis ta posture !");

            const btn = document.getElementById("send-btn");
            btn.innerText = "Envoi...";
            btn.disabled = true;

            try {
                await addDoc(collection(db, "meteo_classe"), {
                    pseudo: pseudo,
                    energie: energie,
                    emotion: selectedEmo,
                    social: selectedSoc,
                    timestamp: Date.now()
                });
                document.getElementById("form-screen").classList.add("hidden");
                document.getElementById("success-screen").classList.remove("hidden");
            } catch (e) {
                alert("Erreur : " + e.message);
                btn.innerText = "R√©essayer";
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
