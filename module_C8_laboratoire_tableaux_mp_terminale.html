<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module C.8 - Laboratoire Virtuel Tableaux MP - Bac Pro Terminale</title>
    <style>
        /* RESPONSIVE MOBILE-FIRST OBLIGATOIRE */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        /* Variables CSS - Charte graphique unifi√©e PSE */
        :root {
            --primary-pse: #2E86AB;
            --secondary-pse: #A23B72;
            --success-pse: #219653;
            --warning-pse: #F2994A;
            --danger-pse: #EB5757;
            --dark-pse: #2F3542;
            --light-pse: #F1F2F6;
        }

        /* ACCESSIBILIT√â - Police OpenDyslexie */
        @import url('https://fonts.googleapis.com/css2?family=OpenDyslexic:wght@400;700&display=swap');
        
        .dyslexie-mode {
            font-family: 'OpenDyslexic', sans-serif !important;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--dark-pse);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-size: 16px;
        }

        .exercice-container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* EN-T√äTE P√âDAGOGIQUE OBLIGATOIRE */
        .cadre-pedagogique {
            background: linear-gradient(135deg, var(--primary-pse), var(--secondary-pse));
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(46, 134, 171, 0.3);
        }

        .module-info h2 {
            font-size: 1.8em;
            margin-bottom: 15px;
            font-weight: 700;
            text-align: center;
        }

        .objectif {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            text-align: center;
        }

        .competences-travaillees {
            margin-bottom: 15px;
        }

        .competences-list {
            list-style: none;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .competences-list li {
            background: rgba(255, 255, 255, 0.15);
            padding: 10px;
            border-radius: 8px;
            backdrop-filter: blur(5px);
        }

        .competence-c1 { border-left: 5px solid #E74C3C; }
        .competence-c2 { border-left: 5px solid #3498DB; }
        .competence-c3 { border-left: 5px solid #2ECC71; }

        .niveau-cible {
            text-align: center;
            font-weight: 600;
            font-size: 1.1em;
        }

        /* LABORATOIRE LAYOUT */
        .labo-container {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            margin: 30px 0;
        }

        .zone-manipulation {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            min-height: 600px;
        }

        .zone-tableaux {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            max-height: 600px;
            overflow-y: auto;
        }

        /* TABLEAUX MP OFFICIELS */
        .tableau-mp {
            background: #f8f9fa;
            border: 2px solid var(--primary-pse);
            border-radius: 10px;
            margin: 15px 0;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .tableau-mp:hover {
            box-shadow: 0 5px 15px rgba(46, 134, 171, 0.2);
        }

        .tableau-header {
            background: var(--primary-pse);
            color: white;
            padding: 12px;
            font-weight: 600;
            text-align: center;
        }

        .tableau-content {
            overflow-x: auto;
        }

        .tableau-mp table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85em;
        }

        .tableau-mp th,
        .tableau-mp td {
            border: 1px solid #dee2e6;
            padding: 8px;
            text-align: left;
            vertical-align: top;
        }

        .tableau-mp th {
            background: var(--light-pse);
            font-weight: 600;
            font-size: 0.8em;
        }

        .tableau-mp td {
            font-size: 0.75em;
            line-height: 1.3;
        }

        /* CAS D'ANALYSE */
        .cas-analyse {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border-left: 5px solid var(--warning-pse);
        }

        .cas-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .cas-numero {
            background: var(--warning-pse);
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-weight: 600;
            font-size: 0.9em;
        }

        .cas-profil {
            font-style: italic;
            color: var(--dark-pse);
        }

        /* ZONE DE RECHERCHE */
        .zone-recherche {
            background: rgba(46, 134, 171, 0.05);
            border: 2px dashed var(--primary-pse);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            min-height: 120px;
            transition: all 0.3s ease;
        }

        .zone-recherche.active {
            background: rgba(33, 150, 83, 0.1);
            border-color: var(--success-pse);
        }

        .zone-recherche.error {
            background: rgba(235, 87, 87, 0.1);
            border-color: var(--danger-pse);
        }

        /* √âL√âMENTS DRAGGABLES */
        .element-draggable {
            background: var(--primary-pse);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            margin: 5px;
            cursor: grab;
            display: inline-block;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .element-draggable:hover {
            background: var(--secondary-pse);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .element-draggable:active {
            cursor: grabbing;
            transform: scale(0.95);
        }

        .element-draggable.dropped {
            background: var(--success-pse);
        }

        /* RESULTATS ANALYSE */
        .resultat-analyse {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 5px solid var(--success-pse);
            display: none;
        }

        .resultat-analyse.show {
            display: block;
            animation: slideIn 0.5s ease-in-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* BOUTONS */
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
            margin: 5px;
        }

        .btn-primary {
            background: var(--primary-pse);
            color: white;
        }

        .btn-success {
            background: var(--success-pse);
            color: white;
        }

        .btn-warning {
            background: var(--warning-pse);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        /* ACCESSIBILIT√â */
        .speech-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 50px;
            padding: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            z-index: 1000;
            display: flex;
            gap: 10px;
        }

        .speech-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            background: var(--primary-pse);
            color: white;
            cursor: pointer;
            font-size: 1.2em;
            transition: all 0.3s ease;
        }

        .speech-btn:hover {
            background: var(--secondary-pse);
            transform: scale(1.1);
        }

        /* AUDIO DISCRET */
        .audio-btn {
            display: inline-block;
            width: 18px;
            height: 18px;
            background: var(--primary-pse);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0.6em;
            margin-left: 6px;
            vertical-align: middle;
            transition: all 0.2s ease;
            opacity: 0.5;
            line-height: 1;
        }

        .audio-btn:hover {
            opacity: 1;
            background: var(--secondary-pse);
            transform: scale(1.2);
        }

        .audio-btn.playing {
            background: var(--success-pse);
            opacity: 1;
            animation: pulse 0.8s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.1); opacity: 1; }
        }

        /* PROGRESSION */
        .progression-labo {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .progress-bar {
            background: #e9ecef;
            border-radius: 25px;
            height: 12px;
            margin: 15px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success-pse), var(--primary-pse));
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 25px;
        }

        /* RESPONSIVE */
        @media (max-width: 1024px) {
            .labo-container {
                grid-template-columns: 1fr;
            }
            
            .zone-tableaux {
                order: -1;
                max-height: 400px;
            }
        }

        /* RGPD FOOTER */
        .rgpd-notice {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 8px;
            font-size: 0.9em;
            color: #6c757d;
            text-align: center;
            margin-top: 30px;
        }

        /* HIGHLIGHT RECHERCHE */
        .highlight {
            background: yellow !important;
            font-weight: bold;
        }

        .highlight-correct {
            background: rgba(33, 150, 83, 0.3) !important;
            border: 2px solid var(--success-pse) !important;
        }

        .highlight-incorrect {
            background: rgba(235, 87, 87, 0.3) !important;
            border: 2px solid var(--danger-pse) !important;
        }
    </style>
</head>
<body>
    <div class="exercice-container">
        <!-- EN-T√äTE P√âDAGOGIQUE OBLIGATOIRE -->
        <div class="cadre-pedagogique">
            <div class="module-info">
                <h2>üß™ Module C.8 : Laboratoire Virtuel Tableaux MP</h2>
                <div class="objectif">
                    <strong>Objectif :</strong> Manipuler et analyser les tableaux officiels MP pour reconna√Ætre les maladies professionnelles
                </div>
            </div>
            
            <div class="competences-travaillees">
                <h3>Comp√©tences travaill√©es dans cet exercice :</h3>
                <ul class="competences-list">
                    <li class="competence-c1"><strong>C1</strong> - Traiter une information</li>
                    <li class="competence-c2"><strong>C2</strong> - Appliquer une d√©marche d'analyse dans une situation donn√©e</li>
                    <li class="competence-c3"><strong>C3</strong> - Expliquer un ph√©nom√®ne en lien avec une mesure de pr√©vention</li>
                </ul>
            </div>
            
            <div class="niveau-cible">
                <strong>Niveau :</strong> Bac Pro Terminale
            </div>
        </div>

        <!-- CONTR√îLES D'ACCESSIBILIT√â -->
        <div class="speech-controls">
            <button class="speech-btn" id="playBtn" title="Lire le contenu" onclick="toggleSpeech()">üîä</button>
            <button class="speech-btn" id="dyslexieBtn" title="Police OpenDyslexie" onclick="toggleDyslexieFont()">üëÅ</button>
        </div>

        <!-- PROGRESSION DU LABORATOIRE -->
        <div class="progression-labo">
            <h3 style="color: var(--dark-pse); margin-bottom: 15px;">
                üî¨ Progression du laboratoire
            </h3>
            <div id="progress-text">√âtape 1/4 : D√©couverte des tableaux MP</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <div style="margin-top: 15px;">
                <span class="btn btn-primary" id="next-step" onclick="nextStep()">Commencer l'analyse</span>
            </div>
        </div>

        <!-- LABORATOIRE PRINCIPAL -->
        <div class="labo-container">
            <!-- ZONE DE MANIPULATION -->
            <div class="zone-manipulation">
                <h3 style="color: var(--dark-pse); margin-bottom: 20px;" id="manipulation-title">
                    üîç Phase de d√©couverte
                    <button class="audio-btn" onclick="lireAudio('phase')" title="√âcouter cette phase">üîä</button>
                </h3>
                
                <div id="manipulation-content">
                    <div class="cas-analyse">
                        <div class="cas-header">
                            <div class="cas-numero">Introduction</div>
                        </div>
                        <p><strong>Bienvenue dans le laboratoire virtuel des tableaux MP !</strong></p>
                        <p>Vous allez apprendre √† utiliser les tableaux officiels de maladies professionnelles pour analyser des cas concrets d'exposition.</p>
                        <p><strong>üìã Objectifs du laboratoire :</strong></p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>Comprendre la structure des tableaux MP</li>
                            <li>Rechercher efficacement dans les colonnes</li>
                            <li>V√©rifier les crit√®res de reconnaissance</li>
                            <li>Analyser des cas limites et exceptions</li>
                        </ul>
                        
                        <div style="margin-top: 20px; padding: 15px; background: rgba(255, 255, 255, 0.5); border-radius: 8px;">
                            <strong>üí° Conseil d'expert :</strong> Les tableaux MP sont des outils juridiques pr√©cis. 
                            Chaque colonne a une importance cruciale pour la reconnaissance !
                        </div>
                    </div>
                </div>
            </div>

            <!-- ZONE TABLEAUX MP -->
            <div class="zone-tableaux">
                <h4 style="color: var(--dark-pse); margin-bottom: 15px;">
                    üìä Tableaux MP Officiels
                    <button class="audio-btn" onclick="lireAudio('tableaux')" title="√âcouter pr√©sentation tableaux">üîä</button>
                </h4>
                
                <!-- TABLEAU 65 - ECZ√âMA -->
                <div class="tableau-mp" id="tableau65">
                    <div class="tableau-header">
                        TABLEAU 65 - L√©sions ecz√©matiformes de m√©canisme allergique
                    </div>
                    <div class="tableau-content">
                        <table>
                            <thead>
                                <tr>
                                    <th>D√âSIGNATION<br>DES MALADIES</th>
                                    <th>D√âLAI<br>DE PRISE EN CHARGE</th>
                                    <th>LISTE LIMITATIVE DES<br>TRAVAUX SUSCEPTIBLES<br>DE PROVOQUER CES MALADIES</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>L√©sions ecz√©matiformes</strong><br>r√©cidivant en cas de<br>nouvelle exposition<br>au risque</td>
                                    <td><strong>7 jours</strong><br>(sous r√©serve d'une<br>dur√©e d'exposition<br>de 15 jours)</td>
                                    <td>‚Ä¢ Pr√©paration, emploi, manipulation de :<br>- Solvants organiques<br>- Peintures<br>- Vernis<br>- Colles<br>- Produits de nettoyage<br>‚Ä¢ Travaux exposant aux r√©sines √©poxy<br>‚Ä¢ Travaux de coiffure</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- TABLEAU 57 - AMIANTE -->
                <div class="tableau-mp" id="tableau57">
                    <div class="tableau-header">
                        TABLEAU 57 - Affections respiratoires li√©es √† l'inhalation
                    </div>
                    <div class="tableau-content">
                        <table>
                            <thead>
                                <tr>
                                    <th>D√âSIGNATION<br>DES MALADIES</th>
                                    <th>D√âLAI<br>DE PRISE EN CHARGE</th>
                                    <th>LISTE LIMITATIVE DES<br>TRAVAUX SUSCEPTIBLES<br>DE PROVOQUER CES MALADIES</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Asthme objectiv√©</strong><br>par explorations<br>fonctionnelles<br>respiratoires</td>
                                    <td><strong>7 ans</strong><br>(sous r√©serve d'une<br>dur√©e d'exposition<br>de 5 ans)</td>
                                    <td>‚Ä¢ Travaux exposant aux poussi√®res :<br>- Farine et c√©r√©ales<br>- Bois (menuiserie, √©b√©nisterie)<br>- Latex naturel<br>‚Ä¢ Travaux de boulangerie<br>‚Ä¢ Travaux v√©t√©rinaires<br>‚Ä¢ Travaux de laboratoire</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- TABLEAU 98 - RACHIS -->
                <div class="tableau-mp" id="tableau98">
                    <div class="tableau-header">
                        TABLEAU 98 - Affections chroniques du rachis lombaire
                    </div>
                    <div class="tableau-content">
                        <table>
                            <thead>
                                <tr>
                                    <th>D√âSIGNATION<br>DES MALADIES</th>
                                    <th>D√âLAI<br>DE PRISE EN CHARGE</th>
                                    <th>LISTE LIMITATIVE DES<br>TRAVAUX SUSCEPTIBLES<br>DE PROVOQUER CES MALADIES</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Sciatique par hernie<br>discale lombaire</strong><br>avec troubles<br>neurologiques</td>
                                    <td><strong>6 mois</strong><br>(sous r√©serve d'une<br>dur√©e d'exposition<br>de 5 ans)</td>
                                    <td>‚Ä¢ Manutention manuelle de charges :<br>- Port de charges ‚â• 15 kg<br>- Charges cumul√©es ‚â• 7,5 tonnes/jour<br>‚Ä¢ Postures contraignantes :<br>- Flexions/torsions du tronc<br>- Position accroupie<br>‚Ä¢ Conduite d'engins vibrants</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- RGPD FOOTER -->
        <div class="rgpd-notice">
            <p>üîí <strong>Conformit√© RGPD :</strong> Cet exercice respecte votre anonymat.</p>
        </div>
    </div>

    <script>
        // VARIABLES GLOBALES
        let etapeActuelle = 1;
        let totalEtapes = 4;
        let score = 0;
        let maxScore = 0;

        // CAS D'ANALYSE √Ä TRAITER
        const casAnalyse = [
            {
                id: 1,
                nom: "Marie",
                age: 28,
                profession: "Coiffeuse",
                probleme: "Ecz√©ma des mains depuis 3 mois",
                exposition: "Shampoings, colorations, permanentes",
                dureeExposition: "2 ans",
                arretTravail: "5 jours apr√®s apparition",
                tableauCorrect: "tableau65",
                criteres: {
                    maladie: "L√©sions ecz√©matiformes",
                    delai: "7 jours",
                    travaux: "Travaux de coiffure"
                },
                reconnaissance: true
            },
            {
                id: 2,
                nom: "Thomas",
                age: 45,
                profession: "Menuisier",
                probleme: "Asthme et difficult√©s respiratoires",
                exposition: "Poussi√®res de bois (ch√™ne, h√™tre)",
                dureeExposition: "8 ans",
                arretTravail: "1 an apr√®s d√©but des sympt√¥mes",
                tableauCorrect: "tableau57",
                criteres: {
                    maladie: "Asthme objectiv√©",
                    delai: "7 ans",
                    travaux: "Bois (menuiserie)"
                },
                reconnaissance: true
            },
            {
                id: 3,
                nom: "Sophie",
                age: 38,
                profession: "Aide-soignante",
                probleme: "Sciatique avec hernie discale",
                exposition: "Port de patients (soul√®vements r√©p√©t√©s)",
                dureeExposition: "6 ans",
                arretTravail: "3 mois apr√®s diagnostic",
                tableauCorrect: "tableau98",
                criteres: {
                    maladie: "Sciatique par hernie discale",
                    delai: "6 mois",
                    travaux: "Port de charges ‚â• 15 kg"
                },
                reconnaissance: true
            },
            {
                id: 4,
                nom: "Laurent",
                age: 52,
                profession: "Comptable",
                probleme: "Troubles musculo-squelettiques poignet",
                exposition: "Travail sur ordinateur",
                dureeExposition: "15 ans",
                arretTravail: "Imm√©diat",
                tableauCorrect: "aucun",
                criteres: {},
                reconnaissance: false
            }
        ];

        let casActuel = 0;

        // √âTAPES DU LABORATOIRE
        const etapes = [
            {
                titre: "üîç Phase de d√©couverte",
                contenu: "introduction"
            },
            {
                titre: "üß™ Analyse de cas - Marie (Coiffeuse)",
                contenu: "analyse"
            },
            {
                titre: "üî¨ Recherche dans les tableaux",
                contenu: "recherche"
            },
            {
                titre: "üìä Synth√®se et validation",
                contenu: "synthese"
            }
        ];

        // INITIALISATION
        document.addEventListener('DOMContentLoaded', function() {
            mettreAJourProgression();
        });

        // NAVIGATION ENTRE √âTAPES
        function nextStep() {
            if (etapeActuelle < totalEtapes) {
                etapeActuelle++;
                mettreAJourProgression();
                afficherEtape();
            }
        }

        function mettreAJourProgression() {
            const progression = ((etapeActuelle - 1) / (totalEtapes - 1)) * 100;
            document.getElementById('progress-fill').style.width = progression + '%';
            
            const texteProgression = `√âtape ${etapeActuelle}/${totalEtapes} : ${etapes[etapeActuelle - 1].titre.replace('üîç ', '').replace('üß™ ', '').replace('üî¨ ', '').replace('üìä ', '')}`;
            document.getElementById('progress-text').textContent = texteProgression;
            
            // Bouton suivant
            const btnNext = document.getElementById('next-step');
            if (etapeActuelle === totalEtapes) {
                btnNext.textContent = 'Terminer le laboratoire';
                btnNext.onclick = terminerLabo;
            } else if (etapeActuelle === 1) {
                btnNext.textContent = 'Commencer l\'analyse';
            } else {
                btnNext.textContent = '√âtape suivante';
            }
        }

        function afficherEtape() {
            const titre = document.getElementById('manipulation-title');
            const contenu = document.getElementById('manipulation-content');
            
            titre.innerHTML = etapes[etapeActuelle - 1].titre + 
                `<button class="audio-btn" onclick="lireAudio('etape${etapeActuelle}')" title="√âcouter cette √©tape">üîä</button>`;
            
            switch(etapeActuelle) {
                case 2:
                    afficherAnalyseCas();
                    break;
                case 3:
                    afficherRecherche();
                    break;
                case 4:
                    afficherSynthese();
                    break;
                default:
                    // √âtape 1 d√©j√† affich√©e
                    break;
            }
        }

        // √âTAPE 2 : ANALYSE DE CAS
        function afficherAnalyseCas() {
            const cas = casAnalyse[casActuel];
            const contenu = document.getElementById('manipulation-content');
            
            contenu.innerHTML = `
                <div class="cas-analyse">
                    <div class="cas-header">
                        <div class="cas-numero">Cas ${cas.id}</div>
                        <div class="cas-profil">${cas.nom}, ${cas.age} ans</div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 15px 0;">
                        <div>
                            <strong>üë§ Profil professionnel :</strong>
                            <ul style="margin: 10px 0 10px 20px;">
                                <li><strong>M√©tier :</strong> ${cas.profession}</li>
                                <li><strong>Exposition :</strong> ${cas.exposition}</li>
                                <li><strong>Dur√©e :</strong> ${cas.dureeExposition}</li>
                            </ul>
                        </div>
                        <div>
                            <strong>üè• Probl√®me de sant√© :</strong>
                            <ul style="margin: 10px 0 10px 20px;">
                                <li><strong>Sympt√¥mes :</strong> ${cas.probleme}</li>
                                <li><strong>D√©claration :</strong> ${cas.arretTravail}</li>
                            </ul>
                        </div>
                    </div>
                    <div style="background: rgba(255, 255, 255, 0.7); padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <strong>üîç Votre mission :</strong> Analysez ce cas pour d√©terminer s'il peut √™tre reconnu comme maladie professionnelle.
                        <br><strong>M√©thode :</strong> Examinez les tableaux MP √† droite et identifiez les correspondances.
                    </div>
                </div>
                
                <div class="zone-recherche" id="zone-recherche">
                    <h4>üéØ Zone d'analyse</h4>
                    <p>Glissez ici les √©l√©ments que vous trouvez dans les tableaux MP correspondant au cas de ${cas.nom}</p>
                    <div id="elements-deposes" style="margin-top: 15px;"></div>
                </div>
                
                <div style="margin-top: 20px;">
                    <h5>üìã √âl√©ments √† rechercher dans les tableaux :</h5>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin: 15px 0;">
                        <div class="element-draggable" draggable="true" data-type="maladie" data-value="${cas.criteres.maladie || 'Non trouv√©'}">
                            Maladie : ${cas.criteres.maladie || 'Non trouv√©'}
                        </div>
                        <div class="element-draggable" draggable="true" data-type="delai" data-value="${cas.criteres.delai || 'Non applicable'}">
                            D√©lai : ${cas.criteres.delai || 'Non applicable'}
                        </div>
                        <div class="element-draggable" draggable="true" data-type="travaux" data-value="${cas.criteres.travaux || 'Non r√©pertori√©'}">
                            Travaux : ${cas.criteres.travaux || 'Non r√©pertori√©'}
                        </div>
                    </div>
                </div>
            `;
            
            // Ajouter les event listeners pour le drag & drop
            initDragAndDrop();
        }

        // DRAG & DROP
        function initDragAndDrop() {
            const draggables = document.querySelectorAll('.element-draggable');
            const zoneRecherche = document.getElementById('zone-recherche');
            
            draggables.forEach(draggable => {
                draggable.addEventListener('dragstart', e => {
                    e.dataTransfer.setData('text/plain', draggable.dataset.type);
                    draggable.style.opacity = '0.5';
                });
                
                draggable.addEventListener('dragend', e => {
                    draggable.style.opacity = '1';
                });
            });
            
            zoneRecherche.addEventListener('dragover', e => {
                e.preventDefault();
                zoneRecherche.classList.add('active');
            });
            
            zoneRecherche.addEventListener('dragleave', e => {
                if (!zoneRecherche.contains(e.relatedTarget)) {
                    zoneRecherche.classList.remove('active');
                }
            });
            
            zoneRecherche.addEventListener('drop', e => {
                e.preventDefault();
                const type = e.dataTransfer.getData('text/plain');
                const draggable = document.querySelector(`[data-type="${type}"]`);
                
                if (draggable) {
                    // Ajouter l'√©l√©ment √† la zone
                    const elementDepose = document.createElement('div');
                    elementDepose.className = 'element-draggable dropped';
                    elementDepose.textContent = draggable.textContent;
                    
                    document.getElementById('elements-deposes').appendChild(elementDepose);
                    draggable.style.display = 'none';
                    
                    // V√©rifier si tous les √©l√©ments sont d√©pos√©s
                    const elementsRestants = document.querySelectorAll('.element-draggable:not([style*="none"])');
                    if (elementsRestants.length === 0) {
                        validerAnalyse();
                    }
                }
                
                zoneRecherche.classList.remove('active');
            });
        }

        function validerAnalyse() {
            const cas = casAnalyse[casActuel];
            const zoneRecherche = document.getElementById('zone-recherche');
            
            if (cas.reconnaissance) {
                zoneRecherche.classList.add('active');
                score++;
                
                // Highlight du tableau correct
                const tableauCorrect = document.getElementById(cas.tableauCorrect);
                if (tableauCorrect) {
                    tableauCorrect.classList.add('highlight-correct');
                }
                
                setTimeout(() => {
                    afficherResultatAnalyse(true);
                }, 1000);
            } else {
                zoneRecherche.classList.add('error');
                setTimeout(() => {
                    afficherResultatAnalyse(false);
                }, 1000);
            }
            
            maxScore++;
        }

        function afficherResultatAnalyse(reussi) {
            const cas = casAnalyse[casActuel];
            const contenu = document.getElementById('manipulation-content');
            
            const resultat = document.createElement('div');
            resultat.className = 'resultat-analyse show';
            
            if (reussi) {
                resultat.innerHTML = `
                    <h4 style="color: var(--success-pse);">‚úÖ Analyse correcte !</h4>
                    <p><strong>Le cas de ${cas.nom} est reconnaissable en MP</strong> selon le ${cas.tableauCorrect.replace('tableau', 'tableau n¬∞')}.</p>
                    <div style="margin: 15px 0;">
                        <strong>Crit√®res v√©rifi√©s :</strong>
                        <ul style="margin-left: 20px;">
                            <li>‚úÖ Maladie r√©pertori√©e : ${cas.criteres.maladie}</li>
                            <li>‚úÖ D√©lai respect√© : ${cas.criteres.delai}</li>
                            <li>‚úÖ Travaux list√©s : ${cas.criteres.travaux}</li>
                        </ul>
                    </div>
                `;
            } else {
                resultat.innerHTML = `
                    <h4 style="color: var(--danger-pse);">‚ùå Cas non reconnaissable</h4>
                    <p><strong>Le cas de ${cas.nom} ne peut pas √™tre reconnu en MP</strong> selon les tableaux actuels.</p>
                    <p><strong>Raison :</strong> Le travail de ${cas.profession.toLowerCase()} avec exposition √† "${cas.exposition}" 
                    ne figure dans aucun tableau MP pour ce type de pathologie.</p>
                    <div style="background: rgba(255, 193, 7, 0.1); padding: 10px; border-radius: 5px; margin: 10px 0;">
                        <strong>üí° Alternative :</strong> Possibilit√© d'un dossier CRRMP (hors tableau) si IP > 25%.
                    </div>
                `;
            }
            
            contenu.appendChild(resultat);
        }

        // √âTAPE 3 : RECHERCHE LIBRE
        function afficherRecherche() {
            const contenu = document.getElementById('manipulation-content');
            
            contenu.innerHTML = `
                <div class="cas-analyse">
                    <div class="cas-header">
                        <div class="cas-numero">Recherche guid√©e</div>
                    </div>
                    <p><strong>üîç Explorez librement les tableaux MP !</strong></p>
                    <p>Cliquez sur les √©l√©ments des tableaux pour les explorer et comprendre leur structure.</p>
                    
                    <div style="margin: 20px 0; padding: 15px; background: rgba(255, 255, 255, 0.7); border-radius: 8px;">
                        <strong>üéØ Points cl√©s √† retenir :</strong>
                        <ul style="margin: 10px 0 10px 20px;">
                            <li><strong>Colonne 1 :</strong> Description pr√©cise de la maladie</li>
                            <li><strong>Colonne 2 :</strong> D√©lai maximum + dur√©e d'exposition minimum</li>
                            <li><strong>Colonne 3 :</strong> Liste limitative des travaux exposants</li>
                        </ul>
                    </div>
                </div>
                
                <div style="margin: 20px 0;">
                    <h4>üí° Quiz rapide - Testez vos connaissances :</h4>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 15px 0;">
                        <p><strong>Question 1 :</strong> Quel est le d√©lai maximum pour d√©clarer un ecz√©ma professionnel ?</p>
                        <div style="margin: 10px 0;">
                            <button class="btn btn-primary" onclick="repondreQuiz(1, 'a', false)">A) 15 jours</button>
                            <button class="btn btn-primary" onclick="repondreQuiz(1, 'b', true)">B) 7 jours</button>
                            <button class="btn btn-primary" onclick="repondreQuiz(1, 'c', false)">C) 1 mois</button>
                        </div>
                        <div id="reponse1" style="display: none; margin-top: 10px;"></div>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 15px 0;">
                        <p><strong>Question 2 :</strong> Combien d'ann√©es d'exposition minimum pour une sciatique par hernie discale ?</p>
                        <div style="margin: 10px 0;">
                            <button class="btn btn-primary" onclick="repondreQuiz(2, 'a', false)">A) 2 ans</button>
                            <button class="btn btn-primary" onclick="repondreQuiz(2, 'b', true)">B) 5 ans</button>
                            <button class="btn btn-primary" onclick="repondreQuiz(2, 'c', false)">C) 10 ans</button>
                        </div>
                        <div id="reponse2" style="display: none; margin-top: 10px;"></div>
                    </div>
                </div>
            `;
        }

        function repondreQuiz(question, reponse, correct) {
            const div = document.getElementById(`reponse${question}`);
            div.style.display = 'block';
            
            if (correct) {
                div.innerHTML = '<span style="color: var(--success-pse);">‚úÖ Bonne r√©ponse !</span>';
                score++;
            } else {
                div.innerHTML = '<span style="color: var(--danger-pse);">‚ùå Incorrect. Relisez le tableau correspondant.</span>';
            }
            maxScore++;
        }

        // √âTAPE 4 : SYNTH√àSE
        function afficherSynthese() {
            const contenu = document.getElementById('manipulation-content');
            const tauxReussite = maxScore > 0 ? Math.round((score / maxScore) * 100) : 0;
            
            let niveau = '';
            if (tauxReussite >= 80) niveau = 'Expert des tableaux MP';
            else if (tauxReussite >= 60) niveau = 'Bonne compr√©hension';
            else niveau = '√Ä approfondir';
            
            contenu.innerHTML = `
                <div class="cas-analyse">
                    <div class="cas-header">
                        <div class="cas-numero">Bilan</div>
                    </div>
                    <h3 style="color: var(--success-pse); margin-bottom: 15px;">üéì Laboratoire termin√© !</h3>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                        <div style="text-align: center; padding: 20px; background: rgba(46, 134, 171, 0.1); border-radius: 10px;">
                            <div style="font-size: 2.5em; font-weight: bold; color: var(--primary-pse);">${tauxReussite}%</div>
                            <div style="font-weight: 600;">Score global</div>
                        </div>
                        <div style="text-align: center; padding: 20px; background: rgba(33, 150, 83, 0.1); border-radius: 10px;">
                            <div style="font-size: 1.5em; font-weight: bold; color: var(--success-pse);">${niveau}</div>
                            <div style="font-weight: 600;">Niveau atteint</div>
                        </div>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <h4>üéØ Ce que vous avez appris :</h4>
                        <ul style="margin: 10px 0 10px 20px;">
                            <li>‚úÖ Structure et utilisation des tableaux MP officiels</li>
                            <li>‚úÖ M√©thodologie de recherche dans les 3 colonnes</li>
                            <li>‚úÖ V√©rification des crit√®res de reconnaissance</li>
                            <li>‚úÖ Analyse de cas concrets professionnels</li>
                        </ul>
                    </div>
                    
                    <div style="background: rgba(255, 255, 255, 0.7); padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <strong>üí° Pour aller plus loin :</strong> Les tableaux MP √©voluent r√©guli√®rement. 
                        Consultez toujours la version officielle sur le site de l'INRS ou de l'Assurance Maladie.
                    </div>
                    
                    <div style="text-align: center; margin-top: 25px;">
                        <button class="btn btn-primary" onclick="recommencerLabo()">üîÑ Recommencer le laboratoire</button>
                        <button class="btn btn-success" onclick="window.print()">üìÑ Imprimer le certificat</button>
                    </div>
                </div>
            `;
        }

        function recommencerLabo() {
            etapeActuelle = 1;
            score = 0;
            maxScore = 0;
            casActuel = 0;
            
            // R√©initialiser l'affichage
            document.getElementById('manipulation-title').innerHTML = etapes[0].titre + 
                `<button class="audio-btn" onclick="lireAudio('phase')" title="√âcouter cette phase">üîä</button>`;
            
            document.getElementById('manipulation-content').innerHTML = `
                <div class="cas-analyse">
                    <div class="cas-header">
                        <div class="cas-numero">Introduction</div>
                    </div>
                    <p><strong>Bienvenue dans le laboratoire virtuel des tableaux MP !</strong></p>
                    <p>Vous allez apprendre √† utiliser les tableaux officiels de maladies professionnelles pour analyser des cas concrets d'exposition.</p>
                </div>
            `;
            
            // R√©initialiser les highlights
            document.querySelectorAll('.highlight-correct, .highlight-incorrect').forEach(el => {
                el.classList.remove('highlight-correct', 'highlight-incorrect');
            });
            
            mettreAJourProgression();
        }

        function terminerLabo() {
            afficherSynthese();
        }

        // ACCESSIBILIT√â - Synth√®se vocale globale
        let speechSynth = window.speechSynthesis;
        let isReading = false;
        let currentUtterance = null;

        function toggleSpeech() {
            if (isReading) {
                speechSynth.cancel();
                isReading = false;
                document.getElementById('playBtn').textContent = 'üîä';
                if (document.querySelector('.audio-btn.playing')) {
                    document.querySelector('.audio-btn.playing').classList.remove('playing');
                }
            } else {
                const text = document.querySelector('.zone-manipulation').textContent;
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'fr-FR';
                utterance.rate = 0.8;
                
                utterance.onend = function() {
                    isReading = false;
                    document.getElementById('playBtn').textContent = 'üîä';
                };
                
                speechSynth.speak(utterance);
                isReading = true;
                document.getElementById('playBtn').textContent = '‚è∏Ô∏è';
            }
        }

        // AUDIO DISCRET PAR SECTION
        function lireAudio(section) {
            // Arr√™ter toute lecture en cours
            if (currentUtterance) {
                speechSynth.cancel();
                document.querySelectorAll('.audio-btn.playing').forEach(btn => {
                    btn.classList.remove('playing');
                });
            }

            let text = '';
            let audioBtn = event.target;
            
            // D√©finir le texte selon la section
            switch(section) {
                case 'phase':
                    text = "Bienvenue dans le laboratoire virtuel des tableaux MP. Vous allez apprendre √† analyser des cas de maladies professionnelles.";
                    break;
                case 'tableaux':
                    text = "Voici les tableaux MP officiels : tableau 65 pour les ecz√©mas, tableau 57 pour l'asthme professionnel, tableau 98 pour les troubles du rachis.";
                    break;
                case 'etape2':
                    text = "√âtape 2 : Analyse du cas de Marie, coiffeuse avec ecz√©ma des mains. Recherchez dans les tableaux les crit√®res correspondants.";
                    break;
                case 'etape3':
                    text = "√âtape 3 : Recherche libre dans les tableaux. Explorez la structure des 3 colonnes : maladie, d√©lai, travaux.";
                    break;
                case 'etape4':
                    text = "√âtape 4 : Synth√®se du laboratoire. Bilan de vos performances et certificat de r√©ussite.";
                    break;
                default:
                    text = "Section du laboratoire virtuel tableaux MP.";
            }
            
            if (text) {
                audioBtn.classList.add('playing');
                
                currentUtterance = new SpeechSynthesisUtterance(text);
                currentUtterance.lang = 'fr-FR';
                currentUtterance.rate = 0.9;
                currentUtterance.pitch = 1.1;
                
                currentUtterance.onend = function() {
                    audioBtn.classList.remove('playing');
                    currentUtterance = null;
                };
                
                currentUtterance.onerror = function() {
                    audioBtn.classList.remove('playing');
                    currentUtterance = null;
                };
                
                speechSynth.speak(currentUtterance);
            }
        }

        // ACCESSIBILIT√â - Police OpenDyslexie
        function toggleDyslexieFont() {
            document.body.classList.toggle('dyslexie-mode');
            const btn = document.getElementById('dyslexieBtn');
            btn.textContent = document.body.classList.contains('dyslexie-mode') ? 'üëÅÔ∏è' : 'üëÅ';
        }
    </script>
</body>
</html>