<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module A.9 - Escape Game Crise Sanitaire - Terminale Bac Pro</title>
    <style>
        :root {
            --primary-pse: #2E86AB;
            --secondary-pse: #A23B72;
            --success-pse: #219653;
            --warning-pse: #F2994A;
            --danger-pse: #EB5757;
            --dark-pse: #2F3542;
            --light-pse: #F1F2F6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            line-height: 1.6;
            color: #333;
        }

        .exercice-container {
            width: 100%;
            max-width: 100vw;
            padding: 15px;
            font-size: 16px;
        }

        .cadre-pedagogique {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-left: 5px solid var(--primary-pse);
        }

        .module-info h2 {
            color: var(--primary-pse);
            font-size: 1.4rem;
            margin-bottom: 15px;
        }

        .objectif {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid var(--success-pse);
        }

        .competences-travaillees h3 {
            color: var(--dark-pse);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .competences-list {
            list-style: none;
        }

        .competences-list li {
            background: linear-gradient(90deg, #e3f2fd 0%, #f3e5f5 100%);
            margin: 8px 0;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid var(--secondary-pse);
        }

        .niveau-cible {
            background: var(--primary-pse);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            display: inline-block;
            margin-top: 15px;
            font-weight: bold;
        }

        .escape-container {
            background: white;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .game-header {
            background: linear-gradient(135deg, #FF6B6B, #EE5A52);
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
        }

        .game-title {
            font-size: 2rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .urgency-indicator {
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 25px;
            margin: 15px auto;
            max-width: 300px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .timer-container {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.3);
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .timer {
            color: #FFD93D;
        }

        .scenario-intro {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 25px;
            margin: 0;
            position: relative;
        }

        .scenario-intro::before {
            content: "üö®";
            position: absolute;
            top: -15px;
            left: 20px;
            background: #fff3cd;
            padding: 0 10px;
            font-size: 1.5rem;
        }

        .game-content {
            padding: 30px;
        }

        .enigma-section {
            background: #f8f9fa;
            border: 3px solid var(--primary-pse);
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            position: relative;
            transition: all 0.3s ease;
        }

        .enigma-section.locked {
            opacity: 0.6;
            pointer-events: none;
        }

        .enigma-section.solved {
            border-color: var(--success-pse);
            background: linear-gradient(135deg, #e8f5e8, #f0f8f0);
        }

        .enigma-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .enigma-number {
            background: var(--primary-pse);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .enigma-number.solved {
            background: var(--success-pse);
        }

        .enigma-title {
            flex: 1;
            font-size: 1.3rem;
            color: var(--dark-pse);
            font-weight: bold;
        }

        .lock-status {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .investigation-panel {
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }

        .evidence-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .evidence-card {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .evidence-card:hover {
            border-color: var(--primary-pse);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .evidence-card.selected {
            border-color: var(--success-pse) !important;
            background: #e8f5e8 !important;
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(33, 150, 83, 0.3) !important;
            position: relative;
        }

        .evidence-card.selected::after {
            content: '‚úÖ CORRECT !';
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--success-pse);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            z-index: 10;
        }

        .evidence-card.incorrect {
            border-color: var(--danger-pse) !important;
            background: #ffe6e6 !important;
            animation: shake 0.8s ease-in-out;
            position: relative;
        }

        .evidence-card.incorrect::after {
            content: '‚ùå FAUX';
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--danger-pse);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            z-index: 10;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-12px); }
            75% { transform: translateX(12px); }
        }

        .analysis-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .analysis-table th {
            background: var(--primary-pse);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .analysis-table td {
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
        }

        .contamination-level {
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            text-align: center;
        }

        .level-safe { background: var(--success-pse); color: white; }
        .level-warning { background: var(--warning-pse); color: white; }
        .level-danger { background: var(--danger-pse); color: white; }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .action-btn {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            padding: 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .action-btn:hover {
            border-color: var(--primary-pse);
            background: rgba(46, 134, 171, 0.05);
            transform: translateY(-3px);
        }

        .action-btn.correct {
            background: var(--success-pse) !important;
            color: white !important;
            border-color: var(--success-pse) !important;
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(33, 150, 83, 0.3) !important;
        }

        .action-btn.correct::after {
            content: ' ‚úÖ EXCELLENT';
            font-weight: bold;
            margin-left: 10px;
            font-size: 0.9rem;
        }

        .action-btn.incorrect {
            background: var(--danger-pse) !important;
            color: white !important;
            border-color: var(--danger-pse) !important;
            animation: shake 0.8s ease-in-out;
        }

        .action-btn.incorrect::after {
            content: ' ‚ùå ESSAYEZ ENCORE';
            font-weight: bold;
            margin-left: 10px;
            font-size: 0.9rem;
        }

        .competence-badge {
            background: var(--secondary-pse);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            margin: 5px 5px 5px 0;
            display: inline-block;
        }

        .progress-tracker {
            background: rgba(255,255,255,0.9);
            padding: 20px;
            border-radius: 10px;
            margin: 25px 0;
            text-align: center;
        }

        .progress-bar {
            background: #e9ecef;
            border-radius: 25px;
            height: 12px;
            margin: 15px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, var(--success-pse), var(--primary-pse));
            height: 100%;
            border-radius: 25px;
            transition: width 0.8s ease;
            width: 0%;
        }

        .hint-box {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            display: none;
        }

        .hint-box.show {
            display: block;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .solution-panel {
            background: #e8f5e8;
            border: 2px solid var(--success-pse);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            display: none;
        }

        .solution-panel.show {
            display: block;
            animation: fadeIn 0.8s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .victory-screen {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 40px;
            text-align: center;
            margin: 30px 0;
            border-radius: 15px;
            display: none;
        }

        .victory-screen.show {
            display: block;
            animation: victoryAnimation 1s ease;
        }

        @keyframes victoryAnimation {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }

        .victory-title {
            font-size: 2.5rem;
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .stat-card {
            background: rgba(255,255,255,0.2);
            padding: 20px;
            border-radius: 10px;
        }

        .rgpd-notice {
            background: #f8f9fa;
            color: #6c757d;
            padding: 15px;
            text-align: center;
            font-size: 0.9rem;
            margin-top: 40px;
            border-radius: 10px;
        }

        /* Responsive */
        @media (min-width: 768px) {
            .exercice-container {
                padding: 20px;
                font-size: 17px;
            }
        }

        @media (min-width: 1024px) {
            .exercice-container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 30px;
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <!-- EN-T√äTE P√âDAGOGIQUE OBLIGATOIRE -->
    <div class="exercice-container">
        <div class="cadre-pedagogique">
            <div class="module-info">
                <h2>Module A.9 : La s√©curit√© alimentaire</h2>
                <div class="objectif">
                    <strong>Objectif :</strong> Appr√©hender les risques li√©s aux aliments pour agir en consommateur responsable.
                </div>
            </div>
            
            <div class="competences-travaillees">
                <h3>Comp√©tences travaill√©es dans cet exercice :</h3>
                <ul class="competences-list">
                    <li><strong>C2</strong> - Appliquer une d√©marche d'analyse dans une situation donn√©e</li>
                    <li><strong>C3</strong> - Expliquer un ph√©nom√®ne physiologique, un enjeu environnemental, une disposition r√©glementaire, en lien avec une mesure de pr√©vention</li>
                    <li><strong>C4</strong> - Proposer une solution pour r√©soudre un probl√®me</li>
                    <li><strong>C5</strong> - Argumenter un choix</li>
                    <li><strong>C6</strong> - Communiquer √† l'√©crit et √† l'oral avec une syntaxe claire et un vocabulaire adapt√©</li>
                </ul>
            </div>
            
            <div class="niveau-cible">
                <strong>Niveau :</strong> Bac Pro Terminale
            </div>
        </div>

        <!-- ESCAPE GAME -->
        <div class="escape-container">
            <div class="game-header">
                <div class="timer-container">
                    üïê <span class="timer" id="gameTimer">45:00</span>
                </div>
                <h1 class="game-title">üö® ESCAPE GAME : CRISE SANITAIRE</h1>
                <div class="urgency-indicator">
                    ‚ö° INTERVENTION D'URGENCE ‚ö°
                </div>
            </div>

            <div class="scenario-intro">
                <h2 style="color: #d63384; margin-bottom: 15px;">üé≠ SC√âNARIO D'URGENCE</h2>
                <p><strong>Vous √™tes inspecteur(trice) DGAL en mission d'urgence.</strong></p>
                <p>Le restaurant gastronomique <strong>"Le Gourmet d'Or"</strong> (120 couverts/jour) fait face √† une crise sanitaire majeure : <strong>48 clients hospitalis√©s</strong> apr√®s le service d'hier soir avec des sympt√¥mes d'intoxication alimentaire grave.</p>
                <p><strong>MISSION :</strong> Identifier la source de contamination, √©valuer les risques et prendre les mesures d'urgence pour prot√©ger la sant√© publique. Vous disposez de <strong>45 minutes</strong> pour r√©soudre cette enqu√™te et √©viter une catastrophe sanitaire !</p>
            </div>

            <div class="game-content">
                <!-- Progress Tracker -->
                <div class="progress-tracker">
                    <h3>üîç Progression de l'enqu√™te</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressBar"></div>
                    </div>
                    <p><span id="progressText">0/6 √©nigmes r√©solues</span> ‚Ä¢ Temps restant : <span id="timeRemaining">45:00</span></p>
                </div>

                <!-- √âNIGME 1 : ANALYSE SYMPT√îMES -->
                <div class="enigma-section" id="enigma1">
                    <div class="enigma-header">
                        <div class="enigma-number" id="num1">1</div>
                        <div class="enigma-title">ANALYSE DES SYMPT√îMES PATIENTS</div>
                        <div class="lock-status" id="lock1">üîì</div>
                        <span class="competence-badge">C2 - D√©marche analyse</span>
                    </div>

                    <div class="investigation-panel">
                        <h4>üìã RAPPORT M√âDICAL - H√¥pital Saint-Louis</h4>
                        <div style="background: white; padding: 15px; border-radius: 8px; margin: 10px 0;">
                            <p><strong>Patients admis :</strong> 48 personnes (√¢ges 25-78 ans)</p>
                            <p><strong>Sympt√¥mes observ√©s :</strong></p>
                            <ul style="margin: 10px 0 10px 20px;">
                                <li>Diarrh√©e aqueuse profuse (100% des cas)</li>
                                <li>Vomissements r√©p√©t√©s (95% des cas)</li>
                                <li>Fi√®vre √©lev√©e 38-40¬∞C (85% des cas)</li>
                                <li>Douleurs abdominales intenses (90% des cas)</li>
                            </ul>
                            <p><strong>D√©lai d'incubation :</strong> 8-24h apr√®s le repas</p>
                            <p><strong>√âtat :</strong> 3 patients en soins intensifs, 45 hospitalis√©s</p>
                        </div>

                        <p><strong>üîç QUESTION D'ENQU√äTE :</strong> Quel agent pathog√®ne correspond √† ces sympt√¥mes ?</p>
                        
                        <div class="evidence-grid">
                            <div class="evidence-card" onclick="selectEvidence(this, false, 1)">
                                <h5>ü¶† Listeria Monocytogenes</h5>
                                <p>Incubation : 3-70 jours<br>
                                Sympt√¥mes : fi√®vre mod√©r√©e, m√©ningite possible</p>
                            </div>
                            <div class="evidence-card" onclick="selectEvidence(this, true, 1)">
                                <h5>ü¶† Salmonella Enteritidis</h5>
                                <p>Incubation : 8-48h<br>
                                Sympt√¥mes : diarrh√©e, vomissements, fi√®vre √©lev√©e</p>
                            </div>
                            <div class="evidence-card" onclick="selectEvidence(this, false, 1)">
                                <h5>ü¶† Escherichia Coli</h5>
                                <p>Incubation : 1-8 jours<br>
                                Sympt√¥mes : diarrh√©e sanglante, colites</p>
                            </div>
                            <div class="evidence-card" onclick="selectEvidence(this, false, 1)">
                                <h5>ü¶† Clostridium Perfringens</h5>
                                <p>Incubation : 8-22h<br>
                                Sympt√¥mes : diarrh√©e sans fi√®vre ni vomissement</p>
                            </div>
                        </div>
                    </div>

                    <div class="solution-panel" id="solution1">
                        <h4>‚úÖ DIAGNOSTIC CONFIRM√â</h4>
                        <p><strong>Salmonella Enteritidis</strong> - Les sympt√¥mes (diarrh√©e profuse + vomissements + fi√®vre √©lev√©e) et le d√©lai d'incubation (8-24h) correspondent parfaitement √† une salmonellose aigu√´. Cette bact√©rie pathog√®ne est fr√©quemment associ√©e aux ≈ìufs et volailles mal cuits.</p>
                    </div>
                </div>

                <!-- √âNIGME 2 : TRA√áABILIT√â MENU -->
                <div class="enigma-section locked" id="enigma2">
                    <div class="enigma-header">
                        <div class="enigma-number" id="num2">2</div>
                        <div class="enigma-title">TRA√áABILIT√â DU MENU CONTAMIN√â</div>
                        <div class="lock-status" id="lock2">üîí</div>
                        <span class="competence-badge">C1 - Traiter information</span>
                    </div>

                    <div class="investigation-panel">
                        <h4>üçΩÔ∏è MENU DU 8 F√âVRIER 2026 - SERVICE SOIR</h4>
                        <table class="analysis-table">
                            <thead>
                                <tr>
                                    <th>Plat</th>
                                    <th>Nb clients servis</th>
                                    <th>Clients malades</th>
                                    <th>Taux d'attaque</th>
                                    <th>Ingr√©dients √† risque</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>≈íufs √† la coque au caviar</strong></td>
                                    <td>52</td>
                                    <td>48</td>
                                    <td class="contamination-level level-danger">92.3%</td>
                                    <td>≈íufs fermiers, cr√®me fra√Æche</td>
                                </tr>
                                <tr>
                                    <td>Salade de l√©gumes verts</td>
                                    <td>78</td>
                                    <td>8</td>
                                    <td class="contamination-level level-safe">10.2%</td>
                                    <td>Salade, vinaigrette maison</td>
                                </tr>
                                <tr>
                                    <td>Saumon grill√©</td>
                                    <td>65</td>
                                    <td>5</td>
                                    <td class="contamination-level level-safe">7.7%</td>
                                    <td>Saumon atlantique, beurre</td>
                                </tr>
                                <tr>
                                    <td>Tiramisu maison</td>
                                    <td>89</td>
                                    <td>12</td>
                                    <td class="contamination-level level-warning">13.5%</td>
                                    <td>Mascarpone, ≈ìufs, caf√©</td>
                                </tr>
                            </tbody>
                        </table>

                        <p><strong>üîç QUESTION D'ENQU√äTE :</strong> Quel plat est la source probable de contamination ?</p>
                        
                        <div class="action-buttons">
                            <div class="action-btn" onclick="selectAction(this, false, 2)">
                                <h5>ü•ó Salade de l√©gumes</h5>
                                <p>Taux d'attaque : 10.2%</p>
                            </div>
                            <div class="action-btn" onclick="selectAction(this, true, 2)">
                                <h5>ü•ö ≈íufs √† la coque au caviar</h5>
                                <p>Taux d'attaque : 92.3%</p>
                            </div>
                            <div class="action-btn" onclick="selectAction(this, false, 2)">
                                <h5>üêü Saumon grill√©</h5>
                                <p>Taux d'attaque : 7.7%</p>
                            </div>
                            <div class="action-btn" onclick="selectAction(this, false, 2)">
                                <h5>üç∞ Tiramisu maison</h5>
                                <p>Taux d'attaque : 13.5%</p>
                            </div>
                        </div>
                    </div>

                    <div class="solution-panel" id="solution2">
                        <h4>‚úÖ ALIMENT SOURCE IDENTIFI√â</h4>
                        <p><strong>≈íufs √† la coque au caviar</strong> - Le taux d'attaque de 92.3% indique clairement cet aliment comme source de contamination. Les ≈ìufs insuffisamment cuits favorisent la survie de Salmonella Enteritidis, souvent pr√©sente dans la coquille ou le jaune d'≈ìuf.</p>
                    </div>
                </div>

                <!-- √âNIGME 3 : ANALYSE FOURNISSEUR -->
                <div class="enigma-section locked" id="enigma3">
                    <div class="enigma-header">
                        <div class="enigma-number" id="num3">3</div>
                        <div class="enigma-title">ENQU√äTE CHEZ LE FOURNISSEUR</div>
                        <div class="lock-status" id="lock3">üîí</div>
                        <span class="competence-badge">C3 - Expliquer ph√©nom√®nes</span>
                    </div>

                    <div class="investigation-panel">
                        <h4>üöö FERME AVICOLE "Les Poules Heureuses" - Lot n¬∞2026-0208</h4>
                        <div style="background: white; padding: 15px; border-radius: 8px; margin: 10px 0;">
                            <p><strong>Livraison :</strong> 200 ≈ìufs fermiers bio le 7 f√©vrier 2026</p>
                            <p><strong>Conditions transport :</strong> Camion non r√©frig√©r√©, temp√©rature ext√©rieure 15¬∞C</p>
                            <p><strong>Stockage restaurant :</strong> Temp√©rature ambiante (20¬∞C) pendant 18h</p>
                        </div>

                        <table class="analysis-table">
                            <thead>
                                <tr>
                                    <th>Analyse microbiologique</th>
                                    <th>R√©sultat √©chantillon</th>
                                    <th>Norme</th>
                                    <th>Conformit√©</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Salmonella sur coquille</td>
                                    <td class="contamination-level level-danger">POSITIF</td>
                                    <td>ABSENCE</td>
                                    <td>‚ùå NON CONFORME</td>
                                </tr>
                                <tr>
                                    <td>Salmonella dans l'≈ìuf</td>
                                    <td class="contamination-level level-warning">FAIBLE</td>
                                    <td>ABSENCE</td>
                                    <td>‚ùå NON CONFORME</td>
                                </tr>
                                <tr>
                                    <td>Date de ponte</td>
                                    <td>5 f√©vrier 2026</td>
                                    <td>< 9 jours</td>
                                    <td>‚úÖ CONFORME</td>
                                </tr>
                            </tbody>
                        </table>

                        <p><strong>üîç QUESTION D'ENQU√äTE :</strong> Pourquoi la contamination s'est-elle d√©velopp√©e ?</p>
                        
                        <div class="action-buttons">
                            <div class="action-btn" onclick="selectAction(this, false, 3)">
                                <h5>üìÖ ≈íufs trop anciens</h5>
                                <p>D√©passement de DLC</p>
                            </div>
                            <div class="action-btn" onclick="selectAction(this, true, 3)">
                                <h5>üå°Ô∏è Rupture cha√Æne du froid</h5>
                                <p>T¬∞ √©lev√©e favorise multiplication</p>
                            </div>
                            <div class="action-btn" onclick="selectAction(this, false, 3)">
                                <h5>üßº D√©faut de lavage</h5>
                                <p>Coquilles mal nettoy√©es</p>
                            </div>
                            <div class="action-btn" onclick="selectAction(this, false, 3)">
                                <h5>üë®‚Äçüç≥ Cuisson insuffisante</h5>
                                <p>Temp√©rature de cuisson trop basse</p>
                            </div>
                        </div>
                    </div>

                    <div class="solution-panel" id="solution3">
                        <h4>‚úÖ CAUSE SCIENTIFIQUE IDENTIFI√âE</h4>
                        <p><strong>Rupture de la cha√Æne du froid</strong> - Les Salmonelles pr√©sentes sur la coquille se multiplient rapidement entre 15-20¬∞C. Le stockage √† temp√©rature ambiante (20¬∞C) pendant 18h a permis leur prolif√©ration et p√©n√©tration dans l'≈ìuf. Le respect de la temp√©rature r√©glementaire (‚â§ 5¬∞C) aurait limit√© cette croissance microbienne.</p>
                    </div>
                </div>

                <!-- √âNIGME 4 : MESURES D'URGENCE -->
                <div class="enigma-section locked" id="enigma4">
                    <div class="enigma-header">
                        <div class="enigma-number" id="num4">4</div>
                        <div class="enigma-title">MESURES D'URGENCE √Ä PRENDRE</div>
                        <div class="lock-status" id="lock4">üîí</div>
                        <span class="competence-badge">C4 - Proposer solutions</span>
                    </div>

                    <div class="investigation-panel">
                        <h4>‚ö° D√âCISIONS D'URGENCE R√âGLEMENTAIRES</h4>
                        <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid #ffc107;">
                            <p><strong>CONTEXTE :</strong> Vous devez prendre des mesures imm√©diates pour prot√©ger la sant√© publique et emp√™cher l'extension de la contamination. Le restaurant continue de servir et le fournisseur livre d'autres √©tablissements.</p>
                        </div>

                        <p><strong>üîç PRIORIT√âS D'ACTION :</strong> Classez les mesures par ordre de priorit√© (1 = le plus urgent)</p>
                        
                        <div class="action-buttons" id="priorityButtons">
                            <div class="action-btn priority-btn" onclick="setPriority(this, 2)" data-priority="0">
                                <h5>üì¢ Communication publique</h5>
                                <p>Informer les m√©dias et la population</p>
                                <span class="priority-number"></span>
                            </div>
                            <div class="action-btn priority-btn" onclick="setPriority(this, 1)" data-priority="0">
                                <h5>üö´ Fermeture imm√©diate restaurant</h5>
                                <p>Arr√™t service + mise sous scell√©s</p>
                                <span class="priority-number"></span>
                            </div>
                            <div class="action-btn priority-btn" onclick="setPriority(this, 4)" data-priority="0">
                                <h5>üìã Enqu√™te √©pid√©miologique</h5>
                                <p>Recherche d'autres cas similaires</p>
                                <span class="priority-number"></span>
                            </div>
                            <div class="action-btn priority-btn" onclick="setPriority(this, 3)" data-priority="0">
                                <h5>üöö Rappel produits fournisseur</h5>
                                <p>Blocage lots ≈ìufs contamin√©s</p>
                                <span class="priority-number"></span>
                            </div>
                        </div>

                        <div style="text-align: center; margin: 20px 0;">
                            <button class="action-btn" onclick="validatePriorities()" id="validateBtn" style="background: var(--primary-pse); color: white; border: none;">
                                ‚úÖ Valider l'ordre de priorit√©
                            </button>
                        </div>
                    </div>

                    <div class="solution-panel" id="solution4">
                        <h4>‚úÖ ORDRE DE PRIORIT√â CORRECT</h4>
                        <ol style="margin-left: 20px; margin-top: 15px;">
                            <li><strong>Fermeture imm√©diate restaurant</strong> - Stopper l'exposition</li>
                            <li><strong>Communication publique</strong> - Alerter les consommateurs</li>
                            <li><strong>Rappel produits fournisseur</strong> - Limiter l'extension</li>
                            <li><strong>Enqu√™te √©pid√©miologique</strong> - Rechercher d'autres foyers</li>
                        </ol>
                    </div>
                </div>

                <!-- √âNIGME 5 : R√âGLEMENTATION -->
                <div class="enigma-section locked" id="enigma5">
                    <div class="enigma-header">
                        <div class="enigma-number" id="num5">5</div>
                        <div class="enigma-title">SANCTIONS R√âGLEMENTAIRES</div>
                        <div class="lock-status" id="lock5">üîí</div>
                        <span class="competence-badge">C5 - Argumenter choix</span>
                    </div>

                    <div class="investigation-panel">
                        <h4>‚öñÔ∏è CADRE R√âGLEMENTAIRE APPLICABLE</h4>
                        <div style="background: white; padding: 15px; border-radius: 8px; margin: 10px 0;">
                            <p><strong>Non-conformit√©s constat√©es :</strong></p>
                            <ul style="margin: 10px 0 10px 20px;">
                                <li>‚ùå Non-respect cha√Æne du froid (stockage ≈ìufs 20¬∞C)</li>
                                <li>‚ùå Cuisson insuffisante (≈ìufs √† la coque = 65¬∞C vs 75¬∞C requis)</li>
                                <li>‚ùå D√©faut de tra√ßabilit√© (pas d'enregistrement temp√©rature)</li>
                                <li>‚ùå Formation hygi√®ne insuffisante (personnel non sensibilis√©)</li>
                            </ul>
                        </div>

                        <p><strong>üîç QUESTION D'ARGUMENTATION :</strong> Justifiez la sanction appropri√©e :</p>
                        
                        <div class="action-buttons">
                            <div class="action-btn" onclick="selectAction(this, false, 5)">
                                <h5>üí∞ Amende administrative</h5>
                                <p>Sanction financi√®re uniquement</p>
                            </div>
                            <div class="action-btn" onclick="selectAction(this, false, 5)">
                                <h5>üìù Mise en demeure</h5>
                                <p>D√©lai pour mise en conformit√©</p>
                            </div>
                            <div class="action-btn" onclick="selectAction(this, true, 5)">
                                <h5>üö´ Fermeture administrative</h5>
                                <p>Arr√™t d'activit√© jusqu'√† conformit√©</p>
                            </div>
                            <div class="action-btn" onclick="selectAction(this, false, 5)">
                                <h5>üîç Surveillance renforc√©e</h5>
                                <p>Contr√¥les plus fr√©quents</p>
                            </div>
                        </div>
                    </div>

                    <div class="solution-panel" id="solution5">
                        <h4>‚úÖ SANCTION JUSTIFI√âE</h4>
                        <p><strong>Fermeture administrative</strong> - La gravit√© de l'intoxication (48 hospitalisations) et les multiples non-conformit√©s cr√©ent un danger imminent pour la sant√© publique. La fermeture temporaire permet de contraindre √† une mise en conformit√© compl√®te avant r√©ouverture, seule mesure proportionn√©e au risque sanitaire.</p>
                    </div>
                </div>

                <!-- √âNIGME 6 : PR√âVENTION -->
                <div class="enigma-section locked" id="enigma6">
                    <div class="enigma-header">
                        <div class="enigma-number" id="num6">6</div>
                        <div class="enigma-title">PLAN DE PR√âVENTION</div>
                        <div class="lock-status" id="lock6">üîí</div>
                        <span class="competence-badge">C6 - Communication pro</span>
                    </div>

                    <div class="investigation-panel">
                        <h4>üìã RECOMMANDATIONS PR√âVENTIVES</h4>
                        <p><strong>R√©digez un plan d'actions pr√©ventives pour √©viter la r√©cidive :</strong></p>
                        
                        <div class="action-buttons">
                            <div class="action-btn preventive-measure" onclick="toggleMeasure(this)" data-essential="true">
                                <h5>üå°Ô∏è Contr√¥le temp√©rature continue</h5>
                                <p>Enregistreurs automatiques + alertes</p>
                                <span class="selection-status">‚ùå</span>
                            </div>
                            <div class="action-btn preventive-measure" onclick="toggleMeasure(this)" data-essential="true">
                                <h5>üç≥ Formation cuisson s√©curis√©e</h5>
                                <p>75¬∞C minimum pour ≈ìufs + thermom√®tre</p>
                                <span class="selection-status">‚ùå</span>
                            </div>
                            <div class="action-btn preventive-measure" onclick="toggleMeasure(this)" data-essential="false">
                                <h5>üí∞ N√©gociation prix fournisseurs</h5>
                                <p>Optimisation des co√ªts d'achat</p>
                                <span class="selection-status">‚ùå</span>
                            </div>
                            <div class="action-btn preventive-measure" onclick="toggleMeasure(this)" data-essential="true">
                                <h5>üßº Protocole hygi√®ne renforc√©</h5>
                                <p>Formation + contr√¥le lavage mains</p>
                                <span class="selection-status">‚ùå</span>
                            </div>
                            <div class="action-btn preventive-measure" onclick="toggleMeasure(this)" data-essential="false">
                                <h5>üé® R√©novation d√©coration</h5>
                                <p>Am√©lioration esth√©tique des locaux</p>
                                <span class="selection-status">‚ùå</span>
                            </div>
                            <div class="action-btn preventive-measure" onclick="toggleMeasure(this)" data-essential="true">
                                <h5>üìä Tra√ßabilit√© num√©rique</h5>
                                <p>Syst√®me HACCP + enregistrements</p>
                                <span class="selection-status">‚ùå</span>
                            </div>
                        </div>

                        <div style="text-align: center; margin: 20px 0;">
                            <button class="action-btn" onclick="validatePrevention()" id="preventionBtn" style="background: var(--primary-pse); color: white; border: none;">
                                üìù Finaliser le plan de pr√©vention
                            </button>
                        </div>
                    </div>

                    <div class="solution-panel" id="solution6">
                        <h4>‚úÖ PLAN DE PR√âVENTION VALID√â</h4>
                        <p><strong>Mesures essentielles s√©lectionn√©es :</strong> Contr√¥le temp√©rature, formation cuisson, protocole hygi√®ne et tra√ßabilit√© HACCP. Ces 4 mesures ciblent les causes racines identifi√©es lors de l'enqu√™te et forment un syst√®me de pr√©vention coh√©rent selon la r√©glementation du "Paquet Hygi√®ne" europ√©en.</p>
                    </div>
                </div>

                <!-- √âCRAN DE VICTOIRE -->
                <div class="victory-screen" id="victoryScreen">
                    <div class="victory-title">üéâ MISSION ACCOMPLIE ! üéâ</div>
                    <p style="font-size: 1.3rem; margin-bottom: 25px;">
                        F√©licitations ! Vous avez brillamment r√©solu cette crise sanitaire complexe.
                    </p>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3 id="finalTime">‚è±Ô∏è 32min 45s</h3>
                            <p>Temps de r√©solution</p>
                        </div>
                        <div class="stat-card">
                            <h3>üéØ 6/6</h3>
                            <p>√ânigmes r√©solues</p>
                        </div>
                        <div class="stat-card">
                            <h3>üë• 48</h3>
                            <p>Patients sauv√©s</p>
                        </div>
                        <div class="stat-card">
                            <h3>üèÜ Expert</h3>
                            <p>Niveau atteint</p>
                        </div>
                    </div>
                    
                    <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 10px; margin-top: 25px;">
                        <h3>üéì COMP√âTENCES VALID√âES :</h3>
                        <div style="margin-top: 15px;">
                            <span class="competence-badge">C2 - D√©marche d'analyse m√©thodique</span>
                            <span class="competence-badge">C3 - Explication ph√©nom√®nes microbiologiques</span>
                            <span class="competence-badge">C4 - Solutions d'urgence pertinentes</span>
                            <span class="competence-badge">C5 - Argumentation r√©glementaire</span>
                            <span class="competence-badge">C6 - Communication professionnelle</span>
                        </div>
                        <p style="margin-top: 20px; font-size: 1.1rem;">
                            <strong>‚úÖ Pr√™t(e) pour l'√©preuve PSE Terminale !</strong><br>
                            Vous ma√Ætrisez parfaitement l'analyse de crise sanitaire et la gestion des risques alimentaires.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer RGPD -->
        <div class="rgpd-notice">
            üîí Conformit√© RGPD : Cet exercice respecte votre anonymat.
        </div>
    </div>

    <script>
        let gameStartTime = Date.now();
        let timeRemaining = 45 * 60; // 45 minutes en secondes
        let currentEnigma = 1;
        let totalEnigmas = 6;
        let solvedCount = 0;
        let gameTimer;
        let priorityOrder = [0, 0, 0, 0]; // Pour l'√©nigme 4
        let selectedMeasures = []; // Pour l'√©nigme 6

        // D√©marrer le timer
        function startTimer() {
            gameTimer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(gameTimer);
                    alert("‚è∞ Temps √©coul√© ! La crise sanitaire s'aggrave...");
                    location.reload();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            const timeString = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            document.getElementById('gameTimer').textContent = timeString;
            document.getElementById('timeRemaining').textContent = timeString;
        }

        // S√©lection de preuves/evidence
        function selectEvidence(element, isCorrect, enigmaNum) {
            const allCards = element.parentElement.querySelectorAll('.evidence-card');
            allCards.forEach(card => {
                card.style.pointerEvents = 'none';
                card.classList.remove('selected');
            });

            if (isCorrect) {
                element.classList.add('selected');
                
                // Message de succ√®s flottant
                showGameMessage(element, "üéâ Excellent d√©duction !", 'success');
                
                setTimeout(() => {
                    solveEnigma(enigmaNum);
                }, 2000);
            } else {
                element.classList.add('incorrect');
                
                // Message d'erreur flottant
                showGameMessage(element, "ü§î R√©fl√©chissez encore...", 'error');
                
                setTimeout(() => {
                    element.classList.remove('incorrect');
                    allCards.forEach(card => card.style.pointerEvents = 'auto');
                }, 2500);
            }
        }

        // S√©lection d'action
        function selectAction(element, isCorrect, enigmaNum) {
            const allButtons = element.parentElement.querySelectorAll('.action-btn');
            allButtons.forEach(btn => {
                btn.style.pointerEvents = 'none';
                btn.classList.remove('selected');
            });

            if (isCorrect) {
                element.classList.add('correct');
                
                // Message de succ√®s
                showGameMessage(element, "üí° Brillant raisonnement !", 'success');
                
                setTimeout(() => {
                    solveEnigma(enigmaNum);
                }, 2000);
            } else {
                element.classList.add('incorrect');
                
                // Message d'erreur
                showGameMessage(element, "‚ùå Pas tout √† fait...", 'error');
                
                setTimeout(() => {
                    element.classList.remove('incorrect');
                    allButtons.forEach(btn => btn.style.pointerEvents = 'auto');
                }, 2500);
            }
        }

        function showGameMessage(button, message, type) {
            const messageDiv = document.createElement('div');
            const bgColor = type === 'success' ? 'var(--success-pse)' : 'var(--danger-pse)';
            
            messageDiv.style.cssText = `
                position: absolute;
                top: -60px;
                left: 50%;
                transform: translateX(-50%);
                background: ${bgColor};
                color: white;
                padding: 12px 20px;
                border-radius: 25px;
                font-weight: bold;
                font-size: 0.9rem;
                z-index: 1000;
                animation: gameMessageFloat 0.8s ease-out;
                box-shadow: 0 8px 20px rgba(0,0,0,0.2);
                white-space: nowrap;
            `;
            messageDiv.textContent = message;
            
            // Ajouter animation CSS
            if (!document.querySelector('#gameMessageStyle')) {
                const style = document.createElement('style');
                style.id = 'gameMessageStyle';
                style.textContent = `
                    @keyframes gameMessageFloat {
                        0% { opacity: 0; transform: translateX(-50%) translateY(20px); }
                        50% { opacity: 1; transform: translateX(-50%) translateY(-10px); }
                        100% { opacity: 1; transform: translateX(-50%) translateY(0px); }
                    }
                `;
                document.head.appendChild(style);
            }
            
            button.style.position = 'relative';
            button.appendChild(messageDiv);
            
            setTimeout(() => messageDiv.remove(), 3000);
        }

        // D√©finir priorit√© (√©nigme 4)
        function setPriority(element, correctPriority) {
            const currentPriority = parseInt(element.dataset.priority) || 0;
            const newPriority = currentPriority + 1;
            
            if (newPriority <= 4) {
                element.dataset.priority = newPriority;
                element.querySelector('.priority-number').textContent = newPriority;
                element.style.background = `hsl(${120 - newPriority * 20}, 70%, 85%)`;
            } else {
                element.dataset.priority = 0;
                element.querySelector('.priority-number').textContent = '';
                element.style.background = '#f8f9fa';
            }
        }

        // Valider les priorit√©s
        function validatePriorities() {
            const buttons = document.querySelectorAll('.priority-btn');
            const priorities = [];
            
            buttons.forEach(btn => {
                priorities.push(parseInt(btn.dataset.priority) || 0);
            });
            
            const expectedOrder = [2, 1, 4, 3]; // Communication, Fermeture, Enqu√™te, Rappel
            let isCorrect = true;
            
            for (let i = 0; i < expectedOrder.length; i++) {
                if (priorities[i] !== expectedOrder[i]) {
                    isCorrect = false;
                    break;
                }
            }
            
            if (isCorrect) {
                solveEnigma(4);
            } else {
                alert("‚ùå Ordre de priorit√© incorrect. R√©fl√©chissez √† l'urgence de chaque action...");
                buttons.forEach(btn => {
                    btn.dataset.priority = 0;
                    btn.querySelector('.priority-number').textContent = '';
                    btn.style.background = '#f8f9fa';
                });
            }
        }

        // Toggle mesure pr√©ventive (√©nigme 6)
        function toggleMeasure(element) {
            const isSelected = element.classList.contains('selected');
            const statusElement = element.querySelector('.selection-status');
            
            if (isSelected) {
                element.classList.remove('selected');
                element.style.background = '#f8f9fa';
                statusElement.textContent = '‚ùå';
            } else {
                element.classList.add('selected');
                element.style.background = 'rgba(46, 134, 171, 0.1)';
                statusElement.textContent = '‚úÖ';
            }
        }

        // Valider pr√©vention
        function validatePrevention() {
            const measures = document.querySelectorAll('.preventive-measure');
            let essentialSelected = 0;
            let nonEssentialSelected = 0;
            
            measures.forEach(measure => {
                if (measure.classList.contains('selected')) {
                    if (measure.dataset.essential === 'true') {
                        essentialSelected++;
                    } else {
                        nonEssentialSelected++;
                    }
                }
            });
            
            // Doit s√©lectionner les 4 mesures essentielles et aucune non-essentielle
            if (essentialSelected === 4 && nonEssentialSelected === 0) {
                solveEnigma(6);
            } else {
                alert("‚ùå Plan incomplet. S√©lectionnez uniquement les mesures directement li√©es √† la s√©curit√© alimentaire.");
            }
        }

        // R√©soudre une √©nigme
        function solveEnigma(enigmaNum) {
            document.getElementById(`solution${enigmaNum}`).classList.add('show');
            document.getElementById(`num${enigmaNum}`).classList.add('solved');
            document.getElementById(`lock${enigmaNum}`).textContent = 'üîì';
            document.getElementById(`enigma${enigmaNum}`).classList.add('solved');
            
            solvedCount++;
            updateProgress();
            
            // D√©verrouiller l'√©nigme suivante
            if (enigmaNum < totalEnigmas) {
                setTimeout(() => {
                    const nextEnigma = document.getElementById(`enigma${enigmaNum + 1}`);
                    nextEnigma.classList.remove('locked');
                    nextEnigma.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 2000);
            } else {
                // Fin du jeu
                setTimeout(() => {
                    clearInterval(gameTimer);
                    showVictory();
                }, 2000);
            }
        }

        // Mettre √† jour la progression
        function updateProgress() {
            const percentage = (solvedCount / totalEnigmas) * 100;
            document.getElementById('progressBar').style.width = `${percentage}%`;
            document.getElementById('progressText').textContent = `${solvedCount}/${totalEnigmas} √©nigmes r√©solues`;
        }

        // Afficher l'√©cran de victoire
        function showVictory() {
            const finalTime = Math.floor((Date.now() - gameStartTime) / 1000);
            const minutes = Math.floor(finalTime / 60);
            const seconds = finalTime % 60;
            
            document.getElementById('finalTime').textContent = `‚è±Ô∏è ${minutes}min ${seconds}s`;
            document.getElementById('victoryScreen').classList.add('show');
            document.getElementById('victoryScreen').scrollIntoView({ behavior: 'smooth' });
        }

        // D√©marrer le jeu
        document.addEventListener('DOMContentLoaded', function() {
            startTimer();
            updateTimerDisplay();
        });
    </script>
</body>
</html>