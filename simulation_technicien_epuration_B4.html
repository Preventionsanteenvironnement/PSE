<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module B.4 - Simulation Technicien √âpuration - Premi√®re Bac Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=OpenDyslexie&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-pse: #2E86AB;
            --secondary-pse: #A23B72;
            --success-pse: #219653;
            --warning-pse: #F2994A;
            --danger-pse: #EB5757;
            --dark-pse: #2F3542;
            --light-pse: #F1F2F6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', 'OpenDyslexie', Arial, sans-serif;
            font-size: 16px;
            line-height: 1.6;
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            min-height: 100vh;
            padding: 15px;
        }

        .exercice-container {
            width: 100%;
            max-width: 100vw;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
        }

        /* EN-T√äTE P√âDAGOGIQUE OBLIGATOIRE */
        .cadre-pedagogique {
            background: linear-gradient(135deg, var(--primary-pse) 0%, var(--secondary-pse) 100%);
            color: white;
            padding: 25px;
            text-align: center;
        }

        .module-info h2 {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .objectif {
            background: rgba(255,255,255,0.15);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-size: 1.1rem;
        }

        .competences-travaillees {
            margin-top: 20px;
        }

        .competences-list {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }

        .competences-list li {
            background: rgba(255,255,255,0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            border-left: 4px solid #fff;
        }

        .niveau-cible {
            margin-top: 15px;
            font-size: 1.1rem;
            font-weight: 600;
        }

        /* EXERCICE PRINCIPAL */
        .exercice-principal {
            padding: 30px 25px;
        }

        .scenario-intro {
            background: linear-gradient(135deg, #00cec9, #00b894);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }

        .scenario-intro h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        .station-dashboard {
            background: var(--light-pse);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            position: relative;
        }

        .dashboard-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 25px;
        }

        .station-status {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }

        .status-indicator {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-indicator.normal { background: var(--success-pse); }
        .status-indicator.alert { background: var(--warning-pse); }
        .status-indicator.danger { background: var(--danger-pse); }

        .parametres-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .parametre-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .parametre-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .parametre-nom {
            font-weight: 600;
            color: var(--dark-pse);
            margin-bottom: 5px;
        }

        .parametre-valeur {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary-pse);
            margin-bottom: 5px;
        }

        .parametre-status {
            font-size: 0.9rem;
            padding: 3px 8px;
            border-radius: 15px;
            font-weight: 500;
        }

        .status-normal { background: #d4edda; color: #155724; }
        .status-alert { background: #fff3cd; color: #856404; }
        .status-danger { background: #f8d7da; color: #721c24; }

        .incident-panel {
            background: linear-gradient(135deg, #ff7675, #d63031);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
        }

        .incident-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .incident-icon {
            font-size: 3rem;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        .incident-details {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }

        .choix-zone {
            display: grid;
            gap: 15px;
            margin: 25px 0;
        }

        .choix-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            position: relative;
        }

        .choix-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-color: var(--primary-pse);
        }

        .choix-card.selected {
            border-color: var(--warning-pse);
            background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
            transform: translateY(-3px);
        }

        .choix-card.correct {
            border-color: var(--success-pse);
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
        }

        .choix-card.incorrect {
            border-color: var(--danger-pse);
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
        }

        .choix-card h4 {
            color: var(--primary-pse);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .choix-card.selected h4,
        .choix-card.correct h4,
        .choix-card.incorrect h4 {
            color: var(--dark-pse);
        }

        .consequence {
            font-size: 0.9rem;
            color: #666;
            margin-top: 10px;
            font-style: italic;
        }

        .communication-panel {
            background: linear-gradient(135deg, #6c5ce7, #5f3dc4);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
        }

        .message-area {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }

        .message-template {
            background: white;
            color: var(--dark-pse);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            font-size: 0.95rem;
            line-height: 1.5;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .message-template:hover {
            border-color: var(--primary-pse);
            transform: translateX(5px);
        }

        .message-template.selected {
            border-color: var(--warning-pse);
            background: #ffeaa7;
        }

        .btn-principal {
            background: linear-gradient(135deg, var(--success-pse), #00b894);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin: 20px 0;
        }

        .btn-principal:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .btn-principal:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* FEEDBACK */
        .feedback-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .feedback-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .feedback-card {
            background: linear-gradient(135deg, #2a2a3e, #1e1e2f);
            color: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 90vw;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            position: relative;
        }

        .feedback-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .feedback-icon {
            font-size: 4rem;
            margin-bottom: 15px;
        }

        .feedback-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .correction-explicite {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .correction-explicite h4 {
            color: #ff7675;
            margin-bottom: 15px;
        }

        .bonne-reponse {
            background: rgba(0, 184, 148, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 4px solid #00b894;
        }

        .explication {
            background: rgba(255, 193, 7, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 4px solid #fdcb6e;
        }

        .astuce-bac {
            background: rgba(116, 185, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #74b9ff;
        }

        .astuce-bac strong {
            color: #74b9ff;
        }

        .btn-fermer {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .btn-fermer:hover {
            background: rgba(255,255,255,0.1);
        }

        /* PROGRESSION */
        .progression-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
        }

        .etape-indicator {
            flex: 1;
            height: 8px;
            background: #ddd;
            border-radius: 4px;
            position: relative;
        }

        .etape-indicator.completed {
            background: var(--success-pse);
        }

        .etape-indicator.active {
            background: var(--warning-pse);
        }

        .etape-label {
            font-size: 0.9rem;
            font-weight: 600;
            text-align: center;
            margin-top: 5px;
        }

        /* RGPD FOOTER */
        .rgpd-notice {
            background: #f8f9fa;
            padding: 15px;
            text-align: center;
            font-size: 0.9rem;
            color: #6c757d;
            border-top: 1px solid #dee2e6;
        }

        /* RESPONSIVE */
        @media (min-width: 768px) {
            body {
                font-size: 17px;
                padding: 20px;
            }
            
            .exercice-container {
                max-width: 1000px;
            }
            
            .cadre-pedagogique {
                padding: 35px;
            }
            
            .exercice-principal {
                padding: 40px 35px;
            }
            
            .parametres-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }
            
            .choix-zone {
                grid-template-columns: 1fr;
            }
        }

        @media (min-width: 1024px) {
            body {
                font-size: 18px;
                padding: 30px;
            }
            
            .exercice-container {
                max-width: 1200px;
            }
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="exercice-container">
        <!-- EN-T√äTE P√âDAGOGIQUE OBLIGATOIRE -->
        <div class="cadre-pedagogique">
            <div class="module-info">
                <h2>Module B.4 : L'eau et le d√©veloppement durable</h2>
                <div class="objectif">
                    <strong>Objectif :</strong> Adopter un comportement √©coresponsable afin de pr√©server les ressources en eau
                </div>
            </div>
            
            <div class="competences-travaillees">
                <h3>Comp√©tences travaill√©es dans cet exercice :</h3>
                <ul class="competences-list">
                    <li><strong>C4</strong> - Proposer une solution pour r√©soudre un probl√®me</li>
                    <li><strong>C5</strong> - Argumenter un choix</li>
                    <li><strong>C6</strong> - Communiquer avec une syntaxe claire et un vocabulaire adapt√©</li>
                </ul>
            </div>
            
            <div class="niveau-cible">
                <strong>Niveau :</strong> Bac Pro Premi√®re
            </div>
        </div>

        <!-- EXERCICE PRINCIPAL -->
        <main class="exercice-principal">
            <div class="scenario-intro">
                <h3>üè≠ SIMULATION PROFESSIONNELLE : Technicien Station d'√âpuration</h3>
                <p>Vous √™tes technicien dans une station d'√©puration urbaine. Un incident technique vient de se produire et compromet le traitement des eaux us√©es. Vous devez analyser la situation, prendre les bonnes d√©cisions et communiquer efficacement avec votre hi√©rarchie.</p>
            </div>

            <div class="progression-container" id="progressionContainer">
                <div class="etape-indicator active" id="etape1">
                    <div class="etape-label">1. Diagnostic</div>
                </div>
                <div class="etape-indicator" id="etape2">
                    <div class="etape-label">2. Action</div>
                </div>
                <div class="etape-indicator" id="etape3">
                    <div class="etape-label">3. Communication</div>
                </div>
            </div>

            <!-- √âTAPE 1 : DIAGNOSTIC -->
            <div class="station-dashboard" id="etapesDiagnostic">
                <div class="dashboard-header">
                    <h4>üìä Tableau de bord - Station d'√©puration AQUATECH</h4>
                    <div class="station-status">
                        <div class="status-indicator danger" id="statusIndicator"></div>
                        <span id="statusText">INCIDENT EN COURS</span>
                    </div>
                </div>

                <div class="parametres-grid">
                    <div class="parametre-card">
                        <div class="parametre-icon">ü¶†</div>
                        <div class="parametre-nom">DBO5</div>
                        <div class="parametre-valeur">450 mg/L</div>
                        <div class="parametre-status status-danger">Trop √©lev√©</div>
                    </div>
                    <div class="parametre-card">
                        <div class="parametre-icon">üß™</div>
                        <div class="parametre-nom">pH</div>
                        <div class="parametre-valeur">4.2</div>
                        <div class="parametre-status status-danger">Trop acide</div>
                    </div>
                    <div class="parametre-card">
                        <div class="parametre-icon">üí®</div>
                        <div class="parametre-nom">O2 dissous</div>
                        <div class="parametre-valeur">1.5 mg/L</div>
                        <div class="parametre-status status-danger">Insuffisant</div>
                    </div>
                    <div class="parametre-card">
                        <div class="parametre-icon">‚ö°</div>
                        <div class="parametre-nom">A√©rateurs</div>
                        <div class="parametre-valeur">2/6</div>
                        <div class="parametre-status status-danger">Panne</div>
                    </div>
                </div>
            </div>

            <div class="incident-panel">
                <div class="incident-header">
                    <div class="incident-icon">üö®</div>
                    <div>
                        <h4>ALERTE : Dysfonctionnement majeur d√©tect√©</h4>
                        <p>Heure : 14h30 - Secteur : Traitement biologique</p>
                    </div>
                </div>
                <div class="incident-details">
                    <strong>Situation :</strong> Quatre a√©rateurs sur six sont en panne dans le bassin d'a√©ration. 
                    Le niveau d'oxyg√®ne dissous chute dangereusement, le pH devient acide, et la DBO5 
                    (Demande Biologique en Oxyg√®ne) explose. Les bact√©ries √©puratrices risquent de mourir, 
                    compromettant tout le processus d'√©puration.
                </div>
            </div>

            <!-- √âTAPE 2 : CHOIX D'ACTION -->
            <div class="choix-zone" id="etapesAction" style="display: none;">
                <h4>‚ö° Quelle est votre premi√®re action prioritaire ?</h4>
                
                <div class="choix-card" data-choix="maintenance" data-correct="false">
                    <h4>üîß Appeler imm√©diatement la maintenance</h4>
                    <p>Contacter l'√©quipe de maintenance pour r√©parer les a√©rateurs en panne.</p>
                    <div class="consequence">‚è±Ô∏è Temps d'intervention : 3-4 heures. Risque de mortalit√© des bact√©ries.</div>
                </div>

                <div class="choix-card" data-choix="bypass" data-correct="true">
                    <h4>üö∞ Activer le syst√®me de bypass d'urgence</h4>
                    <p>D√©river une partie des eaux vers les bassins de secours et augmenter l'oxyg√©nation.</p>
                    <div class="consequence">‚úÖ Action imm√©diate. Stabilisation en 30 minutes. Solution temporaire efficace.</div>
                </div>

                <div class="choix-card" data-choix="rejet" data-correct="false">
                    <h4>‚õî Arr√™ter le traitement temporairement</h4>
                    <p>Stopper l'arriv√©e des eaux us√©es le temps de la r√©paration.</p>
                    <div class="consequence">‚ùå Risque de d√©bordement des r√©seaux. Pollution environnementale.</div>
                </div>

                <div class="choix-card" data-choix="produits" data-correct="false">
                    <h4>üß™ Ajouter des produits chimiques</h4>
                    <p>Injecter de la chaux pour corriger le pH et du peroxyde d'hydrog√®ne pour l'oxyg√®ne.</p>
                    <div class="consequence">‚ö†Ô∏è Solution co√ªteuse. Risque de d√©s√©quilibre biologique. Effets secondaires.</div>
                </div>

                <button class="btn-principal" id="btnValiderAction" disabled>
                    ‚ö° D√âCLENCHER L'ACTION D'URGENCE
                </button>
            </div>

            <!-- √âTAPE 3 : COMMUNICATION -->
            <div class="communication-panel" id="etapesCommunication" style="display: none;">
                <h4>üìû Communication avec la hi√©rarchie</h4>
                <p>Vous devez maintenant informer votre chef d'√©quipe de la situation et des mesures prises. Choisissez le message le plus professionnel et pr√©cis :</p>
                
                <div class="message-area">
                    <div class="message-template" data-message="correct">
                        <strong>üìã Message professionnel :</strong><br>
                        "Chef, incident technique en cours sur bassin d'a√©ration : 4 a√©rateurs HS, chute O2 √† 1.5 mg/L, pH acide √† 4.2. 
                        J'ai activ√© le bypass d'urgence, situation sous contr√¥le. Demande intervention maintenance en urgence. 
                        Qualit√© rejet temporairement assur√©e par bassins de secours. Rapport d√©taill√© en cours."
                    </div>

                    <div class="message-template" data-message="incomplete">
                        <strong>üì± Message incomplet :</strong><br>
                        "Salut chef, on a un probl√®me avec les a√©rateurs. √áa marche plus tr√®s bien. 
                        J'ai fait quelque chose pour arranger √ßa temporairement. Faudrait appeler quelqu'un pour r√©parer."
                    </div>

                    <div class="message-template" data-message="panique">
                        <strong>üò∞ Message alarmiste :</strong><br>
                        "URGENCE ! Catastrophe √† la station ! Tout est en panne ! Les bact√©ries vont mourir ! 
                        On va polluer toute la rivi√®re ! Il faut absolument faire quelque chose imm√©diatement !"
                    </div>
                </div>

                <button class="btn-principal" id="btnValiderCommunication" disabled>
                    üì§ ENVOYER LE MESSAGE
                </button>
            </div>
        </main>

        <!-- RGPD FOOTER -->
        <div class="rgpd-notice">
            üîí Conformit√© RGPD : Cet exercice respecte votre anonymat.
        </div>
    </div>

    <!-- FEEDBACK OVERLAY -->
    <div class="feedback-overlay" id="feedbackOverlay">
        <div class="feedback-card">
            <button class="btn-fermer" id="btnFermer">√ó</button>
            <div class="feedback-header">
                <div class="feedback-icon" id="feedbackIcon">üéØ</div>
                <div class="feedback-title" id="feedbackTitle">Mission accomplie !</div>
            </div>
            <div id="feedbackContent"></div>
        </div>
    </div>

    <script>
        class SimulationTechnicien {
            constructor() {
                this.etapeActuelle = 1;
                this.choixAction = null;
                this.choixCommunication = null;
                this.score = 0;
                this.init();
            }

            init() {
                this.attachEventListeners();
                this.demarrerSimulation();
            }

            attachEventListeners() {
                // Actions d'urgence
                document.querySelectorAll('[data-choix]').forEach(card => {
                    card.addEventListener('click', (e) => this.selectionnerAction(e.target.closest('[data-choix]')));
                });

                // Messages
                document.querySelectorAll('[data-message]').forEach(template => {
                    template.addEventListener('click', (e) => this.selectionnerMessage(e.target.closest('[data-message]')));
                });

                // Boutons validation
                document.getElementById('btnValiderAction').addEventListener('click', () => this.validerAction());
                document.getElementById('btnValiderCommunication').addEventListener('click', () => this.validerCommunication());
                
                // Fermer feedback
                document.getElementById('btnFermer').addEventListener('click', () => this.fermerFeedback());
                document.getElementById('feedbackOverlay').addEventListener('click', (e) => {
                    if (e.target.id === 'feedbackOverlay') this.fermerFeedback();
                });
            }

            demarrerSimulation() {
                // Animation du tableau de bord
                setTimeout(() => {
                    this.passerEtapeSuivante();
                }, 3000);
            }

            selectionnerAction(card) {
                // D√©s√©lectionner les autres
                document.querySelectorAll('[data-choix]').forEach(c => c.classList.remove('selected'));
                
                // S√©lectionner la nouvelle
                card.classList.add('selected');
                this.choixAction = card.dataset.choix;
                
                document.getElementById('btnValiderAction').disabled = false;
            }

            validerAction() {
                const cards = document.querySelectorAll('[data-choix]');
                let feedback = '';
                
                cards.forEach(card => {
                    if (card.dataset.correct === 'true') {
                        card.classList.add('correct');
                        if (card.dataset.choix === this.choixAction) {
                            this.score += 50;
                        }
                    } else if (card.dataset.choix === this.choixAction) {
                        card.classList.add('incorrect');
                    }
                });

                // Feedback imm√©diat
                if (this.choixAction === 'bypass') {
                    feedback = '<div class="bonne-reponse">‚úÖ <strong>Excellente d√©cision !</strong> Le bypass d\'urgence permet de stabiliser imm√©diatement la situation.</div>';
                } else {
                    feedback = '<div class="correction-explicite"><h4>‚ùå CORRECTION</h4>';
                    feedback += '<div class="bonne-reponse"><strong>‚úÖ LA BONNE ACTION √âTAIT :</strong><br>Activer le syst√®me de bypass d\'urgence</div>';
                    feedback += '<div class="explication"><strong>üí° EXPLICATION :</strong> En cas de panne d\'a√©rateurs, la priorit√© est de maintenir l\'oxyg√©nation des bact√©ries √©puratrices. Le bypass permet de r√©partir la charge et d\'√©viter la mortalit√© bact√©rienne.</div></div>';
                }

                setTimeout(() => {
                    this.afficherFeedbackIntermediaire(feedback);
                    setTimeout(() => {
                        this.fermerFeedback();
                        this.passerEtapeSuivante();
                    }, 3000);
                }, 1000);
            }

            selectionnerMessage(template) {
                // D√©s√©lectionner les autres
                document.querySelectorAll('[data-message]').forEach(t => t.classList.remove('selected'));
                
                // S√©lectionner le nouveau
                template.classList.add('selected');
                this.choixCommunication = template.dataset.message;
                
                document.getElementById('btnValiderCommunication').disabled = false;
            }

            validerCommunication() {
                if (this.choixCommunication === 'correct') {
                    this.score += 50;
                }
                
                this.terminerSimulation();
            }

            passerEtapeSuivante() {
                this.etapeActuelle++;
                
                // Mettre √† jour la progression
                for (let i = 1; i < this.etapeActuelle; i++) {
                    document.getElementById(`etape${i}`).classList.remove('active');
                    document.getElementById(`etape${i}`).classList.add('completed');
                }
                
                if (this.etapeActuelle <= 3) {
                    document.getElementById(`etape${this.etapeActuelle}`).classList.add('active');
                }

                // Afficher la bonne √©tape
                if (this.etapeActuelle === 2) {
                    document.getElementById('etapesDiagnostic').style.display = 'none';
                    document.getElementById('etapesAction').style.display = 'block';
                } else if (this.etapeActuelle === 3) {
                    document.getElementById('etapesAction').style.display = 'none';
                    document.getElementById('etapesCommunication').style.display = 'block';
                }
            }

            terminerSimulation() {
                let feedback = '<div class="correction-explicite">';
                feedback += '<h4>‚úÖ SIMULATION TERMIN√âE</h4>';
                
                feedback += '<div class="bonne-reponse">';
                feedback += '<strong>üìã ANALYSE DE VOTRE PERFORMANCE :</strong><br>';
                
                if (this.choixAction === 'bypass') {
                    feedback += '‚ö° <strong>Action d\'urgence :</strong> Excellent ! Le bypass √©tait la solution optimale.<br>';
                } else {
                    feedback += '‚ö° <strong>Action d\'urgence :</strong> √Ä am√©liorer. Le bypass √©tait plus efficace.<br>';
                }
                
                if (this.choixCommunication === 'correct') {
                    feedback += 'üìû <strong>Communication :</strong> Parfait ! Message pr√©cis et professionnel.';
                } else if (this.choixCommunication === 'incomplete') {
                    feedback += 'üìû <strong>Communication :</strong> Manque de pr√©cision technique.';
                } else {
                    feedback += 'üìû <strong>Communication :</strong> Trop alarmiste, g√©n√®re du stress inutile.';
                }
                feedback += '</div>';
                
                feedback += '<div class="explication">';
                feedback += '<strong>üí° EXPLICATION TECHNIQUE :</strong><br>';
                feedback += 'En station d\'√©puration, la survie des bact√©ries √©puratrices d√©pend de l\'oxyg√©nation. ';
                feedback += 'Une chute de l\'O2 dissous compromet le processus biologique. Le pH acide inhibe √©galement l\'activit√© bact√©rienne. ';
                feedback += 'Le bypass d\'urgence permet de r√©partir la charge polluante et maintenir l\'efficacit√© du traitement.';
                feedback += '</div>';
                
                feedback += '<div class="astuce-bac">';
                feedback += '<strong>üéØ ASTUCE BAC :</strong> ';
                feedback += 'Retenez les param√®tres critiques : O2 dissous > 2 mg/L, pH entre 6.5-8.5, DBO5 < 25 mg/L en sortie. ';
                feedback += 'En situation d\'urgence, la communication doit √™tre factuelle, pr√©cise et inclure les mesures prises. ';
                feedback += 'Un technicien doit conna√Ætre les proc√©dures d\'urgence et savoir prioriser les actions.';
                feedback += '</div>';
                
                feedback += '</div>';
                
                this.showFeedback(this.score >= 80 ? 'success' : 'partial', feedback);
            }

            afficherFeedbackIntermediaire(content) {
                document.getElementById('feedbackIcon').textContent = '‚ö°';
                document.getElementById('feedbackTitle').textContent = 'Action en cours...';
                document.getElementById('feedbackContent').innerHTML = content;
                document.getElementById('feedbackOverlay').classList.add('show');
            }

            showFeedback(type, content) {
                const overlay = document.getElementById('feedbackOverlay');
                const icon = document.getElementById('feedbackIcon');
                const title = document.getElementById('feedbackTitle');
                const feedbackContent = document.getElementById('feedbackContent');
                
                if (type === 'success') {
                    icon.textContent = 'üèÜ';
                    title.textContent = `Mission r√©ussie ! Score : ${this.score}/100`;
                } else {
                    icon.textContent = 'üìã';
                    title.textContent = `Mission termin√©e - Score : ${this.score}/100`;
                }
                
                feedbackContent.innerHTML = content;
                overlay.classList.add('show');
            }

            fermerFeedback() {
                document.getElementById('feedbackOverlay').classList.remove('show');
            }
        }

        // Initialisation au chargement de la page
        window.addEventListener('DOMContentLoaded', () => {
            new SimulationTechnicien();
        });
    </script>
</body>
</html>