<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module C9 ‚Äì Mission RPS : Les 6 facteurs de Gollac</title>
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --primary: #bb86fc;
            --secondary: #03dac6;
            --error: #cf6679;
            --warning: #f59e0b;
            --text: #ffffff;
            --text-muted: #b0b0b0;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, sans-serif;
            background-color: var(--bg-color);
            color: var(--text);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .app-container {
            max-width: 650px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        /* Header & Progress */
        header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(30, 30, 30, 0.98);
            padding: 12px 20px;
            z-index: 100;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            font-weight: bold;
            font-size: 0.95rem;
        }

        .header-score {
            background: var(--primary);
            color: black;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.85rem;
        }

        .progress-bar {
            position: fixed;
            top: 52px;
            left: 0;
            right: 0;
            height: 5px;
            background: #333;
            z-index: 99;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary), var(--primary));
            width: 0%;
            transition: width 0.4s ease;
        }

        /* Cards */
        .card {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.5);
            margin-top: 70px;
            animation: slideUp 0.4s ease-out;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 { 
            margin: 0 0 10px 0; 
            font-size: 1.6rem;
            color: var(--primary);
        }
        h2 { 
            color: var(--secondary); 
            font-size: 1.2rem; 
            margin: 0 0 15px 0;
        }
        h3 {
            color: var(--primary);
            font-size: 1.1rem;
            margin: 0 0 10px 0;
        }
        p { 
            color: var(--text-muted); 
            line-height: 1.6; 
            margin: 0 0 15px 0;
        }

        /* === PAGE 0 : OBJECTIFS === */
        .objectif-box {
            background: linear-gradient(135deg, rgba(187, 134, 252, 0.15), rgba(3, 218, 198, 0.1));
            border: 1px solid rgba(187, 134, 252, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .objectif-box h3 {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .objectif-box ul {
            margin: 10px 0 0 20px;
            padding: 0;
            color: var(--text-muted);
        }

        .objectif-box li {
            margin: 8px 0;
        }

        .badge-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            border-radius: 25px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .badge-primary {
            background: rgba(187, 134, 252, 0.2);
            border: 1px solid var(--primary);
            color: var(--primary);
        }

        .badge-secondary {
            background: rgba(3, 218, 198, 0.2);
            border: 1px solid var(--secondary);
            color: var(--secondary);
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.2);
            border: 1px solid var(--warning);
            color: var(--warning);
        }

        .consignes-box {
            background: #2a2a2a;
            border-left: 4px solid var(--warning);
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .consignes-box h4 {
            color: var(--warning);
            margin: 0 0 10px 0;
            font-size: 0.95rem;
        }

        .consignes-box ol {
            margin: 0;
            padding-left: 20px;
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .consignes-box li {
            margin: 6px 0;
        }

        /* Competence tag dans les questions */
        .competence-tag {
            display: inline-block;
            background: var(--primary);
            color: black;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 700;
            margin-left: 8px;
        }

        .points-tag {
            display: inline-block;
            background: var(--secondary);
            color: black;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 700;
            margin-left: 5px;
        }

        /* Images */
        .img-wrapper {
            background: white;
            padding: 10px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: inline-block;
        }
        img {
            max-width: 100%;
            max-height: 220px;
            border-radius: 8px;
            object-fit: contain;
        }

        /* Boutons */
        .btn-grid {
            display: grid;
            gap: 10px;
        }

        button {
            background-color: #2d2d2d;
            color: white;
            border: 2px solid #444;
            padding: 14px 16px;
            border-radius: 12px;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            font-weight: 500;
        }

        button:hover, button:active {
            background-color: #3d3d3d;
            border-color: #555;
            transform: scale(1.01);
        }

        button.selected-correct {
            background-color: rgba(3, 218, 198, 0.2);
            border-color: var(--secondary);
            color: var(--secondary);
        }

        button.selected-wrong {
            background-color: rgba(207, 102, 121, 0.2);
            border-color: var(--error);
            color: var(--error);
        }

        button.primary-action {
            background: linear-gradient(135deg, var(--primary), #9d4edd);
            color: white;
            border: none;
            text-align: center;
            width: 100%;
            margin-top: 20px;
            font-weight: 700;
            font-size: 1rem;
            padding: 16px;
        }

        button.primary-action:hover {
            filter: brightness(1.1);
        }

        /* Feedback Zone */
        .feedback-box {
            margin-top: 20px;
            padding: 18px;
            border-radius: 12px;
            background: #252525;
            display: none;
            border-left: 4px solid var(--secondary);
            text-align: left;
        }
        .feedback-box.error { 
            border-left-color: var(--error); 
        }

        .feedback-box strong {
            font-size: 1.1rem;
        }

        /* Screens visibility */
        .screen { display: none; }
        .screen.active { display: block; }

        /* Checklist Auto-eval */
        .checklist-item {
            display: flex;
            align-items: flex-start;
            background: #2a2a2a;
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 10px;
            text-align: left;
            gap: 12px;
        }
        .checklist-item input {
            transform: scale(1.4);
            margin-top: 3px;
            accent-color: var(--secondary);
        }
        .checklist-item span {
            color: var(--text-muted);
            font-size: 0.95rem;
        }

        /* R√©sultat final */
        .result-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px auto;
            box-shadow: 0 0 40px rgba(3, 218, 198, 0.3);
        }

        .result-circle span {
            font-size: 2.2rem;
            font-weight: 900;
            color: black;
        }

        .result-msg {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
        }

        /* Responsive */
        @media (max-width: 500px) {
            .card { padding: 20px; margin-top: 65px; }
            h1 { font-size: 1.4rem; }
            .badge-row { gap: 8px; }
            .badge { padding: 6px 10px; font-size: 0.8rem; }
        }
    </style>
</head>
<body>

    <header>
        <span class="header-title">üìã Module C9 ‚Äì Mission RPS</span>
        <span class="header-score" id="score-display">0 / 20</span>
    </header>
    <div class="progress-bar"><div class="progress-fill" id="progress"></div></div>

    <div class="app-container">
        
        <!-- === √âCRAN 0 : PAGE D'ACCUEIL AVEC OBJECTIFS === -->
        <div id="screen-welcome" class="screen active card">
            <h1>üéì Mission : Pr√©vention RPS</h1>
            <p style="color:var(--secondary); font-weight:600; margin-bottom:20px;">
                üìö Approfondissement : Les 6 facteurs de risques de Gollac
            </p>

            <div class="objectif-box">
                <h3>üéØ Comp√©tence & Objectif</h3>
                <p style="margin:10px 0;"><b>Module C9 :</b> Pr√©venir les risques psychosociaux au travail.</p>
                <p style="margin:0;"><b>√ätre capable de :</b></p>
                <ul>
                    <li>Identifier les 3 types de RPS (stress, violences internes, violences externes)</li>
                    <li>Reconna√Ætre les 6 facteurs de risques (mod√®le de Gollac)</li>
                    <li>Distinguer les cons√©quences sur la sant√© et sur l'entreprise</li>
                    <li>S√©lectionner une mesure de pr√©vention adapt√©e</li>
                </ul>
                <div class="badge-row">
                    <span class="badge badge-primary">C2 Analyser</span>
                    <span class="badge badge-primary">C3 Expliquer</span>
                    <span class="badge badge-primary">C4 Proposer</span>
                    <span class="badge badge-secondary">20 questions</span>
                    <span class="badge badge-warning">20 points</span>
                </div>
            </div>

            <div class="consignes-box">
                <h4>üìù Consignes</h4>
                <ol>
                    <li><b>Lire</b> chaque situation attentivement</li>
                    <li><b>Analyser</b> l'image si elle est pr√©sente</li>
                    <li><b>S√©lectionner</b> la bonne r√©ponse parmi les propositions</li>
                    <li><b>Justifier</b> mentalement ton choix √† partir du cours</li>
                    <li><b>Valider</b> ta progression jusqu'√† la fin</li>
                    <li><b>T'auto√©valuer</b> en cochant ce que tu ma√Ætrises</li>
                </ol>
            </div>

            <div class="img-wrapper" style="text-align:center; width:100%;">
                <img src="imagesrps/risquepsychosociaux.jpg" alt="RPS" onerror="this.style.display='none'">
            </div>

            <button class="primary-action" onclick="startQuiz()">üöÄ Commencer la mission</button>
        </div>

        <!-- === √âCRAN QUIZ === -->
        <div id="screen-quiz" class="screen card">
            <h2 id="q-category">Cat√©gorie</h2>
            <p id="q-competence" style="margin:-10px 0 15px 0; font-size:0.85rem;"></p>
            
            <div id="q-image-container" class="img-wrapper" style="display:none; text-align:center; width:100%;">
                <img id="q-image" src="" alt="Situation">
            </div>
            <p id="q-text" style="color:white; font-size:1.05rem; font-weight:500;">La question va ici...</p>
            
            <div id="options-container" class="btn-grid"></div>

            <div id="feedback" class="feedback-box">
                <strong id="feedback-title"></strong>
                <p id="feedback-text" style="margin:8px 0 0 0; color:var(--text-muted); font-size:0.9rem; line-height:1.5;"></p>
                <button class="primary-action" onclick="nextQuestion()">Continuer ‚ûî</button>
            </div>
        </div>

        <!-- === √âCRAN AUTO-√âVALUATION === -->
        <div id="screen-autoeval" class="screen card">
            <h2>üìù Auto-√©valuation</h2>
            <p>Avant de voir ton score final, coche les comp√©tences que tu penses ma√Ætriser :</p>
            
            <div class="checklist-item">
                <input type="checkbox" id="check1"> 
                <span><b>C2 ‚Äì</b> Je sais identifier les 3 types de RPS (stress, violences internes/externes).</span>
            </div>
            <div class="checklist-item">
                <input type="checkbox" id="check2"> 
                <span><b>C2 ‚Äì</b> Je reconnais les 6 facteurs de risques de Gollac.</span>
            </div>
            <div class="checklist-item">
                <input type="checkbox" id="check3"> 
                <span><b>C3 ‚Äì</b> Je distingue burn-out et bore-out.</span>
            </div>
            <div class="checklist-item">
                <input type="checkbox" id="check4"> 
                <span><b>C3 ‚Äì</b> Je connais les obligations de l'employeur et le DUERP.</span>
            </div>
            <div class="checklist-item">
                <input type="checkbox" id="check5"> 
                <span><b>C4 ‚Äì</b> Je sais proposer une mesure de pr√©vention adapt√©e.</span>
            </div>
            
            <button class="primary-action" onclick="showResults()">üìä Voir mon bilan</button>
        </div>

        <!-- === √âCRAN R√âSULTAT === -->
        <div id="screen-result" class="screen card" style="text-align:center;">
            <h1>üèÅ Mission Termin√©e !</h1>
            
            <div class="result-circle">
                <span id="final-score-value">0</span>
            </div>
            
            <div class="result-msg">
                <p id="final-msg" style="color:white; margin:0;">Analyse en cours...</p>
            </div>

            <div id="competences-recap" style="text-align:left; margin-top:20px;">
                <h3 style="color:var(--secondary);">üìä Bilan par comp√©tence</h3>
                <div id="comp-details"></div>
            </div>
            
            <button class="primary-action" onclick="location.reload()">üîÑ Recommencer la mission</button>
        </div>

    </div>

<script>
    // === DONN√âES DU QUIZ AVEC COMP√âTENCES ===
    const quizData = [
        // PHASE 1 : DIAGNOSTIC (C3 - Expliquer)
        {
            category: "Phase 1 : Diagnostic",
            competence: "C3",
            competenceLabel: "Expliquer",
            text: "Qu'est-ce qu'un Risque Psychosocial (RPS) ?",
            options: [
                "Un risque li√© uniquement aux machines", 
                "Un risque pour la sant√© mentale et physique li√© au travail", 
                "Un conflit personnel sans lien avec le travail"
            ],
            correct: 1,
            feedback: "Les RPS sont des risques pour la sant√© physique ET mentale des travailleurs, caus√©s par l'organisation du travail et les relations professionnelles."
        },
        {
            category: "Phase 1 : Diagnostic",
            competence: "C3",
            competenceLabel: "Expliquer",
            text: "Qui est responsable l√©galement de la sant√© des salari√©s ?",
            options: [
                "Le salari√© lui-m√™me", 
                "L'employeur (obligation de s√©curit√©)", 
                "La m√©decine du travail uniquement"
            ],
            correct: 1,
            feedback: "C'est l'employeur ! Selon le Code du travail (art. L4121-1), il a une obligation de r√©sultat concernant la s√©curit√© et la sant√© des salari√©s."
        },
        {
            category: "Phase 1 : Diagnostic",
            competence: "C3",
            competenceLabel: "Expliquer",
            text: "Les RPS ont un co√ªt financier pour l'entreprise. Vrai ou Faux ?",
            options: ["Vrai", "Faux"],
            correct: 0,
            feedback: "Vrai ! Absent√©isme, baisse de productivit√©, turnover et mauvaise image co√ªtent tr√®s cher √† l'entreprise."
        },

        // PHASE 2 : VOCABULAIRE (C2 - Analyser + C3 - Expliquer)
        {
            category: "Phase 2 : Vocabulaire",
            competence: "C2",
            competenceLabel: "Analyser",
            text: "Analysez cette image. De quoi souffre ce salari√© ?",
            image: "imagesrps/Stress.jpg",
            options: [
                "De harc√®lement", 
                "De stress (surcharge)", 
                "De violence externe"
            ],
            correct: 1,
            feedback: "C'est le STRESS : un d√©s√©quilibre entre les contraintes (pile de dossiers) et les ressources disponibles pour y faire face."
        },
        {
            category: "Phase 2 : Vocabulaire",
            competence: "C2",
            competenceLabel: "Analyser",
            text: "Quelle est la situation repr√©sent√©e sur cette image ?",
            image: "imagesrps/boreout.jpg",
            options: [
                "Un burn-out (surcharge)", 
                "Un bore-out (ennui)", 
                "C'est la m√™me chose"
            ],
            correct: 1,
            feedback: "C'est un BORE-OUT : l'√©puisement professionnel par l'ennui et le manque de t√¢ches. C'est l'inverse du burn-out."
        },
        {
            category: "Phase 2 : Vocabulaire",
            competence: "C2",
            competenceLabel: "Analyser",
            text: "Cette sc√®ne se passe entre coll√®gues. Quel type de risque ?",
            image: "imagesrps/violenceinterne.jpg",
            options: [
                "Violence interne", 
                "Violence externe", 
                "Stress"
            ],
            correct: 0,
            feedback: "VIOLENCE INTERNE : harc√®lement ou conflit qui se passe √Ä L'INT√âRIEUR de l'entreprise (entre coll√®gues ou avec la hi√©rarchie)."
        },
        {
            category: "Phase 2 : Vocabulaire",
            competence: "C2",
            competenceLabel: "Analyser",
            text: "Un client insulte un ouvrier sur un chantier. C'est...",
            image: "imagesrps/violenceexterne.jpg",
            options: [
                "Une incivilit√© interne", 
                "Une violence externe", 
                "Un conflit de valeur"
            ],
            correct: 1,
            feedback: "VIOLENCE EXTERNE : l'agresseur (client, usager, patient) est ext√©rieur √† l'entreprise."
        },
        {
            category: "Phase 2 : Vocabulaire",
            competence: "C3",
            competenceLabel: "Expliquer",
            text: "Le harc√®lement sexuel est d√©fini comme...",
            options: [
                "Des propos ou comportements √† connotation sexuelle r√©p√©t√©s", 
                "Une simple blague lourde une fois", 
                "Une critique sur le travail"
            ],
            correct: 0,
            feedback: "Exact. Le harc√®lement sexuel = propos/comportements √† connotation sexuelle r√©p√©t√©s OU pression grave m√™me non r√©p√©t√©e (loi du 2 ao√ªt 2021)."
        },

        // PHASE 3 : LES 6 FACTEURS DE GOLLAC (C2 - Analyser)
        {
            category: "Phase 3 : Les 6 facteurs (Gollac)",
            competence: "C2",
            competenceLabel: "Analyser",
            text: "Regardez cette image. Quel facteur de risque ?",
            image: "imagesrps/manquedautonomie.jpg",
            options: [
                "Intensit√© du travail", 
                "Manque d'autonomie", 
                "Ins√©curit√© de l'emploi"
            ],
            correct: 1,
            feedback: "MANQUE D'AUTONOMIE (Gollac n¬∞3) : le salari√© ne peut pas prendre de d√©cisions sur son travail, il est ¬´ cadenass√© ¬ª."
        },
        {
            category: "Phase 3 : Les 6 facteurs (Gollac)",
            competence: "C2",
            competenceLabel: "Analyser",
            text: "Devoir cacher sa tristesse ou sourire forc√© face √† un client, c'est...",
            image: "imagesrps/Exigencesemotionnelles.jpg",
            options: [
                "Des exigences √©motionnelles", 
                "Des rapports sociaux d√©grad√©s", 
                "De la violence physique"
            ],
            correct: 0,
            feedback: "EXIGENCES √âMOTIONNELLES (Gollac n¬∞2) : devoir ma√Ætriser ses √©motions pour le travail, ce qui est √©puisant √† long terme."
        },
        {
            category: "Phase 3 : Les 6 facteurs (Gollac)",
            competence: "C2",
            competenceLabel: "Analyser",
            text: "Avoir peur de perdre son emploi ou ne pas savoir si son contrat sera renouvel√©.",
            image: "imagesrps/Insecuritedelasituationdetravail.jpg",
            options: [
                "Conflit de valeurs", 
                "Ins√©curit√© de la situation de travail", 
                "Intensit√© du travail"
            ],
            correct: 1,
            feedback: "INS√âCURIT√â DE LA SITUATION DE TRAVAIL (Gollac n¬∞6) : la pr√©carit√© et l'incertitude sont de gros facteurs de stress."
        },
        {
            category: "Phase 3 : Les 6 facteurs (Gollac)",
            competence: "C2",
            competenceLabel: "Analyser",
            text: "Travailler dans le bruit, √™tre interrompu tout le temps, devoir aller trop vite.",
            image: "imagesrps/Intensiteetempsde travail.jpg",
            options: [
                "Rapports sociaux d√©grad√©s", 
                "Intensit√© et temps de travail", 
                "Manque d'autonomie"
            ],
            correct: 1,
            feedback: "INTENSIT√â ET TEMPS DE TRAVAIL (Gollac n¬∞1) : la pression du rythme, les d√©lais, les interruptions, les conditions difficiles."
        },
        {
            category: "Phase 3 : Les 6 facteurs (Gollac)",
            competence: "C2",
            competenceLabel: "Analyser",
            text: "Devoir vendre un produit qu'on sait √™tre une arnaque. √áa heurte ma conscience.",
            image: "imagesrps/conflitsdevaleurs.jpg",
            options: [
                "Conflits de valeurs", 
                "Exigences √©motionnelles", 
                "Violence interne"
            ],
            correct: 0,
            feedback: "CONFLITS DE VALEURS (Gollac n¬∞5) : on me demande de faire quelque chose que je d√©sapprouve moralement ou √©thiquement."
        },
        {
            category: "Phase 3 : Les 6 facteurs (Gollac)",
            competence: "C2",
            competenceLabel: "Analyser",
            text: "Mon chef ne me dit jamais bonjour et me critique devant tout le monde.",
            image: "imagesrps/Rapportssociauxautravaildegrades.jpg",
            options: [
                "Rapports sociaux d√©grad√©s", 
                "Ins√©curit√© de l'emploi", 
                "Intensit√© du travail"
            ],
            correct: 0,
            feedback: "RAPPORTS SOCIAUX D√âGRAD√âS (Gollac n¬∞4) : manque de soutien, mauvaise ambiance, management toxique."
        },

        // PHASE 4 : CONS√âQUENCES & PR√âVENTION (C3 + C4)
        {
            category: "Phase 4 : Cons√©quences",
            competence: "C3",
            competenceLabel: "Expliquer",
            text: "Quelle image repr√©sente une cons√©quence sur l'int√©grit√© PHYSIQUE ?",
            image: "imagesrps/integritephysique.jpg",
            options: [
                "Le mal de dos (TMS)", 
                "La d√©pression", 
                "L'absent√©isme"
            ],
            correct: 0,
            feedback: "Les TMS (Troubles Musculo-Squelettiques) sont des atteintes √† l'INT√âGRIT√â PHYSIQUE : le corps est endommag√©."
        },
        {
            category: "Phase 4 : Cons√©quences",
            competence: "C3",
            competenceLabel: "Expliquer",
            text: "Quelle image repr√©sente une atteinte √† l'int√©grit√© MENTALE ?",
            image: "imagesrps/integritementale.jpg",
            options: [
                "Maladie cardio-vasculaire", 
                "D√©pression / Anxi√©t√©", 
                "Accident du travail"
            ],
            correct: 1,
            feedback: "D√©pression et anxi√©t√© sont des atteintes √† l'INT√âGRIT√â MENTALE (psychique) : fragilisation de l'estime de soi, burn-out."
        },
        {
            category: "Phase 4 : Cons√©quences",
            competence: "C3",
            competenceLabel: "Expliquer",
            text: "Si les salari√©s sont malades, quelles sont les cons√©quences pour l'entreprise ?",
            image: "imagesrps/consequence_entreprise.jpg",
            options: [
                "Aucune cons√©quence", 
                "Absent√©isme et baisse de productivit√©", 
                "Baisse des imp√¥ts"
            ],
            correct: 1,
            feedback: "Co√ªt √©norme pour l'entreprise : absent√©isme, turnover, baisse de qualit√©, mauvaise image, difficult√©s √† recruter."
        },
        {
            category: "Phase 4 : Pr√©vention",
            competence: "C4",
            competenceLabel: "Proposer",
            text: "Situation : Trop de bruit dans l'open-space. Quelle est la MEILLEURE pr√©vention ?",
            options: [
                "Donner des boules Quies (protection individuelle)", 
                "Installer des cloisons anti-bruit (pr√©vention collective)", 
                "Dire aux gens de chuchoter (information)"
            ],
            correct: 1,
            feedback: "Toujours privil√©gier la PR√âVENTION COLLECTIVE (modifier l'environnement) avant la protection individuelle."
        },
        {
            category: "Phase 4 : Pr√©vention",
            competence: "C3",
            competenceLabel: "Expliquer",
            text: "Le Document Unique (DUERP) sert √†...",
            image: "imagesrps/Lecadre_reglementaire.jpg",
            options: [
                "Licencier les gens stress√©s", 
                "Lister et √©valuer les risques dans l'entreprise", 
                "Donner des amendes aux salari√©s"
            ],
            correct: 1,
            feedback: "Le DUERP est OBLIGATOIRE. L'employeur y liste tous les risques identifi√©s et les mesures de pr√©vention pr√©vues."
        },
        {
            category: "Phase 4 : Pr√©vention",
            competence: "C3",
            competenceLabel: "Expliquer",
            text: "Derni√®re question ! Qui peut aider un salari√© en souffrance ?",
            options: [
                "Le m√©decin du travail", 
                "Les repr√©sentants du personnel (CSE)", 
                "Les deux"
            ],
            correct: 2,
            feedback: "Les deux ! On peut aussi contacter l'inspection du travail, des psychologues, ou des associations sp√©cialis√©es."
        }
    ];

    // === VARIABLES ===
    let currentQuestionIndex = 0;
    let score = 0;
    let scoresByCompetence = { C2: 0, C3: 0, C4: 0 };
    let maxByCompetence = { C2: 0, C3: 0, C4: 0 };

    // Calculer le max par comp√©tence
    quizData.forEach(q => {
        if (maxByCompetence[q.competence] !== undefined) {
            maxByCompetence[q.competence]++;
        }
    });

    // === FONCTIONS ===
    function startQuiz() {
        showScreen('screen-quiz');
        loadQuestion();
    }

    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    function loadQuestion() {
        const q = quizData[currentQuestionIndex];
        
        // Cat√©gorie + Comp√©tence
        document.getElementById('q-category').innerText = q.category;
        document.getElementById('q-competence').innerHTML = 
            `<span class="competence-tag">${q.competence}</span>` +
            `<span class="points-tag">1 pt</span>` +
            ` <span style="color:var(--text-muted);">‚Äî ${q.competenceLabel}</span>`;
        
        // Question
        document.getElementById('q-text').innerText = q.text;
        
        // Image ?
        const imgContainer = document.getElementById('q-image-container');
        const img = document.getElementById('q-image');
        if (q.image) {
            imgContainer.style.display = 'inline-block';
            img.src = q.image;
            img.onerror = () => imgContainer.style.display = 'none';
        } else {
            imgContainer.style.display = 'none';
        }

        // Options
        const optionsDiv = document.getElementById('options-container');
        optionsDiv.innerHTML = '';
        q.options.forEach((opt, index) => {
            const btn = document.createElement('button');
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(index, btn);
            optionsDiv.appendChild(btn);
        });

        // Reset Feedback
        document.getElementById('feedback').style.display = 'none';
        
        // Progress Bar
        const pct = (currentQuestionIndex / quizData.length) * 100;
        document.getElementById('progress').style.width = pct + '%';
    }

    function checkAnswer(selectedIndex, btnElement) {
        // D√©sactiver tous les boutons
        const buttons = document.querySelectorAll('#options-container button');
        buttons.forEach(b => b.disabled = true);

        const q = quizData[currentQuestionIndex];
        const isCorrect = (selectedIndex === q.correct);
        
        if (isCorrect) {
            btnElement.classList.add('selected-correct');
            document.getElementById('feedback').classList.remove('error');
            document.getElementById('feedback-title').innerText = "‚úÖ Excellent !";
            score++;
            if (scoresByCompetence[q.competence] !== undefined) {
                scoresByCompetence[q.competence]++;
            }
        } else {
            btnElement.classList.add('selected-wrong');
            buttons[q.correct].classList.add('selected-correct');
            document.getElementById('feedback').classList.add('error');
            document.getElementById('feedback-title').innerText = "‚ùå Pas tout √† fait...";
        }

        document.getElementById('feedback-text').innerText = q.feedback;
        document.getElementById('feedback').style.display = 'block';
        document.getElementById('score-display').innerText = `${score} / ${quizData.length}`;
    }

    function nextQuestion() {
        currentQuestionIndex++;
        if (currentQuestionIndex < quizData.length) {
            loadQuestion();
        } else {
            showScreen('screen-autoeval');
            document.getElementById('progress').style.width = '100%';
        }
    }

    function showResults() {
        showScreen('screen-result');
        
        // Score final
        document.getElementById('final-score-value').innerText = `${score}/20`;
        
        // Message
        const msg = document.getElementById('final-msg');
        if (score >= 16) {
            msg.innerHTML = "üåü <b>Expert en Pr√©vention !</b><br>Tu ma√Ætrises parfaitement le module C9 et les 6 facteurs de Gollac.";
        } else if (score >= 12) {
            msg.innerHTML = "üëç <b>Bon travail !</b><br>Les bases sont acquises. R√©vise les facteurs que tu as manqu√©s.";
        } else if (score >= 8) {
            msg.innerHTML = "üìö <b>√Ä consolider.</b><br>Relis le cours sur les 6 facteurs de Gollac et les cons√©quences.";
        } else {
            msg.innerHTML = "‚ö†Ô∏è <b>Module √† retravailler.</b><br>Reprends les fiches et le sch√©ma de synth√®se.";
        }

        // Bilan par comp√©tence
        const compDetails = document.getElementById('comp-details');
        compDetails.innerHTML = `
            <div style="background:#2a2a2a; padding:12px; border-radius:8px; margin:8px 0;">
                <b style="color:var(--primary);">C2 ‚Äì Analyser</b>
                <span style="float:right; color:var(--secondary);">${scoresByCompetence.C2} / ${maxByCompetence.C2}</span>
                <div style="color:var(--text-muted); font-size:0.85rem; margin-top:5px;">Identifier types de RPS et facteurs Gollac</div>
            </div>
            <div style="background:#2a2a2a; padding:12px; border-radius:8px; margin:8px 0;">
                <b style="color:var(--primary);">C3 ‚Äì Expliquer</b>
                <span style="float:right; color:var(--secondary);">${scoresByCompetence.C3} / ${maxByCompetence.C3}</span>
                <div style="color:var(--text-muted); font-size:0.85rem; margin-top:5px;">D√©finitions, obligations, cons√©quences</div>
            </div>
            <div style="background:#2a2a2a; padding:12px; border-radius:8px; margin:8px 0;">
                <b style="color:var(--primary);">C4 ‚Äì Proposer</b>
                <span style="float:right; color:var(--secondary);">${scoresByCompetence.C4} / ${maxByCompetence.C4}</span>
                <div style="color:var(--text-muted); font-size:0.85rem; margin-top:5px;">Mesures de pr√©vention adapt√©es</div>
            </div>
        `;
    }
</script>

</body>
</html>
