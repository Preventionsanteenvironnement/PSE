<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Module D2 - Le budget (Index)</title>
  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --ink:#1f2937;
      --muted:#6b7280;
      --accent:#0f766e;
      --line:#e5e7eb;
      --shadow:0 10px 25px rgba(0,0,0,.06);
      --radius:18px;
      --pad:16px;
      --max:1240px;
      --focus:0 0 0 3px rgba(15,118,110,.22);
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --fs: 16.5px;
      --lh: 1.45;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--font);
      font-size:var(--fs);
      line-height:var(--lh);
      color:var(--ink);
      background:linear-gradient(180deg, #fff, var(--bg));
    }
    .wrap{max-width:var(--max); margin:0 auto; padding:18px 14px 26px}
    header{
      display:flex; gap:14px; align-items:flex-start; justify-content:space-between;
      padding:16px 16px; background:var(--card); border:1px solid var(--line);
      border-radius:var(--radius); box-shadow:var(--shadow);
      margin-bottom:12px;
      flex-wrap:wrap;
    }
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px; border-radius:999px; border:1px solid var(--line);
      color:var(--muted); background:#fff;
      font-size:13px; font-weight:950;
    }
    h1{margin:8px 0 6px; font-size:24px; line-height:1.15}
    .sub{color:var(--muted); margin:0; font-size:14px}
    .meta{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
    .pill{
      font-family:var(--mono);
      padding:6px 10px; border-radius:999px; border:1px solid var(--line);
      background:#fff; color:var(--muted); font-size:13px; font-weight:950;
    }
    .btn{
      border:1px solid var(--line); background:#fff; color:var(--ink);
      padding:10px 12px; border-radius:12px; cursor:pointer;
      font-weight:950; font-size:14px;
      box-shadow:0 2px 8px rgba(0,0,0,.04);
      user-select:none;
      text-decoration:none;
      display:inline-flex; align-items:center; gap:10px;
    }
    .btn:hover{border-color:#d1d5db}
    .btn:focus{outline:none; box-shadow:var(--focus)}
    .btn.primary{background:linear-gradient(180deg, #0f766e, #0b5f58); color:#fff; border-color:#0b5f58}
    .grid{
      display:grid;
      grid-template-columns:1fr;
      gap:12px;
    }
    @media (min-width: 980px){
      .grid{grid-template-columns: 1fr 1fr;}
    }
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:var(--pad);
      min-width:0;
    }
    .cardTop{
      display:flex; align-items:flex-start; justify-content:space-between; gap:10px; flex-wrap:wrap;
      margin-bottom:10px;
    }
    .step{
      display:flex; align-items:center; gap:10px;
      font-weight:950;
      font-size:16px;
    }
    .num{
      width:34px; height:34px; border-radius:12px;
      display:inline-flex; align-items:center; justify-content:center;
      background:rgba(15,118,110,.08);
      border:1px solid rgba(15,118,110,.20);
      color:var(--accent);
      font-weight:1000;
      font-family:var(--mono);
    }
    .title{font-weight:1000}
    .desc{margin:0; color:var(--muted)}
    .links{
      display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;
      align-items:center;
    }
    .small{font-size:13px; color:var(--muted)}
    .kbd{font-family:var(--mono); font-size:13px; padding:3px 7px; border:1px solid var(--line); border-radius:8px; background:#fff}
    .progressWrap{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:12px 14px;
      margin-bottom:12px;
      display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap;
    }
    .progress{
      flex:1; min-width:220px;
      height:12px; border-radius:999px;
      background:#eef2f7; overflow:hidden; border:1px solid var(--line);
    }
    .bar{height:100%; width:0%; background:linear-gradient(90deg, #0f766e, #7c2d12)}
    .right{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    footer{
      margin-top:12px;
      color:var(--muted);
      font-size:13px;
      text-align:center;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div>
        <div class="badge">MODULE D2</div>
        <h1>Le budget</h1>
        <p class="sub">Parcours complet en autonomie</p>
        <div class="meta">
          <div class="pill">Competences : C1 • C2 • C3 • C4 • C5</div>
          <div class="pill">Format : pages interactives</div>
        </div>
      </div>

      <div style="display:flex; flex-direction:column; gap:10px; align-items:flex-end; min-width:260px">
        <a class="btn primary" href="d2-situation-carla-paysage-sans-exemples.html">Commencer</a>
        <a class="btn" href="#" id="btnReset">Reinitialiser toutes les sauvegardes</a>
        <div class="small">Astuce : utiliser <span class="kbd">Cmd</span> + <span class="kbd">L</span> puis <span class="kbd">Entrer</span> pour revenir a cette page</div>
      </div>
    </header>

    <section class="progressWrap" aria-label="progression">
      <div style="flex:1; min-width:240px">
        <div class="small" style="margin-bottom:6px">Progression (pages remplies)</div>
        <div class="progress"><div class="bar" id="bar"></div></div>
      </div>
      <div class="right">
        <div class="pill" id="progressTxt">0 / 6</div>
        <a class="btn" href="proposer-des-solutions.html">Aller a la fin</a>
      </div>
    </section>

    <section class="grid">
      <article class="card">
        <div class="cardTop">
          <div class="step">
            <span class="num">1</span>
            <span class="title">Situation Carla</span>
          </div>
          <div class="pill">C2</div>
        </div>
        <p class="desc">Analyser la situation et identifier les informations utiles.</p>
        <div class="links">
          <a class="btn primary" href="d2-situation-carla-paysage-sans-exemples.html">Ouvrir</a>
        </div>
      </article>

      <article class="card">
        <div class="cardTop">
          <div class="step">
            <span class="num">2</span>
            <span class="title">Budget et revenus</span>
          </div>
          <div class="pill">C1 • C2</div>
        </div>
        <p class="desc">Comprendre la definition d’un budget et distinguer les recettes (revenus).</p>
        <div class="links">
          <a class="btn primary" href="budget-et-revenus.html">Ouvrir</a>
          <a class="btn" href="budget-et-revenus-2.html">Exercices +</a>
        </div>
      </article>

      <article class="card">
        <div class="cardTop">
          <div class="step">
            <span class="num">3</span>
            <span class="title">Depenses : categories</span>
          </div>
          <div class="pill">C2 • C4</div>
        </div>
        <p class="desc">Classer les depenses : incompressibles, courantes, exceptionnelles.</p>
        <div class="links">
          <a class="btn primary" href="depenses-categories.html">Ouvrir</a>
        </div>
      </article>

      <article class="card">
        <div class="cardTop">
          <div class="step">
            <span class="num">4</span>
            <span class="title">Etat du budget</span>
          </div>
          <div class="pill">C1 • C2</div>
        </div>
        <p class="desc">Identifier : budget equilibre, excedentaire, deficitaire.</p>
        <div class="links">
          <a class="btn primary" href="etat-du-budget.html">Ouvrir</a>
        </div>
      </article>

      <article class="card">
        <div class="cardTop">
          <div class="step">
            <span class="num">5</span>
            <span class="title">Epargne : choisir un compte</span>
          </div>
          <div class="pill">C3 • C5</div>
        </div>
        <p class="desc">Choisir un compte epargne selon disponibilite et taux d’interet.</p>
        <div class="links">
          <a class="btn primary" href="epargne-choisir-compte-v2.html">Ouvrir</a>
        </div>
      </article>

      <article class="card">
        <div class="cardTop">
          <div class="step">
            <span class="num">6</span>
            <span class="title">Proposer des solutions</span>
          </div>
          <div class="pill">C2 • C4 • C5</div>
        </div>
        <p class="desc">Calculer, deduire, proposer des solutions et choisir l’epargne adaptee.</p>
        <div class="links">
          <a class="btn primary" href="proposer-des-solutions.html">Ouvrir</a>
        </div>
      </article>
    </section>

    <footer>
      Sauvegarde automatique active dans chaque page
    </footer>
  </div>

  <script>
    // Chaque page a sa propre cle localStorage
    // Ici, on estime l'avancement par la presence de ces cles
    const KEYS = [
      "pse_d2_carla_landscape_v2",            // d2-situation-carla-paysage-sans-exemples.html
      "pse_budget_revenus_v1",                // budget-et-revenus.html (si ta page utilise autre cle, ce compteur n'est qu'indicatif)
      "pse_depenses_categories_v1",           // depenses-categories.html
      "pse_etat_du_budget_v1",                // etat-du-budget.html
      "pse_epargne_choisir_compte_v2",        // epargne-choisir-compte-v2.html
      "pse_d2_proposer_solutions_v1"          // proposer-des-solutions.html
    ];

    function countProgress(){
      let done = 0;
      for(const k of KEYS){
        if(localStorage.getItem(k)) done++;
      }
      const pct = Math.round((done / KEYS.length) * 100);
      document.getElementById("bar").style.width = pct + "%";
      document.getElementById("progressTxt").textContent = done + " / " + KEYS.length;
    }

    function resetAll(){
      for(const k of KEYS){
        localStorage.removeItem(k);
      }
      countProgress();
    }

    document.getElementById("btnReset").addEventListener("click", (e)=>{
      e.preventDefault();
      resetAll();
    });

    countProgress();
  </script>

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <script>
    // Activation du "Douanier" (blocage écran si pas de code)
    window.PSE_CODE_REQUIRED = true; 

    const firebaseConfig = {
      apiKey: "AIzaSyAWdCMvOiAJln3eT9LIAQD3RWJUD0lQcLI",
      authDomain: "devoirs-pse.firebaseapp.com",
      projectId: "devoirs-pse",
      storageBucket: "devoirs-pse.appspot.com",
      messagingSenderId: "614730413904",
      appId: "1:614730413904:web:a5dd478af5de30f6bede55"
    };

    if (!firebase.apps || !firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    window.db = firebase.firestore();
  </script>

  <script src="annuaire.js"></script>

  <script>
    if (typeof enregistrerVisite === "function") {
      enregistrerVisite(document.title || "Module D2 Index");
    }
  </script>
</body>
</html>
