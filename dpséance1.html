<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module A2: Le Sommeil - S√©ance 1 (√âpur√© et Restaur√©)</title>
    <style>
        /* ==================================== */
        /* 1. STYLES DE BASE & TYPOGRAPHIE */
        /* ==================================== */
        body {
            font-family: Arial, sans-serif;
            line-height: 1.8;
            padding: 0;
            margin: 0;
            background-color: #f4f7f9;
            display: flex;
        }
        
        .content-area {
            flex-grow: 1; 
            max-width: 800px;
            padding: 30px;
        }

        .module-header {
            background-color: #007bff;
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 20px;
        }

        .section-box {
            background-color: white;
            padding: 20px;
            margin-bottom: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        h2 { color: #007bff; border-bottom: 3px solid #ffcc00; padding-bottom: 5px; }
        h3 { color: #343a40; margin-top: 25px; }
        
        .situation-image {
            display: block;
            margin: 15px auto;
            max-width: 90%;
            height: auto;
            border: 2px solid #ccc;
            border-radius: 5px;
        }

        /* ==================================== */
        /* 2. BARRE LAT√âRALE (SIMPLIFI√âE) */
        /* ==================================== */
        .sidebar {
            width: 250px;
            background-color: #e9ecef;
            padding: 15px;
            position: sticky; 
            top: 0;
            height: 100vh;
            box-shadow: -2px 0 5px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
        }
        
        .sidebar h3 {
            color: #495057;
            border-bottom: 1px solid #adb5bd;
            padding-bottom: 5px;
            margin-bottom: 15px;
        }
        
        .sidebar-group {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            background-color: #f8f9fa;
        }
        
        .sidebar-group p {
            font-weight: bold;
        }
        
        .sidebar button {
            width: 100%;
            padding: 10px;
            margin-top: 8px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s;
        }
        
        .save-btn { background-color: #28a745; color: white; }
        .save-btn:hover { background-color: #1e7e34; }
        .load-btn { background-color: #ffc107; color: #343a40; }
        .load-btn:hover { background-color: #e0a800; }
        .reset-btn { background-color: #dc3545; color: white; }
        .reset-btn:hover { background-color: #c82333; }
        .audio-btn { background-color: #17a2b8; color: white; }
        .audio-btn:hover { background-color: #138496; }
        
        #confirmation-message {
            margin-top: 15px;
            padding: 10px;
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
            border-radius: 5px;
            text-align: center;
            display: none;
            font-size: 0.9em;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        
        /* ==================================== */
        /* 3. INTERACTIVIT√â (Restauration Visuelle) */
        /* ==================================== */
        
        /* Mots cliquables : Tr√®s visibles et interactifs */
        .mot-cle {
            cursor: pointer;
            padding: 8px 15px; /* Augmentation du padding pour un clic facile */
            border-radius: 5px;
            transition: all 0.2s;
            display: inline-block;
            margin: 6px; /* Plus d'espace entre les mots */
            font-weight: bold;
            border: 3px solid #007bff; /* Bordure √©paisse pour attirer l'≈ìil */
            color: #007bff;
            background-color: #e0f0ff;
            font-size: 1.1em; /* Texte l√©g√®rement plus grand */
        }
        .mot-cle:hover {
            transform: scale(1.05);
            box-shadow: 0 0 8px rgba(0, 123, 255, 0.7); /* Ombre l√©g√®re au survol */
        }
        .mot-cle.selected {
            background-color: #28a745;
            color: white;
            border-color: #1e7e34;
        }

        /* Glisser-D√©poser : Mots √† glisser */
        [draggable="true"] {
            cursor: grab;
            background-color: #ffcc00; /* Jaune Vif */
            color: #343a40;
            border: 3px solid #e0a800; /* Bordure plus √©paisse */
            padding: 10px 15px; /* Augment√© */
            margin: 5px;
            border-radius: 5px;
            display: inline-block;
            font-weight: bold;
            font-size: 1.1em;
        }

        /* Glisser-D√©poser : Zone de d√©p√¥t */
        .drop-zone {
            min-height: 70px; /* Plus grand */
            border: 4px dashed #dc3545; /* Lignes tr√®s visibles */
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-style: italic;
            background-color: #fff0f0;
            margin-top: 10px;
            line-height: 1.2;
            font-size: 1.2em; /* Texte dans la zone plus grand */
        }
        
        .feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            display: none;
            font-weight: bold;
            font-size: 1.1em;
        }

    </style>
</head>
<body>

    <div class="sidebar">
        
        <h3>‚öôÔ∏è Options pour m'aider</h3>
        
        <div class="sidebar-group">
            <p>1. Audio (√âcoute des consignes)</p>
            <button onclick="playAudio()" id="play-button" class="audio-btn">‚ñ∂Ô∏è √âcouter</button>
            <button onclick="stopAudio()" id="stop-button" class="audio-btn" disabled>‚èπÔ∏è Arr√™ter</button>
            <audio id="course-audio" src="audio_seance1.mp3" preload="auto"></audio>
        </div>

        <div class="sidebar-group">
            <p>2. Taille du Texte (Loupe)</p>
            <label for="font-size-slider">Agrandir :</label>
            <input type="range" id="font-size-slider" min="100" max="180" value="100" step="10" oninput="changeFontSize(this.value)">
            <span id="font-size-value">100%</span>
        </div>
        
        <hr style="border-top: 1px solid #adb5bd;">

        <h3>üíæ Mon travail</h3>
        <button onclick="saveProgress()" class="save-btn">üíæ Enregistrer ma page</button>
        <button onclick="loadProgress(true)" class="load-btn">‚Ü©Ô∏è Reprendre mon travail</button>
        <button onclick="resetProgress()" class="reset-btn">üóëÔ∏è R√©initialiser tout</button>
        
        <div id="confirmation-message"></div>
    </div>

    <div class="content-area" id="main-content">
        
        <div class="module-header">
            <h1>MODULE A2: Le sommeil, un rythme biologique</h1>
            <h2>S√©ance 1 : Je comprends l'importance de bien dormir</h2>
        </div>

        <div class="section-box">
            <h3>üéØ Objectifs Simples</h3>
            <ul>
                <li>Je comprends pourquoi le sommeil est important pour √™tre en forme.</li>
                <li>J'identifie qui est concern√© par ce probl√®me.</li>
            </ul>
            <p style="font-size: 0.9em; margin-top: 15px;">Comp√©tence CAP : C1 - Identifier les besoins essentiels pour bien travailler.</p>
        </div>

        <div class="section-box">
            <h3 style="color: #dc3545;">üî¥ √âTAPE 1 : La Situation</h3>
            <p>Regarde l'image ci-dessous. Il y a Sarah et son amie Lina qui parlent.</p>
            
            <img src="situation_sommeil_bd.jpg" alt="Bande dessin√©e montrant Sarah et Lina parlant de fatigue et de sommeil." class="situation-image">

            <hr>
            
            <h4>1. Quel est le probl√®me ? (Clique sur le bon mot)</h4>
            <p>Sarah est tr√®s fatigu√©e. Elle a un probl√®me avec son...</p>
            <div id="q1-container">
                <span class="mot-cle" data-answer="sommeil" data-q="q1">SOMMEIL</span>
                <span class="mot-cle" data-answer="√©cole" data-q="q1">√âCOLE</span>
                <span class="mot-cle" data-answer="amis" data-q="q1">AMIS</span>
            </div>
            <button onclick="checkAnswer('q1', 'sommeil')" style="margin-top: 10px; padding: 8px 15px; background-color: #007bff; color: white; border: none; border-radius: 5px;">V√©rifier mon choix üîç</button>
            <div class="feedback" id="feedback-q1"></div>
        </div>

        <div class="section-box">
            <h3 style="color: #ffc107;">üü° √âTAPE 2 : Qui et O√π ?</h3>

            <h4>2. Qui est concern√© ? (Clique sur les deux pr√©noms)</h4>
            <p>Dans cette image, qui sont les deux personnes pr√©sentes ?</p>
            <div id="q2-container">
                <span class="mot-cle" data-answer="Sarah" data-q="q2_click">Sarah</span>
                <span class="mot-cle" data-answer="Professeur" data-q="q2_click">Professeur</span>
                <span class="mot-cle" data-answer="Lina" data-q="q2_click">Lina</span>
                <span class="mot-cle" data-answer="M√©decin" data-q="q2_click">M√©decin</span>
            </div>
            <button onclick="checkAnswerMulti('q2_click', ['Sarah', 'Lina'])" style="margin-top: 10px; padding: 8px 15px; background-color: #007bff; color: white; border: none; border-radius: 5px;">V√©rifier mes choix üîç</button>
            <div class="feedback" id="feedback-q2_click"></div>
        </div>

        <div class="section-box">
            <h3 style="color: #28a745;">üü¢ √âTAPE 3 : Cons√©quence</h3>
            <p>Quand Sarah est fatigu√©e, cela cr√©e un probl√®me. Elle a du mal √† travailler en classe.</p>
            
            <p>Mots √† glisser :</p>
            <div style="min-height: 40px;">
                <span id="drag-fatigue" draggable="true" ondragstart="drag(event)">FATIGU√âE</span>
                <span id="drag-concentration" draggable="true" ondragstart="drag(event)">CONCENTRATION</span>
            </div>
            
            <p style="margin-top: 20px;">D√©pose le bon mot pour finir la phrase :</p>
            <p>Quand on dort mal, on a du mal √† se tenir attentif. On perd sa :</p>
            
            <div class="drop-zone" ondrop="drop(event, 'drop-q3')" ondragover="allowDrop(event)" id="drop-q3" data-correct-word="concentration">
                 ‚Üí D√©pose le mot ici ! ‚Üê
            </div>
            <button onclick="checkDragDrop('drop-q3')" style="margin-top: 10px; padding: 8px 15px; background-color: #007bff; color: white; border: none; border-radius: 5px;">V√©rifier le mot d√©pos√© üîç</button>
            <div class="feedback" id="feedback-drop-q3"></div>
        </div>
        
        <hr>
        
        <div class="section-box" style="text-align: center; background-color: #e0f0ff;">
            <h3>F√©licitations ! Tu as termin√© la S√©ance 1.</h3>
            <p>N'oublie pas de cliquer sur üíæ Enregistrer ma page pour ne pas perdre ton travail.</p>
        </div>

    </div>


    <script>
        // ====================================
        // JAVASCRIPT : GESTION DE LA R√âINITIALISATION ET ACCESSIBILIT√â
        // Le code JS reste bas√© sur la V4 car il g√®re correctement l'interactivit√©.
        // Seule la partie Police Dyslexique est retir√©e.
        // ====================================

        const localStorageKey = 'courseProgress_A2_S1';
        const confirmationMessage = document.getElementById('confirmation-message');

        function showConfirmation(message) {
            confirmationMessage.innerText = message;
            confirmationMessage.style.display = 'block';
            confirmationMessage.style.opacity = 1;
            
            setTimeout(() => {
                confirmationMessage.style.opacity = 0;
                setTimeout(() => confirmationMessage.style.display = 'none', 500); 
            }, 3000);
        }

        // --- AUDIO ---
        const audio = document.getElementById('course-audio');
        const playButton = document.getElementById('play-button');
        const stopButton = document.getElementById('stop-button');

        function playAudio() {
            if (audio.error) {
                showConfirmation("‚ùå Erreur : Le fichier audio est introuvable (audio_seance1.mp3).");
                return;
            }
            if (audio.readyState < 2) {
                showConfirmation("‚è≥ Chargement de l'audio en cours, veuillez r√©essayer.");
                audio.load();
                return;
            }
            
            audio.play();
            playButton.disabled = true;
            stopButton.disabled = false;
        }

        function stopAudio() {
            audio.pause();
            audio.currentTime = 0;
            playButton.disabled = false;
            stopButton.disabled = true;
        }
        audio.onended = function() {
            playButton.disabled = false;
            stopButton.disabled = true;
        };
        audio.onerror = function() {
            showConfirmation("‚ùå Erreur de lecture de l'audio. Assurez-vous que le fichier est bien l√†.");
            playButton.disabled = true;
            stopButton.disabled = true;
        };


        // --- TAILLE DU TEXTE (Fonctionne) ---
        function changeFontSize(value) {
            document.getElementById('main-content').style.fontSize = value + '%';
            document.getElementById('font-size-value').innerText = value + '%';
            saveState('font-size-slider', value);
        }

        // --- INTERACTIVIT√â (Clics) ---
        const motCles = document.querySelectorAll('.mot-cle');
        motCles.forEach(mot => {
            mot.addEventListener('click', function() {
                if (mot.dataset.q === 'q1') {
                    document.querySelectorAll('.mot-cle[data-q="q1"]').forEach(m => m.classList.remove('selected'));
                    this.classList.add('selected');
                }
                if (mot.dataset.q === 'q2_click') {
                    this.classList.toggle('selected');
                }
            });
        });

        function checkAnswer(questionId, correctAnswer) {
            const selectedWord = document.querySelector(`.mot-cle[data-q="${questionId}"].selected`);
            const feedbackElement = document.getElementById(`feedback-${questionId}`);
            document.querySelectorAll('.feedback').forEach(f => f.style.display = 'none');

            if (selectedWord) {
                const isCorrect = selectedWord.dataset.answer === correctAnswer;
                feedbackElement.className = isCorrect ? 'feedback correct' : 'feedback incorrect';
                feedbackElement.style.display = 'block';
                feedbackElement.innerHTML = isCorrect ? '‚úîÔ∏è **Bravo !** C\'est bien le sommeil le probl√®me.' : '‚ùå **Non, essaie encore.** De quoi parlent-elles ?';
                saveState(questionId, selectedWord.dataset.answer);
            } else {
                showConfirmation("‚ö†Ô∏è Clique sur un mot pour r√©pondre !");
            }
        }

        function checkAnswerMulti(questionId, correctAnswers) {
            const selectedWords = document.querySelectorAll(`.mot-cle[data-q="${questionId}"].selected`);
            const feedbackElement = document.getElementById(`feedback-${questionId}`);
            document.querySelectorAll('.feedback').forEach(f => f.style.display = 'none');
            
            const selectedText = Array.from(selectedWords).map(m => m.dataset.answer);
            const isCorrect = correctAnswers.every(answer => selectedText.includes(answer)) && selectedText.length === correctAnswers.length;

            feedbackElement.className = isCorrect ? 'feedback correct' : 'feedback incorrect';
            feedbackElement.style.display = 'block';
            feedbackElement.innerHTML = isCorrect ? '‚úîÔ∏è **G√©nial !** Ce sont Sarah et Lina qui discutent.' : '‚ùå **Attention.** Tu dois choisir exactement les deux personnes de la bande dessin√©e.';
            
            saveState(questionId, selectedText);
        }

        // --- INTERACTIVIT√â (Glisser-D√©poser) ---
        function allowDrop(ev) { ev.preventDefault(); }
        function drag(ev) { ev.dataTransfer.setData("text", ev.target.id); }

        function drop(ev, dropZoneId) {
            ev.preventDefault();
            const data = ev.dataTransfer.getData("text");
            const draggedElement = document.getElementById(data);
            const dropZone = document.getElementById(dropZoneId);

            if (dropZone.querySelector('[draggable="true"]')) {
                showConfirmation("Attention : Un mot est d√©j√† d√©pos√©. Retire-le !");
                return;
            }
            dropZone.innerText = '';
            dropZone.appendChild(draggedElement);
        }

        function checkDragDrop(dropZoneId) {
            const dropZone = document.getElementById(dropZoneId);
            const feedbackElement = document.getElementById(`feedback-${dropZoneId}`);
            const correctWord = dropZone.dataset.correctWord;
            const droppedElement = dropZone.querySelector('span[draggable="true"]');

            document.querySelectorAll('.feedback').forEach(f => f.style.display = 'none');

            if (droppedElement) {
                const isCorrect = droppedElement.innerText.toLowerCase() === correctWord.toLowerCase();
                
                feedbackElement.className = isCorrect ? 'feedback correct' : 'feedback incorrect';
                feedbackElement.style.display = 'block';
                feedbackElement.innerHTML = isCorrect ? `‚úîÔ∏è **Super !** C'est la **CONCENTRATION** qui pose probl√®me.` : `‚ùå **Faux.** Essaie l'autre mot √† glisser !`;

                if (!isCorrect) {
                    const originalContainer = document.querySelector('.section-box:nth-child(4) div:nth-child(3)');
                    originalContainer.appendChild(droppedElement);
                    dropZone.innerText = '‚Üí D√©pose le mot ici ! ‚Üê';
                }
                
                saveState(dropZoneId, droppedElement.id);

            } else {
                showConfirmation("‚ö†Ô∏è D√©pose un mot dans la zone avant de v√©rifier !");
            }
        }

        // --- SAUVEGARDE & REPRISE & R√âINITIALISATION ---
        
        function saveState(key, value) {
            const progress = JSON.parse(localStorage.getItem(localStorageKey) || '{}');
            progress[key] = value;
            localStorage.setItem(localStorageKey, JSON.stringify(progress));
        }

        function loadState() {
            return JSON.parse(localStorage.getItem(localStorageKey) || '{}');
        }

        function saveProgress() {
            showConfirmation("‚úÖ Votre progression a √©t√© ENREGISTR√âE !");
        }

        function resetProgress() {
            const confirmReset = confirm("√ätes-vous s√ªr(e) de vouloir TOUT effacer et recommencer √† z√©ro ?");
            if (confirmReset) {
                localStorage.removeItem(localStorageKey);
                showConfirmation("üóëÔ∏è Toutes les donn√©es ont √©t√© EFFAC√âES. La page va se recharger.");
                
                setTimeout(() => {
                    window.location.reload(); 
                }, 2000);
            }
        }

        function loadProgress(manualLoad = false) {
            const progress = loadState();
            let hasLoadedData = false;

            for (const key in progress) {
                if (progress.hasOwnProperty(key)) {
                    hasLoadedData = true;

                    // Taille de police
                    if (key === 'font-size-slider') {
                        document.getElementById('font-size-slider').value = progress[key];
                        changeFontSize(progress[key]);
                    } 
                    // Q1, Q2, Q3 (Logique de restauration inchang√©e)
                    else if (key === 'q1') {
                        document.querySelectorAll('.mot-cle[data-q="q1"]').forEach(m => m.classList.remove('selected'));
                        const selected = document.querySelector(`.mot-cle[data-q="q1"][data-answer="${progress[key]}"]`);
                        if (selected) selected.classList.add('selected');
                    }
                    else if (key === 'q2_click' && Array.isArray(progress[key])) {
                        document.querySelectorAll('.mot-cle[data-q="q2_click"]').forEach(m => m.classList.remove('selected'));
                        progress[key].forEach(answer => {
                            const selected = document.querySelector(`.mot-cle[data-q="q2_click"][data-answer="${answer}"]`);
                            if (selected) selected.classList.add('selected');
                        });
                    }
                    else if (key === 'drop-q3') {
                        const droppedElement = document.getElementById(progress[key]);
                        const dropZone = document.getElementById('drop-q3');
                        if(droppedElement && dropZone) {
                            dropZone.innerText = '';
                            dropZone.appendChild(droppedElement);
                        }
                    }
                }
            }

            if (hasLoadedData && manualLoad) {
                showConfirmation("‚Ü©Ô∏è Votre travail a √©t√© repris ! Vous pouvez continuer.");
            } else if (manualLoad && !hasLoadedData) {
                showConfirmation("‚ÑπÔ∏è Aucune donn√©e enregistr√©e trouv√©e. Vous commencez √† z√©ro.");
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
             loadProgress(false); 
        });
        
    </script>

</body>
</html>
