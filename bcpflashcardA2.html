<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PSE Speed Run - Rythmes Biologiques</title>
    <style>
        :root {
            --dark-bg: #1e1e1e;
            --card-bg: #2d2d2d;
            --text-color: #f0f0f0;
            --accent-color: #00bcd4;
            --error-color: #e91e63;
            --success-color: #4caf50;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: var(--dark-bg);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        h1 {
            color: var(--accent-color);
            margin-bottom: 20px;
            font-size: 1.8em;
            text-align: center;
        }

        #progress-container {
            width: 100%;
            max-width: 600px;
            margin-bottom: 15px;
        }

        #progress-bar {
            height: 10px;
            background-color: var(--card-bg);
            border-radius: 5px;
            overflow: hidden;
        }

        #progress-fill {
            height: 100%;
            width: 0%;
            background-color: var(--success-color);
            transition: width 0.3s ease-in-out;
        }

        #card-counter {
            text-align: right;
            font-size: 0.9em;
            margin-top: 5px;
        }

        #game-area {
            width: 100%;
            max-width: 400px;
            perspective: 1000px;
            min-height: 300px; /* Assure un espace minimal */
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        #flashcard {
            background-color: transparent;
            width: 100%;
            height: 250px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
            margin-bottom: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        }

        .flip-card-inner {
            position: absolute;
            width: 100%;
            height: 100%;
            text-align: center;
            transform-style: preserve-3d;
        }

        #flashcard.flipped {
            transform: rotateY(180deg);
        }

        .flip-card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            border-radius: 12px;
            font-size: 1.4em;
            font-weight: bold;
            line-height: 1.4;
            word-wrap: break-word;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
        }

        #front-content {
            background-color: var(--card-bg);
        }

        #back-content {
            background-color: var(--accent-color);
            color: var(--dark-bg);
            transform: rotateY(180deg);
        }

        #back-content p {
            margin: 0;
            font-size: 0.9em;
            color: var(--dark-bg);
        }

        #back-content strong {
            font-size: 1.2em;
            color: var(--dark-bg);
        }

        #controls {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .button:hover {
            transform: translateY(-2px);
        }

        #answer-buttons button {
            display: none; /* Cach√© initialement */
        }

        #answer-buttons.visible button {
            display: block;
        }

        #button-flip {
            background-color: var(--accent-color);
            color: var(--dark-bg);
        }

        #button-flip:hover {
            background-color: #00a4b8;
        }

        #button-missed {
            background-color: var(--error-color);
            color: var(--text-color);
        }

        #button-missed:hover {
            background-color: #c91e56;
        }

        #button-knew {
            background-color: var(--success-color);
            color: var(--dark-bg);
        }

        #button-knew:hover {
            background-color: #3e8e41;
        }

        #combo-display {
            font-size: 1.2em;
            color: #ff9800;
            margin-top: 10px;
            font-weight: bold;
            min-height: 20px;
        }

        #end-screen {
            background-color: var(--card-bg);
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.7);
        }

        #end-screen h2 {
            color: var(--accent-color);
        }

        #end-screen p {
            font-size: 1.1em;
            margin: 15px 0;
        }

        #end-screen button {
            margin-top: 20px;
        }

        @media (max-width: 600px) {
            body {
                padding: 10px;
            }

            h1 {
                font-size: 1.5em;
            }

            .flip-card-face {
                font-size: 1.2em;
                padding: 15px;
            }

            #controls {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>

    <h1>PSE Speed Run - Rythmes Biologiques</h1>

    <div id="progress-container">
        <div id="progress-bar"><div id="progress-fill"></div></div>
        <div id="card-counter">0/0</div>
    </div>
    
    <div id="game-area">
        <div id="flashcard" onclick="flipCard()">
            <div class="flip-card-inner">
                <div id="front-content" class="flip-card-face"></div>
                <div id="back-content" class="flip-card-face"></div>
            </div>
        </div>

        <div id="combo-display"></div>

        <div id="controls">
            <button id="button-flip" class="button" onclick="flipCard()">Retourner la carte</button>
            <div id="answer-buttons">
                <button id="button-missed" class="button" onclick="handleAnswer(false)">‚ùå Je ne savais pas</button>
                <button id="button-knew" class="button" onclick="handleAnswer(true)">‚úÖ Je savais</button>
            </div>
        </div>
    </div>

    <div id="end-screen" style="display:none;">
        <h2>Course Termin√©e !</h2>
        <p>Cartes totales : <span id="total-cards-final"></span></p>
        <p>Cartes r√©ussies : <span id="knew-cards-final"></span></p>
        <p>Cartes manqu√©es : <span id="missed-cards-final"></span></p>
        <button class="button" id="button-restart" onclick="initGame(false)">Recommencer tout</button>
        <button class="button" id="button-review-errors" onclick="initGame(true)">Revoir les erreurs</button>
    </div>

    <script>
        // Moteur de Flashcard PSE Speed Run (HTML/JS/CSS int√©gr√©)
        
        const cardData = [
            { question: "D√©finition : Rythme Biologique", answer: "Variation d'une fonction de l'organisme qui se r√©p√®te r√©guli√®rement." },
            { question: "P√©riode : Rythme Circadien", answer: "Environ 24 heures." },
            { question: "Exemple : Rythme Circadien", answer: "Alternance veille-sommeil." },
            { question: "P√©riode : Rythme Ultradien", answer: "Moins de 24 heures (secondes, minutes, heures)." },
            { question: "Exemple : Rythme Ultradien", answer: "Rythme cardiaque, clignement des yeux, rythme respiratoire." },
            { question: "P√©riode : Rythme Infradien", answer: "Plus de 24 heures (semaines, mois)." },
            { question: "Exemple : Rythme Infradien", answer: "Cycle ovarien/menstruel." },
            { question: "Combien de cycles par nuit de sommeil ?", answer: "4 √† 6 cycles." },
            { question: "Dur√©e moyenne d'un cycle de sommeil", answer: "Environ 90 minutes." },
            { question: "R√¥le : Sommeil Lent Profond", answer: "R√©cup√©ration physique, s√©cr√©tion d'hormones." },
            { question: "R√¥le : Sommeil Paradoxal", answer: "R√©cup√©ration mentale et m√©morisation (r√™ves)." },
            { question: "Moment de la nuit o√π la r√©cup√©ration physique est maximale", answer: "D√©but de nuit (sommeil lent profond plus long)." },
            { question: "Cons√©quence : Nuit plus courte sur la m√©morisation", answer: "M√©morisation r√©duite (sommeil paradoxal est plus important en fin de nuit)." },
            { question: "Facteur influen√ßant les Rythmes Biologiques (3 cat√©gories)", answer: "Facteurs individuels, environnementaux, et sociaux." },
            { question: "Exemple : Facteur Social", answer: "Horaires de travail (travail post√©), horaires des repas, contraintes familiales." },
            { question: "Conditions de travail causant une D√©synchronisation", answer: "Travail post√©, travail de nuit, d√©calage horaire." },
            { question: "Cons√©quence de la D√©synchronisation sur la sant√©", answer: "Troubles du sommeil, fatigue, risques cardio-vasculaires, d√©pression." },
            { question: "Cons√©quence de la D√©synchronisation sur le travail/√©cole", answer: "Diminution de la vigilance/concentration, accidents du travail, absent√©isme." },
            { question: "R√®gle d'Hygi√®ne de Sommeil : Temp√©rature id√©ale", answer: "16 √† 18 ¬∞C." },
            { question: "Interdit pour le Travailleur de Nuit de moins de...", answer: "18 ans." },
            { question: "Droit du Travailleur de Nuit", answer: "Repos obligatoire, suivi m√©dical adapt√©, acc√®s prioritaire au travail de jour." },
            { question: "C2P : Int√©r√™t pour le travailleur de nuit", answer: "Accumuler des points pour formation ou retraite anticip√©e." }
        ];

        let cards = [];
        let currentIndex = 0;
        let missedCards = [];
        let errorReviewMode = false;
        let comboStreak = 0;

        const flashcardElement = document.getElementById('flashcard');
        const frontContentElement = document.getElementById('front-content');
        const backContentElement = document.getElementById('back-content');
        const cardCounterElement = document.getElementById('card-counter');
        const progressFillElement = document.getElementById('progress-fill');
        const endScreenElement = document.getElementById('end-screen');
        const gameAreaElement = document.getElementById('game-area');
        const comboDisplayElement = document.getElementById('combo-display');
        const flipButton = document.getElementById('button-flip');
        const answerButtonsContainer = document.getElementById('answer-buttons');

        function initGame(reviewErrors = false) {
            errorReviewMode = reviewErrors;
            
            if (reviewErrors && missedCards.length > 0) {
                cards = [...missedCards]; // Copie les cartes manqu√©es
                missedCards = []; // R√©initialise pour le nouveau jeu d'erreurs
                document.getElementById('button-review-errors').style.display = 'none';
            } else {
                cards = [...cardData]; // Utilise toutes les cartes
                missedCards = [];
                // S'assurer que le bouton de revoir les erreurs est cach√© s'il n'y a pas d'erreurs √† revoir
                document.getElementById('button-review-errors').style.display = 'none';
            }

            shuffleArray(cards);
            currentIndex = 0;
            comboStreak = 0;

            gameAreaElement.style.display = 'flex';
            endScreenElement.style.display = 'none';
            answerButtonsContainer.classList.remove('visible');
            flipButton.style.display = 'block';
            comboDisplayElement.textContent = '';
            
            loadCard();
            updateProgress();
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function loadCard() {
            if (currentIndex < cards.length) {
                const currentCard = cards[currentIndex];
                frontContentElement.textContent = currentCard.question;
                backContentElement.innerHTML = `<strong>R√âPONSE :</strong><p>${currentCard.answer}</p>`;
                flashcardElement.classList.remove('flipped');
                
                // Mettre √† jour l'√©tat des boutons
                answerButtonsContainer.classList.remove('visible');
                flipButton.style.display = 'block';

            } else {
                endGame();
            }
        }

        function flipCard() {
            flashcardElement.classList.toggle('flipped');
            if (flashcardElement.classList.contains('flipped')) {
                // Montrer les boutons de r√©ponse et cacher le bouton de flip
                answerButtonsContainer.classList.add('visible');
                flipButton.style.display = 'none';
            } else {
                // Cacher les boutons de r√©ponse et montrer le bouton de flip
                answerButtonsContainer.classList.remove('visible');
                flipButton.style.display = 'block';
            }
        }

        function handleAnswer(knew) {
            if (knew) {
                comboStreak++;
            } else {
                missedCards.push(cards[currentIndex]);
                comboStreak = 0;
            }
            
            comboDisplayElement.textContent = comboStreak > 1 ? `üî• Combo x${comboStreak}` : '';

            currentIndex++;
            updateProgress();
            loadCard();
        }

        function updateProgress() {
            const totalCards = cardData.length;
            const currentCardNumber = currentIndex < cards.length ? currentIndex + 1 : cards.length;
            const totalCardsInCurrentGame = cards.length;
            
            cardCounterElement.textContent = `${currentCardNumber}/${totalCardsInCurrentGame}`;
            progressFillElement.style.width = `${(currentCardNumber / totalCardsInCurrentGame) * 100}%`;
        }

        function endGame() {
            const totalCards = cards.length;
            const missedCount = missedCards.length;
            const knewCount = totalCards - missedCount;
            
            gameAreaElement.style.display = 'none';
            endScreenElement.style.display = 'block';

            document.getElementById('total-cards-final').textContent = totalCards;
            document.getElementById('knew-cards-final').textContent = knewCount;
            document.getElementById('missed-cards-final').textContent = missedCount;

            // Afficher le bouton "Revoir les erreurs" seulement s'il y a des erreurs
            document.getElementById('button-review-errors').style.display = missedCount > 0 && !errorReviewMode ? 'block' : 'none';
        }

        // D√©marrage s√©curis√©
        window.onload = () => {
            initGame(false);
        };

    </script>
</body>
</html>