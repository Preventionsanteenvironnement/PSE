<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPS S1.3 - Liens prosociaux</title>
    <style>
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f0f4f8;
            color: #1e293b;
            line-height: 1.6;
            min-height: 100vh;
            padding-bottom: 40px;
        }

        .container {
            max-width: 520px;
            margin: 0 auto;
            padding: 16px;
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            color: #6366f1;
            text-decoration: none;
            font-size: 0.95rem;
            font-weight: 500;
            margin-bottom: 12px;
            transition: color 0.2s;
        }

        .back-btn:hover { color: #4338ca; }

        .header-card {
            background: linear-gradient(135deg, #4f46e5, #6366f1);
            border-radius: 15px;
            padding: 28px 24px;
            color: white;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }

        .header-card .emoji { font-size: 2.2rem; margin-bottom: 8px; }
        .header-card h1 { font-size: 1.6rem; margin-bottom: 8px; font-weight: 700; }
        .header-card p { font-size: 0.92rem; opacity: 0.92; line-height: 1.5; }

        .card {
            background: white;
            border-radius: 15px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            animation: fadeIn 0.4s ease;
        }

        .card-title {
            font-size: 1.15rem;
            font-weight: 700;
            color: #4f46e5;
            margin-bottom: 16px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section { display: none; }
        .section.active { display: block; }

        .intro-text {
            font-size: 0.9rem;
            color: #475569;
            line-height: 1.6;
            margin-bottom: 16px;
        }

        .prosocial-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            margin: 16px 0;
        }

        .prosocial-box {
            border-radius: 12px;
            padding: 12px 8px;
            text-align: center;
            font-size: 0.78rem;
            line-height: 1.4;
        }

        .prosocial-box.materiel {
            background: #dbeafe;
            border: 2px solid #93c5fd;
            color: #1e40af;
        }

        .prosocial-box.emotionnel {
            background: #fce7f3;
            border: 2px solid #f9a8d4;
            color: #9d174d;
        }

        .prosocial-box.cooperation {
            background: #e0e7ff;
            border: 2px solid #a5b4fc;
            color: #3730a3;
        }

        .prosocial-box .box-icon {
            font-size: 1.3rem;
            display: block;
            margin-bottom: 4px;
        }

        .prosocial-box .box-label {
            font-weight: 700;
            display: block;
            margin-bottom: 3px;
            font-size: 0.72rem;
        }

        .highlight-text {
            font-size: 0.88rem;
            color: #1e293b;
            background: #eef2ff;
            border-left: 3px solid #6366f1;
            padding: 12px 14px;
            border-radius: 0 10px 10px 0;
            margin: 16px 0;
            line-height: 1.55;
        }

        .btn-primary {
            display: block;
            width: 100%;
            background: linear-gradient(135deg, #4f46e5, #6366f1);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 15px 24px;
            font-size: 1.05rem;
            font-weight: 700;
            cursor: pointer;
            font-family: inherit;
            margin-top: 8px;
            transition: transform 0.15s, box-shadow 0.15s;
            box-shadow: 0 3px 12px rgba(99, 102, 241, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 18px rgba(99, 102, 241, 0.35);
        }

        .progress-bar {
            height: 6px;
            background: #e2e8f0;
            border-radius: 20px;
            overflow: hidden;
            margin-bottom: 6px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4f46e5, #6366f1);
            border-radius: 20px;
            transition: width 0.4s ease;
        }

        .progress-text {
            font-size: 0.8rem;
            color: #94a3b8;
            text-align: right;
            margin-bottom: 16px;
        }

        .scenario-card {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 18px 16px;
            margin-bottom: 14px;
        }

        .scenario-emoji {
            font-size: 1.3rem;
            margin-bottom: 6px;
            display: block;
        }

        .scenario-text {
            font-size: 0.92rem;
            color: #1e293b;
            line-height: 1.5;
        }

        .response-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 14px 16px;
            margin-bottom: 8px;
            cursor: pointer;
            font-size: 0.88rem;
            line-height: 1.5;
            transition: all 0.2s;
            animation: fadeIn 0.3s ease;
        }

        .response-card:hover { border-color: #6366f1; background: #eef2ff; }
        .response-card.disabled { pointer-events: none; opacity: 0.6; }
        .response-card.selected-best { border-color: #22c55e; background: #dcfce7; opacity: 1; }
        .response-card.selected-ok { border-color: #f59e0b; background: #fef3c7; opacity: 1; }
        .response-card.selected-bad { border-color: #ef4444; background: #fee2e2; opacity: 1; }
        .response-card.reveal-best { border-color: #22c55e; background: #dcfce7; opacity: 1; }

        .response-label {
            display: inline-block;
            font-size: 0.72rem;
            font-weight: 700;
            padding: 2px 8px;
            border-radius: 6px;
            margin-bottom: 4px;
        }

        .feedback-card {
            border-radius: 12px;
            padding: 14px 16px;
            margin-bottom: 12px;
            font-size: 0.88rem;
            line-height: 1.5;
            animation: fadeIn 0.3s ease;
        }

        .feedback-card.best {
            background: #dcfce7;
            border: 2px solid #86efac;
            color: #166534;
        }

        .feedback-card.ok {
            background: #fef3c7;
            border: 2px solid #fcd34d;
            color: #92400e;
        }

        .feedback-card.bad {
            background: #fee2e2;
            border: 2px solid #fca5a5;
            color: #991b1b;
        }

        .feedback-icon { font-weight: 700; margin-right: 4px; }

        .btn-next {
            display: block;
            width: 100%;
            background: #6366f1;
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px;
            font-size: 0.92rem;
            font-weight: 600;
            cursor: pointer;
            font-family: inherit;
            transition: background 0.2s;
        }

        .btn-next:hover { background: #4f46e5; }

        .context-card {
            background: #e0e7ff;
            border-radius: 12px;
            padding: 12px 14px;
            margin-bottom: 10px;
            font-size: 0.88rem;
            font-weight: 600;
            color: #3730a3;
        }

        .gratitude-text {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 14px 16px;
            margin-bottom: 14px;
            font-size: 0.92rem;
            line-height: 1.5;
            color: #475569;
        }

        .option-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 14px 16px;
            margin-bottom: 8px;
            cursor: pointer;
            font-size: 0.88rem;
            line-height: 1.5;
            transition: all 0.2s;
            animation: fadeIn 0.3s ease;
        }

        .option-card:hover { border-color: #6366f1; background: #eef2ff; }
        .option-card.disabled { pointer-events: none; opacity: 0.6; }
        .option-card.selected-correct { border-color: #22c55e; background: #dcfce7; opacity: 1; }
        .option-card.selected-wrong { border-color: #ef4444; background: #fee2e2; opacity: 1; }
        .option-card.reveal-correct { border-color: #22c55e; background: #dcfce7; opacity: 1; }

        .feedback-card.correct {
            background: #dcfce7;
            border: 2px solid #86efac;
            color: #166534;
        }

        .feedback-card.wrong {
            background: #fee2e2;
            border: 2px solid #fca5a5;
            color: #991b1b;
        }

        .score-display {
            text-align: center;
            padding: 20px;
        }

        .score-number {
            font-size: 3rem;
            font-weight: 800;
            color: #4f46e5;
            line-height: 1.1;
        }

        .score-total {
            font-size: 1.1rem;
            color: #94a3b8;
            font-weight: 500;
        }

        .score-message {
            margin-top: 14px;
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
            line-height: 1.45;
        }

        .synthesis-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 12px 14px;
            background: #e0e7ff;
            border-radius: 10px;
            margin-bottom: 8px;
            font-size: 0.88rem;
            color: #312e81;
            line-height: 1.5;
        }

        .synthesis-icon {
            font-size: 1.2rem;
            flex-shrink: 0;
        }
    </style>
</head>
<body>

<div class="container">
    <a href="index.html" class="back-btn">‚Üê Retour</a>

    <div class="header-card">
        <div class="emoji">ü§ù</div>
        <h1>Tisser des liens positifs</h1>
        <p>D√©couvre les comportements qui renforcent les relations</p>
    </div>

    <!-- SECTION 1 : INTRO -->
    <div id="section-intro" class="section active">
        <div class="card">
            <div class="card-title">ü§ù Les comportements prosociaux</div>
            <p class="intro-text">Les <strong>comportements prosociaux</strong> sont les actions positives que l'on fait pour les autres. Ils renforcent les liens et cr√©ent un climat de confiance. Il en existe plusieurs types :</p>

            <div class="prosocial-grid">
                <div class="prosocial-box materiel">
                    <span class="box-icon">üì¶</span>
                    <span class="box-label">AIDE CONCR√àTE</span>
                    Pr√™ter, aider, partager
                </div>
                <div class="prosocial-box emotionnel">
                    <span class="box-icon">üíú</span>
                    <span class="box-label">SOUTIEN √âMOTIONNEL</span>
                    √âcouter, r√©conforter, encourager
                </div>
                <div class="prosocial-box cooperation">
                    <span class="box-icon">üß©</span>
                    <span class="box-label">COOP√âRATION</span>
                    Collaborer, s'organiser ensemble
                </div>
            </div>

            <div class="highlight-text">
                Les comportements prosociaux ne sont pas r√©serv√©s aux grandes occasions. Un simple geste au quotidien ‚Äî pr√™ter un stylo, encourager un camarade, travailler ensemble ‚Äî peut avoir un impact positif sur le climat de la classe.
            </div>

            <button class="btn-primary" onclick="startScenarios()">üéØ Commencer le d√©fi</button>
        </div>
    </div>

    <!-- SECTION 2 : SCENARIOS -->
    <div id="section-scenarios" class="section">
        <div class="card">
            <div class="card-title">üéØ Choisis la meilleure r√©action</div>
            <div class="progress-bar"><div class="progress-fill" id="scen-progress"></div></div>
            <div class="progress-text" id="scen-progress-text"></div>
            <div id="scen-container"></div>
        </div>
    </div>

    <!-- SECTION 3 : GRATITUDE -->
    <div id="section-gratitude" class="section">
        <div class="card">
            <div class="card-title">üôè Exprimer sa reconnaissance</div>
            <p class="intro-text">La <strong>gratitude</strong> renforce les liens. Reconna√Ætre ce que les autres font pour nous ‚Äî de fa√ßon sinc√®re et pr√©cise ‚Äî encourage les comportements positifs et nourrit la confiance.</p>
            <div class="progress-bar"><div class="progress-fill" id="grat-progress"></div></div>
            <div class="progress-text" id="grat-progress-text"></div>
            <div id="grat-container"></div>
        </div>
    </div>

    <!-- SECTION 4 : BILAN -->
    <div id="section-bilan" class="section">
        <div class="card">
            <div class="score-display">
                <div class="score-number" id="final-score">0</div>
                <div class="score-total">/ 16</div>
                <div class="score-message" id="score-message"></div>
            </div>
        </div>

        <div class="card">
            <div class="card-title">Ce qu'il faut retenir</div>
            <div class="synthesis-item">
                <span class="synthesis-icon">üì¶</span>
                <span>L'aide concr√®te (pr√™ter, partager) r√©pond √† un besoin mat√©riel ou pratique.</span>
            </div>
            <div class="synthesis-item">
                <span class="synthesis-icon">üíú</span>
                <span>Le soutien √©motionnel (√©couter, encourager) montre qu'on se soucie de l'autre.</span>
            </div>
            <div class="synthesis-item">
                <span class="synthesis-icon">üß©</span>
                <span>La coop√©ration (travailler ensemble) cr√©e un b√©n√©fice mutuel et renforce le groupe.</span>
            </div>
            <div class="synthesis-item">
                <span class="synthesis-icon">üôè</span>
                <span>Exprimer sa gratitude de fa√ßon sinc√®re et pr√©cise renforce les liens et encourage les comportements positifs.</span>
            </div>

            <button class="btn-primary" onclick="resetAll()" style="margin-top:16px;">üîÑ Refaire l'exercice</button>
        </div>
    </div>
</div>

<footer style="text-align:center; padding:20px 16px; color:#94a3b8; font-size:0.78rem;">
    Comp√©tences psychosociales ‚Äî R√©f√©rentiel Sant√© publique France 2025
</footer>

<script>
    /* ========== DATA ========== */
    var scenarios = [
        {
            emoji: "üëã",
            text: "Un nouvel √©l√®ve arrive dans ta classe. Il ne conna√Æt personne et reste seul √† sa table.",
            options: [
                { type: "non", label: "Tu continues ta conversation sans faire attention.", feedback: "Ignorer un nouvel arrivant ne favorise pas l'int√©gration. Un petit geste peut faire une grande diff√©rence.", points: 0 },
                { type: "partiel", label: "Tu lui fais un signe de t√™te quand il s'assoit.", feedback: "C'est un d√©but, mais un geste plus actif l'aiderait √† se sentir accueilli.", points: 1 },
                { type: "prosocial", label: "Tu vas te pr√©senter et tu lui proposes de d√©jeuner avec ton groupe.", feedback: "Tu prends l'initiative d'aller vers l'autre. C'est un comportement prosocial qui facilite l'int√©gration.", points: 2 }
            ]
        },
        {
            emoji: "üìö",
            text: "Un camarade laisse tomber toutes ses affaires dans le couloir entre deux cours.",
            options: [
                { type: "non", label: "Tu passes √† c√¥t√© sans t'arr√™ter.", feedback: "Ne pas r√©agir alors qu'on peut aider facilement, c'est une occasion manqu√©e de renforcer un lien.", points: 0 },
                { type: "partiel", label: "Tu lui dis ¬´ Pas de chance ! ¬ª en passant.", feedback: "La remarque montre que tu as vu la situation, mais une aide concr√®te serait plus utile.", points: 1 },
                { type: "prosocial", label: "Tu t'arr√™tes pour l'aider √† ramasser ses affaires.", feedback: "C'est de l'aide concr√®te : tu passes √† l'action pour aider l'autre. Simple et efficace.", points: 2 }
            ]
        },
        {
            emoji: "üìù",
            text: "Pendant un travail de groupe, un √©l√®ve ne comprend pas la consigne et n'avance pas.",
            options: [
                { type: "non", label: "Tu fais ta partie sans t'en occuper.", feedback: "Chacun pour soi ne favorise pas la coop√©ration. Le travail de groupe implique de s'entraider.", points: 0 },
                { type: "partiel", label: "Tu lui dis de relire l'√©nonc√©.", feedback: "C'est une piste, mais r√©expliquer avec tes mots serait plus aidant.", points: 1 },
                { type: "prosocial", label: "Tu prends le temps de lui r√©expliquer la consigne avec tes propres mots.", feedback: "Tu combines aide concr√®te et coop√©ration. Le groupe entier en b√©n√©ficie.", points: 2 }
            ]
        },
        {
            emoji: "üòî",
            text: "Un camarade a l'air triste depuis quelques jours. Il participe moins en classe.",
            options: [
                { type: "non", label: "Ce ne sont pas tes affaires, tu ne dis rien.", feedback: "Respecter l'espace de l'autre est important, mais montrer qu'on se soucie de lui aussi.", points: 0 },
                { type: "partiel", label: "Tu en parles avec d'autres camarades.", feedback: "Parler de quelqu'un dans son dos n'est pas la meilleure approche. Mieux vaut s'adresser directement √† lui.", points: 1 },
                { type: "prosocial", label: "Tu vas discr√®tement vers lui et tu lui demandes s'il va bien.", feedback: "C'est du soutien √©motionnel : tu montres que tu te soucies de l'autre, avec discr√©tion et respect.", points: 2 }
            ]
        },
        {
            emoji: "üéØ",
            text: "Un √©l√®ve se fait taquiner m√©chamment par d'autres pendant la r√©cr√©ation.",
            options: [
                { type: "non", label: "Tu regardes la sc√®ne sans r√©agir.", feedback: "Ne pas r√©agir peut √™tre per√ßu comme une approbation. Les t√©moins ont un r√¥le important.", points: 0 },
                { type: "partiel", label: "Tu changes de sujet pour d√©tourner l'attention.", feedback: "C'est une strat√©gie indirecte qui peut aider, mais un soutien plus clair serait plus efficace.", points: 1 },
                { type: "prosocial", label: "Tu interviens calmement pour soutenir l'√©l√®ve et rappeler le respect.", feedback: "Tu agis avec courage et bienveillance. C'est un comportement prosocial fort qui prot√®ge l'autre.", points: 2 }
            ]
        },
        {
            emoji: "üèÖ",
            text: "Ton ami a rat√© une comp√©tition sportive √† laquelle il tenait beaucoup.",
            options: [
                { type: "non", label: "Tu changes de sujet pour ne pas en parler.", feedback: "√âviter le sujet peut donner l'impression que sa d√©ception n'a pas d'importance.", points: 0 },
                { type: "partiel", label: "Tu lui dis ¬´ C'est pas grave, y'en aura d'autres. ¬ª", feedback: "L'intention est bonne, mais minimiser sa d√©ception ne l'aide pas √† se sentir compris.", points: 1 },
                { type: "prosocial", label: "Tu reconnais sa d√©ception et tu lui rappelles les progr√®s qu'il a faits.", feedback: "Tu valides son √©motion tout en l'aidant √† voir le positif. C'est du soutien √©motionnel de qualit√©.", points: 2 }
            ]
        }
    ];

    var gratitudeItems = [
        {
            context: "üìñ Un camarade t'a aid√© √† comprendre un cours que tu avais manqu√©.",
            options: [
                { text: "Merci d'avoir pris le temps de m'expliquer. Gr√¢ce √† toi, j'ai pu rattraper ce que j'avais manqu√©.", correct: true, feedback: "Tu exprimes ta reconnaissance de fa√ßon pr√©cise : tu nommes ce que l'autre a fait et l'impact positif." },
                { text: "OK merci, c'√©tait pas si compliqu√© de toute fa√ßon.", correct: false, feedback: "Minimiser l'aide re√ßue peut d√©courager l'autre de proposer son aide √† l'avenir." },
                { text: "Merci.", correct: false, feedback: "C'est poli, mais tr√®s bref. Pr√©ciser pourquoi on est reconnaissant renforce le lien." }
            ]
        },
        {
            context: "üë®‚Äçüè´ Un professeur a pris du temps en dehors des cours pour te r√©expliquer un chapitre.",
            options: [
                { text: "Merci beaucoup pour votre aide. Vos explications m'ont permis de comprendre ce qui me bloquait.", correct: true, feedback: "Tu montres que tu as conscience de l'effort de l'autre et de son impact concret sur ta compr√©hension." },
                { text: "Merci, mais j'aurais fini par trouver tout seul.", correct: false, feedback: "Diminuer la valeur de l'aide re√ßue n'encourage pas les comportements bienveillants." },
                { text: "Merci monsieur.", correct: false, feedback: "C'est correct mais g√©n√©rique. Expliquer en quoi l'aide a √©t√© utile montre une vraie reconnaissance." }
            ]
        },
        {
            context: "ü§ù Un ami t'a soutenu pendant une p√©riode o√π tu avais du mal √† t'organiser.",
            options: [
                { text: "Merci d'avoir √©t√© l√†. Savoir que je peux compter sur toi, √ßa m'a vraiment aid√© √† tenir le coup.", correct: true, feedback: "Tu exprimes l'impact √©motionnel de son soutien. C'est une gratitude sinc√®re qui renforce le lien." },
                { text: "Merci, t'es sympa.", correct: false, feedback: "C'est amical mais vague. Pr√©ciser ce qui t'a aid√© montre que tu valorises vraiment son geste." },
                { text: "C'est normal entre amis, pas besoin de remercier.", correct: false, feedback: "M√™me entre amis, exprimer sa reconnaissance renforce la relation et encourage la bienveillance." }
            ]
        },
        {
            context: "üé® Tes camarades de groupe ont fait un gros travail sur un projet commun.",
            options: [
                { text: "Bravo √† tous pour le travail accompli. Chacun a apport√© quelque chose d'important au projet.", correct: true, feedback: "Tu reconnais la contribution de chacun. C'est une gratitude collective qui valorise la coop√©ration." },
                { text: "Heureusement que j'√©tais l√† pour organiser tout √ßa.", correct: false, feedback: "Se mettre en avant au lieu de reconna√Ætre le travail des autres ne renforce pas les liens." },
                { text: "Oui bon, c'√©tait un travail obligatoire de toute fa√ßon.", correct: false, feedback: "R√©duire le travail √† une obligation ignore l'effort r√©el que chacun a fourni." }
            ]
        }
    ];

    /* ========== STATE ========== */
    var shuffledScen = [];
    var currentScen = 0;
    var scenScore = 0;

    var shuffledGrat = [];
    var currentGrat = 0;
    var gratScore = 0;

    /* ========== UTILITIES ========== */
    function shuffle(arr) {
        var a = arr.slice();
        for (var i = a.length - 1; i > 0; i--) {
            var j = Math.floor(Math.random() * (i + 1));
            var tmp = a[i]; a[i] = a[j]; a[j] = tmp;
        }
        return a;
    }

    function showSection(id) {
        var sections = document.querySelectorAll('.section');
        for (var i = 0; i < sections.length; i++) sections[i].classList.remove('active');
        document.getElementById(id).classList.add('active');
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    /* ========== SCENARIOS ========== */
    function startScenarios() {
        shuffledScen = shuffle(scenarios);
        currentScen = 0;
        scenScore = 0;
        showSection('section-scenarios');
        renderScenario();
    }

    function renderScenario() {
        var item = shuffledScen[currentScen];
        var total = shuffledScen.length;
        var pct = (currentScen / total) * 100;

        document.getElementById('scen-progress').style.width = pct + '%';
        document.getElementById('scen-progress-text').textContent = 'Situation ' + (currentScen + 1) + ' / ' + total;

        var shuffledOpts = shuffle(item.options);

        var html = '';
        html += '<div class="scenario-card"><span class="scenario-emoji">' + item.emoji + '</span><div class="scenario-text">' + item.text + '</div></div>';

        for (var i = 0; i < shuffledOpts.length; i++) {
            var o = shuffledOpts[i];
            html += '<div class="response-card" data-type="' + o.type + '" data-points="' + o.points + '" data-feedback="' + o.feedback.replace(/"/g, '&quot;') + '" onclick="answerScenario(this)">' + o.label + '</div>';
        }

        html += '<div id="scen-feedback"></div>';
        document.getElementById('scen-container').innerHTML = html;
    }

    function answerScenario(el) {
        var type = el.getAttribute('data-type');
        var points = parseInt(el.getAttribute('data-points'));
        var feedback = el.getAttribute('data-feedback');
        scenScore += points;

        var cards = document.querySelectorAll('#scen-container .response-card');
        for (var i = 0; i < cards.length; i++) cards[i].classList.add('disabled');

        if (type === 'prosocial') {
            el.classList.add('selected-best');
        } else if (type === 'partiel') {
            el.classList.add('selected-ok');
            for (var i = 0; i < cards.length; i++) {
                if (cards[i].getAttribute('data-type') === 'prosocial') cards[i].classList.add('reveal-best');
            }
        } else {
            el.classList.add('selected-bad');
            for (var i = 0; i < cards.length; i++) {
                if (cards[i].getAttribute('data-type') === 'prosocial') cards[i].classList.add('reveal-best');
            }
        }

        var fbClass = type === 'prosocial' ? 'best' : (type === 'partiel' ? 'ok' : 'bad');
        var fbIcon = type === 'prosocial' ? '‚úì' : (type === 'partiel' ? '~' : '‚úó');

        var isLast = currentScen >= shuffledScen.length - 1;
        var btnLabel = isLast ? 'Passer √† la gratitude ‚Üí' : 'Suivant ‚Üí';
        var btnAction = isLast ? 'startGratitude()' : 'nextScenario()';

        var html = '<div class="feedback-card ' + fbClass + '"><span class="feedback-icon">' + fbIcon + '</span> ' + feedback + '</div>';
        html += '<button class="btn-next" onclick="' + btnAction + '">' + btnLabel + '</button>';

        document.getElementById('scen-feedback').innerHTML = html;
    }

    function nextScenario() {
        currentScen++;
        renderScenario();
    }

    /* ========== GRATITUDE ========== */
    function startGratitude() {
        shuffledGrat = shuffle(gratitudeItems);
        currentGrat = 0;
        gratScore = 0;
        showSection('section-gratitude');
        renderGratitude();
    }

    function renderGratitude() {
        var item = shuffledGrat[currentGrat];
        var total = shuffledGrat.length;
        var pct = (currentGrat / total) * 100;

        document.getElementById('grat-progress').style.width = pct + '%';
        document.getElementById('grat-progress-text').textContent = (currentGrat + 1) + ' / ' + total;

        var shuffledOpts = shuffle(item.options);

        var html = '';
        html += '<div class="context-card">' + item.context + '</div>';

        for (var i = 0; i < shuffledOpts.length; i++) {
            var o = shuffledOpts[i];
            html += '<div class="option-card" data-correct="' + o.correct + '" data-feedback="' + o.feedback.replace(/"/g, '&quot;') + '" onclick="answerGratitude(this)">' + o.text + '</div>';
        }

        html += '<div id="grat-feedback"></div>';
        document.getElementById('grat-container').innerHTML = html;
    }

    function answerGratitude(el) {
        var correct = el.getAttribute('data-correct') === 'true';
        var feedback = el.getAttribute('data-feedback');
        if (correct) gratScore++;

        var cards = document.querySelectorAll('#grat-container .option-card');
        for (var i = 0; i < cards.length; i++) cards[i].classList.add('disabled');

        if (correct) {
            el.classList.add('selected-correct');
        } else {
            el.classList.add('selected-wrong');
            for (var i = 0; i < cards.length; i++) {
                if (cards[i].getAttribute('data-correct') === 'true') cards[i].classList.add('reveal-correct');
            }
        }

        var fbClass = correct ? 'correct' : 'wrong';
        var fbIcon = correct ? '‚úì' : '‚úó';
        var isLast = currentGrat >= shuffledGrat.length - 1;
        var btnLabel = isLast ? 'Voir mon bilan ‚Üí' : 'Suite ‚Üí';
        var btnAction = isLast ? 'showBilan()' : 'nextGratitude()';

        var html = '<div class="feedback-card ' + fbClass + '"><span class="feedback-icon">' + fbIcon + '</span> ' + feedback + '</div>';
        html += '<button class="btn-next" onclick="' + btnAction + '">' + btnLabel + '</button>';

        document.getElementById('grat-feedback').innerHTML = html;
    }

    function nextGratitude() {
        currentGrat++;
        renderGratitude();
    }

    /* ========== BILAN ========== */
    function showBilan() {
        var total = scenScore + gratScore;
        document.getElementById('final-score').textContent = total;

        var msg = '';
        if (total >= 14) msg = 'üåü Excellent ! Tu sais cr√©er des liens positifs et exprimer ta reconnaissance.';
        else if (total >= 10) msg = 'üëè Bien jou√© ! Tu as de bonnes bases pour renforcer tes relations.';
        else msg = 'üí™ C\'est un bon d√©but ! Chaque petit geste prosocial compte.';

        document.getElementById('score-message').textContent = msg;
        showSection('section-bilan');
    }

    /* ========== RESET ========== */
    function resetAll() {
        currentScen = 0; scenScore = 0;
        currentGrat = 0; gratScore = 0;
        showSection('section-intro');
    }
</script>

</body>
</html>
