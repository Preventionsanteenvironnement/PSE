<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>S√©ance 3 : Mon Projet Post-Bac & Bilan ‚Äì Seconde Bac Pro AGOrA</title>
  <style>
    * { box-sizing: border-box; }

    html { font-size: 16px; }

    body{
      margin: 0; padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f4f6fb; color: #222;
      overflow-x: hidden;
    }

    .container{
      max-width: 1100px;
      margin: 0 auto;
      padding: 24px 16px 40px;
    }

    header{
      background: linear-gradient(135deg, #0f766e, #14b8a6);
      color: #fff;
      padding: 20px 24px;
      border-radius: 14px;
      margin-bottom: 16px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.15);
    }

    header h1{ margin: 0 0 6px; font-size: 1.5rem; }
    header h2{ margin: 0; font-weight: 400; font-size: 1.05rem; opacity: 0.95; }

    .badge{
      display: inline-block;
      margin-top: 10px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.15);
      font-size: 0.8rem;
    }

    .font-controls{
      position: sticky;
      top: 10px;
      z-index: 50;
      display: flex;
      gap: 8px;
      justify-content: flex-end;
      margin: 0 0 10px;
    }

    .font-btn{
      border: none;
      border-radius: 999px;
      padding: 8px 12px;
      font-weight: 700;
      cursor: pointer;
      background: #0f766e;
      color: #fff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.10);
    }

    .font-btn:active{ transform: translateY(1px); }

    .info-bar{
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      background: #ffffff;
      border-radius: 12px;
      padding: 12px 16px;
      margin-bottom: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }

    .info-field{
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
      flex: 1 1 260px;
      min-width: 220px;
    }

    .info-field label{ font-weight: 600; }

    .info-field input[type="date"]{
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid #c3c8d8;
      font-size: 0.95rem;
      width: 100%;
      max-width: 280px;
    }

    .visitor-counter{
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 8px;
      background: #f0fdf4;
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid #bbf7d0;
      flex: 0 0 auto;
      white-space: nowrap;
    }

    .visitor-counter img{ height: 20px; vertical-align: middle; }

    .section{
      background: #ffffff;
      border-radius: 16px;
      padding: 18px 20px 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      border: 1px solid #ccfbf1;
    }

    .section-header{
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .section-title{
      font-size: 1.1rem;
      font-weight: 650;
      color: #0f766e;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .section-title span.icon{ font-size: 1.4rem; }

    .section-subtitle{
      font-size: 0.85rem;
      color: #555;
      margin-bottom: 8px;
    }

    .chip-row{
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 12px;
    }

    .chip{
      padding: 6px 10px;
      border-radius: 999px;
      background: #f0fdfa;
      font-size: 0.82rem;
      color: #0f766e;
      border: 1px solid #ccfbf1;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      transition: all 0.2s;
      user-select: none;
      max-width: 100%;
      overflow-wrap: anywhere;
    }

    .chip:hover{ background: #ccfbf1; }
    .chip.active{ background: #0f766e; color: #fff; border-color: #0f766e; }

    .field-block{ margin-bottom: 18px; }
    .field-block label{ display: block; font-weight: 600; font-size: 0.9rem; margin-bottom: 4px; }
    .field-block small{ display: block; font-size: 0.78rem; color: #666; margin-bottom: 3px; }

    textarea{
      width: 100%;
      min-height: 60px;
      resize: none;
      padding: 10px 10px;
      border-radius: 10px;
      border: 1px solid #c7cedf;
      font-size: 0.95rem;
      background: #fafbff;
      overflow-y: hidden;
      line-height: 1.35;
    }

    textarea:focus{
      outline: none;
      border-color: #14b8a6;
      background: #ffffff;
      box-shadow: 0 0 0 2px rgba(20,184,166,0.15);
    }

    input[type="range"]{
      width: min(260px, 100%);
      accent-color: #0f766e;
    }

    .range-label{
      font-size: 0.85rem;
      margin-left: 8px;
      font-weight: 600;
      color: #0f766e;
      white-space: nowrap;
    }

    .dnd-container{
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 6px;
      font-size: 0.85rem;
    }

    .dnd-pool, .dnd-dropzone{
      flex: 1 1 280px;
      min-height: 110px;
      border-radius: 12px;
      border: 1px dashed #99f6e4;
      padding: 10px 10px;
      background: #f0fdfa;
    }

    .dnd-title{
      font-weight: 700;
      margin-bottom: 8px;
      font-size: 0.85rem;
      color: #0f766e;
    }

    .dnd-item{
      background: #ffffff;
      border: 1px solid #5eead4;
      border-radius: 999px;
      padding: 8px 12px;
      display: inline-block;
      margin: 4px 6px 0 0;
      cursor: move;
      user-select: none;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
      max-width: 100%;
      overflow-wrap: anywhere;
    }

    .dnd-dropzone.over{
      background: #ccfbf1;
      border-style: solid;
    }

    .action-check{
      display: flex;
      align-items: flex-start;
      gap: 10px;
      margin-bottom: 10px;
      font-size: 0.95rem;
    }

    .action-check input{ margin-top: 2px; }

    footer{
      text-align: center;
      margin-top: 24px;
      font-size: 0.78rem;
      color: #666;
    }

    .page-break{
      margin-top: 20px;
      border-top: 1px dashed #d0d5e5;
      padding-top: 16px;
    }

    @media (max-width: 720px){
      .container{ padding: 18px 12px 34px; }
      header{ padding: 16px 14px; }
      header h1{ font-size: 1.25rem; }
      header h2{ font-size: 0.95rem; }
      .section{ padding: 16px 14px; }
      .visitor-counter{ margin-left: 0; }
      .info-field{ min-width: 200px; }
    }

    @media print{
      body{ background: #fff; }
      .font-controls, .chip-row{ display: none !important; }
      header, .section{ box-shadow: none; border: none; }
      .page-break{ page-break-before: always; border: none; padding-top: 0; }
    }
  </style>
</head>

<body>
  <div class="container">

    <div class="font-controls" aria-label="Taille du texte">
      <button class="font-btn" type="button" onclick="changeSize(-1)">A-</button>
      <button class="font-btn" type="button" onclick="changeSize(1)">A+</button>
    </div>

    <header>
      <h1>S√©ance 3 : Mon Projet Post-Bac & Mon Bilan</h1>
      <h2>Explorer l'apr√®s-AGOrA et valoriser mes comp√©tences</h2>
      <div class="badge">Classe : Seconde Bac Pro AGOrA</div>
    </header>

    <div class="info-bar">
      <div class="info-field">
        <label for="dateTravail">Date :</label>
        <input type="date" id="dateTravail" />
      </div>

      <div class="visitor-counter">
        <small>Vues :</small>
        <img src="https://img.shields.io/badge/Compteur-Actif-blue?style=flat-square" alt="Compteur" />
      </div>
    </div>

    <section class="section" id="partiePostBac">
      <div class="section-header">
        <div class="section-title"><span class="icon">üéì</span> Partie 1 ‚Äì Mon Apr√®s-Bac</div>
      </div>
      <div class="section-subtitle">
        Quelles sont les poursuites d'√©tudes possibles apr√®s mon Bac Pro AGOrA ?
      </div>

      <div class="field-block">
        <label>1. Mon intention actuelle</label>
        <small>Vers quoi penses-tu te diriger apr√®s le bac ? (S√©lectionne une option)</small>
        <div class="chip-row">
          <div class="chip" onclick="selectSingleChip(this, 'intention')"><span>üìö</span> Poursuivre mes √©tudes (BTS, BUT...)</div>
          <div class="chip" onclick="selectSingleChip(this, 'intention')"><span>üíº</span> Travailler directement</div>
          <div class="chip" onclick="selectSingleChip(this, 'intention')"><span>ü§∑</span> Je ne sais pas encore</div>
        </div>
        <input type="hidden" id="intention" />
      </div>

      <div class="field-block">
        <label>2. Les formations qui m'int√©ressent</label>
        <small>S√©lectionne les pistes que tu aimerais explorer (Multi-choix possible).</small>
        <div class="chip-row">
          <div class="chip" onclick="toggleChip(this, 'pistes')"><span>üè¢</span> BTS Gestion de la PME (GPME)</div>
          <div class="chip" onclick="toggleChip(this, 'pistes')"><span>ü§ù</span> BTS Support √† l'Action Manag√©riale (SAM)</div>
          <div class="chip" onclick="toggleChip(this, 'pistes')"><span>üìä</span> BTS Comptabilit√© et Gestion (CG)</div>
          <div class="chip" onclick="toggleChip(this, 'pistes')"><span>üé•</span> BTS Audiovisuel (Gestion de Prod.)</div>
          <div class="chip" onclick="toggleChip(this, 'pistes')"><span>üéì</span> BUT GEA (Gestion Entreprises & Admin)</div>
          <div class="chip" onclick="toggleChip(this, 'pistes')"><span>üõçÔ∏è</span> BUT Tech de Co (TC)</div>
          <div class="chip" onclick="toggleChip(this, 'pistes')"><span>üèõÔ∏è</span> Licence AES ou √âco-Gestion</div>
          <div class="chip" onclick="toggleChip(this, 'pistes')"><span>üßë‚Äçüíº</span> Emploi (Assistant de gestion/RH...)</div>
        </div>
        <input type="hidden" id="pistes" />
      </div>

      <div class="field-block">
        <label for="motivationEtudes">3. Ma motivation pour les √©tudes longues</label>
        <small>Te sens-tu pr√™t(e) √† faire encore 2 ou 3 ans d'√©tudes apr√®s le bac ?</small>
        <div class="info-field">
          <input type="range" id="motivationEtudes" min="0" max="10" value="5" />
          <span class="range-label" id="valeurMotivation">5 / 10</span>
        </div>
      </div>
    </section>

    <div class="page-break"></div>

    <section class="section">
      <div class="section-header">
        <div class="section-title"><span class="icon">üîç</span> Partie 2 ‚Äì Bilan de mes Atouts AGOrA</div>
      </div>
      <div class="section-subtitle">
        Quelles comp√©tences professionnelles ai-je commenc√© √† acqu√©rir ?
      </div>

      <div class="field-block">
        <label>4. Mes comp√©tences acquises</label>
        <small>D√©place les comp√©tences du Bac Pro AGOrA dans la zone qui te correspond.</small>

        <div class="dnd-container">
          <div class="dnd-pool" id="poolCompetences">
            <div class="dnd-title">Comp√©tences √† trier</div>
            <div class="dnd-item" draggable="true">Accueil physique et t√©l√©phonique</div>
            <div class="dnd-item" draggable="true">Gestion administrative (courriers, mails)</div>
            <div class="dnd-item" draggable="true">Utilisation de logiciels (Texteur, Tableur)</div>
            <div class="dnd-item" draggable="true">Communication √©crite (orthographe, style)</div>
            <div class="dnd-item" draggable="true">Travaux comptables de base</div>
            <div class="dnd-item" draggable="true">Travail en √©quipe / Projet</div>
          </div>

          <div class="dnd-dropzone" data-zone="maitrise">
            <div class="dnd-title">‚úÖ Je me d√©brouille bien</div>
          </div>

          <div class="dnd-dropzone" data-zone="apprendre">
            <div class="dnd-title">üöß Je dois encore progresser</div>
          </div>
        </div>
      </div>

      <div class="field-block">
        <label for="lienMatiere">5. Mon lien Mati√®re / M√©tier</label>
        <small>Quelle mati√®re professionnelle t'a le plus aid√© √† comprendre le monde du travail ? Pourquoi ?</small>
        <textarea id="lienMatiere" placeholder="Exemple : J'aime l'Eco-Droit car je comprends mieux les r√®gles de l'entreprise... ou La Gestion car c'est concret..."></textarea>
      </div>
    </section>

    <section class="section">
      <div class="section-header">
        <div class="section-title"><span class="icon">üó∫Ô∏è</span> Partie 3 ‚Äì Mes Prochaines D√©marches</div>
      </div>
      <div class="section-subtitle">Passer √† l'action pour mon avenir.</div>

      <div class="field-block">
        <label>6. Ma Check-list d'orientation</label>
        <small>Coche ce que tu comptes faire prochainement.</small>

        <div class="action-check">
          <input type="checkbox" id="actJPO" />
          <label for="actJPO">Aller √† une Journ√©e Portes Ouvertes (JPO) de lyc√©e ou CFA.</label>
        </div>

        <div class="action-check">
          <input type="checkbox" id="actStage" />
          <label for="actStage">Poser des questions sur l'embauche pendant mon prochain stage.</label>
        </div>

        <div class="action-check">
          <input type="checkbox" id="actRDV" />
          <label for="actRDV">Prendre rendez-vous avec le Psy-EN ou le Prof Principal.</label>
        </div>

        <div class="action-check">
          <input type="checkbox" id="actFiche" />
          <label for="actFiche">Faire des recherches sur Internet (Onisep, Parcoursup).</label>
        </div>
      </div>

      <div class="field-block">
        <label for="metiersVises">7. M√©tiers ou Secteurs √† explorer</label>
        <small>Note ici 2 ou 3 m√©tiers ou secteurs pr√©cis (ex: Immobilier, Secr√©tariat m√©dical, Banque) sur lesquels tu vas te renseigner.</small>
        <textarea id="metiersVises" placeholder="Je vais me renseigner sur..."></textarea>
      </div>
    </section>

    <div class="page-break"></div>

    <section class="section" style="border-color: #fcd34d;">
      <div class="section-header">
        <div class="section-title" style="color: #b45309;"><span class="icon">üìù</span> Partie 4 ‚Äì Ma Fiche de Suivi Personnel</div>
      </div>
      <div class="section-subtitle">Synth√®se √† conserver pour tes entretiens.</div>

      <div class="field-block">
        <label>Mes 3 points forts (Synth√®se S√©ances 1, 2 & 3)</label>
        <textarea id="syntheseForces" style="height: 80px;" placeholder="Ex: Je suis ponctuel, je ma√Ætrise bien Word, je sais accueillir les clients..."></textarea>
      </div>

      <div class="field-block">
        <label>Ce que je dois travailler en priorit√©</label>
        <textarea id="syntheseBesoins" style="height: 80px;" placeholder="Ex: Am√©liorer mon orthographe, oser prendre la parole, trouver mon orientation..."></textarea>
      </div>
    </section>

    <footer>
      S√©ance 3 : Mon Projet Post-Bac & Bilan ‚Äì Seconde Bac Pro AGOrA
    </footer>
  </div>

  <script>
    let currentSize = 16;

    function changeSize(delta) {
      currentSize += delta;
      if (currentSize < 12) currentSize = 12;
      if (currentSize > 24) currentSize = 24;
      document.documentElement.style.fontSize = currentSize + 'px';
      const h1 = document.querySelector('h1');
      if(h1) h1.style.fontSize = (2 * (currentSize/16)) + 'rem';
    }

    const slider = document.getElementById('motivationEtudes');
    const label = document.getElementById('valeurMotivation');
    if (slider && label) {
      slider.addEventListener('input', function() { label.textContent = this.value + ' / 10'; });
    }

    function autoResize(el) {
      el.style.height = 'auto';
      el.style.height = (el.scrollHeight + 2) + 'px';
    }

    document.querySelectorAll('textarea').forEach(ta => {
      autoResize(ta);
      ta.addEventListener('input', () => autoResize(ta));
    });

    function selectSingleChip(chip, inputId) {
      const container = chip.parentElement;
      container.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
      chip.classList.add('active');
      document.getElementById(inputId).value = chip.innerText.trim();
    }

    function toggleChip(chip, inputId) {
      chip.classList.toggle('active');
      const input = document.getElementById(inputId);
      let values = input.value ? input.value.split(' || ') : [];
      const val = chip.innerText.trim();

      if (chip.classList.contains('active')) {
        if (!values.includes(val)) values.push(val);
      } else {
        values = values.filter(v => v !== val);
      }
      input.value = values.join(' || ');
    }

    let draggedItem = null;

    function initDND() {
      document.querySelectorAll('.dnd-item').forEach(item => {
        item.addEventListener('dragstart', function(e) {
          draggedItem = item;
          e.dataTransfer.effectAllowed = 'move';
          item.style.opacity = '0.5';
        });
        item.addEventListener('dragend', function() {
          item.style.opacity = '1';
          draggedItem = null;
        });
      });

      document.querySelectorAll('.dnd-dropzone, .dnd-pool').forEach(zone => {
        zone.addEventListener('dragover', e => {
          e.preventDefault();
          zone.classList.add('over');
        });
        zone.addEventListener('dragleave', () => zone.classList.remove('over'));
        zone.addEventListener('drop', e => {
          e.preventDefault();
          zone.classList.remove('over');
          if (draggedItem) {
            if (e.target.classList.contains('dnd-title')) zone.insertBefore(draggedItem, e.target.nextSibling);
            else zone.appendChild(draggedItem);
          }
        });
      });
    }

    document.addEventListener('DOMContentLoaded', initDND);
  </script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getFirestore, collection, addDoc, updateDoc, doc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAWdCMvOiAJln3eT9LIAQD3RWJUD0lQcLI",
      authDomain: "devoirs-pse.firebaseapp.com",
      projectId: "devoirs-pse",
      storageBucket: "devoirs-pse.appspot.com",
      messagingSenderId: "614730413904",
      appId: "1:614730413904:web:a5dd478af5de30f6bede55"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let currentDocId = null;
    let startTime = Date.now();

    function getIdentity() { return localStorage.getItem("cockpit_student_id"); }

    async function demarrerVisite() {
      try {
        let userCode = getIdentity() || "ANONYME";
        let userClass = localStorage.getItem("cockpit_student_class") || "VISITEUR";
        const pageName = document.title || window.location.pathname.split("/").pop();
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent);

        const ref = await addDoc(collection(db, "statistiques_usage"), {
          page: pageName,
          userCode: userCode,
          classe: userClass,
          device: isMobile ? "Mobile" : "Desktop",
          action: "Consultation",
          duree: 0,
          timestamp: serverTimestamp(),
          date: new Date().toISOString()
        });

        currentDocId = ref.id;

        setInterval(async () => {
          if (currentDocId && document.visibilityState === "visible") {
            try {
              await updateDoc(doc(db, "statistiques_usage", currentDocId), {
                duree: Math.floor((Date.now() - startTime) / 1000)
              });
            } catch (e) {}
          }
        }, 10000);

      } catch (e) { console.warn("Erreur Tracker", e); }
    }

    demarrerVisite();
  </script>
</body>
</html>
