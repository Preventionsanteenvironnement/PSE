<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R√©vision C.3 - Les Acteurs de Pr√©vention - Bac Pro Premi√®re</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #0f3460 0%, #16213e 50%, #1a1a2e 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
            transition: all 0.3s ease;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }
        
        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .btn-back {
            background: rgba(255,255,255,0.1);
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            border: 2px solid rgba(255,255,255,0.2);
            cursor: pointer;
        }
        
        .btn-back:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }
        
        .score-bar {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 50px;
        }
        
        .score-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .score-item .icon {
            font-size: 18px;
        }
        
        /* √âcrans */
        .screen {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .screen.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* √âcran d'accueil */
        .welcome-screen {
            text-align: center;
            padding: 30px 0;
        }
        
        .welcome-title {
            font-size: 38px;
            font-weight: 900;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #4facfe, #00f2fe, #03a9f4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .welcome-subtitle {
            font-size: 18px;
            color: rgba(255,255,255,0.7);
            margin-bottom: 30px;
        }
        
        /* Module Info Card */
        .module-card {
            background: linear-gradient(135deg, rgba(79, 172, 254, 0.3), rgba(0, 242, 254, 0.3));
            border: 2px solid rgba(79, 172, 254, 0.5);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            text-align: left;
        }
        
        .module-card h3 {
            font-size: 20px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #4facfe;
        }
        
        .module-objectif {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        .module-objectif h4 {
            font-size: 16px;
            margin-bottom: 10px;
            color: #00f2fe;
        }
        
        .objectif-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 8px 0;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .objectif-item .check {
            color: #4CAF50;
            font-size: 16px;
            flex-shrink: 0;
            margin-top: 2px;
        }
        
        .competences-row {
            display: flex;
            gap: 8px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .comp-badge {
            background: rgba(255,255,255,0.15);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
        }
        
        .comp-badge.c1 { background: rgba(16, 185, 129, 0.3); border: 1px solid #10b981; }
        .comp-badge.c2 { background: rgba(102, 126, 234, 0.3); border: 1px solid #667eea; }
        .comp-badge.c3 { background: rgba(245, 158, 11, 0.3); border: 1px solid #f59e0b; }
        .comp-badge.c4 { background: rgba(239, 68, 68, 0.3); border: 1px solid #ef4444; }
        .comp-badge.c5 { background: rgba(168, 85, 247, 0.3); border: 1px solid #a855f7; }
        .comp-badge.c6 { background: rgba(34, 197, 94, 0.3); border: 1px solid #22c55e; }
        
        /* Niveaux */
        .niveaux-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 25px;
        }
        
        .niveau-card {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .niveau-card:hover:not(.locked) {
            background: rgba(255,255,255,0.1);
            transform: translateX(5px);
            border-color: rgba(79, 172, 254, 0.5);
        }
        
        .niveau-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .niveau-card.completed {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }
        
        .niveau-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }
        
        .niveau-content {
            flex-grow: 1;
        }
        
        .niveau-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .niveau-description {
            font-size: 12px;
            color: rgba(255,255,255,0.7);
        }
        
        .niveau-progress {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .progress-bar {
            width: 60px;
            height: 6px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            transition: width 0.3s ease;
        }
        
        .progress-percent {
            font-size: 12px;
            font-weight: 600;
            min-width: 30px;
        }
        
        /* √âcran de jeu */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .level-info {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }
        
        .card-progress {
            background: rgba(255,255,255,0.1);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .flashcard {
            background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(255,255,255,0.9));
            color: #333;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            min-height: 350px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .card-header {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .card-type {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            display: inline-block;
            margin-bottom: 15px;
        }
        
        .card-keyword {
            font-size: 28px;
            font-weight: 900;
            color: #0f3460;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .question-section {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .question-text {
            font-size: 18px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 20px;
            line-height: 1.4;
            color: #0f3460;
        }
        
        /* Input pour mots-cl√©s */
        .keyword-input {
            width: 100%;
            padding: 15px;
            border: 3px solid #e0e0e0;
            border-radius: 15px;
            font-size: 16px;
            text-align: center;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        
        .keyword-input:focus {
            outline: none;
            border-color: #4facfe;
            transform: scale(1.02);
        }
        
        /* Options QCM */
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .option-btn {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            text-align: left;
        }
        
        .option-btn:hover {
            background: #e3f2fd;
            border-color: #4facfe;
            transform: translateX(5px);
        }
        
        .option-btn.selected {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            color: white;
            border-color: #4facfe;
        }
        
        .option-letter {
            background: rgba(79, 172, 254, 0.1);
            color: #0f3460;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            flex-shrink: 0;
        }
        
        .option-btn.selected .option-letter {
            background: rgba(255,255,255,0.3);
            color: white;
        }
        
        /* Boutons Vrai/Faux */
        .vf-container {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .vf-btn {
            flex: 1;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            font-weight: 700;
        }
        
        .vf-btn.vrai:hover {
            background: #e8f5e8;
            border-color: #4CAF50;
        }
        
        .vf-btn.faux:hover {
            background: #fef2f2;
            border-color: #f44336;
        }
        
        .vf-btn.selected.vrai {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }
        
        .vf-btn.selected.faux {
            background: #f44336;
            color: white;
            border-color: #f44336;
        }
        
        /* Controls */
        .card-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }
        
        .hint-btn {
            background: linear-gradient(135deg, #ff9a9e, #fecfef);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .hint-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 154, 158, 0.4);
        }
        
        .validate-btn {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 700;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .validate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
        }
        
        .hint-text {
            background: linear-gradient(135deg, #fff3cd, #fff8e1);
            border: 2px solid #ffc107;
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
            color: #856404;
            font-size: 14px;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Feedback Overlay - FONDS OPAQUES OBLIGATOIRE */
        .feedback-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85); /* OPAQUE */
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1000;
            padding: 20px;
        }
        
        .feedback-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        
        .feedback-card {
            background: linear-gradient(135deg, #ffffff, #f8fafc); /* OPAQUE */
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            text-align: center;
            color: #333;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            transform: scale(0.8);
            transition: transform 0.3s ease;
        }
        
        .feedback-overlay.visible .feedback-card {
            transform: scale(1);
        }
        
        .feedback-card.correct {
            border: 3px solid #4CAF50;
        }
        
        .feedback-card.incorrect {
            border: 3px solid #f44336;
        }
        
        .feedback-icon {
            font-size: 60px;
            margin-bottom: 20px;
            display: block;
        }
        
        .feedback-title {
            font-size: 24px;
            font-weight: 900;
            margin-bottom: 10px;
        }
        
        .feedback-points {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            display: inline-block;
            margin-bottom: 20px;
            font-weight: 700;
        }
        
        .feedback-explanation {
            background: rgba(79, 172, 254, 0.1); /* OPAQUE */
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
        }
        
        .feedback-explanation h4 {
            color: #0f3460;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .feedback-explanation p {
            line-height: 1.6;
            margin-bottom: 15px;
            color: #333;
        }
        
        .keyword-box {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            font-weight: 700;
            margin: 15px 0;
            text-align: center;
        }
        
        .tip-box {
            background: linear-gradient(135deg, #fff9c4, #fef08a); /* OPAQUE */
            border: 2px solid #f59e0b;
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .tip-box h5 {
            color: #92400e;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .tip-box p {
            color: #92400e;
            font-size: 13px;
            line-height: 1.5;
        }
        
        .next-btn {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 700;
            margin-top: 20px;
            transition: all 0.3s ease;
        }
        
        .next-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
        }
        
        /* R√©sultats */
        .results-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(255,255,255,0.9)); /* OPAQUE */
            color: #333;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }
        
        .results-icon {
            font-size: 80px;
            margin-bottom: 20px;
            display: block;
        }
        
        .results-title {
            font-size: 32px;
            font-weight: 900;
            margin-bottom: 20px;
            color: #0f3460;
        }
        
        .results-score {
            font-size: 48px;
            font-weight: 900;
            color: #4facfe;
            margin-bottom: 20px;
        }
        
        .results-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }
        
        .stat-item {
            background: rgba(79, 172, 254, 0.1);
            padding: 15px;
            border-radius: 12px;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: 900;
            color: #0f3460;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
        }
        
        .errors-recap {
            background: rgba(244, 67, 54, 0.1); /* OPAQUE */
            border: 2px solid #f44336;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
        }
        
        .errors-recap h4 {
            color: #c62828;
            margin-bottom: 15px;
        }
        
        .errors-recap ul {
            list-style: none;
            padding: 0;
        }
        
        .errors-recap li {
            background: rgba(255,255,255,0.8); /* OPAQUE */
            padding: 8px 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            color: #333;
        }
        
        .results-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 30px;
        }
        
        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            color: white;
        }
        
        .btn-secondary {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        /* Streak popup */
        .streak-popup {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #ff9a9e, #fecfef);
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            font-weight: 900;
            font-size: 18px;
            z-index: 1001;
            display: none;
            animation: bounceIn 0.5s ease;
        }
        
        @keyframes bounceIn {
            0% { opacity: 0; transform: translateX(-50%) translateY(-30px); }
            60% { opacity: 1; transform: translateX(-50%) translateY(10px); }
            100% { transform: translateX(-50%) translateY(0); }
        }
        
        /* Confettis */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #ff9a9e;
            animation: confetti-fall 3s linear infinite;
            z-index: 1002;
        }
        
        @keyframes confetti-fall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 15px; }
            .welcome-title { font-size: 32px; }
            .flashcard { padding: 25px; min-height: 300px; }
            .card-keyword { font-size: 24px; }
            .question-text { font-size: 16px; }
            .vf-container { flex-direction: column; }
            .results-score { font-size: 36px; }
            .results-stats { grid-template-columns: repeat(2, 1fr); }
            .results-buttons { flex-direction: column; }
            .header { justify-content: center; }
            .score-bar { flex-wrap: wrap; }
            .feedback-card { padding: 25px; margin: 10px; }
        }
        
        /* Animations d'attention */
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <a href="#" class="btn-back" onclick="goHome()">‚Üê Retour</a>
            <div class="score-bar">
                <div class="score-item">
                    <span class="icon">üéØ</span>
                    <span id="totalPoints">0</span>
                </div>
                <div class="score-item">
                    <span class="icon">üî•</span>
                    <span id="currentStreak">0</span>
                </div>
            </div>
        </div>

        <!-- √âcran d'accueil -->
        <div class="screen active" id="homeScreen">
            <div class="welcome-screen">
                <div class="welcome-title">üõ°Ô∏è ACTEURS DE PR√âVENTION</div>
                <div class="welcome-subtitle">Ma√Ætrise des r√¥les et missions - Module C.3</div>

                <!-- Module Info Card -->
                <div class="module-card">
                    <h3>üéì Module C.3 : Les acteurs de pr√©vention</h3>
                    
                    <div class="module-objectif">
                        <h4>üéØ Objectifs p√©dagogiques</h4>
                        <div class="objectif-item">
                            <span class="check">‚úì</span>
                            <span>Identifier les acteurs internes et externes de la pr√©vention</span>
                        </div>
                        <div class="objectif-item">
                            <span class="check">‚úì</span>
                            <span>Conna√Ætre les missions et responsabilit√©s de chaque acteur</span>
                        </div>
                        <div class="objectif-item">
                            <span class="check">‚úì</span>
                            <span>Comprendre les interactions entre les diff√©rents acteurs</span>
                        </div>
                        <div class="objectif-item">
                            <span class="check">‚úì</span>
                            <span>Ma√Ætriser la signification des sigles professionnels</span>
                        </div>
                    </div>

                    <div class="competences-row">
                        <span class="comp-badge c1">C1</span>
                        <span class="comp-badge c2">C2</span>
                        <span class="comp-badge c3">C3</span>
                        <span class="comp-badge c4">C4</span>
                        <span class="comp-badge c5">C5</span>
                        <span class="comp-badge c6">C6</span>
                    </div>
                </div>

                <!-- Niveaux -->
                <div class="niveaux-grid">
                    <div class="niveau-card" onclick="startLevel(1)">
                        <div class="niveau-icon">üë•</div>
                        <div class="niveau-content">
                            <div class="niveau-title">Niveau 1 : Acteurs Internes</div>
                            <div class="niveau-description">Employeur, Salari√© comp√©tent, CSE (Comit√© Social et √âconomique), SST (Sauveteur Secouriste du Travail)</div>
                        </div>
                        <div class="niveau-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="level1Bar" style="width: 0%"></div>
                            </div>
                            <span class="progress-percent" id="level1Percent">0%</span>
                        </div>
                    </div>

                    <div class="niveau-card" onclick="startLevel(2)">
                        <div class="niveau-icon">üèõÔ∏è</div>
                        <div class="niveau-content">
                            <div class="niveau-title">Niveau 2 : Acteurs Externes</div>
                            <div class="niveau-description">Inspection du travail, SPST (Service de Pr√©vention et de Sant√© au Travail), CARSAT (Caisse d'Assurance Retraite et de la Sant√© au Travail)</div>
                        </div>
                        <div class="niveau-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="level2Bar" style="width: 0%"></div>
                            </div>
                            <span class="progress-percent" id="level2Percent">0%</span>
                        </div>
                    </div>

                    <div class="niveau-card" onclick="startLevel(3)">
                        <div class="niveau-icon">‚öñÔ∏è</div>
                        <div class="niveau-content">
                            <div class="niveau-title">Niveau 3 : Missions et Responsabilit√©s</div>
                            <div class="niveau-description">R√¥les sp√©cifiques, obligations l√©gales, domaines d'intervention de chaque acteur</div>
                        </div>
                        <div class="niveau-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="level3Bar" style="width: 0%"></div>
                            </div>
                            <span class="progress-percent" id="level3Percent">0%</span>
                        </div>
                    </div>

                    <div class="niveau-card" onclick="startLevel(4)">
                        <div class="niveau-icon">ü§ù</div>
                        <div class="niveau-content">
                            <div class="niveau-title">Niveau 4 : Interactions et Coordination</div>
                            <div class="niveau-description">Comment les acteurs collaborent, cas pratiques, situations professionnelles</div>
                        </div>
                        <div class="niveau-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="level4Bar" style="width: 0%"></div>
                            </div>
                            <span class="progress-percent" id="level4Percent">0%</span>
                        </div>
                    </div>

                    <div class="niveau-card" onclick="startLevel(5)">
                        <div class="niveau-icon">üèÜ</div>
                        <div class="niveau-content">
                            <div class="niveau-title">Niveau 5 : Ma√Ætrise Compl√®te</div>
                            <div class="niveau-description">Synth√®se g√©n√©rale, cas complexes, pr√©paration aux √©preuves</div>
                        </div>
                        <div class="niveau-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="level5Bar" style="width: 0%"></div>
                            </div>
                            <span class="progress-percent" id="level5Percent">0%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- √âcran de jeu -->
        <div class="screen" id="gameScreen">
            <div class="game-header">
                <div class="level-info">
                    <span id="levelTitle">Niveau 1</span>
                </div>
                <div class="card-progress" id="cardProgress">1/10</div>
            </div>

            <div class="flashcard">
                <div class="card-header">
                    <div class="card-type" id="cardType">Acteur Interne</div>
                    <div class="card-keyword" id="cardKeyword">Employeur</div>
                </div>

                <div class="question-section" id="questionSection">
                    <!-- Contenu dynamique selon le type de question -->
                </div>

                <div class="card-controls">
                    <button class="hint-btn" onclick="showHint()">üí° Indice</button>
                    <button class="validate-btn" onclick="validateAnswer()">Valider</button>
                </div>

                <div class="hint-text" id="hintText" style="display: none;"></div>
            </div>
        </div>

        <!-- √âcran de r√©sultats -->
        <div class="screen" id="resultsScreen">
            <div class="results-card">
                <div class="results-icon" id="resultsIcon">üéâ</div>
                <div class="results-title" id="resultsTitle">Niveau r√©ussi !</div>
                <div class="results-score" id="resultsScore">85%</div>

                <div class="results-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="correctCount">8/10</div>
                        <div class="stat-label">Correctes</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="pointsEarned">+80</div>
                        <div class="stat-label">Points</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="bestStreak">5</div>
                        <div class="stat-label">Meilleure s√©rie</div>
                    </div>
                </div>

                <div class="errors-recap" id="errorsRecap" style="display: none;">
                    <h4>üîç Points √† revoir</h4>
                    <ul id="errorsList"></ul>
                </div>

                <div class="results-buttons">
                    <button class="btn btn-secondary" onclick="goHome()">üè† Accueil</button>
                    <button class="btn btn-primary" onclick="nextLevel()" id="nextLevelBtn" style="display: none;">Niveau suivant üöÄ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Feedback Overlay -->
    <div class="feedback-overlay" id="feedbackOverlay">
        <div class="feedback-card" id="feedbackCard">
            <div class="feedback-icon" id="feedbackIcon">‚úÖ</div>
            <div class="feedback-title" id="feedbackTitle">Bravo !</div>
            <div class="feedback-points" id="feedbackPoints">+10 points</div>
            
            <div class="feedback-explanation" id="feedbackExplanation">
                <!-- Contenu dynamique -->
            </div>

            <button class="next-btn" onclick="nextCard()">Carte suivante</button>
        </div>
    </div>

    <!-- Streak Popup -->
    <div class="streak-popup" id="streakPopup"></div>

    <script>
        // Variables globales
        let currentLevel = 1;
        let currentCardIndex = 0;
        let totalPoints = 0;
        let currentStreak = 0;
        let bestStreak = 0;
        let levelPoints = 0;
        let levelCorrect = 0;
        let levelErrors = [];
        let hintUsed = false;
        let levelProgress = [0, 0, 0, 0, 0, 0];

        // Donn√©es des niveaux et cartes
        const levels = {
            1: {
                title: "Acteurs Internes",
                cards: [
                    {
                        type: "keyword",
                        keyword: "Employeur",
                        question: "Qui est l√©galement responsable de la s√©curit√© et de la sant√© des salari√©s dans l'entreprise ?",
                        answer: "employeur",
                        explanation: "L'employeur a une obligation g√©n√©rale de s√©curit√© envers tous ses salari√©s selon l'article L4121-1 du Code du travail. Il doit prendre toutes les mesures n√©cessaires pour assurer leur s√©curit√© et prot√©ger leur sant√© physique et mentale.",
                        hint: "C'est la personne qui dirige l'entreprise et qui a le pouvoir de d√©cision.",
                        tip: "Retenir : Obligation g√©n√©rale = responsabilit√© p√©nale en cas d'accident grave"
                    },
                    {
                        type: "qcm",
                        keyword: "Salari√© comp√©tent",
                        question: "Quelle est la mission principale du salari√© comp√©tent d√©sign√© par l'employeur ?",
                        options: [
                            "Contr√¥ler le respect des horaires de travail",
                            "Assister l'employeur dans la mise en ≈ìuvre de la pr√©vention",
                            "Remplacer l'employeur en cas d'absence",
                            "Former les nouveaux salari√©s aux techniques de production"
                        ],
                        answer: 1,
                        explanation: "Le salari√© comp√©tent est d√©sign√© par l'employeur pour l'assister dans la mise en ≈ìuvre des mesures de pr√©vention des risques professionnels. Il contribue √† l'identification des risques et √† la mise en place des actions de pr√©vention.",
                        hint: "Il aide l'employeur mais ne le remplace pas dans ses obligations.",
                        tip: "PPRP = Programme de Pr√©vention des Risques Professionnels dont il est charg√©"
                    },
                    {
                        type: "qcm",
                        keyword: "CSE",
                        question: "√Ä partir de quel effectif le CSE (Comit√© Social et √âconomique) devient-il obligatoire ?",
                        options: [
                            "5 salari√©s",
                            "11 salari√©s",
                            "25 salari√©s",
                            "50 salari√©s"
                        ],
                        answer: 1,
                        explanation: "Le CSE (Comit√© Social et √âconomique) est obligatoire dans les entreprises d'au moins 11 salari√©s. Il remplace depuis 2017 les anciennes instances repr√©sentatives du personnel (d√©l√©gu√©s du personnel, comit√© d'entreprise, CHSCT).",
                        hint: "C'est un seuil relativement bas pour une petite entreprise.",
                        tip: "11 salari√©s = seuil l√©gal √† retenir absolument pour le Bac"
                    },
                    {
                        type: "vf",
                        keyword: "CSE - Missions",
                        question: "Le CSE a-t-il un droit d'enqu√™te en cas d'accident du travail ?",
                        answer: true,
                        explanation: "Oui, le CSE dispose d'un droit d'enqu√™te en mati√®re d'accidents du travail ou de maladies professionnelles. Il peut mener une enqu√™te contradictoire avec l'employeur pour identifier les causes et proposer des mesures de pr√©vention.",
                        hint: "Le CSE d√©fend les int√©r√™ts des salari√©s, notamment en mati√®re de s√©curit√©.",
                        tip: "Enqu√™te contradictoire = CSE + Employeur ensemble pour plus d'objectivit√©"
                    },
                    {
                        type: "keyword",
                        keyword: "SST",
                        question: "Que signifie le sigle SST dans le contexte de la pr√©vention en entreprise ?",
                        answer: "sauveteur secouriste du travail",
                        explanation: "SST signifie Sauveteur Secouriste du Travail. C'est un salari√© form√© aux premiers secours et √† la pr√©vention des risques professionnels. Il peut intervenir imm√©diatement en cas d'accident et participe √† la pr√©vention dans l'entreprise.",
                        hint: "Il s'agit d'une formation sp√©cialis√©e dans le secours au travail.",
                        tip: "Formation SST = 12h minimum, recyclage tous les 2 ans obligatoire"
                    },
                    {
                        type: "qcm",
                        keyword: "Responsabilit√©s Employeur",
                        question: "En cas d'accident du travail grave, quelle est la premi√®re obligation de l'employeur ?",
                        options: [
                            "Contacter son assurance",
                            "Organiser une enqu√™te interne",
                            "D√©clarer l'accident √† la CPAM dans les 48h",
                            "Modifier imm√©diatement l'organisation du travail"
                        ],
                        answer: 2,
                        explanation: "L'employeur doit d√©clarer tout accident du travail √† la CPAM (Caisse Primaire d'Assurance Maladie) dans les 48 heures. Cette d√©claration est obligatoire m√™me si l'accident semble b√©nin au d√©part.",
                        hint: "Il s'agit d'une obligation administrative avec un d√©lai pr√©cis.",
                        tip: "48h = d√©lai l√©gal imp√©ratif, sanction p√©nale si non-respect"
                    },
                    {
                        type: "vf",
                        keyword: "Formation SST",
                        question: "Un SST peut-il donner des ordres aux autres salari√©s en mati√®re de s√©curit√© ?",
                        answer: false,
                        explanation: "Non, un SST ne peut pas donner d'ordres. Il n'a pas d'autorit√© hi√©rarchique. Son r√¥le est d'intervenir en cas d'urgence, de sensibiliser ses coll√®gues et d'alerter l'employeur sur les risques observ√©s, mais il n'a pas de pouvoir disciplinaire.",
                        hint: "Il agit par conseil et exemple, pas par autorit√©.",
                        tip: "SST = mission de conseil et d'alerte, pas de commandement"
                    },
                    {
                        type: "qcm",
                        keyword: "Document Unique",
                        question: "Qui est responsable de la r√©daction du Document Unique d'√âvaluation des Risques Professionnels (DUERP) ?",
                        options: [
                            "Le salari√© comp√©tent uniquement",
                            "L'employeur, aid√© par le salari√© comp√©tent",
                            "Le CSE en autonomie",
                            "Un organisme externe obligatoirement"
                        ],
                        answer: 1,
                        explanation: "L'employeur est responsable de la r√©daction du DUERP, mais il peut et doit s'appuyer sur le salari√© comp√©tent pour l'aider dans cette d√©marche. Le CSE doit √™tre consult√© mais n'est pas r√©dacteur.",
                        hint: "La responsabilit√© finale reste toujours √† l'employeur.",
                        tip: "DUERP = obligation employeur mais travail collaboratif recommand√©"
                    }
                ]
            },
            2: {
                title: "Acteurs Externes",
                cards: [
                    {
                        type: "keyword",
                        keyword: "Inspection du travail",
                        question: "Quel organisme contr√¥le l'application de la l√©gislation du travail dans les entreprises ?",
                        answer: "inspection du travail",
                        explanation: "L'inspection du travail est un service public charg√© de veiller au respect de la l√©gislation du travail. Les inspecteurs peuvent entrer dans les entreprises, constater les infractions et prendre des mesures pour faire respecter le droit du travail.",
                        hint: "C'est l'organisme de contr√¥le principal du minist√®re du travail.",
                        tip: "Pouvoir de police administrative = peut arr√™ter une activit√© dangereuse"
                    },
                    {
                        type: "qcm",
                        keyword: "SPST",
                        question: "Que signifie le sigle SPST ?",
                        options: [
                            "Service Public de S√©curit√© au Travail",
                            "Service de Pr√©vention et de Sant√© au Travail", 
                            "Syst√®me de Protection des Salari√©s au Travail",
                            "Service de Pr√©vention des Sinistres au Travail"
                        ],
                        answer: 1,
                        explanation: "SPST signifie Service de Pr√©vention et de Sant√© au Travail. C'est un organisme qui assure le suivi m√©dical des salari√©s et accompagne les employeurs dans la pr√©vention des risques professionnels.",
                        hint: "Il s'occupe √† la fois de sant√© et de pr√©vention.",
                        tip: "SPST remplace les anciens services de m√©decine du travail depuis 2012"
                    },
                    {
                        type: "qcm",
                        keyword: "CARSAT",
                        question: "Que signifie le sigle CARSAT ?",
                        options: [
                            "Centre d'Aide et de Recherche en S√©curit√© au Travail",
                            "Caisse d'Assurance Retraite et de la Sant√© au Travail",
                            "Comit√© d'Analyse des Risques et de S√©curit√© au Travail",
                            "Centre d'Accompagnement et de R√©paration des Salari√©s au Travail"
                        ],
                        answer: 1,
                        explanation: "CARSAT signifie Caisse d'Assurance Retraite et de la Sant√© au Travail. Elle g√®re les accidents du travail et maladies professionnelles, fixe les taux de cotisation et accompagne les entreprises en pr√©vention.",
                        hint: "Elle s'occupe √† la fois de retraite et de sant√© au travail.",
                        tip: "CARSAT = ex-CRAM, fusion retraite + AT/MP en 2010"
                    },
                    {
                        type: "vf",
                        keyword: "M√©decin du travail",
                        question: "Le m√©decin du travail peut-il d√©clarer un salari√© inapte √† son poste ?",
                        answer: true,
                        explanation: "Oui, le m√©decin du travail a le pouvoir de d√©clarer un salari√© inapte √† son poste si l'√©tat de sant√© du salari√© ne lui permet plus d'exercer ses fonctions sans danger pour lui-m√™me ou ses coll√®gues.",
                        hint: "C'est une pr√©rogative m√©dicale importante pour prot√©ger la sant√©.",
                        tip: "Inaptitude = obligation de recherche de reclassement par l'employeur"
                    },
                    {
                        type: "qcm",
                        keyword: "Missions CARSAT",
                        question: "Quelle est la principale mission de la CARSAT en mati√®re de pr√©vention ?",
                        options: [
                            "Contr√¥ler les heures suppl√©mentaires",
                            "Fixer les taux de cotisation Accidents du Travail/Maladies Professionnelles",
                            "Organiser les √©lections du CSE",
                            "Former obligatoirement tous les SST"
                        ],
                        answer: 1,
                        explanation: "La CARSAT fixe les taux de cotisation AT/MP selon la sinistralit√© de l'entreprise. Plus une entreprise a d'accidents, plus son taux augmente. C'est un syst√®me d'incitation √©conomique √† la pr√©vention.",
                        hint: "Elle agit sur l'aspect financier pour encourager la pr√©vention.",
                        tip: "Taux AT/MP = levier √©conomique puissant pour la s√©curit√©"
                    },
                    {
                        type: "vf",
                        keyword: "Visite m√©dicale",
                        question: "Tous les salari√©s doivent-ils obligatoirement passer une visite m√©dicale au SPST ?",
                        answer: true,
                        explanation: "Oui, tous les salari√©s doivent b√©n√©ficier d'un suivi m√©dical par le SPST. Selon les risques du poste, ce sera un suivi individuel renforc√© ou un suivi individuel simple, mais aucun salari√© n'√©chappe √† ce suivi.",
                        hint: "C'est une obligation de l'employeur pour tous ses salari√©s.",
                        tip: "Suivi adapt√© au poste : renforc√© (risques √©lev√©s) ou simple (autres postes)"
                    },
                    {
                        type: "qcm",
                        keyword: "Inspection - Pouvoirs",
                        question: "Que peut faire l'inspection du travail en cas de danger grave et imminent ?",
                        options: [
                            "Licencier le salari√© en danger",
                            "Arr√™ter temporairement l'activit√© dangereuse",
                            "Remplacer l'employeur d√©faillant",
                            "Modifier le contrat de travail du salari√©"
                        ],
                        answer: 1,
                        explanation: "En cas de danger grave et imminent, l'inspecteur du travail peut ordonner l'arr√™t temporaire de l'activit√© ou l'utilisation d'un √©quipement dangereux. C'est son pouvoir de police administrative.",
                        hint: "L'inspecteur peut agir de mani√®re contraignante pour prot√©ger les salari√©s.",
                        tip: "Danger grave et imminent = pouvoir d'arr√™t imm√©diat sans d√©lai"
                    },
                    {
                        type: "keyword",
                        keyword: "Pr√©vention primaire",
                        question: "Comment appelle-t-on les actions visant √† √©viter l'apparition des risques professionnels ?",
                        answer: "pr√©vention primaire",
                        explanation: "La pr√©vention primaire vise √† supprimer ou r√©duire les risques √† la source avant qu'ils ne causent des dommages. C'est le niveau de pr√©vention le plus efficace car il agit sur les causes plut√¥t que sur les cons√©quences.",
                        hint: "C'est le type de pr√©vention le plus en amont, le plus efficace.",
                        tip: "3 types : primaire (supprime), secondaire (d√©tecte), tertiaire (r√©pare)"
                    }
                ]
            },
            3: {
                title: "Missions et Responsabilit√©s",
                cards: [
                    {
                        type: "qcm",
                        keyword: "Obligation de s√©curit√©",
                        question: "L'obligation de s√©curit√© de l'employeur est-elle de r√©sultat ou de moyens ?",
                        options: [
                            "De moyens uniquement",
                            "De r√©sultat en principe",
                            "Cela d√©pend du secteur d'activit√©",
                            "De moyens renforc√©s seulement"
                        ],
                        answer: 1,
                        explanation: "L'obligation de s√©curit√© de l'employeur est une obligation de r√©sultat. Cela signifie qu'il doit assurer effectivement la s√©curit√©, et qu'un accident peut engager sa responsabilit√© m√™me s'il avait pris des mesures.",
                        hint: "C'est l'obligation la plus contraignante en droit.",
                        tip: "R√©sultat = responsabilit√© m√™me si moyens mis en ≈ìuvre (sauf faute inexcusable salari√©)"
                    },
                    {
                        type: "vf",
                        keyword: "Droit de retrait",
                        question: "Un salari√© peut-il utiliser son droit de retrait s'il estime sa situation dangereuse ?",
                        answer: true,
                        explanation: "Oui, tout salari√© peut exercer son droit de retrait s'il a un motif raisonnable de penser qu'une situation pr√©sente un danger grave et imminent pour sa vie ou sa sant√©. Il doit alerter l'employeur mais peut se retirer imm√©diatement.",
                        hint: "C'est un droit individuel de protection du salari√©.",
                        tip: "Conditions : danger grave + imminent + motif raisonnable (appr√©ciation subjective mais raisonnable)"
                    },
                    {
                        type: "qcm",
                        keyword: "Faute inexcusable",
                        question: "Dans quel cas l'employeur peut-il voir sa responsabilit√© aggrav√©e en cas d'accident du travail ?",
                        options: [
                            "Si l'accident a lieu un dimanche",
                            "Si l'employeur avait conscience du danger et n'a pas agi",
                            "Si le salari√© √©tait en p√©riode d'essai",
                            "Si l'accident implique plusieurs salari√©s"
                        ],
                        answer: 1,
                        explanation: "La faute inexcusable de l'employeur est caract√©ris√©e quand il avait ou aurait d√ª avoir conscience du danger et qu'il n'a pas pris les mesures n√©cessaires. Elle entra√Æne une indemnisation major√©e de la victime.",
                        hint: "Il s'agit d'un manquement grave de l'employeur qui avait conscience du risque.",
                        tip: "Faute inexcusable = conscience du danger + absence de mesures = indemnisation major√©e"
                    },
                    {
                        type: "keyword",
                        keyword: "DUERP",
                        question: "Que signifie le sigle DUERP ?",
                        answer: "document unique d'√©valuation des risques professionnels",
                        explanation: "DUERP signifie Document Unique d'√âvaluation des Risques Professionnels. C'est un document obligatoire dans toute entreprise qui recense tous les risques professionnels et les mesures de pr√©vention prises ou √† prendre.",
                        hint: "C'est LE document central de la pr√©vention en entreprise.",
                        tip: "Obligatoire d√®s 1 salari√©, mise √† jour annuelle + si modification poste/technique"
                    },
                    {
                        type: "vf",
                        keyword: "Formation s√©curit√©",
                        question: "L'employeur doit-il former tous ses salari√©s √† la s√©curit√© ?",
                        answer: true,
                        explanation: "Oui, l'employeur a l'obligation de former tous ses salari√©s √† la s√©curit√©, notamment lors de l'embauche, en cas de changement de poste ou de modification des √©quipements. Cette formation fait partie de ses obligations de pr√©vention.",
                        hint: "La formation est un pilier fondamental de la pr√©vention.",
                        tip: "Formation obligatoire : embauche + changement poste + nouveau risque + p√©riodique"
                    },
                    {
                        type: "qcm",
                        keyword: "√âquipements de protection",
                        question: "Qui doit fournir les √âquipements de Protection Individuelle (EPI) aux salari√©s ?",
                        options: [
                            "Le salari√© doit les acheter lui-m√™me",
                            "L'employeur doit les fournir gratuitement",
                            "Le CSE finance les EPI",
                            "C'est un partage de frais employeur-salari√©"
                        ],
                        answer: 1,
                        explanation: "L'employeur doit fournir gratuitement les EPI √† ses salari√©s. Il doit aussi s'assurer de leur bon √©tat, de leur utilisation correcte et organiser leur maintenance. Le co√ªt ne peut jamais √™tre √† la charge du salari√©.",
                        hint: "C'est une charge enti√®rement patronale, jamais salariale.",
                        tip: "EPI gratuits + formation utilisation + maintenance + remplacement = obligation employeur"
                    },
                    {
                        type: "qcm",
                        keyword: "Comit√© d'hygi√®ne",
                        question: "Dans les entreprises de plus de 300 salari√©s, quelle commission sp√©cialis√©e du CSE s'occupe sp√©cifiquement de sant√© et s√©curit√© ?",
                        options: [
                            "Commission des conditions de travail",
                            "Commission hygi√®ne et s√©curit√©",
                            "Commission sant√©, s√©curit√© et conditions de travail (CSSCT)",
                            "Commission pr√©vention des risques"
                        ],
                        answer: 2,
                        explanation: "Dans les entreprises d'au moins 300 salari√©s, le CSE doit constituer une Commission Sant√©, S√©curit√© et Conditions de Travail (CSSCT) qui se consacre sp√©cifiquement aux questions de sant√© et s√©curit√© au travail.",
                        hint: "C'est une commission sp√©cialis√©e pour les grandes entreprises.",
                        tip: "CSSCT obligatoire ‚â• 300 salari√©s = sp√©cialisation sant√©-s√©curit√© du CSE"
                    },
                    {
                        type: "vf",
                        keyword: "M√©decin du travail ind√©pendance",
                        question: "Le m√©decin du travail est-il ind√©pendant dans ses d√©cisions m√©dicales ?",
                        answer: true,
                        explanation: "Oui, le m√©decin du travail jouit d'une ind√©pendance professionnelle totale dans ses d√©cisions m√©dicales. L'employeur ne peut pas lui donner d'instructions sur ses avis d'aptitude ou ses recommandations m√©dicales.",
                        hint: "C'est un principe fondamental du statut m√©dical.",
                        tip: "Ind√©pendance technique absolue = garantie d√©ontologique prot√©g√©e par la loi"
                    }
                ]
            },
            4: {
                title: "Interactions et Coordination",
                cards: [
                    {
                        type: "qcm",
                        keyword: "Coordination acteurs",
                        question: "En cas d'accident grave, dans quel ordre logique interviennent g√©n√©ralement les acteurs ?",
                        options: [
                            "Inspection ‚Üí CSE ‚Üí SST ‚Üí Employeur",
                            "SST ‚Üí Employeur ‚Üí CSE ‚Üí Inspection",
                            "Employeur ‚Üí CARSAT ‚Üí CSE ‚Üí SST",
                            "CSE ‚Üí SST ‚Üí Inspection ‚Üí Employeur"
                        ],
                        answer: 1,
                        explanation: "L'ordre logique est : SST (premiers secours imm√©diats), Employeur (enqu√™te et d√©claration), CSE (enqu√™te contradictoire), Inspection du travail (contr√¥le et sanctions si n√©cessaire). Chaque acteur a son moment d'intervention.",
                        hint: "Pensez √† la chronologie : urgence ‚Üí gestion ‚Üí contr√¥le.",
                        tip: "Chronologie type : secours ‚Üí enqu√™te interne ‚Üí enqu√™te contradictoire ‚Üí contr√¥le externe"
                    },
                    {
                        type: "vf",
                        keyword: "Compl√©mentarit√© missions",
                        question: "Les missions des acteurs internes et externes se compl√®tent-elles ?",
                        answer: true,
                        explanation: "Oui, les missions sont compl√©mentaires : les acteurs internes (employeur, CSE, SST) agissent au quotidien dans l'entreprise, tandis que les acteurs externes (inspection, SPST, CARSAT) apportent expertise, contr√¥le et accompagnement.",
                        hint: "Chaque acteur a un r√¥le sp√©cifique qui s'articule avec les autres.",
                        tip: "Syst√®me fran√ßais = multiplicit√© d'acteurs pour croiser les regards et √©viter les angles morts"
                    },
                    {
                        type: "qcm",
                        keyword: "Conflit pr√©vention",
                        question: "Si un employeur refuse de suivre une recommandation du SPST, que peut faire le m√©decin du travail ?",
                        options: [
                            "Rien, ses recommandations ne sont pas contraignantes",
                            "Saisir l'inspection du travail",
                            "Licencier le salari√© concern√©",
                            "Fermer temporairement l'entreprise"
                        ],
                        answer: 1,
                        explanation: "Le m√©decin du travail peut saisir l'inspection du travail si l'employeur ne suit pas ses recommandations et que la sant√© des salari√©s est en danger. L'inspection peut alors contraindre l'employeur.",
                        hint: "Le m√©decin a un relais institutionnel en cas de conflit.",
                        tip: "SPST ‚Üí Inspection = escalade possible en cas de refus employeur dangereux"
                    },
                    {
                        type: "keyword",
                        keyword: "Pluridisciplinarit√©",
                        question: "Comment appelle-t-on l'approche qui combine diff√©rentes expertises (m√©dicale, technique, humaine) en pr√©vention ?",
                        answer: "pluridisciplinarit√©",
                        explanation: "La pluridisciplinarit√© en pr√©vention consiste √† combiner les comp√©tences m√©dicales, techniques, organisationnelles et humaines pour une approche globale des risques professionnels. C'est l'approche recommand√©e par les SPST.",
                        hint: "C'est l'approche qui croise plusieurs disciplines d'expertise.",
                        tip: "Pluridisciplinarit√© = m√©decin + ergonome + psychologue + ing√©nieur s√©curit√© + etc."
                    },
                    {
                        type: "qcm",
                        keyword: "Information circulation",
                        question: "Qui peut demander √† consulter le Document Unique d'√âvaluation des Risques Professionnels ?",
                        options: [
                            "Seulement l'employeur et l'inspection du travail",
                            "Les salari√©s, leurs repr√©sentants, l'inspection, le SPST",
                            "Uniquement le CSE et la direction",
                            "Seulement les salari√©s expos√©s aux risques"
                        ],
                        answer: 1,
                        explanation: "Le DUERP doit √™tre accessible aux salari√©s, √† leurs repr√©sentants (CSE), √† l'inspection du travail, au SPST et aux organismes de s√©curit√© sociale. La transparence est un principe de la pr√©vention.",
                        hint: "La pr√©vention efficace n√©cessite de la transparence et du partage d'information.",
                        tip: "DUERP accessible = principe de transparence pour permettre participation de tous"
                    },
                    {
                        type: "vf",
                        keyword: "Formation commune",
                        question: "Les acteurs de pr√©vention peuvent-ils se former ensemble ?",
                        answer: true,
                        explanation: "Oui, la formation commune des acteurs de pr√©vention est recommand√©e car elle permet de cr√©er un langage commun, de mieux comprendre les r√¥les de chacun et d'am√©liorer la coordination. C'est une bonne pratique.",
                        hint: "Se former ensemble am√©liore la coordination et la compr√©hension mutuelle.",
                        tip: "Formation commune = meilleure coordination + langage partag√© + culture s√©curit√© commune"
                    },
                    {
                        type: "qcm",
                        keyword: "Alerte et signalement",
                        question: "Un salari√© t√©moin d'une situation dangereuse doit-il en informer plusieurs acteurs ?",
                        options: [
                            "Non, seulement son chef direct",
                            "Oui, l'employeur ET le repr√©sentant du personnel",
                            "Seulement l'inspection du travail",
                            "Cela d√©pend de la gravit√© du danger"
                        ],
                        answer: 1,
                        explanation: "Un salari√© doit informer imm√©diatement l'employeur ET peut informer les repr√©sentants du personnel (CSE). Cette double information permet un traitement plus rapide et un contr√¥le mutuel.",
                        hint: "L'alerte doit circuler vers ceux qui peuvent agir rapidement.",
                        tip: "Double alerte employeur + CSE = traitement rapide + contr√¥le d√©mocratique"
                    },
                    {
                        type: "keyword",
                        keyword: "Plan de pr√©vention",
                        question: "Comment appelle-t-on le document qui organise la coop√©ration en mati√®re de s√©curit√© entre une entreprise utilisatrice et des entreprises ext√©rieures ?",
                        answer: "plan de pr√©vention",
                        explanation: "Le plan de pr√©vention est obligatoire quand des entreprises ext√©rieures interviennent pour certains travaux. Il d√©finit les mesures de pr√©vention et organise la coordination entre les diff√©rents acteurs pr√©sents sur le site.",
                        hint: "C'est un document de coordination entre plusieurs entreprises sur un m√™me site.",
                        tip: "Plan de pr√©vention obligatoire si travaux > 400h ou risques particuliers"
                    }
                ]
            },
            5: {
                title: "Ma√Ætrise Compl√®te",
                cards: [
                    {
                        type: "qcm",
                        keyword: "Synth√®se syst√®me fran√ßais",
                        question: "Quelle est la caract√©ristique principale du syst√®me fran√ßais de pr√©vention des risques professionnels ?",
                        options: [
                            "Un seul acteur central tout-puissant",
                            "Une multiplicit√© d'acteurs aux r√¥les compl√©mentaires",
                            "Une gestion uniquement par les entreprises",
                            "Un contr√¥le exclusivement √©tatique"
                        ],
                        answer: 1,
                        explanation: "Le syst√®me fran√ßais se caract√©rise par une multiplicit√© d'acteurs (internes et externes) aux r√¥les compl√©mentaires, permettant un contr√¥le crois√© et une expertise vari√©e. Cette pluralit√© est une force du syst√®me.",
                        hint: "Le syst√®me fran√ßais privil√©gie la compl√©mentarit√© plut√¥t que l'unicit√©.",
                        tip: "Syst√®me fran√ßais = pluralit√© organis√©e pour √©viter angles morts et monopoles"
                    },
                    {
                        type: "vf",
                        keyword: "√âvolution r√©glementaire",
                        question: "La r√©glementation sur les acteurs de pr√©vention √©volue-t-elle r√©guli√®rement ?",
                        answer: true,
                        explanation: "Oui, la r√©glementation √©volue constamment pour s'adapter aux nouveaux risques (t√©l√©travail, risques psychosociaux, etc.) et am√©liorer l'efficacit√© du syst√®me. Les acteurs doivent se former en continu.",
                        hint: "Le monde du travail √©volue, la pr√©vention aussi.",
                        tip: "Veille r√©glementaire indispensable pour tous les acteurs de pr√©vention"
                    },
                    {
                        type: "qcm",
                        keyword: "Indicateurs de performance",
                        question: "Quel est le meilleur indicateur de l'efficacit√© d'un syst√®me de pr√©vention ?",
                        options: [
                            "Le nombre de formations r√©alis√©es",
                            "Le co√ªt des √©quipements de s√©curit√©",
                            "La diminution du nombre d'accidents et de maladies professionnelles",
                            "Le nombre de r√©unions CSE organis√©es"
                        ],
                        answer: 2,
                        explanation: "L'efficacit√© se mesure avant tout par la diminution du nombre d'accidents du travail et de maladies professionnelles. C'est l'objectif final de tout syst√®me de pr√©vention : prot√©ger effectivement la sant√© des travailleurs.",
                        hint: "L'efficacit√© se mesure aux r√©sultats concrets de protection.",
                        tip: "Indicateurs cl√©s : taux de fr√©quence + taux de gravit√© + absent√©isme pour raisons de sant√©"
                    },
                    {
                        type: "keyword",
                        keyword: "Culture de s√©curit√©",
                        question: "Comment appelle-t-on l'ensemble des valeurs, comportements et pratiques partag√©es en mati√®re de s√©curit√© dans une entreprise ?",
                        answer: "culture de s√©curit√©",
                        explanation: "La culture de s√©curit√© est l'ensemble des valeurs, comportements et pratiques partag√©es par tous les membres d'une organisation en mati√®re de s√©curit√©. Elle se construit dans le temps gr√¢ce √† l'action coordonn√©e de tous les acteurs.",
                        hint: "C'est ce qui fait que la s√©curit√© devient 'naturelle' dans une entreprise.",
                        tip: "Culture s√©curit√© = valeurs + comportements + pratiques partag√©es par tous"
                    },
                    {
                        type: "qcm",
                        keyword: "Cas complexe",
                        question: "Une entreprise a un accident grave, un conflit social et une visite d'inspection simultan√©ment. Qui coordonne la gestion de cette crise ?",
                        options: [
                            "L'inspection du travail prend le contr√¥le total",
                            "L'employeur reste responsable de la coordination",
                            "Le CSE g√®re la situation",
                            "Un m√©diateur externe est obligatoire"
                        ],
                        answer: 1,
                        explanation: "M√™me en situation de crise, l'employeur reste responsable de la coordination car il a l'obligation g√©n√©rale de s√©curit√©. Les autres acteurs interviennent dans leurs domaines mais ne remplacent pas la responsabilit√© patronale.",
                        hint: "La responsabilit√© fondamentale ne change pas, m√™me en crise.",
                        tip: "En crise : responsabilit√© employeur maintenue + intervention renforc√©e autres acteurs"
                    },
                    {
                        type: "vf",
                        keyword: "Innovation pr√©vention",
                        question: "Les nouvelles technologies peuvent-elles aider √† am√©liorer la coordination entre acteurs de pr√©vention ?",
                        answer: true,
                        explanation: "Oui, les nouvelles technologies (applications, plateformes collaboratives, objets connect√©s) peuvent consid√©rablement am√©liorer la coordination, le partage d'information et la r√©activit√© des acteurs de pr√©vention.",
                        hint: "Le num√©rique transforme aussi la pr√©vention et la coordination.",
                        tip: "Technologies = opportunit√© d'am√©liorer circulation info + r√©activit√© + tra√ßabilit√©"
                    },
                    {
                        type: "qcm",
                        keyword: "Pr√©paration BAC",
                        question: "Pour l'√©preuve du Bac, quelle est la connaissance la plus importante sur les acteurs de pr√©vention ?",
                        options: [
                            "Conna√Ætre tous les textes de loi par c≈ìur",
                            "Savoir identifier le bon acteur pour chaque situation",
                            "M√©moriser les organigrammes des organismes",
                            "Retenir toutes les dates de cr√©ation des institutions"
                        ],
                        answer: 1,
                        explanation: "Pour le Bac, l'essentiel est de savoir identifier quel acteur est le plus appropri√© dans chaque situation donn√©e et comprendre pourquoi. C'est une comp√©tence d'analyse et d'application plus que de m√©morisation.",
                        hint: "Le Bac teste plus la logique et l'analyse que la m√©morisation pure.",
                        tip: "BAC = logique situationnelle + bon acteur + justification du choix"
                    },
                    {
                        type: "keyword",
                        keyword: "Responsabilit√© p√©nale",
                        question: "Quel type de responsabilit√© peut √™tre engag√©e pour l'employeur en cas d'accident grave par n√©gligence ?",
                        answer: "responsabilit√© p√©nale",
                        explanation: "En cas d'accident grave caus√© par une n√©gligence de l'employeur dans ses obligations de s√©curit√©, sa responsabilit√© p√©nale peut √™tre engag√©e (homicide ou blessures involontaires), en plus de sa responsabilit√© civile.",
                        hint: "C'est la responsabilit√© la plus grave, qui peut conduire √† des sanctions personnelles.",
                        tip: "Responsabilit√© p√©nale = sanctions personnelles (amende + prison) + casier judiciaire"
                    }
                ]
            }
        };

        // Fonctions principales
        function startLevel(level) {
            currentLevel = level;
            currentCardIndex = 0;
            levelPoints = 0;
            levelCorrect = 0;
            levelErrors = [];
            hintUsed = false;

            document.getElementById('homeScreen').classList.remove('active');
            document.getElementById('gameScreen').classList.add('active');
            document.getElementById('levelTitle').textContent = `Niveau ${level} : ${levels[level].title}`;
            
            showCard();
        }

        function showCard() {
            const card = levels[currentLevel].cards[currentCardIndex];
            const total = levels[currentLevel].cards.length;
            
            // Mise √† jour de la progression
            document.getElementById('cardProgress').textContent = `${currentCardIndex + 1}/${total}`;
            
            // Affichage de la carte
            document.getElementById('cardType').textContent = levels[currentLevel].title;
            document.getElementById('cardKeyword').textContent = card.keyword;
            
            // R√©initialisation
            document.getElementById('hintText').style.display = 'none';
            hintUsed = false;
            
            const questionSection = document.getElementById('questionSection');
            
            if (card.type === 'keyword') {
                questionSection.innerHTML = `
                    <p class="question-text">${card.question}</p>
                    <input type="text" class="keyword-input" id="keywordAnswer" placeholder="Tapez votre r√©ponse..." autocomplete="off">
                `;
                
                // Focus sur l'input
                setTimeout(() => {
                    document.getElementById('keywordAnswer').focus();
                }, 100);
                
                // Validation avec Entr√©e
                document.getElementById('keywordAnswer').addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        validateAnswer();
                    }
                });
            }
            else if (card.type === 'qcm') {
                let optionsHTML = card.options.map((opt, i) => `
                    <button class="option-btn" data-index="${i}" onclick="selectOption(this)">
                        <span class="option-letter">${String.fromCharCode(65 + i)}</span>
                        <span>${opt}</span>
                    </button>
                `).join('');
                
                questionSection.innerHTML = `
                    <p class="question-text">${card.question}</p>
                    <div class="options-container">${optionsHTML}</div>
                `;
            }
            else if (card.type === 'vf') {
                questionSection.innerHTML = `
                    <p class="question-text">${card.question}</p>
                    <div class="vf-container">
                        <button class="vf-btn vrai" onclick="selectVF(this, true)">‚úì VRAI</button>
                        <button class="vf-btn faux" onclick="selectVF(this, false)">‚úó FAUX</button>
                    </div>
                `;
            }
        }

        function selectOption(btn) {
            document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
        }

        function selectVF(btn, value) {
            document.querySelectorAll('.vf-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            btn.dataset.value = value;
        }

        function showHint() {
            const card = levels[currentLevel].cards[currentCardIndex];
            if (card.hint) {
                document.getElementById('hintText').innerHTML = `üí° <strong>Indice :</strong> ${card.hint}`;
                document.getElementById('hintText').style.display = 'block';
                hintUsed = true;
            }
        }

        function validateAnswer() {
            const card = levels[currentLevel].cards[currentCardIndex];
            let isCorrect = false;
            let userAnswer = '';
            
            if (card.type === 'keyword') {
                userAnswer = document.getElementById('keywordAnswer').value.trim().toLowerCase();
                // Normalisation pour les accents et variations
                const normalize = str => str.normalize('NFD').replace(/[\u0300-\u036f]/g, '').toLowerCase();
                const normalizedAnswer = normalize(card.answer);
                const normalizedUser = normalize(userAnswer);
                
                isCorrect = normalizedUser === normalizedAnswer || 
                           normalizedUser.includes(normalizedAnswer) ||
                           normalizedAnswer.includes(normalizedUser) ||
                           // Gestion des sigles
                           (normalizedAnswer.length > 10 && normalizedUser.length >= 3 && normalizedAnswer.includes(normalizedUser));
            }
            else if (card.type === 'qcm') {
                const selected = document.querySelector('.option-btn.selected');
                if (!selected) { 
                    alert('S√©lectionnez une r√©ponse avant de valider !'); 
                    return; 
                }
                userAnswer = parseInt(selected.dataset.index);
                isCorrect = userAnswer === card.answer;
            }
            else if (card.type === 'vf') {
                const selected = document.querySelector('.vf-btn.selected');
                if (!selected) { 
                    alert('S√©lectionnez VRAI ou FAUX avant de valider !'); 
                    return; 
                }
                userAnswer = selected.dataset.value === 'true';
                isCorrect = userAnswer === card.answer;
            }
            
            showFeedback(isCorrect, card);
        }

        function showFeedback(isCorrect, card) {
            const overlay = document.getElementById('feedbackOverlay');
            const feedbackCard = document.getElementById('feedbackCard');
            
            let points = 0;
            if (isCorrect) {
                points = hintUsed ? 5 : 10;
                levelCorrect++;
                currentStreak++;
                if (currentStreak > bestStreak) bestStreak = currentStreak;
                
                // Streak bonus
                if (currentStreak === 3) showStreakPopup('üî• 3 de suite !');
                else if (currentStreak === 5) showStreakPopup('üî•üî• 5 de suite !');
                else if (currentStreak === 10) showStreakPopup('üî•üî•üî• INCROYABLE !');
            } else {
                currentStreak = 0;
                levelErrors.push(card.keyword || card.question.replace(/<[^>]*>/g, '').substring(0, 50) + '...');
            }
            
            levelPoints += points;
            totalPoints += points;
            updateScoreDisplay();
            
            feedbackCard.className = 'feedback-card ' + (isCorrect ? 'correct' : 'incorrect');
            document.getElementById('feedbackIcon').textContent = isCorrect ? '‚úÖ' : '‚ùå';
            document.getElementById('feedbackTitle').textContent = isCorrect ? 
                (currentStreak >= 3 ? 'Excellent ! üî•' : 'Bravo !') : 'Pas tout √† fait...';
            document.getElementById('feedbackPoints').textContent = isCorrect ? `+${points} points` : '0 point';
            document.getElementById('feedbackPoints').style.display = isCorrect ? 'block' : 'none';
            
            document.getElementById('feedbackExplanation').innerHTML = `
                <h4>üìö Explication</h4>
                <p>${card.explanation}</p>
                <div class="keyword-box">üîë <span>${card.keyword}</span></div>
                ${card.tip ? `<div class="tip-box"><h5>üí° Astuce BAC</h5><p>${card.tip}</p></div>` : ''}
            `;
            
            overlay.classList.add('visible');
        }

        function showStreakPopup(text) {
            const popup = document.getElementById('streakPopup');
            popup.textContent = text;
            popup.style.display = 'block';
            setTimeout(() => { popup.style.display = 'none'; }, 1500);
        }

        function nextCard() {
            document.getElementById('feedbackOverlay').classList.remove('visible');
            currentCardIndex++;
            
            if (currentCardIndex >= levels[currentLevel].cards.length) {
                showResults();
            } else {
                showCard();
            }
        }

        function showResults() {
            const total = levels[currentLevel].cards.length;
            const percent = Math.round((levelCorrect / total) * 100);
            
            levelProgress[currentLevel] = Math.max(levelProgress[currentLevel], percent);
            
            document.getElementById('gameScreen').classList.remove('active');
            document.getElementById('resultsScreen').classList.add('active');
            
            document.getElementById('resultsIcon').textContent = percent >= 80 ? 'üéâ' : percent >= 50 ? 'üëç' : 'üí™';
            document.getElementById('resultsTitle').textContent = percent >= 80 ? 'Niveau r√©ussi !' : percent >= 50 ? 'Pas mal !' : 'Continue !';
            document.getElementById('resultsScore').textContent = percent + '%';
            document.getElementById('correctCount').textContent = levelCorrect + '/' + total;
            document.getElementById('pointsEarned').textContent = '+' + levelPoints;
            document.getElementById('bestStreak').textContent = bestStreak;
            
            // Erreurs
            const errorsRecap = document.getElementById('errorsRecap');
            if (levelErrors.length > 0) {
                errorsRecap.style.display = 'block';
                document.getElementById('errorsList').innerHTML = levelErrors.map(e => `<li>${e}</li>`).join('');
            } else {
                errorsRecap.style.display = 'none';
            }
            
            // Confettis si r√©ussi
            if (percent >= 80) {
                createConfetti();
            }
            
            // Bouton niveau suivant
            document.getElementById('nextLevelBtn').style.display = (currentLevel < 5 && percent >= 60) ? 'flex' : 'none';
            
            updateHomeProgress();
        }

        function createConfetti() {
            const colors = ['#4facfe', '#00f2fe', '#03a9f4', '#4CAF50', '#f59e0b', '#ff9a9e'];
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 2 + 's';
                confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                document.body.appendChild(confetti);
                setTimeout(() => confetti.remove(), 3000);
            }
        }

        function goHome() {
            document.getElementById('resultsScreen').classList.remove('active');
            document.getElementById('gameScreen').classList.remove('active');
            document.getElementById('homeScreen').classList.add('active');
            updateHomeProgress();
        }

        function nextLevel() {
            if (currentLevel < 5) {
                startLevel(currentLevel + 1);
                document.getElementById('resultsScreen').classList.remove('active');
            }
        }

        function updateScoreDisplay() {
            document.getElementById('totalPoints').textContent = totalPoints;
            document.getElementById('currentStreak').textContent = currentStreak;
        }

        function updateHomeProgress() {
            for (let i = 1; i <= 5; i++) {
                document.getElementById(`level${i}Percent`).textContent = levelProgress[i] + '%';
                document.getElementById(`level${i}Bar`).style.width = levelProgress[i] + '%';
            }
        }

        // Initialisation
        updateScoreDisplay();
        updateHomeProgress();

        // Gestion du clavier pour l'accessibilit√©
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                // Fermer les overlays avec Escape
                document.getElementById('feedbackOverlay').classList.remove('visible');
            }
        });

        // Support tactile am√©lior√©
        let touchStartY = 0;
        document.addEventListener('touchstart', function(e) {
            touchStartY = e.touches[0].clientY;
        }, { passive: true });

        document.addEventListener('touchmove', function(e) {
            // Emp√™cher le scroll √©lastique sur mobile
            if (document.querySelector('.feedback-overlay.visible')) {
                e.preventDefault();
            }
        }, { passive: false });

        // Auto-focus sur les inputs
        document.addEventListener('focusin', function(e) {
            if (e.target.classList.contains('keyword-input')) {
                // Scroll vers l'input sur mobile
                setTimeout(() => {
                    e.target.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 300);
            }
        });
    </script>
</body>
</html>