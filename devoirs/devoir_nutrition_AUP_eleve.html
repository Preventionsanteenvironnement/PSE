<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Évaluation PSE - Alimentation et Santé</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; background-color: #f4f7f6; }
        .container { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        .doc-section { background: #eef7ff; border-left: 5px solid #3498db; padding: 15px; margin: 20px 0; font-size: 0.95rem; }
        .question-block { background: #fff; border: 1px solid #ddd; padding: 20px; margin-bottom: 20px; border-radius: 5px; position: relative; }
        .q-header { display: flex; justify-content: space-between; margin-bottom: 10px; border-bottom: 1px dashed #eee; padding-bottom: 5px; }
        .q-label { font-weight: bold; background: #3498db; color: white; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; border-radius: 50%; }
        .q-comp { font-weight: bold; color: #7f8c8d; }
        .q-points { font-style: italic; color: #e67e22; }
        .q-text { font-size: 1.1rem; margin-bottom: 15px; }
        .q-options { display: flex; flex-direction: column; gap: 10px; }
        .q-option { display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 8px; border-radius: 4px; transition: background 0.2s; }
        .q-option:hover { background: #f9f9f9; }
        .comp-display { display: none; }
        .submit-section { text-align: center; margin-top: 40px; padding: 20px; border-top: 2px solid #eee; }
        .submit-btn { background: #27ae60; color: white; border: none; padding: 15px 40px; font-size: 1.2rem; border-radius: 30px; cursor: pointer; transition: transform 0.2s, background 0.2s; }
        .submit-btn:hover { background: #219150; transform: scale(1.05); }
        input[type="text"], select, input[type="number"] { padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 100%; max-width: 400px; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background: #f8f9fa; }

        @media (max-width: 768px) {
            .container { padding: 10px; }
            .question-block { padding: 15px; margin-bottom: 15px; }
            .q-header { flex-direction: column; gap: 8px; align-items: flex-start; }
        }
        @media (max-width: 480px) {
            body { padding: 10px; }
            .container { padding: 5px; }
            input[type="checkbox"], input[type="radio"] { transform: scale(1.3); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Évaluation PSE : Alimentation et Santé (Bac Pro)</h1>
        
        <div style="margin-bottom: 20px; padding: 15px; background: #eee; border-radius: 5px;">
            <label for="code-eleve"><strong>Code Élève :</strong></label>
            <input type="text" id="code-eleve" placeholder="Saisissez votre code ici..." required>
        </div>

        <div class="doc-section">
            <h3>Document 1 : Les Aliments Ultra-Transformés (AUP) - Étude CNRS</h3>
            <p>En France, 80% des produits en supermarché sont des AUP. Une étude montre que même à calories égales, un régime riche en AUP cause une prise de poids et augmente le risque cardiovasculaire. Des perturbateurs endocriniens (phtalates) et polluants (lithium) ont été retrouvés dans le sang des consommateurs, impactant notamment la fertilité masculine.</p>
        </div>

        <div class="doc-section">
            <h3>Document 2 : Principes de l'équilibre alimentaire</h3>
            <p>L'équilibre repose sur la consommation de 5 fruits et légumes par jour, la limitation de la viande rouge et des produits ultra-transformés, et une répartition de l'assiette (1/2 légumes, 1/4 féculents, 1/4 protéines).</p>
        </div>

        <div class="question-block" data-qid="q1">
            <div class="q-header">
                <span class="q-label">1</span>
                <span class="q-comp">C1</span>
                <span class="q-points">1 pt</span>
            </div>
            <span class="comp-display">C1</span>
            <input type="hidden" class="point-input" value="1">
            <input type="hidden" class="student-score" value="0">
            <div class="q-text"><strong>Identifier</strong> la proportion de produits ultra-transformés (AUP) présents dans les supermarchés français selon le Document 1.</div>
            <select class="reponse-eleve" data-qid="q1">
                <option value="">-- Choisir --</option>
                <option value="50%">50%</option>
                <option value="80%">80%</option>
                <option value="25%">25%</option>
            </select>
        </div>

        <div class="question-block" data-qid="q2">
            <div class="q-header"><span class="q-label">2</span><span class="q-comp">C1</span><span class="q-points">1 pt</span></div>
            <span class="comp-display">C1</span><input type="hidden" class="point-input" value="1"><input type="hidden" class="student-score" value="0">
            <div class="q-text"><strong>Relever</strong> dans le Document 1 deux polluants identifiés dans le sang des participants.</div>
            <div class="q-options">
                <label class="q-option"><input type="checkbox" class="reponse-eleve" data-qid="q2" value="lithium"> Lithium</label>
                <label class="q-option"><input type="checkbox" class="reponse-eleve" data-qid="q2" value="fer"> Fer</label>
                <label class="q-option"><input type="checkbox" class="reponse-eleve" data-qid="q2" value="phtalate"> Phtalate cxMINP</label>
            </div>
        </div>

        <div class="question-block" data-qid="q3">
            <div class="q-header"><span class="q-label">3</span><span class="q-comp">C2</span><span class="q-points">1.5 pts</span></div>
            <span class="comp-display">C2</span><input type="hidden" class="point-input" value="1.5"><input type="hidden" class="student-score" value="0">
            <div class="q-text"><strong>Identifier</strong> le problème de santé publique soulevé par la consommation massive d'AUP en cochant la réponse exacte.</div>
            <div class="q-options">
                <label class="q-option"><input type="radio" name="q3" class="reponse-eleve" data-qid="q3" value="pb_chronique"> Augmentation des maladies chroniques et impact sur la fertilité</label>
                <label class="q-option"><input type="radio" name="q3" class="reponse-eleve" data-qid="q3" value="pb_micro"> Risque immédiat d'intoxication alimentaire bactérienne</label>
            </div>
        </div>

        <div class="question-block" data-qid="q4">
            <div class="q-header"><span class="q-label">4</span><span class="q-comp">C2</span><span class="q-points">2 pts</span></div>
            <span class="comp-display">C2</span><input type="hidden" class="point-input" value="2"><input type="hidden" class="student-score" value="0">
            <div class="q-text"><strong>Caractériser</strong> les conséquences sur la santé d'un régime ultra-transformé même sans excès de calories (Doc 1).</div>
            <div class="q-options">
                <label class="q-option"><input type="checkbox" class="reponse-eleve" data-qid="q4" value="poids"> Prise de poids et de masse corporelle</label>
                <label class="q-option"><input type="checkbox" class="reponse-eleve" data-qid="q4" value="cardio"> Augmentation du ratio LDL/HDL (risque cardiovasculaire)</label>
                <label class="q-option"><input type="checkbox" class="reponse-eleve" data-qid="q4" value="vision"> Amélioration de la vision nocturne</label>
            </div>
        </div>

        <div class="question-block" data-qid="q5">
            <div class="q-header"><span class="q-label">5</span><span class="q-comp">C3</span><span class="q-points">1.5 pts</span></div>
            <span class="comp-display">C3</span><input type="hidden" class="point-input" value="1.5"><input type="hidden" class="student-score" value="0">
            <div class="q-text"><strong>Expliquer</strong> le lien entre les procédés industriels des AUP et la fertilité masculine.</div>
            <select class="reponse-eleve" data-qid="q5">
                <option value="">-- Choisir l'explication --</option>
                <option value="pertubateurs">Les additifs et polluants agissent comme perturbateurs endocriniens</option>
                <option value="sucre">Le sucre détruit directement les spermatozoïdes</option>
            </select>
        </div>

        <div class="question-block" data-qid="q6">
            <div class="q-header"><span class="q-label">6</span><span class="q-comp">C3</span><span class="q-points">1.5 pts</span></div>
            <span class="comp-display">C3</span><input type="hidden" class="point-input" value="1.5"><input type="hidden" class="student-score" value="0">
            <div class="q-text"><strong>Associer</strong> chaque erreur alimentaire à sa conséquence sur l'activité professionnelle.</div>
            <table>
                <tr><td>Grignotage entre les repas</td><td><select class="reponse-eleve" data-qid="q6_1"><option value="">--</option><option value="fatigue">Grosse fatigue / baisse rendement</option></select></td></tr>
            </table>
        </div>

        <div class="question-block" data-qid="q7">
            <div class="q-header"><span class="q-label">7</span><span class="q-comp">C3</span><span class="q-points">1 pt</span></div>
            <span class="comp-display">C3</span><input type="hidden" class="point-input" value="1"><input type="hidden" class="student-score" value="0">
            <div class="q-text"><strong>Mettre en relation</strong> le ratio LDL/HDL élevé avec le risque pathologique associé.</div>
            <select class="reponse-eleve" data-qid="q7">
                <option value="">-- Choisir --</option>
                <option value="cv">Maladies cardiovasculaires</option>
                <option value="diabete">Diabète de type 1</option>
            </select>
        </div>

        <div class="question-block" data-qid="q8">
            <div class="q-header"><span class="q-label">8</span><span class="q-comp">C4</span><span class="q-points">1.5 pts</span></div>
            <span class="comp-display">C4</span><input type="hidden" class="point-input" value="1.5"><input type="hidden" class="student-score" value="0">
            <div class="q-text"><strong>Proposer</strong> la répartition idéale d'une assiette équilibrée pour le déjeuner (Doc 2).</div>
            <div class="q-options">
                <label class="q-option"><input type="radio" name="q8" class="reponse-eleve" data-qid="q8" value="correct"> 1/2 légumes, 1/4 féculents, 1/4 protéines</label>
                <label class="q-option"><input type="radio" name="q8" class="reponse-eleve" data-qid="q8" value="faux"> 1/2 viande, 1/2 féculents</label>
            </div>
        </div>

        <div class="question-block" data-qid="q9">
            <div class="q-header"><span class="q-label">9</span><span class="q-comp">C4</span><span class="q-points">1 pt</span></div>
            <span class="comp-display">C4</span><input type="hidden" class="point-input" value="1"><input type="hidden" class="student-score" value="0">
            <div class="q-text"><strong>Conseiller</strong> une fréquence de consommation de fruits et légumes pour rester en bonne santé.</div>
            <input type="number" class="reponse-eleve" data-qid="q9" placeholder="Nombre par jour...">
        </div>

        <div class="question-block" data-qid="q10">
            <div class="q-header"><span class="q-label">10</span><span class="q-comp">C1</span><span class="q-points">1 pt</span></div>
            <span class="comp-display">C1</span><input type="hidden" class="point-input" value="1"><input type="hidden" class="student-score" value="0">
            <div class="q-text"><strong>Repérer</strong> le nombre limite de verres d'alcool par jour préconisé (Doc 2).</div>
            <input type="number" class="reponse-eleve" data-qid="q10">
        </div>

        <div class="question-block" data-qid="q11">
            <div class="q-header"><span class="q-label">11</span><span class="q-comp">C2</span><span class="q-points">1 pt</span></div>
            <span class="comp-display">C2</span><input type="hidden" class="point-input" value="1"><input type="hidden" class="student-score" value="0">
            <div class="q-text"><strong>Identifier</strong> l'hormone dont la baisse est liée au métabolisme dans l'étude (Doc 1).</div>
            <input type="text" class="reponse-eleve" data-qid="q11" placeholder="Nom de l'hormone...">
        </div>

        <div class="question-block" data-qid="q12">
            <div class="q-header"><span class="q-label">12</span><span class="q-comp">C2</span><span class="q-points">1.5 pts</span></div>
            <span class="comp-display">C2</span><input type="hidden" class="point-input" value="1.5"><input type="hidden" class="student-score" value="0">
            <div class="q-text"><strong>Distinguer</strong> les deux types de besoins satisfaits par les protéines et les glucides.</div>
            <table>
                <tr><td>Protéines</td><td><select class="reponse-eleve" data-qid="q12_1"><option value="">--</option><option value="batisseur">Besoins bâtisseurs</option></select></td></tr>
                <tr><td>Glucides/Féculents</td><td><select class="reponse-eleve" data-qid="q12_2"><option value="">--</option><option value="energetique">Besoins énergétiques</option></select></td></tr>
            </table>
        </div>

        <div class="question-block" data-qid="q13">
            <div class="q-header"><span class="q-label">13</span><span class="q-comp">C3</span><span class="q-points">1 pt</span></div>
            <span class="comp-display">C3</span><input type="hidden" class="point-input" value="1"><input type="hidden" class="student-score" value="0">
            <div class="q-text"><strong>Expliquer</strong> l'origine des polluants dans les AUP.</div>
            <select class="reponse-eleve" data-qid="q13">
                <option value="">-- Choisir --</option>
                <option value="procédés">Contamination via les procédés industriels et emballages</option>
                <option value="naturel">Présence naturelle dans les fruits</option>
            </select>
        </div>

        <div class="question-block" data-qid="q14">
            <div class="q-header"><span class="q-label">14</span><span class="q-comp">C4</span><span class="q-points">1.5 pts</span></div>
            <span class="comp-display">C4</span><input type="hidden" class="point-input" value="1.5"><input type="hidden" class="student-score" value="0">
            <div class="q-text"><strong>Suggérer</strong> deux alternatives aux produits ultra-transformés pour le goûter.</div>
            <div class="q-options">
                <label class="q-option"><input type="checkbox" class="reponse-eleve" data-qid="q14" value="fruit"> Un fruit frais</label>
                <label class="q-option"><input type="checkbox" class="reponse-eleve" data-qid="q14" value="oleagineux"> Une poignée de fruits à coque</label>
                <label class="q-option"><input type="checkbox" class="reponse-eleve" data-qid="q14" value="biscuits"> Biscuits industriels fourrés</label>
            </div>
        </div>

        <div class="question-block" data-qid="q15">
            <div class="q-header"><span class="q-label">15</span><span class="q-comp">C5</span><span class="q-points">1 pt</span></div>
            <span class="comp-display">C5</span><input type="hidden" class="point-input" value="1"><input type="hidden" class="student-score" value="0">
            <div class="q-text"><strong>Justifier</strong> l'importance de cuisiner "fait maison" au regard de l'étude du CNRS.</div>
            <select class="reponse-eleve" data-qid="q15">
                <option value="">-- Choisir l'argument --</option>
                <option value="controle">Permet de contrôler les ingrédients et d'éviter les additifs/polluants industriels</option>
                <option value="temps">C'est simplement pour gagner du temps</option>
            </select>
        </div>

        <div class="submit-section">
            <button class="submit-btn" onclick="autocorrectionAvantEnvoi()">Envoyer au prof</button>
            <div class="submit-status"></div>
        </div>
    </div>

    <script>
        const DEVOIR_ID = "devoir_nutrition_AUP_2026";
        document.body.dataset.idExercice = DEVOIR_ID;

        async function autocorrectionAvantEnvoi() {
            try {
                const response = await fetch(`${DEVOIR_ID}_blueprint.json`);
                const blueprint = await response.json();
                
                document.querySelectorAll('.question-block[data-qid]').forEach(block => {
                    const qid = block.dataset.qid;
                    const question = blueprint.content.find(q => q.qid === qid);
                    if (!question) return;
                    
                    let reponseEleve;
                    if (question.inputType === 'checkbox') {
                        reponseEleve = Array.from(block.querySelectorAll('.reponse-eleve:checked')).map(cb => cb.value);
                    } else if (question.inputType === 'radio') {
                        const checked = block.querySelector('.reponse-eleve:checked');
                        reponseEleve = checked ? checked.value : null;
                    } else if (question.inputType === 'number') {
                        reponseEleve = parseFloat(block.querySelector('.reponse-eleve').value);
                    } else if (question.inputType === 'texte_exact') {
                        reponseEleve = block.querySelector('.reponse-eleve').value.trim().toLowerCase();
                    } else {
                        reponseEleve = block.querySelector('.reponse-eleve').value;
                    }
                    
                    let score = 0;
                    if (question.inputType === 'checkbox') {
                        const bonnes = reponseEleve.filter(r => question.reponseCorrecte.includes(r)).length;
                        score = (bonnes / question.reponseCorrecte.length) * question.bareme;
                    } else if (Array.isArray(question.reponseCorrecte)) {
                        score = question.reponseCorrecte.includes(reponseEleve) ? question.bareme : 0;
                    } else {
                        score = (reponseEleve === question.reponseCorrecte) ? question.bareme : 0;
                    }
                    
                    block.querySelector('.student-score').value = Math.round(score * 100) / 100;
                });
                
                if (typeof window.tenterEnvoi === 'function') { window.tenterEnvoi(); } 
                else { alert("Score calculé. (Mode test local)"); }
            } catch(err) { console.error(err); }
        }
    </script>
</body>
</html>