<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Évaluation PSE - Module C3 : Les consignes de sécurité</title>
    <style>
* { box-sizing: border-box; }

body { 
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
    max-width: 900px; 
    margin: 0 auto; 
    padding: 20px; 
    background-color: #f4f4f4; 
    color: #333;
    line-height: 1.6;
    font-size: 16px;
}

.container { 
    background-color: white; 
    padding: 30px; 
    box-shadow: 0 0 15px rgba(0,0,0,0.1); 
    border-radius: 10px; 
}

/* MODE ADAPTÉ - VERSION DISCRÈTE */
.accessibility-link {
    text-align: right;
    margin-bottom: 10px;
    font-size: 0.85em;
}

.accessibility-link a {
    color: #7f8c8d;
    text-decoration: none;
    cursor: pointer;
}

.accessibility-link a:hover {
    color: #3498db;
    text-decoration: underline;
}

/* MODE ADAPTÉ ACTIVÉ */
body.mode-adapte {
    font-size: 20px;
    line-height: 2;
    background-color: #FDF6E3;
}
body.mode-adapte .container { background-color: #FFFBF0; }
body.mode-adapte .question-block { padding: 25px; }
body.mode-adapte textarea.reponse-eleve,
body.mode-adapte input[type="text"].reponse-eleve { font-size: 1.1em; padding: 15px; line-height: 1.8; }
body.mode-adapte img { max-width: 100%; border: 3px solid #3498db; border-radius: 10px; }
body.mode-adapte th, body.mode-adapte td { padding: 15px; font-size: 1em; }
body.mode-adapte .accessibility-link a { color: #e74c3c; font-weight: bold; }

/* TITRE PRINCIPAL */
h1.main-title { 
    color: #2c3e50; 
    text-align: center; 
    font-size: 1.5em; 
    margin-bottom: 15px; 
    border-bottom: 3px solid #3498db; 
    padding-bottom: 15px; 
}

/* PRÉAMBULE - NIVEAU ET COMPÉTENCES */
.eval-meta {
    background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
    color: white;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 25px;
}

.eval-meta .niveau {
    font-size: 1.1em;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid rgba(255,255,255,0.3);
}

.eval-meta .niveau strong {
    background: #e74c3c;
    padding: 5px 15px;
    border-radius: 20px;
    margin-left: 10px;
}

.eval-meta .competences-titre {
    font-weight: bold;
    margin-bottom: 10px;
    font-size: 1em;
}

.eval-meta .competences-liste {
    font-size: 0.9em;
    line-height: 1.8;
    margin: 0;
    padding-left: 20px;
}

.eval-meta .competences-liste li {
    margin-bottom: 5px;
}

.eval-meta .comp-code {
    background: rgba(255,255,255,0.2);
    padding: 2px 8px;
    border-radius: 4px;
    font-weight: bold;
    margin-right: 5px;
}

/* ZONE IDENTIFICATION ÉLÈVE */
.student-info { 
    background-color: #eef2f3; 
    padding: 20px; 
    border-radius: 8px; 
    margin-bottom: 25px; 
}

.student-info-inner {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 40px;
    flex-wrap: wrap;
}

.info-row { 
    display: flex; 
    align-items: center; 
    gap: 10px; 
}

.info-row label { 
    font-weight: bold; 
    white-space: nowrap; 
}

.info-row input { 
    padding: 8px 12px; 
    border: 2px solid #bdc3c7; 
    border-radius: 5px; 
    font-size: 1em; 
}

.info-row input#code-eleve {
    padding: 10px 20px;
    border: 3px solid #e74c3c;
    border-radius: 8px;
    font-size: 1.2em;
    font-weight: bold;
    text-align: center;
    width: 150px;
    text-transform: uppercase;
}

.info-row input#date-eleve {
    width: 160px;
    padding: 8px 12px;
    cursor: pointer;
}

/* SITUATION */
.situation-box { 
    background: linear-gradient(135deg, #e8f4fd 0%, #d6eaf8 100%); 
    border-left: 5px solid #3498db; 
    padding: 20px; 
    margin: 25px 0; 
    border-radius: 0 10px 10px 0; 
}

.situation-box h2 { 
    color: #2980b9; 
    margin-top: 0; 
    font-size: 1.2em; 
}

.situation-images { 
    display: flex; 
    flex-direction: column; 
    gap: 15px; 
    margin-top: 15px; 
}

.situation-images img { 
    max-width: 100%; 
    border-radius: 8px; 
    box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
}

/* DOCUMENTS */
.doc-block { 
    background: #fff; 
    border: 2px solid #27ae60; 
    border-radius: 10px; 
    margin: 25px 0; 
    overflow: hidden; 
}

.doc-title { 
    background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); 
    color: white; 
    padding: 12px 20px; 
    font-weight: bold; 
    font-size: 1.1em; 
}

.doc-content { 
    padding: 15px; 
}

.doc-content img { 
    max-width: 100%; 
    display: block; 
    margin: 10px auto; 
    border-radius: 8px; 
}

/* TITRES THÉMATIQUES */
.theme-title { 
    background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%); 
    color: white; 
    padding: 15px 20px; 
    margin: 30px 0 20px 0; 
    border-radius: 8px; 
    font-size: 1.2em; 
    font-weight: bold; 
    text-align: center; 
}

/* QUESTIONS */
.question-block { 
    background: #fff; 
    border: 1px solid #ddd; 
    margin: 20px 0; 
    padding: 20px; 
    border-radius: 8px; 
}

.question-text { 
    font-size: 1.05em; 
    margin-bottom: 15px; 
    line-height: 1.6;
}

.question-text strong { 
    color: #c0392b; 
}

/* BADGE COMPÉTENCE */
.comp-badge {
    display: inline-block;
    background: #3498db;
    color: white;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 0.75em;
    font-weight: bold;
    margin-right: 5px;
    vertical-align: middle;
}

.help-text { 
    background: #fff3cd; 
    border: 1px solid #ffc107; 
    padding: 10px 15px; 
    border-radius: 5px; 
    font-size: 0.9em; 
    color: #856404; 
    margin-bottom: 15px; 
    font-style: italic; 
}

/* TABLEAUX */
.table-wrapper { 
    overflow-x: auto; 
    -webkit-overflow-scrolling: touch; 
}

table { 
    width: 100%; 
    border-collapse: collapse; 
    margin: 10px 0; 
}

th, td { 
    border: 1px solid #ddd; 
    padding: 12px; 
    text-align: left; 
    vertical-align: middle; 
}

th { 
    background: #34495e; 
    color: white; 
    font-weight: bold; 
}

.table-label { 
    background: #ecf0f1; 
    font-weight: 600; 
}

/* IMAGES PICTOGRAMMES */
.pictogramme-grid { 
    display: grid; 
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); 
    gap: 15px; 
    margin: 15px 0; 
}

.pictogramme-item { 
    text-align: center; 
}

.pictogramme-item img { 
    width: 80px; 
    height: 80px; 
    object-fit: contain; 
    border: 2px solid #ddd; 
    border-radius: 8px; 
    padding: 5px; 
    background: white; 
}

.pictogramme-item .picto-label { 
    font-size: 0.85em; 
    margin-top: 5px; 
    font-weight: bold; 
}

/* CASES À COCHER */
.checkbox-group { 
    display: flex; 
    flex-wrap: wrap; 
    gap: 15px; 
    margin: 10px 0; 
}

.checkbox-item { 
    display: flex; 
    align-items: center; 
    gap: 8px; 
    padding: 10px 15px; 
    background: #f8f9fa; 
    border: 2px solid #dee2e6; 
    border-radius: 8px; 
    cursor: pointer; 
    transition: all 0.2s; 
}

.checkbox-item:hover { 
    border-color: #3498db; 
    background: #e8f4fd; 
}

.checkbox-item input[type="checkbox"], 
.checkbox-item input[type="radio"] { 
    width: 20px; 
    height: 20px; 
    cursor: pointer; 
}

.checkbox-item label { 
    cursor: pointer; 
    font-size: 0.95em; 
}

/* TEXTAREA */
textarea.reponse-eleve { 
    width: 100%; 
    padding: 12px; 
    border: 2px solid #ddd; 
    border-radius: 8px; 
    font-size: 1em; 
    font-family: inherit; 
    resize: vertical; 
    min-height: 80px; 
}

textarea.reponse-eleve:focus { 
    border-color: #3498db; 
    outline: none; 
    box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2); 
}

/* INPUT TEXTE */
input[type="text"].reponse-eleve { 
    padding: 10px 15px; 
    border: 2px solid #ddd; 
    border-radius: 8px; 
    font-size: 1em; 
    width: 100%; 
}

input[type="text"].reponse-eleve:focus { 
    border-color: #3498db; 
    outline: none; 
}

/* SELECT */
select.reponse-eleve { 
    padding: 10px 15px; 
    border: 2px solid #ddd; 
    border-radius: 8px; 
    font-size: 1em; 
    min-width: 200px; 
    cursor: pointer; 
}

/* LABELS POUR RÉPONSES MULTIPLES */
.response-label {
    font-weight: 600;
    margin-bottom: 8px;
    margin-top: 15px;
    color: #2c3e50;
}

.response-label:first-of-type {
    margin-top: 0;
}

/* BOUTON ENVOI */
.submit-btn { 
    display: block; 
    margin: 40px auto 20px auto; 
    padding: 15px 50px; 
    background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); 
    color: white; 
    border: none; 
    border-radius: 50px; 
    font-size: 1.3em; 
    font-weight: bold; 
    cursor: pointer; 
    box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3); 
    transition: transform 0.2s, box-shadow 0.2s; 
}

.submit-btn:hover { 
    transform: translateY(-2px); 
    box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4); 
}

.submit-btn:disabled {
    background: #95a5a6;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

/* MESSAGE DE CONFIRMATION APRÈS ENVOI */
.confirmation-box {
    display: none;
    background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
    color: white;
    padding: 25px;
    border-radius: 10px;
    text-align: center;
    margin: 30px 0;
}

.confirmation-box h3 {
    margin: 0 0 15px 0;
    font-size: 1.4em;
}

.confirmation-box p {
    margin: 10px 0;
    font-size: 1em;
}

/* BOUTON IMPRIMER - VISIBLE UNIQUEMENT APRÈS ENVOI */
.print-btn {
    display: none;
    margin: 20px auto;
    padding: 12px 30px;
    background: #3498db;
    color: white;
    border: none;
    border-radius: 50px;
    font-size: 1.1em;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.2s;
}

.print-btn:hover {
    background: #2980b9;
}

/* STYLES D'IMPRESSION */
@media print {
    body {
        background: white;
        padding: 0;
        font-size: 12pt;
    }
    
    .container {
        box-shadow: none;
        padding: 0;
    }
    
    .accessibility-link,
    .submit-btn,
    .print-btn,
    .confirmation-box {
        display: none !important;
    }
    
    .eval-meta {
        background: #2c3e50 !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
    }
    
    .question-block {
        break-inside: avoid;
        page-break-inside: avoid;
    }
    
    .doc-block {
        break-inside: avoid;
        page-break-inside: avoid;
    }
    
    textarea.reponse-eleve,
    input[type="text"].reponse-eleve {
        border: 1px solid #333;
        min-height: 60px;
    }
    
    /* Afficher les réponses saisies */
    textarea.reponse-eleve,
    input[type="text"].reponse-eleve,
    select.reponse-eleve {
        background: #f9f9f9;
    }
    
    img {
        max-width: 100%;
        break-inside: avoid;
    }
    
    .theme-title {
        background: #34495e !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
    }
    
    .comp-badge {
        background: #3498db !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
    }
}

/* RESPONSIVE */
@media (max-width: 700px) {
    body { 
        padding: 8px; 
        font-size: 0.95em; 
    }
    
    .container { 
        padding: 12px; 
    }
    
    h1.main-title { 
        font-size: 1.2em; 
    }
    
    .eval-meta {
        padding: 15px;
    }
    
    .eval-meta .niveau {
        font-size: 1em;
        text-align: center;
    }
    
    .eval-meta .niveau strong {
        display: block;
        margin: 10px auto 0 auto;
        width: fit-content;
    }
    
    .eval-meta .competences-liste {
        font-size: 0.85em;
        padding-left: 15px;
    }
    
    .student-info-inner {
        flex-direction: column;
        gap: 15px;
    }
    
    .info-row {
        flex-direction: column;
        width: 100%;
        text-align: center;
    }
    
    .info-row input {
        width: 100% !important;
        max-width: 200px;
    }
    
    .checkbox-group { 
        flex-direction: column; 
        gap: 10px; 
    }
    
    .checkbox-item {
        width: 100%;
        justify-content: flex-start;
    }
    
    th, td { 
        padding: 8px; 
        font-size: 0.9em;
    }
    
    .pictogramme-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
    }
    
    .pictogramme-item img { 
        width: 60px; 
        height: 60px; 
    }
    
    .submit-btn { 
        width: 90%; 
        padding: 18px; 
        font-size: 1.2em; 
    }
    
    select.reponse-eleve {
        min-width: 100%;
        width: 100%;
    }
}

@media (max-width: 400px) {
    .pictogramme-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .eval-meta .competences-liste li {
        margin-bottom: 10px;
    }
}
    </style>
</head>
<body data-id-exercice="devoir_C3_consignes_securite">

<div class="container">

    <!-- OPTION ACCESSIBILITÉ - VERSION DISCRÈTE -->
    <div class="accessibility-link">
        <a onclick="toggleAccessibility()" id="accessibility-toggle">Affichage adapté</a>
    </div>

    <!-- TITRE -->
    <h1 class="main-title">Évaluation – Module C3 : Les consignes de sécurité et l'analyse d'une activité de travail</h1>

    <!-- PRÉAMBULE - NIVEAU ET COMPÉTENCES -->
    <div class="eval-meta">
        <p class="niveau">Niveau : <strong>CAP</strong></p>
        <p class="competences-titre">Compétences travaillées :</p>
        <ul class="competences-liste">
            <li><span class="comp-code">C1</span> Traiter une information</li>
            <li><span class="comp-code">C2</span> Appliquer une méthode d'analyse dans une situation donnée</li>
            <li><span class="comp-code">C3</span> Mettre en relation un phénomène physiologique, un enjeu environnemental, une disposition réglementaire, avec une mesure de prévention</li>
            <li><span class="comp-code">C4</span> Proposer une solution pour résoudre un problème lié à la santé, l'environnement ou la consommation</li>
        </ul>
    </div>

    <!-- IDENTIFICATION ÉLÈVE -->
    <div class="student-info">
        <div class="student-info-inner">
            <div class="info-row">
                <label for="code-eleve">CODE ÉLÈVE :</label>
                <input type="text" id="code-eleve" placeholder="Ex: AB12">
            </div>
            <div class="info-row">
                <label for="date-eleve">DATE :</label>
                <input type="date" id="date-eleve">
            </div>
        </div>
    </div>

    <!-- SITUATION -->
    <div class="situation-box">
        <h2>SITUATION</h2>
        <p><strong>Kévin, 17 ans, élève en CAP, débute son premier stage en entreprise dans un atelier de maintenance.</strong> Il découvre le monde professionnel et doit apprendre à respecter les consignes de sécurité pour se protéger et protéger les autres.</p>
        <div class="situation-images">
            <img src="images/bd_situation_v1v2.jpg" alt="BD : Arrivée de Kévin à l'atelier et accueil par son tuteur">
            <img src="images/bd_situation_v3.jpg" alt="BD : Le tuteur montre les consignes de sécurité">
        </div>
    </div>

    <!-- Question 1 -->
    <div class="question-block">
        <div class="question-text"><span class="comp-badge">C2</span> 1. À partir de la situation, <strong>formuler</strong> le problème posé.</div>
        <textarea class="reponse-eleve" data-qid="q_1_probleme" rows="3" placeholder="Votre réponse..."></textarea>
    </div>

    <!-- Question 2 -->
    <div class="question-block">
        <div class="question-text"><span class="comp-badge">C2</span> 2. À partir de la situation, <strong>compléter</strong> le tableau QQOQCP.</div>
        <div class="table-wrapper">
            <table>
                <thead><tr><th style="width:35%;">Question</th><th>Votre réponse</th></tr></thead>
                <tbody>
                    <tr><td class="table-label">De quoi s'agit-il ?</td><td><input type="text" class="reponse-eleve" data-qid="q_2_quoi" placeholder="Votre réponse..."></td></tr>
                    <tr><td class="table-label">Qui est concerné ?</td><td><input type="text" class="reponse-eleve" data-qid="q_2_qui" placeholder="Votre réponse..."></td></tr>
                    <tr><td class="table-label">Où cela se passe-t-il ?</td><td><input type="text" class="reponse-eleve" data-qid="q_2_ou" placeholder="Votre réponse..."></td></tr>
                    <tr><td class="table-label">À quel moment ?</td><td><input type="text" class="reponse-eleve" data-qid="q_2_quand" placeholder="Votre réponse..."></td></tr>
                    <tr><td class="table-label">Dans quel but ?</td><td><input type="text" class="reponse-eleve" data-qid="q_2_pourquoi" placeholder="Votre réponse..."></td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- PICTOGRAMMES -->
    <div class="theme-title">Les pictogrammes de sécurité</div>

    <!-- Document A -->
    <div class="doc-block">
        <div class="doc-title">DOC A — Les types de panneaux de signalisation de sécurité</div>
        <div class="doc-content">
            <table>
                <thead><tr><th>Type de panneau</th><th>Forme</th><th>Couleurs</th><th>Signification</th></tr></thead>
                <tbody>
                    <tr><td><strong>Interdiction</strong></td><td>Rond</td><td>Blanc, cerclé et barré de rouge</td><td>Action ou comportement interdit</td></tr>
                    <tr><td><strong>Obligation</strong></td><td>Rond</td><td>Bleu avec pictogramme blanc</td><td>Action ou comportement obligatoire</td></tr>
                    <tr><td><strong>Avertissement / Danger</strong></td><td>Triangle</td><td>Jaune avec pictogramme noir</td><td>Signale un risque ou un danger</td></tr>
                    <tr><td><strong>Sauvetage / Secours</strong></td><td>Carré ou rectangle</td><td>Vert avec pictogramme blanc</td><td>Indique un équipement de secours</td></tr>
                    <tr><td><strong>Lutte incendie</strong></td><td>Carré ou rectangle</td><td>Rouge avec pictogramme blanc</td><td>Indique un équipement incendie</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Question 3 -->
    <div class="question-block">
        <div class="question-text"><span class="comp-badge">C1</span> 3. À partir du document A, <strong>identifier</strong> le type de chaque panneau ci-dessous.</div>
        <div class="table-wrapper">
            <table>
                <thead><tr><th style="width:25%;">Pictogramme</th><th>Type de panneau</th></tr></thead>
                <tbody>
                    <tr><td style="text-align:center;"><img src="images/OBLIGATION-casque.jpg" alt="Casque obligatoire" style="width:60px;height:60px;"></td><td><select class="reponse-eleve" data-qid="q_3_casque"><option value="">-- Choisir --</option><option value="interdiction">Interdiction</option><option value="obligation">Obligation</option><option value="danger">Avertissement / Danger</option><option value="secours">Sauvetage / Secours</option><option value="incendie">Lutte incendie</option></select></td></tr>
                    <tr><td style="text-align:center;"><img src="images/DANGER-electricite.jpg" alt="Danger électrique" style="width:60px;height:60px;"></td><td><select class="reponse-eleve" data-qid="q_3_electricite"><option value="">-- Choisir --</option><option value="interdiction">Interdiction</option><option value="obligation">Obligation</option><option value="danger">Avertissement / Danger</option><option value="secours">Sauvetage / Secours</option><option value="incendie">Lutte incendie</option></select></td></tr>
                    <tr><td style="text-align:center;"><img src="images/INTERDIT-fumer.jpg" alt="Interdit de fumer" style="width:60px;height:60px;"></td><td><select class="reponse-eleve" data-qid="q_3_fumer"><option value="">-- Choisir --</option><option value="interdiction">Interdiction</option><option value="obligation">Obligation</option><option value="danger">Avertissement / Danger</option><option value="secours">Sauvetage / Secours</option><option value="incendie">Lutte incendie</option></select></td></tr>
                    <tr><td style="text-align:center;"><img src="images/INCENDIE-extincteur.jpg" alt="Extincteur" style="width:60px;height:60px;"></td><td><select class="reponse-eleve" data-qid="q_3_extincteur"><option value="">-- Choisir --</option><option value="interdiction">Interdiction</option><option value="obligation">Obligation</option><option value="danger">Avertissement / Danger</option><option value="secours">Sauvetage / Secours</option><option value="incendie">Lutte incendie</option></select></td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Question 4 -->
    <div class="question-block">
        <div class="question-text"><span class="comp-badge">C1</span> 4. <strong>Associer</strong> chaque pictogramme à sa signification en écrivant la lettre correspondante.</div>
        <div class="pictogramme-grid">
            <div class="pictogramme-item"><img src="images/OBLIGATION-lunettes.jpg" alt="Pictogramme A"><div class="picto-label">A</div></div>
            <div class="pictogramme-item"><img src="images/OBLIGATION-chaussures.jpg" alt="Pictogramme B"><div class="picto-label">B</div></div>
            <div class="pictogramme-item"><img src="images/OBLIGATION-gants.jpg" alt="Pictogramme C"><div class="picto-label">C</div></div>
            <div class="pictogramme-item"><img src="images/DANGER-produit-inflammable.jpg" alt="Pictogramme D"><div class="picto-label">D</div></div>
            <div class="pictogramme-item"><img src="images/SECOURS-croix.jpg" alt="Pictogramme E"><div class="picto-label">E</div></div>
            <div class="pictogramme-item"><img src="images/INTERDIT-entrer.jpg" alt="Pictogramme F"><div class="picto-label">F</div></div>
        </div>
        <div class="table-wrapper">
            <table>
                <thead><tr><th>Signification</th><th style="width:100px;">Lettre</th></tr></thead>
                <tbody>
                    <tr><td>Chaussures de sécurité obligatoires</td><td><input type="text" class="reponse-eleve" data-qid="q_4_chaussures" maxlength="1" style="width:60px;text-align:center;text-transform:uppercase;"></td></tr>
                    <tr><td>Entrée interdite aux personnes non autorisées</td><td><input type="text" class="reponse-eleve" data-qid="q_4_entree" maxlength="1" style="width:60px;text-align:center;text-transform:uppercase;"></td></tr>
                    <tr><td>Premiers secours</td><td><input type="text" class="reponse-eleve" data-qid="q_4_secours" maxlength="1" style="width:60px;text-align:center;text-transform:uppercase;"></td></tr>
                    <tr><td>Port des lunettes de protection obligatoire</td><td><input type="text" class="reponse-eleve" data-qid="q_4_lunettes" maxlength="1" style="width:60px;text-align:center;text-transform:uppercase;"></td></tr>
                    <tr><td>Matières inflammables</td><td><input type="text" class="reponse-eleve" data-qid="q_4_inflammable" maxlength="1" style="width:60px;text-align:center;text-transform:uppercase;"></td></tr>
                    <tr><td>Port des gants obligatoire</td><td><input type="text" class="reponse-eleve" data-qid="q_4_gants" maxlength="1" style="width:60px;text-align:center;text-transform:uppercase;"></td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Question 5 -->
    <div class="question-block">
        <div class="question-text"><span class="comp-badge">C1</span> 5. À partir de la situation et de vos connaissances, <strong>repérer</strong> les pictogrammes d'obligation que doit respecter Kévin lorsqu'il travaille sur une perceuse à colonne.</div>
        <div class="help-text">Plusieurs réponses possibles. Cochez les équipements de protection individuelle (EPI) obligatoires.</div>
        <div class="checkbox-group">
            <div class="checkbox-item"><input type="checkbox" name="q5" value="lunettes" class="reponse-eleve" data-qid="q_5_lunettes" id="q5_lunettes"><label for="q5_lunettes"><img src="images/OBLIGATION-lunettes.jpg" alt="Lunettes" style="width:40px;height:40px;vertical-align:middle;"> Lunettes de protection</label></div>
            <div class="checkbox-item"><input type="checkbox" name="q5" value="casque-antibruit" class="reponse-eleve" data-qid="q_5_antibruit" id="q5_antibruit"><label for="q5_antibruit"><img src="images/OBLIGATION-casque-antibruit.jpg" alt="Casque antibruit" style="width:40px;height:40px;vertical-align:middle;"> Casque antibruit</label></div>
            <div class="checkbox-item"><input type="checkbox" name="q5" value="chaussures" class="reponse-eleve" data-qid="q_5_chaussures" id="q5_chaussures"><label for="q5_chaussures"><img src="images/OBLIGATION-chaussures.jpg" alt="Chaussures" style="width:40px;height:40px;vertical-align:middle;"> Chaussures de sécurité</label></div>
            <div class="checkbox-item"><input type="checkbox" name="q5" value="harnais" class="reponse-eleve" data-qid="q_5_harnais" id="q5_harnais"><label for="q5_harnais"><img src="images/OBLIGATION-harnais.jpg" alt="Harnais" style="width:40px;height:40px;vertical-align:middle;"> Harnais de sécurité</label></div>
            <div class="checkbox-item"><input type="checkbox" name="q5" value="combinaison" class="reponse-eleve" data-qid="q_5_combinaison" id="q5_combinaison"><label for="q5_combinaison"><img src="images/OBLIGATION-combinaison.jpg" alt="Combinaison" style="width:40px;height:40px;vertical-align:middle;"> Vêtement de travail</label></div>
        </div>
    </div>

    <!-- ITAMaMi -->
    <div class="theme-title">L'outil ITAMaMi</div>

    <!-- Document B -->
    <div class="doc-block">
        <div class="doc-title">DOC B — L'outil d'analyse ITAMaMi</div>
        <div class="doc-content">
            <p>L'outil <strong>ITAMaMi</strong> permet d'analyser une activité de travail pour identifier les risques professionnels. Il décompose la situation en 5 éléments :</p>
            <table>
                <thead><tr><th>Lettre</th><th>Élément</th><th>Question</th><th>Exemple</th></tr></thead>
                <tbody>
                    <tr><td><strong>I</strong></td><td>Individu</td><td>Qui travaille ?</td><td>L'opérateur, ses caractéristiques (âge, formation, expérience...)</td></tr>
                    <tr><td><strong>T</strong></td><td>Tâche</td><td>Quel est l'objectif ?</td><td>Le travail prescrit, les objectifs à atteindre</td></tr>
                    <tr><td><strong>A</strong></td><td>Activité</td><td>Comment travaille-t-il ?</td><td>La façon dont le travail est réalisé (gestes, postures, déplacements...)</td></tr>
                    <tr><td><strong>Ma</strong></td><td>Matériel</td><td>Avec quels outils ?</td><td>Les outils, machines, équipements, produits utilisés</td></tr>
                    <tr><td><strong>Mi</strong></td><td>Milieu</td><td>Dans quel environnement ?</td><td>L'environnement de travail (lieu, bruit, température, horaires...)</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Document C -->
    <div class="doc-block">
        <div class="doc-title">DOC C — Une situation de travail en atelier</div>
        <div class="doc-content">
            <img src="images/poste_travail_itamami.jpg" alt="Poste de travail en atelier de maintenance">
            <p style="margin-top:15px; padding:15px; background:#f8f9fa; border-left:4px solid #3498db; border-radius:4px;">
                <strong>Description de la situation de travail :</strong><br>
                Un technicien de maintenance travaille dans un atelier. Il est debout à un établi et contrôle une pièce métallique. Il utilise un pied à coulisse pour mesurer la pièce, qui est maintenue dans un étau. Les outils sont rangés sur un panneau mural et sur l'établi. Il porte une tenue de travail et des lunettes de protection. L'objectif est de vérifier et d'ajuster une pièce mécanique dans des conditions de sécurité.
            </p>
        </div>
    </div>

    <!-- Question 6 -->
    <div class="question-block">
        <div class="question-text"><span class="comp-badge">C2</span> 6. À partir des documents B et C, <strong>compléter</strong> le tableau ITAMaMi en repérant les 5 composantes de l'activité de travail décrite.</div>
        <div class="table-wrapper">
            <table>
                <thead><tr><th style="width:30%;">Composante</th><th>Votre réponse</th></tr></thead>
                <tbody>
                    <tr><td class="table-label">I — Individu</td><td><input type="text" class="reponse-eleve" data-qid="q_6_individu" placeholder="Votre réponse..."></td></tr>
                    <tr><td class="table-label">T — Tâche</td><td><input type="text" class="reponse-eleve" data-qid="q_6_tache" placeholder="Votre réponse..."></td></tr>
                    <tr><td class="table-label">A — Activité</td><td><input type="text" class="reponse-eleve" data-qid="q_6_activite" placeholder="Votre réponse..."></td></tr>
                    <tr><td class="table-label">Ma — Matériel</td><td><input type="text" class="reponse-eleve" data-qid="q_6_materiel" placeholder="Votre réponse..."></td></tr>
                    <tr><td class="table-label">Mi — Milieu</td><td><input type="text" class="reponse-eleve" data-qid="q_6_milieu" placeholder="Votre réponse..."></td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Question 7 -->
    <div class="question-block">
        <div class="question-text"><span class="comp-badge">C3</span> 7. À partir du document B, <strong>distinguer</strong> la différence entre « Tâche » et « Activité » en reliant chaque définition au bon terme.</div>
        <div class="table-wrapper">
            <table>
                <thead><tr><th>Définition</th><th style="width:150px;">Terme</th></tr></thead>
                <tbody>
                    <tr><td>Ce que l'opérateur doit faire (le travail demandé, les objectifs)</td><td><select class="reponse-eleve" data-qid="q_7_def1"><option value="">-- Choisir --</option><option value="tache">Tâche</option><option value="activite">Activité</option></select></td></tr>
                    <tr><td>Ce que l'opérateur fait réellement (ses gestes, ses postures)</td><td><select class="reponse-eleve" data-qid="q_7_def2"><option value="">-- Choisir --</option><option value="tache">Tâche</option><option value="activite">Activité</option></select></td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- PROPOSER DES SOLUTIONS -->
    <div class="theme-title">Proposer des solutions</div>

    <!-- Document D -->
    <div class="doc-block">
        <div class="doc-title">DOC D — Une situation de travail à analyser</div>
        <div class="doc-content">
            <img src="images/situation_risque.jpg" alt="Situation de travail avec risques">
            <p style="text-align:center;font-style:italic;color:#7f8c8d;">Un opérateur utilisant une meuleuse dans un atelier</p>
        </div>
    </div>

    <!-- Question 8 -->
    <div class="question-block">
        <div class="question-text"><span class="comp-badge">C4</span> 8. À partir du document D et de la situation, <strong>proposer</strong> deux consignes de sécurité que l'opérateur devrait appliquer pour se protéger.</div>
        <p class="response-label">– Consigne 1 :</p>
        <textarea class="reponse-eleve" data-qid="q_8_consigne1" rows="2" placeholder="Votre réponse..."></textarea>
        <p class="response-label">– Consigne 2 :</p>
        <textarea class="reponse-eleve" data-qid="q_8_consigne2" rows="2" placeholder="Votre réponse..."></textarea>
    </div>

    <!-- BOUTON ENVOI -->
    <button class="submit-btn" id="submit-btn" onclick="window.tenterEnvoi()">Envoyer au prof</button>

    <!-- MESSAGE DE CONFIRMATION (caché par défaut) -->
    <div class="confirmation-box" id="confirmation-box">
        <h3>Devoir envoyé avec succès !</h3>
        <p>Votre copie a bien été transmise au professeur.</p>
        <p id="confirmation-details"></p>
    </div>

    <!-- BOUTON IMPRIMER (caché par défaut, visible après envoi) -->
    <button class="print-btn" id="print-btn" onclick="window.print()">Imprimer mon devoir</button>

</div>

<!-- SCRIPTS -->
<script>
// Mode adapté
let modeAdapte = false;
function toggleAccessibility() {
    modeAdapte = !modeAdapte;
    document.body.classList.toggle('mode-adapte', modeAdapte);
    document.getElementById('accessibility-toggle').textContent = modeAdapte ? 'Affichage standard' : 'Affichage adapté';
}

// Auto-resize des textarea (s'agrandit automatiquement quand l'élève écrit)
function initAutoResize() {
    document.querySelectorAll('textarea.reponse-eleve').forEach(el => {
        el.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = this.scrollHeight + 'px';
        });
    });
}

// Initialiser au chargement de la page
document.addEventListener('DOMContentLoaded', initAutoResize);

const DEVOIR_ID = "devoir_C3_consignes_securite";
localStorage.setItem('devoir_start_time_' + DEVOIR_ID, Date.now());
let pasteStats = { total: 0, external: 0, document: 0 };

// Fonction appelée après envoi réussi
function afficherConfirmation(code, classe) {
    // Cacher le bouton d'envoi
    document.getElementById('submit-btn').style.display = 'none';
    
    // Afficher la confirmation
    const confirmBox = document.getElementById('confirmation-box');
    confirmBox.style.display = 'block';
    
    let details = 'Code : ' + code;
    if (classe) details += ' — Classe : ' + classe;
    document.getElementById('confirmation-details').textContent = details;
    
    // Afficher le bouton imprimer
    document.getElementById('print-btn').style.display = 'block';
    
    // Désactiver tous les champs
    document.querySelectorAll('.reponse-eleve').forEach(el => {
        el.disabled = true;
        el.style.opacity = '0.8';
    });
}
</script>

<script type="module">
import("/PSE/annuaire.js")
    .then(async () => {
        if(typeof window.demanderCode === 'function') {
            const user = await window.demanderCode("Évaluation C3 - Consignes de sécurité");
            if(user && user.code) {
                document.getElementById('code-eleve').value = user.code;
                window.eleveData = user;
            }
        }
    }).catch(e => console.warn("Annuaire non chargé:", e));
</script>

<script type="module">
import("/PSE/assets/pse-runner.js")
    .then(() => console.log("Runner chargé"))
    .catch(e => { console.error("Runner non chargé:", e); alert("Impossible de charger le système d'envoi."); });
</script>

<script>
window.tenterEnvoi = async function() {
    const codeInput = document.getElementById('code-eleve');
    const code = codeInput.value.trim().toUpperCase();
    if(!code || code.length < 3) { 
        alert("CODE ÉLÈVE MANQUANT\n\nVeuillez entrer votre code élève avant d'envoyer."); 
        codeInput.focus(); 
        return; 
    }
    
    let eleveData = window.eleveData || null;
    if(typeof ANNUAIRE !== 'undefined') {
        const classe = ANNUAIRE[code];
        if(classe) { 
            eleveData = { code: code, classe: classe }; 
        } else { 
            alert("CODE INVALIDE\n\nCe code élève n'existe pas dans l'annuaire."); 
            return; 
        }
    }
    
    const radios = document.querySelectorAll('input[type="radio"].reponse-eleve:checked, input[type="checkbox"].reponse-eleve:checked');
    const textareas = document.querySelectorAll('textarea.reponse-eleve');
    const textInputs = document.querySelectorAll('input[type="text"].reponse-eleve');
    const selects = document.querySelectorAll('select.reponse-eleve');
    let nbReponses = radios.length;
    textareas.forEach(t => { if(t.value.trim()) nbReponses++; });
    textInputs.forEach(t => { if(t.value.trim()) nbReponses++; });
    selects.forEach(s => { if(s.value) nbReponses++; });
    
    let msg = "CONFIRMER L'ENVOI\n\nCode : " + code + "\n";
    if(eleveData?.classe) msg += "Classe : " + eleveData.classe + "\n";
    msg += "Réponses complétées : " + nbReponses + "\n\nAttention : vous ne pourrez plus modifier vos réponses après l'envoi.";
    
    if(!confirm(msg + "\n\nEnvoyer ?")) return;
    
    if(typeof window.envoyerCopie === 'function') { 
        try {
            await window.envoyerCopie(code, pasteStats, eleveData);
            // Envoi réussi : afficher confirmation et bouton imprimer
            afficherConfirmation(code, eleveData?.classe);
        } catch(e) {
            alert("Erreur lors de l'envoi : " + e.message);
        }
    } else { 
        alert("Système d'envoi non disponible.\n\nVeuillez recharger la page et réessayer."); 
    }
};
</script>

</body>
</html>
