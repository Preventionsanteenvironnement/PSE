<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Évaluation – Module C11 : Analyse d’une situation de travail</title>

  <style>
    :root{
      --bg:#f3f4f6;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --line:#e5e7eb;

      --band:#374151;
      --bandText:#ffffff;

      --docBand:#16a34a;
      --docBandText:#ffffff;

      --badge:#111827;
      --badgeText:#ffffff;

      --btn:#111827;
      --btnText:#ffffff;

      --focus:#2563eb;
    }

    *{box-sizing:border-box}

    body{
      margin:0;
      font-family:Arial, Helvetica, sans-serif;
      background:var(--bg);
      color:var(--text);
      line-height:1.55;
    }

    .wrap{
      max-width:980px;
      margin:0 auto;
      padding:16px;
    }

    .eval-header{
      position:relative;
      background:var(--card);
      border:1px solid var(--line);
      border-radius:14px;
      padding:16px;
      box-shadow:0 2px 12px rgba(0,0,0,.05);
    }

    .toggle-adapted{
      position:absolute;
      top:12px;
      right:12px;
      font-size:12px;
      color:var(--muted);
      text-decoration:underline;
      cursor:pointer;
      user-select:none;
    }

    .main-title{
      margin:0 0 10px 0;
      font-size:18px;
      padding-right:120px;
    }

    .eval-meta{
      display:grid;
      grid-template-columns:1fr;
      gap:10px;
      margin-top:8px;
    }

    .niveau{
      margin:0;
      color:var(--muted);
      font-size:13px;
    }

    .competences-titre{
      margin:6px 0 0 0;
      font-weight:700;
      font-size:13px;
      color:var(--muted);
    }

    .competences-liste{
      margin:6px 0 0 0;
      padding-left:18px;
      font-size:13px;
      color:var(--text);
    }

    .competences-liste li{
      margin:4px 0;
    }

    .comp-code{
      display:inline-block;
      min-width:34px;
      text-align:center;
      background:#f9fafb;
      border:1px solid var(--line);
      border-radius:10px;
      padding:2px 6px;
      font-weight:700;
      margin-right:6px;
    }

    .student-info{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
      margin-top:12px;
    }

    .info-row{
      display:flex;
      align-items:center;
      gap:10px;
      background:#f9fafb;
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px;
    }

    .info-row label{
      font-weight:700;
      font-size:13px;
      color:var(--muted);
      min-width:92px;
    }

    .info-row input{
      width:100%;
      border:1px solid var(--line);
      border-radius:10px;
      padding:10px;
      font-size:14px;
      outline:none;
    }

    .info-row input:focus{
      border-color:var(--focus);
      box-shadow:0 0 0 3px rgba(37,99,235,.12);
    }

    .card{
      margin-top:14px;
      background:var(--card);
      border:1px solid var(--line);
      border-radius:14px;
      padding:14px 16px;
      box-shadow:0 2px 12px rgba(0,0,0,.05);
    }

    .theme-title{
      background:var(--band);
      color:var(--bandText);
      text-align:center;
      border-radius:12px;
      padding:10px 12px;
      font-weight:700;
      margin:0 0 12px 0;
      font-size:14px;
    }

    .doc-box{
      border:1px solid var(--line);
      border-radius:12px;
      overflow:hidden;
      margin:10px 0;
      background:#ffffff;
    }

    .doc-band{
      background:var(--docBand);
      color:var(--docBandText);
      padding:10px 12px;
      font-weight:700;
      font-size:13px;
    }

    .doc-content{
      padding:12px;
      font-size:14px;
    }

    .doc-content p{
      margin:8px 0;
    }

    .question-block{
      border-top:1px solid var(--line);
      padding-top:12px;
      margin-top:12px;
    }

    .question-block:first-of-type{
      border-top:none;
      padding-top:0;
      margin-top:0;
    }

    .question-line{
      display:flex;
      align-items:baseline;
      gap:10px;
      flex-wrap:wrap;
      font-size:14px;
      margin:0 0 8px 0;
      white-space:normal;
    }

    .badge{
      display:inline-block;
      background:var(--badge);
      color:var(--badgeText);
      border-radius:10px;
      padding:2px 8px;
      font-size:12px;
      font-weight:700;
    }

    .pts{
      margin-left:auto;
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
    }

    .reponse-eleve{
      width:100%;
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px;
      font-size:14px;
      outline:none;
      resize:none;
      min-height:44px;
    }

    .reponse-eleve:focus{
      border-color:var(--focus);
      box-shadow:0 0 0 3px rgba(37,99,235,.12);
    }

    .grid-2{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }

    .grid-4{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }

    .table-wrapper{
      width:100%;
      overflow:auto;
      border:1px solid var(--line);
      border-radius:12px;
      background:#ffffff;
    }

    table{
      width:100%;
      border-collapse:collapse;
      min-width:720px;
    }

    th, td{
      border:1px solid var(--line);
      padding:10px;
      font-size:13px;
      vertical-align:top;
      text-align:left;
    }

    thead th{
      background:#111827;
      color:#ffffff;
      font-weight:700;
    }

    .radio-cell{
      white-space:nowrap;
      text-align:center;
    }

    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
      margin-top:12px;
    }

    .submit-btn, .print-btn{
      border:none;
      border-radius:12px;
      padding:12px 16px;
      font-weight:700;
      cursor:pointer;
      background:var(--btn);
      color:var(--btnText);
    }

    .print-btn{
      display:none;
      background:#f9fafb;
      color:var(--text);
      border:1px solid var(--line);
    }

    .status{
      margin-top:10px;
      font-size:12px;
      color:var(--muted);
    }

    body.adapted{
      font-size:18px;
      line-height:1.8;
    }

    body.adapted .main-title{font-size:20px}
    body.adapted .theme-title{font-size:16px}
    body.adapted .question-line{font-size:16px}
    body.adapted .reponse-eleve{font-size:16px}

    @media (max-width:720px){
      .student-info{grid-template-columns:1fr}
      .grid-2,.grid-4{grid-template-columns:1fr}
      table{min-width:640px}
      .main-title{padding-right:0}
      .toggle-adapted{position:static;display:inline-block;margin-top:8px}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header class="eval-header">
      <div class="toggle-adapted" id="toggleAdapted">Affichage adapté</div>

      <h1 class="main-title">Évaluation – Module C11 : Analyse d’une situation de travail</h1>

      <div class="eval-meta">
        <p class="niveau">Niveau : <strong>Bac Pro</strong></p>

        <p class="competences-titre">Compétences travaillées :</p>
        <ul class="competences-liste">
          <li><span class="comp-code">C1</span> Traiter une information</li>
          <li><span class="comp-code">C2</span> Appliquer une démarche d’analyse dans une situation donnée</li>
          <li><span class="comp-code">C3</span> Expliquer un phénomène, un enjeu, une disposition, en lien avec une mesure de prévention</li>
          <li><span class="comp-code">C4</span> Proposer une solution pour résoudre un problème</li>
          <li><span class="comp-code">C5</span> Argumenter un choix</li>
          <li><span class="comp-code">C6</span> Communication à l’écrit et à l’oral avec une syntaxe claire et adaptée</li>
        </ul>
      </div>

      <div class="student-info">
        <div class="info-row">
          <label>Code élève :</label>
          <input type="text" id="code-eleve" placeholder="Ex: AB12" required />
        </div>
        <div class="info-row">
          <label>Date :</label>
          <input type="date" id="date-eleve" required />
        </div>
      </div>
    </header>

    <section class="card">
      <div class="theme-title">Phase 1 – Situation-problème</div>

      <div class="doc-box">
        <div class="doc-band">Situation</div>
        <div class="doc-content">
          <p>Maya, 19 ans, travaille en restauration collective dans une cuisine centrale. Lors du service du midi, elle prépare des bacs gastro, dresse des plateaux et réapprovisionne la ligne chaude. Plusieurs fois par service, elle soulève des bacs de 6 à 10 kg, se penche pour atteindre des niveaux bas et effectue des rotations pour poser les bacs sur un chariot. En fin de service, elle ressent des douleurs au bas du dos et aux épaules et dit être très fatiguée. Le sol est parfois humide, l’espace est étroit près de la plonge et la ventilation est bruyante.</p>
        </div>
      </div>

      <div class="question-block">
        <p class="question-line"><span class="badge">C2</span> 1. À partir de la situation, <strong>formuler</strong> la problématique principale. <span class="pts">2 points</span></p>
        <textarea class="reponse-eleve" data-qid="q_1_problematique" rows="3"></textarea>
      </div>
    </section>

    <section class="card">
      <div class="theme-title">Phase 2 – Analyse avec un outil</div>

      <div class="question-block">
        <p class="question-line"><span class="badge">C2</span> 2. À partir de la situation, <strong>compléter</strong> ITAMaMi en indiquant un élément pertinent par case. <span class="pts">5 points</span></p>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Case</th>
                <th>Réponse</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>I – Individu</td>
                <td><textarea class="reponse-eleve" data-qid="q_2_itamami_i" rows="2"></textarea></td>
              </tr>
              <tr>
                <td>T – Tâche</td>
                <td><textarea class="reponse-eleve" data-qid="q_2_itamami_t" rows="2"></textarea></td>
              </tr>
              <tr>
                <td>A – Activité</td>
                <td><textarea class="reponse-eleve" data-qid="q_2_itamami_a" rows="2"></textarea></td>
              </tr>
              <tr>
                <td>Ma – Matériel</td>
                <td><textarea class="reponse-eleve" data-qid="q_2_itamami_ma" rows="2"></textarea></td>
              </tr>
              <tr>
                <td>Mi – Milieu</td>
                <td><textarea class="reponse-eleve" data-qid="q_2_itamami_mi" rows="2"></textarea></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="question-block">
        <p class="question-line"><span class="badge">C2</span> 3. À partir de la situation, <strong>différencier</strong> travail prescrit et travail réel en classant les items suivants. <span class="pts">4 points</span></p>

        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Item</th>
                <th class="radio-cell">Prescrit</th>
                <th class="radio-cell">Réel</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Assurer le réapprovisionnement de la ligne chaude</td>
                <td class="radio-cell"><input type="radio" name="q_3_item1" value="prescrit" class="reponse-eleve" data-qid="q_3_item1"></td>
                <td class="radio-cell"><input type="radio" name="q_3_item1" value="reel" class="reponse-eleve" data-qid="q_3_item1"></td>
              </tr>
              <tr>
                <td>Soulever des bacs de 6 à 10 kg à répétition</td>
                <td class="radio-cell"><input type="radio" name="q_3_item2" value="prescrit" class="reponse-eleve" data-qid="q_3_item2"></td>
                <td class="radio-cell"><input type="radio" name="q_3_item2" value="reel" class="reponse-eleve" data-qid="q_3_item2"></td>
              </tr>
              <tr>
                <td>Dresser des plateaux pour le service</td>
                <td class="radio-cell"><input type="radio" name="q_3_item3" value="prescrit" class="reponse-eleve" data-qid="q_3_item3"></td>
                <td class="radio-cell"><input type="radio" name="q_3_item3" value="reel" class="reponse-eleve" data-qid="q_3_item3"></td>
              </tr>
              <tr>
                <td>Se pencher pour atteindre des niveaux bas</td>
                <td class="radio-cell"><input type="radio" name="q_3_item4" value="prescrit" class="reponse-eleve" data-qid="q_3_item4"></td>
                <td class="radio-cell"><input type="radio" name="q_3_item4" value="reel" class="reponse-eleve" data-qid="q_3_item4"></td>
              </tr>
              <tr>
                <td>Respecter l’organisation du service du midi</td>
                <td class="radio-cell"><input type="radio" name="q_3_item5" value="prescrit" class="reponse-eleve" data-qid="q_3_item5"></td>
                <td class="radio-cell"><input type="radio" name="q_3_item5" value="reel" class="reponse-eleve" data-qid="q_3_item5"></td>
              </tr>
              <tr>
                <td>Effectuer une rotation du tronc en charge pour poser les bacs</td>
                <td class="radio-cell"><input type="radio" name="q_3_item6" value="prescrit" class="reponse-eleve" data-qid="q_3_item6"></td>
                <td class="radio-cell"><input type="radio" name="q_3_item6" value="reel" class="reponse-eleve" data-qid="q_3_item6"></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <section class="card">
      <div class="theme-title">Phase 3 – Documents</div>

      <div class="doc-box">
        <div class="doc-band">DOC A</div>
        <div class="doc-content">
          <p>Rapprocher la charge du corps.</p>
          <p>Fléchir les jambes et garder le dos aligné.</p>
          <p>Éviter la rotation du tronc en charge et pivoter avec les pieds.</p>
          <p>Limiter les gestes répétitifs et faire des pauses.</p>
        </div>
      </div>

      <div class="doc-box">
        <div class="doc-band">DOC B</div>
        <div class="doc-content">
          <p>Masses : bacs de 6 à 10 kg.</p>
          <p>Fréquence : plusieurs manipulations par service.</p>
          <p>Postures : flexions et rotations.</p>
          <p>Espace : zone étroite près de la plonge.</p>
          <p>Sol : parfois humide.</p>
          <p>Bruit : ventilation bruyante.</p>
          <p>Organisation : service du midi cadencé.</p>
        </div>
      </div>

      <div class="doc-box">
        <div class="doc-band">DOC C</div>
        <div class="doc-content">
          <p>Suppression ou réduction du risque : aider la manutention, réduire les contraintes de temps, réorganiser pour limiter les rotations et les flexions.</p>
          <p>Protection collective : aménagement du poste et de l’espace, amélioration de l’adhérence du sol, chariots adaptés.</p>
          <p>Protection individuelle : chaussures antidérapantes, gants adaptés selon tâches.</p>
          <p>Instructions et formation : rappels, formation gestes et postures, formation PRAP.</p>
        </div>
      </div>
    </section>

    <section class="card">
      <div class="theme-title">Phase 4 – Exploitation des documents</div>

      <div class="question-block">
        <p class="question-line"><span class="badge">C1</span> 4. À partir du DOC B, <strong>relever</strong> deux contraintes d’organisation du travail et deux contraintes de milieu. <span class="pts">4 points</span></p>
        <div class="grid-4">
          <input class="reponse-eleve" data-qid="q_4_org1" type="text" placeholder="Organisation 1">
          <input class="reponse-eleve" data-qid="q_4_org2" type="text" placeholder="Organisation 2">
          <input class="reponse-eleve" data-qid="q_4_mil1" type="text" placeholder="Milieu 1">
          <input class="reponse-eleve" data-qid="q_4_mil2" type="text" placeholder="Milieu 2">
        </div>
      </div>

      <div class="question-block">
        <p class="question-line"><span class="badge">C3</span> 5. À partir du DOC A, <strong>expliquer</strong> en quoi une rotation du tronc en charge augmente le risque de douleur au bas du dos. <span class="pts">2 points</span></p>
        <textarea class="reponse-eleve" data-qid="q_5_explication_rotation" rows="4"></textarea>
      </div>
    </section>

    <section class="card">
      <div class="theme-title">Phase 5 – Causalité, hypothèse, prévention</div>

      <div class="question-block">
        <p class="question-line"><span class="badge">C2</span> 6. À partir de la situation et du DOC B, <strong>mettre</strong> en relation deux causes probables avec l’effet douleurs au bas du dos en complétant deux relations cause → activité → effet. <span class="pts">2 points</span></p>
        <div class="grid-2">
          <textarea class="reponse-eleve" data-qid="q_6_cause1" rows="3" placeholder="Relation 1"></textarea>
          <textarea class="reponse-eleve" data-qid="q_6_cause2" rows="3" placeholder="Relation 2"></textarea>
        </div>
      </div>

      <div class="question-block">
        <p class="question-line"><span class="badge">C2</span> 7. À partir de tes réponses, <strong>formuler</strong> une hypothèse complète du type il semble que … amènent … ce qui entraîne …. <span class="pts">1 point</span></p>
        <textarea class="reponse-eleve" data-qid="q_7_hypothese" rows="3"></textarea>
      </div>

      <div class="question-block">
        <p class="question-line"><span class="badge">C4</span> 8. À partir du DOC C, <strong>proposer</strong> trois mesures de prévention adaptées à la situation. <span class="pts">1,5 point</span></p>
        <div class="grid-2">
          <input class="reponse-eleve" data-qid="q_8_mesure1" type="text" placeholder="Mesure 1">
          <input class="reponse-eleve" data-qid="q_8_mesure2" type="text" placeholder="Mesure 2">
        </div>
        <div style="margin-top:10px">
          <input class="reponse-eleve" data-qid="q_8_mesure3" type="text" placeholder="Mesure 3">
        </div>
      </div>

      <div class="question-block">
        <p class="question-line"><span class="badge">C5</span> 9. À partir de la situation, <strong>justifier</strong> la mesure que tu juges la plus prioritaire. <span class="pts">1,5 point</span></p>
        <textarea class="reponse-eleve" data-qid="q_9_justification" rows="4"></textarea>
      </div>

      <div class="actions">
        <button class="submit-btn" type="button" onclick="window.envoyerDevoir()">Envoyer au prof</button>
        <button class="print-btn" id="printBtn" type="button" onclick="window.print()">Imprimer</button>
      </div>

      <div class="status" id="statusMsg">C6 est évaluée globalement sur la clarté et la qualité de la rédaction dans l’ensemble des réponses.</div>
    </section>
  </div>

  <script>
    const DEVOIR_ID = "devoir_c11_analyse_situation_travail_v1";
    localStorage.setItem('devoir_start_time_' + DEVOIR_ID, Date.now());
    let pasteStats = { total: 0, external: 0, document: 0 };

    function autoResize(el){
      if(!el) return;
      el.style.height = 'auto';
      el.style.height = (el.scrollHeight + 2) + 'px';
    }

    document.addEventListener('input', (e) => {
      const t = e.target;
      if(t && t.classList && t.classList.contains('reponse-eleve') && t.tagName === 'TEXTAREA'){
        autoResize(t);
      }
    });

    window.addEventListener('load', () => {
      document.querySelectorAll('textarea.reponse-eleve').forEach(t => autoResize(t));
      const d = document.getElementById('date-eleve');
      if(d && !d.value) d.valueAsDate = new Date();

      const adapted = localStorage.getItem('pse_adapted_mode') === '1';
      if(adapted) document.body.classList.add('adapted');
    });

    document.getElementById('toggleAdapted').addEventListener('click', () => {
      const on = document.body.classList.toggle('adapted');
      localStorage.setItem('pse_adapted_mode', on ? '1' : '0');
    });

    function showPrint(){
      const btn = document.getElementById('printBtn');
      if(btn) btn.style.display = 'inline-block';
    }

    function validateHeader(){
      const code = document.getElementById('code-eleve');
      const date = document.getElementById('date-eleve');
      if(!code || !date) return false;

      const okCode = (code.value || '').trim().length >= 2;
      const okDate = !!date.value;

      if(!okCode){
        code.focus();
        return false;
      }
      if(!okDate){
        date.focus();
        return false;
      }
      return true;
    }

    window.envoyerDevoir = async function(){
      if(!validateHeader()) return;

      if(typeof window.tenterEnvoi !== 'function'){
        const s = document.getElementById('statusMsg');
        if(s) s.textContent = "Envoi indisponible : script runner non chargé.";
        return;
      }

      try{
        const r = window.tenterEnvoi();
        if(r && typeof r.then === 'function'){
          await r;
        }else{
          await new Promise(res => setTimeout(res, 1200));
        }
        localStorage.setItem('devoir_envoye_' + DEVOIR_ID, '1');
        showPrint();
        const s = document.getElementById('statusMsg');
        if(s) s.textContent = "Envoi effectué. Tu peux imprimer une copie si besoin.";
      }catch(e){
        const s = document.getElementById('statusMsg');
        if(s) s.textContent = "Envoi non effectué. Réessaie.";
      }
    };
  </script>

  <script type="module">
    import("https://preventionsanteenvironnement.github.io/PSE/annuaire.js")
      .then(async () => {
        if(typeof window.demanderCode === 'function') {
          const user = await window.demanderCode("Évaluation – Module C11 : Analyse d’une situation de travail");
          if(user && user.code) {
            document.getElementById('code-eleve').value = user.code;
            window.eleveData = user;
          }
        }
      });
  </script>

  <script type="module">
    import("https://preventionsanteenvironnement.github.io/PSE/assets/pse-runner.js");
  </script>
</body>
</html>
