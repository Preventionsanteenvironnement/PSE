<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>√âvaluation PSE ‚Äì Module C11</title>
  <style>
    :root { --bg: #f4f4f4; --card: #ffffff; --text: #111827; --muted: #6b7280; --line: #e5e7eb; --band: #0f172a; --bandText: #ffffff; --badgeBg: #0f172a; --badgeText: #ffffff; --focus: #2563eb; }
    body { font-family: Arial, sans-serif; max-width: 980px; margin: 0 auto; padding: 18px; background: var(--bg); color: var(--text); line-height: 1.6; }
    .container { background: var(--card); padding: 25px; border-radius: 14px; border: 1px solid var(--line); box-shadow: 0 2px 12px rgba(0,0,0,0.06); }
    .phase { margin-top: 20px; border: 1px solid var(--line); border-radius: 14px; background: #fff; overflow: hidden; }
    .phase-title { background: var(--band); color: var(--bandText); padding: 12px; font-weight: 700; text-align: center; }
    .phase-content { padding: 15px; }
    .doc { border: 1px solid var(--line); border-radius: 12px; padding: 15px; background: #f9fafb; margin: 10px 0; }
    .reponse-eleve { width: 100%; border: 1px solid var(--line); border-radius: 10px; padding: 12px; font-size: 14px; outline: none; resize: none; min-height: 60px; margin-top: 8px; }
    .badge { background: var(--badgeBg); color: var(--badgeText); border-radius: 6px; padding: 2px 8px; font-size: 12px; font-weight: bold; }
    .submit-btn { border: none; border-radius: 10px; padding: 15px; font-weight: 700; cursor: pointer; background: #10b981; color: #fff; width: 100%; margin-top: 20px; font-size: 1.1em; }
    #statusMsg { color: #ef4444; font-weight: bold; text-align: center; margin-top: 10px; min-height: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid var(--line); padding: 10px; text-align: left; }
    thead th { background: var(--band); color: #fff; }
  </style>
</head>
<body data-id-exercice="devoir_c11_analyse_situation_travail_v1">
  <div class="container">
    <header>
      <h1>√âvaluation PSE ‚Äì Module C11 ‚Äì Analyse d‚Äôune situation de travail</h1>
      <div style="background: #eef2f3; padding: 15px; border-radius: 10px; display: flex; gap: 20px; align-items: center;">
        <label><strong>VOTRE CODE :</strong></label>
        <input type="text" id="code-eleve" placeholder="Ex: KA47" style="padding: 8px; border-radius: 5px; border: 1px solid #ccc; width: 120px; text-transform: uppercase;">
        <span id="nom-eleve-display" style="color: #2563eb; font-weight: bold;"></span>
      </div>
    </header>

    <section class="phase">
      <div class="phase-title">Phase 1 ‚Äì Situation-probl√®me</div>
      <div class="phase-content">
        <div class="doc">
          <h2>Situation</h2>
          <p id="txt-situation">Maya, 19 ans, travaille en restauration collective dans une cuisine centrale. Pendant le service du midi, elle pr√©pare des bacs gastro, dresse des plateaux et r√©approvisionne la ligne chaude. Plusieurs fois par service, elle soul√®ve des bacs de 6 √† 10 kg, se penche pour atteindre des niveaux bas et effectue des rotations pour poser les bacs sur un chariot. En fin de service, elle ressent des douleurs au bas du dos et aux √©paules et dit √™tre tr√®s fatigu√©e. Le sol est parfois humide, l‚Äôespace est √©troit pr√®s de la plonge et la ventilation est bruyante.</p>
        </div>
        <div class="question">
          <p><span class="badge">C2</span> 1. <b>Formuler</b> la probl√©matique principale de la situation ?</p>
          <textarea class="reponse-eleve" data-qid="q1_problematique"></textarea>
        </div>
      </div>
    </section>

    <section class="phase">
      <div class="phase-title">Phase 2 ‚Äì Analyse avec ITAMaMi</div>
      <div class="phase-content">
        <div class="question">
          <p><span class="badge">C2</span> 2. <b>Compl√©ter</b> ITAMaMi en relevant un √©l√©ment pour chaque case :</p>
          <table>
            <thead><tr><th>Case</th><th>R√©ponse</th></tr></thead>
            <tbody>
              <tr><td>I ‚Äì Individu</td><td><textarea class="reponse-eleve" data-qid="q2_i"></textarea></td></tr>
              <tr><td>T ‚Äì T√¢che</td><td><textarea class="reponse-eleve" data-qid="q2_t"></textarea></td></tr>
              <tr><td>A ‚Äì Activit√©</td><td><textarea class="reponse-eleve" data-qid="q2_a"></textarea></td></tr>
              <tr><td>Ma ‚Äì Mat√©riel</td><td><textarea class="reponse-eleve" data-qid="q2_ma"></textarea></td></tr>
              <tr><td>Mi ‚Äì Milieu</td><td><textarea class="reponse-eleve" data-qid="q2_mi"></textarea></td></tr>
            </tbody>
          </table>
        </div>
        <div class="question">
          <p><span class="badge">C2</span> 3. <b>Classer</b> chaque item (T√¢che ou Activit√©) :</p>
          <table>
            <tr><td>R√©approvisionner la ligne chaude</td><td><select class="reponse-eleve" data-qid="q3_1"><option value="">Choisir...</option><option>T√¢che</option><option>Activit√©</option></select></td></tr>
            <tr><td>Soulever des bacs de 10 kg</td><td><select class="reponse-eleve" data-qid="q3_2"><option value="">Choisir...</option><option>T√¢che</option><option>Activit√©</option></select></td></tr>
            <tr><td>Se pencher vers le bas</td><td><select class="reponse-eleve" data-qid="q3_3"><option value="">Choisir...</option><option>T√¢che</option><option>Activit√©</option></select></td></tr>
          </table>
        </div>
      </div>
    </section>

    <section class="phase">
      <div class="phase-title">Phase 3 & 4 ‚Äì Documents et Exploitation</div>
      <div class="phase-content">
        <div class="doc" id="txt-docs">
          <p><b>DOC A :</b> Principes de manutention (dos droit, fl√©chir jambes...).</p>
          <p><b>DOC B :</b> Fr√©quence √©lev√©e, sol humide, espace √©troit.</p>
          <p><b>DOC C :</b> Hi√©rarchie de pr√©vention (1. Source, 2. Collectif, 3. Individuel, 4. Formation).</p>
        </div>
        <div class="question">
          <p><span class="badge">C1</span> 4. <b>Relever</b> deux contraintes d‚Äôorganisation et deux de milieu :</p>
          <textarea class="reponse-eleve" data-qid="q4_contraintes"></textarea>
        </div>
        <div class="question">
          <p><span class="badge">C3</span> 5. <b>Expliquer</b> le risque de la rotation du tronc en charge :</p>
          <textarea class="reponse-eleve" data-qid="q5_explication"></textarea>
        </div>
      </div>
    </section>

    <section class="phase">
      <div class="phase-title">Phase 5 ‚Äì Hypoth√®se et Pr√©vention</div>
      <div class="phase-content">
        <div class="question">
          <p><span class="badge">C2</span> 6. <b>Relier</b> causes et effets (cha√Ænes) :</p>
          <textarea class="reponse-eleve" data-qid="q6_chaines"></textarea>
        </div>
        <div class="question">
          <p><span class="badge">C2</span> 7. <b>Formuler</b> une hypoth√®se compl√®te :</p>
          <textarea class="reponse-eleve" data-qid="q7_hypothese"></textarea>
        </div>
        <div class="question">
          <p><span class="badge">C4</span> 8. <b>Proposer</b> trois mesures de pr√©vention :</p>
          <textarea class="reponse-eleve" data-qid="q8_mesures"></textarea>
        </div>
        <div class="question">
          <p><span class="badge">C5</span> 9. <b>Justifier</b> la mesure prioritaire :</p>
          <textarea class="reponse-eleve" data-qid="q9_justif"></textarea>
        </div>
      </div>
    </section>

    <div id="statusMsg"></div>
    <button class="submit-btn" onclick="tenterEnvoi()">üöÄ ENVOYER MA COPIE</button>
  </div>

  <script src="https://preventionsanteenvironnement.github.io/PSE/annuaire.js"></script>
  <script src="https://preventionsanteenvironnement.github.io/PSE/assets/pse-runner.js"></script>
  <script>
    const DEVOIR_ID = "devoir_c11_analyse_situation_travail_v1";
    let pasteStats = { total: 0, external: 0, document: 0 };

    // Surveillance Copier-Coller Intelligente
    function initPasteWatch() {
      const internalTexts = Array.from(document.querySelectorAll('.doc, p, h1, h2, td'))
        .map(el => el.innerText.trim()).filter(t => t.length > 10);

      document.querySelectorAll('.reponse-eleve').forEach(el => {
        el.addEventListener('paste', (e) => {
          const content = e.clipboardData.getData('text').trim();
          pasteStats.total++;
          const isInternal = internalTexts.some(t => t.includes(content));
          if (!isInternal) {
            pasteStats.external++;
            document.getElementById('statusMsg').innerText = "‚ö†Ô∏è Collage externe d√©tect√© et signal√© au professeur.";
            setTimeout(() => { document.getElementById('statusMsg').innerText = ""; }, 4000);
          } else {
            pasteStats.document++;
          }
        });
      });
    }

    // Annuaire
    document.getElementById('code-eleve').addEventListener('input', function(e) {
      const c = e.target.value.toUpperCase();
      if(window.ANNUAIRE && window.ANNUAIRE[c]) {
        window.eleveData = { code: c, ...window.ANNUAIRE[c] };
        document.getElementById('nom-eleve-display').innerText = "‚úÖ " + window.eleveData.nom;
      } else {
        document.getElementById('nom-eleve-display').innerText = "";
      }
    });

    async function tenterEnvoi() {
      if(!window.eleveData) return alert("Code invalide.");
      if(confirm("Confirmer l'envoi ?")) {
        if(window.envoyerCopie) window.envoyerCopie(window.eleveData.code, pasteStats, window.eleveData);
      }
    }

    window.onload = initPasteWatch;
  </script>
</body>
</html>
