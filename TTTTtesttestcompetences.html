<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>TEST RPS – Exercice compétences</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:system-ui;background:#f3f4f6;padding:20px}
.card{background:#fff;padding:20px;border-radius:10px;max-width:500px;margin:auto}
button{padding:12px 20px;font-size:16px;font-weight:bold}
</style>
</head>
<body>

<div class="card">
  <h2>Exercice test RPS</h2>

  <label>Identifiant élève</label>
  <input id="nom" style="width:100%;padding:10px;margin-bottom:10px">

  <label>Classe</label>
  <select id="classe" style="width:100%;padding:10px;margin-bottom:20px">
    <option value="">Choisir</option>
    <option value="CAP_HORT2">CAP_HORT2</option>
    <option value="2BACPRO_GATL1">2BACPRO_GATL1</option>
  </select>

  <button onclick="envoyer()">ENVOYER L’EXERCICE</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAWdCMvOiAJln3eT9LIAQD3RWJUD0lQcLI",
  authDomain: "devoirs-pse.firebaseapp.com",
  projectId: "devoirs-pse",
  storageBucket: "devoirs-pse.appspot.com",
  messagingSenderId: "614730413904",
  appId: "1:614730413904:web:a5dd478af5de30f6bede55"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.envoyer = async function () {
  const nom = document.getElementById("nom").value.trim();
  const classe = document.getElementById("classe").value;

  if(!nom || !classe){
    alert("Identifiant et classe obligatoires");
    return;
  }

  await addDoc(collection(db,"exercices"),{
    meta:{
      createdAt:new Date().toISOString(),
      nom:nom,
      classe:classe,
      type:"exercice",
      support:"TEST_RPS_COMPETENCES"
    },
    resultat:{
      score:"10 / 20",
      niveauGlobal:"IM",
      competences:{
        C1:"IM",
        C2:"M",
        C3:"IM",
        C4:"M",
        C5:"",
        C6:""
      },
      tentatives:1,
      tempsPasse:180,
      url:location.href,
      titre:document.title
    }
  });

  alert("Envoyé à PageProf");
};
</script>

</body>
</html>
