<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module B.5 - Escape Game Crise Climatique - Terminale Bac Pro</title>
    <style>
        /* RESPONSIVE MOBILE-FIRST */
        :root {
            --primary-pse: #2E86AB;
            --secondary-pse: #A23B72;
            --success-pse: #219653;
            --warning-pse: #F2994A;
            --danger-pse: #EB5757;
            --dark-pse: #2F3542;
            --light-pse: #F1F2F6;
            --escape-red: #e74c3c;
            --escape-orange: #f39c12;
            --escape-green: #27ae60;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--dark-pse);
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .exercice-container {
            width: 100%;
            max-width: 100vw;
            padding: 15px;
            font-size: 16px;
        }

        /* EN-T√äTE P√âDAGOGIQUE OBLIGATOIRE */
        .cadre-pedagogique {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            border-left: 6px solid var(--danger-pse);
        }

        .module-info h2 {
            color: var(--primary-pse);
            font-size: 1.4rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .objectif {
            background: var(--light-pse);
            padding: 12px;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 0.95rem;
        }

        .competences-travaillees h3 {
            color: var(--secondary-pse);
            margin: 15px 0 10px 0;
            font-size: 1.1rem;
        }

        .competences-list {
            list-style: none;
            padding: 0;
        }

        .competences-list li {
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 6px;
            background: rgba(46, 134, 171, 0.1);
            border-left: 4px solid var(--primary-pse);
        }

        .niveau-cible {
            background: var(--escape-red);
            color: white;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            margin-top: 15px;
            font-weight: 600;
            animation: pulse-urgent 2s infinite;
        }

        @keyframes pulse-urgent {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        /* ESCAPE GAME PRINCIPAL */
        .escape-container {
            background: linear-gradient(135deg, rgba(231,76,60,0.9) 0%, rgba(192,57,43,0.9) 100%);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            color: white;
            position: relative;
            overflow: hidden;
        }

        .escape-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="40" r="1.5" fill="rgba(255,255,255,0.08)"/><circle cx="40" cy="80" r="1" fill="rgba(255,255,255,0.06)"/></svg>');
            pointer-events: none;
        }

        .escape-header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
            z-index: 2;
        }

        .escape-header h2 {
            font-size: 2rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            animation: text-glow 3s infinite alternate;
        }

        @keyframes text-glow {
            0% { text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
            100% { text-shadow: 2px 2px 4px rgba(0,0,0,0.5), 0 0 20px rgba(255,255,255,0.3); }
        }

        /* CHRONOM√àTRE D'URGENCE */
        .chrono-container {
            background: rgba(0,0,0,0.4);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            border: 3px solid #fff;
            box-shadow: inset 0 0 20px rgba(255,255,255,0.1);
        }

        .chrono-display {
            font-size: 3rem;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            color: #fff;
            text-shadow: 0 0 10px rgba(255,255,255,0.5);
            margin: 10px 0;
        }

        .chrono-status {
            font-size: 1.2rem;
            margin-top: 10px;
            font-weight: 600;
        }

        .chrono-urgent {
            color: #ff6b6b !important;
            animation: blink-urgent 1s infinite;
        }

        @keyframes blink-urgent {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        /* SC√âNARIO D'URGENCE */
        .scenario-urgence {
            background: rgba(255,255,255,0.1);
            border-left: 5px solid #fff;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            backdrop-filter: blur(5px);
        }

        .scenario-urgence h3 {
            color: #ffeb3b;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        /* √âNIGMES ET D√âFIS */
        .enigme-card {
            background: white;
            color: var(--dark-pse);
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            border-left: 6px solid var(--warning-pse);
            position: relative;
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.6s ease;
        }

        .enigme-card.unlocked {
            transform: translateY(0);
            opacity: 1;
        }

        .enigme-card.locked {
            background: #f8f9fa;
            color: #6c757d;
            pointer-events: none;
            filter: grayscale(100%);
        }

        .enigme-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .enigme-numero {
            background: var(--warning-pse);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .enigme-info h3 {
            color: var(--escape-red);
            font-size: 1.3rem;
            margin-bottom: 5px;
        }

        .enigme-competence {
            background: var(--primary-pse);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        /* ZONE DE D√âFI */
        .defi-zone {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            text-align: center;
        }

        .defi-question {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--dark-pse);
        }

        /* R√âPONSES INTERACTIVES */
        .reponse-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .reponse-card {
            background: white;
            border: 3px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
        }

        .reponse-card:hover {
            border-color: var(--primary-pse);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }

        .reponse-card.correct {
            background: #d4edda !important;
            border-color: var(--success-pse) !important;
            border-width: 4px !important;
            color: #155724;
            font-weight: bold;
        }

        .reponse-card.incorrect {
            background: #f8d7da !important;
            border-color: var(--danger-pse) !important;
            border-width: 4px !important;
            color: #721c24;
            opacity: 0.7;
        }

        .reponse-card.correct::before {
            content: '‚úÖ';
            position: absolute;
            top: -10px;
            right: -10px;
            background: var(--success-pse);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }

        .reponse-card.incorrect::before {
            content: '‚ùå';
            position: absolute;
            top: -10px;
            right: -10px;
            background: var(--danger-pse);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }

        /* SYST√àME DE CORRECTION EXPLICITE */
        .correction-explicite {
            background: white;
            border: 3px solid var(--danger-pse);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            display: none;
            box-shadow: 0 6px 20px rgba(231,76,60,0.2);
        }

        .correction-explicite h4 {
            color: var(--danger-pse);
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .bonne-reponse {
            background: #d4edda;
            border: 2px solid #c3e6cb;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .bonne-reponse strong {
            color: var(--success-pse);
        }

        .explication-detaillee {
            background: #fff3cd;
            border: 2px solid #ffeaa7;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        /* PROGRESSION ET INDICES */
        .progression-bar {
            background: rgba(255,255,255,0.2);
            height: 20px;
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progression-fill {
            height: 100%;
            background: linear-gradient(90deg, #00b894, #00cec9);
            border-radius: 10px;
            transition: width 1s ease;
            position: relative;
        }

        .progression-fill::after {
            content: attr(data-percent);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .indice-container {
            background: rgba(255,255,255,0.1);
            border: 2px dashed rgba(255,255,255,0.5);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            display: none;
        }

        .indice-container.visible {
            display: block;
            animation: fadeInUp 0.6s ease;
        }

        /* SUCC√àS ET √âCHEC */
        .succes-container {
            background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
            color: white;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            margin: 30px 0;
            display: none;
            box-shadow: 0 10px 30px rgba(0,184,148,0.3);
        }

        .echec-container {
            background: linear-gradient(135deg, #d63031 0%, #e17055 100%);
            color: white;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            margin: 30px 0;
            display: none;
            box-shadow: 0 10px 30px rgba(214,48,49,0.3);
        }

        .score-final {
            font-size: 4rem;
            font-weight: bold;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        /* BOUTONS D'ACTION */
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 8px 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-urgent {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(255,107,107,0.4);
        }

        .btn-urgent:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255,107,107,0.6);
        }

        .btn-indice {
            background: linear-gradient(135deg, #fdcb6e 0%, #e17055 100%);
            color: white;
        }

        .btn-suivant {
            background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
            color: white;
            display: none;
        }

        /* FOOTER RGPD */
        .rgpd-footer {
            text-align: center;
            padding: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            font-size: 0.9rem;
            margin-top: 40px;
            border-radius: 8px;
        }

        /* RESPONSIVE */
        @media (min-width: 768px) {
            .exercice-container {
                padding: 20px;
                font-size: 17px;
            }
            .escape-header h2 {
                font-size: 2.5rem;
            }
            .chrono-display {
                font-size: 4rem;
            }
        }

        @media (min-width: 1024px) {
            .exercice-container {
                max-width: 1100px;
                margin: 0 auto;
                padding: 30px;
                font-size: 18px;
            }
        }

        /* ANIMATIONS */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeInUp 0.8s ease;
        }

        /* EFFETS DE PARTICULES */
        .particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            animation: float 6s infinite ease-in-out;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
    </style>
</head>
<body>
    <div class="exercice-container">
        
        <!-- EN-T√äTE P√âDAGOGIQUE OBLIGATOIRE -->
        <div class="cadre-pedagogique">
            <div class="module-info">
                <h2>Module B.5 : Les ressources en √©nergie et le d√©veloppement durable</h2>
                <div class="objectif">
                    <strong>Objectif :</strong> Adopter un comportement √©cocitoyen afin de pr√©server les ressources en √©nergie
                </div>
            </div>
            
            <div class="competences-travaillees">
                <h3>Comp√©tences travaill√©es dans cet exercice :</h3>
                <ul class="competences-list">
                    <li><strong>C1</strong> - Traiter une information</li>
                    <li><strong>C2</strong> - Appliquer une d√©marche d'analyse dans une situation donn√©e</li>
                    <li><strong>C3</strong> - Expliquer un ph√©nom√®ne physiologique, un enjeu environnemental, une disposition r√©glementaire, en lien avec une mesure de pr√©vention</li>
                    <li><strong>C4</strong> - Proposer une solution pour r√©soudre un probl√®me</li>
                    <li><strong>C5</strong> - Argumenter un choix</li>
                    <li><strong>C6</strong> - Communiquer √† l'√©crit et √† l'oral avec une syntaxe claire et un vocabulaire adapt√©</li>
                </ul>
            </div>
            
            <div class="niveau-cible">
                <strong>üö® MISSION URGENTE - Niveau :</strong> Bac Pro Terminale
            </div>
        </div>

        <!-- ESCAPE GAME PRINCIPAL -->
        <div class="escape-container">
            <div class="particles" id="particles"></div>
            
            <div class="escape-header">
                <h2>üö® ESCAPE GAME CRISE CLIMATIQUE</h2>
                <p style="font-size: 1.2rem; margin-bottom: 20px;">VOUS √äTES LE SEUL ESPOIR DE VOTRE ENTREPRISE</p>
            </div>

            <!-- CHRONOM√àTRE D'URGENCE -->
            <div class="chrono-container">
                <div class="chrono-display" id="chrono-display">45:00</div>
                <div class="chrono-status" id="chrono-status">‚è±Ô∏è TEMPS RESTANT POUR SAUVER L'ENTREPRISE</div>
                <div style="font-size: 0.9rem; margin-top: 10px; opacity: 0.8;">
                    üéØ Objectif : R√©soudre la crise avant l'√©ch√©ance fatale !
                </div>
            </div>

            <!-- SC√âNARIO D'URGENCE -->
            <div class="scenario-urgence fade-in">
                <h3>üè≠ SITUATION CRITIQUE - ECOTECH INDUSTRIES</h3>
                <p style="margin-bottom: 15px;">
                    <strong>FLASH INFO :</strong> Votre entreprise ECOTECH vient de recevoir un ultimatum : 
                    r√©duire ses √©missions de CO‚ÇÇ de <strong>40% en 12 mois</strong> ou perdre tous ses contrats publics 
                    (valeur : 15 millions ‚Ç¨/an).
                </p>
                
                <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <strong>üìã VOS DONN√âES ACTUELLES :</strong><br>
                    ‚Ä¢ √âmissions annuelles : <strong>2 400 tonnes CO‚ÇÇ</strong><br>
                    ‚Ä¢ Budget urgence disponible : <strong>800 000‚Ç¨</strong><br>
                    ‚Ä¢ D√©lai l√©gal : <strong>365 jours</strong><br>
                    ‚Ä¢ Objectif √† atteindre : <strong>1 440 tonnes CO‚ÇÇ max</strong> (-960 tonnes)
                </div>

                <p style="color: #ffeb3b; font-weight: bold; font-size: 1.1rem;">
                    ‚ö° MISSION : R√©solvez 5 √©nigmes √©nerg√©tiques pour identifier les solutions de sauvegarde !
                </p>
            </div>

            <!-- BARRE DE PROGRESSION -->
            <div class="progression-bar">
                <div class="progression-fill" id="progression" style="width: 0%" data-percent="0%"></div>
            </div>
        </div>

        <!-- √âNIGME 1 : ANALYSE RAPIDE -->
        <div class="enigme-card unlocked" id="enigme1">
            <div class="enigme-header">
                <div class="enigme-numero">1</div>
                <div class="enigme-info">
                    <h3>üîç DIAGNOSTIC FLASH</h3>
                    <div class="enigme-competence">C1 - Traiter information</div>
                </div>
            </div>

            <div class="defi-zone">
                <div class="defi-question">
                    URGENCE ! Analysez ce graphique et identifiez le poste d'√©mission prioritaire √† traiter :
                </div>
                
                <div style="background: white; padding: 20px; border-radius: 10px; margin: 15px 0;">
                    <h4>R√©partition des √©missions ECOTECH (2400 tonnes CO‚ÇÇ/an)</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 15px 0;">
                        <div style="text-align: center;">
                            <div style="background: #e74c3c; height: 120px; width: 60px; margin: 0 auto; border-radius: 5px; position: relative; display: flex; align-items: end; justify-content: center; color: white; font-weight: bold;">50%</div>
                            <div style="margin-top: 10px;"><strong>Chauffage/Clim</strong><br>1200 tonnes</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="background: #f39c12; height: 72px; width: 60px; margin: 0 auto; border-radius: 5px; position: relative; display: flex; align-items: end; justify-content: center; color: white; font-weight: bold;">30%</div>
                            <div style="margin-top: 10px;"><strong>Production</strong><br>720 tonnes</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="background: #3498db; height: 48px; width: 60px; margin: 0 auto; border-radius: 5px; position: relative; display: flex; align-items: end; justify-content: center; color: white; font-weight: bold;">20%</div>
                            <div style="margin-top: 10px;"><strong>Transport</strong><br>480 tonnes</div>
                        </div>
                    </div>
                </div>

                <div class="reponse-grid">
                    <div class="reponse-card" onclick="repondreEnigme(1, 'a', true)">
                        <strong>Chauffage/Climatisation</strong><br>
                        <small>Le plus gros √©metteur (1200 tonnes)</small>
                    </div>
                    <div class="reponse-card" onclick="repondreEnigme(1, 'b', false)">
                        <strong>Transport</strong><br>
                        <small>Plus visible au quotidien</small>
                    </div>
                    <div class="reponse-card" onclick="repondreEnigme(1, 'c', false)">
                        <strong>Production</strong><br>
                        <small>C≈ìur de l'activit√©</small>
                    </div>
                </div>
                
                <div class="correction-explicite" id="correction1">
                    <h4>‚ùå CORRECTION IMM√âDIATE</h4>
                    <div class="bonne-reponse">
                        <strong>‚úÖ LA BONNE R√âPONSE :</strong><br>
                        <span style="color: #27ae60; font-weight: bold;">Chauffage/Climatisation (1200 tonnes CO‚ÇÇ = 50%)</span>
                    </div>
                    <div class="explication-detaillee">
                        <strong>üí° LOGIQUE D'URGENCE :</strong><br>
                        En situation de crise, attaquer d'abord le plus gros poste ! 1200 tonnes = 50% du total.
                        M√™me avec -30% sur ce poste, on √©conomise 360 tonnes CO‚ÇÇ.
                        Transport (480 tonnes) : m√™me avec -50%, seulement 240 tonnes √©conomis√©es.
                        <strong>PRIORIT√â = MAXIMUM D'IMPACT !</strong>
                    </div>
                </div>

                <button class="btn btn-indice" onclick="afficherIndice(1)">üí° Besoin d'un indice</button>
                <div class="indice-container" id="indice1">
                    <strong>üí° INDICE :</strong> En crise, toujours prioriser le poste qui repr√©sente le plus gros volume d'√©missions. 50% du total = 1200 tonnes !
                </div>
            </div>
        </div>

        <!-- √âNIGME 2 : CALCULS SOUS PRESSION -->
        <div class="enigme-card locked" id="enigme2">
            <div class="enigme-header">
                <div class="enigme-numero">2</div>
                <div class="enigme-info">
                    <h3>üßÆ CALCULS DE SURVIE</h3>
                    <div class="enigme-competence">C2 - D√©marche d'analyse</div>
                </div>
            </div>

            <div class="defi-zone">
                <div class="defi-question">
                    URGENT ! Calculez les √©conomies r√©alisables avec ces 3 solutions d'urgence :
                </div>

                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <strong>üìä SOLUTIONS DISPONIBLES :</strong><br>
                    ‚Ä¢ <strong>Isolation renforc√©e :</strong> -40% sur chauffage/clim | Co√ªt : 300 000‚Ç¨<br>
                    ‚Ä¢ <strong>Machines efficaces :</strong> -25% sur production | Co√ªt : 250 000‚Ç¨<br>
                    ‚Ä¢ <strong>Flotte √©lectrique :</strong> -60% sur transport | Co√ªt : 200 000‚Ç¨<br>
                    <strong>BUDGET TOTAL DISPONIBLE : 800 000‚Ç¨</strong>
                </div>

                <div style="background: white; padding: 20px; border-radius: 10px; margin: 15px 0;">
                    <h4>Calculatrice d'urgence :</h4>
                    <div style="margin: 10px 0;">
                        Isolation : 1200 √ó 40% = <strong id="calc-isolation">480 tonnes CO‚ÇÇ √©conomis√©es</strong>
                    </div>
                    <div style="margin: 10px 0;">
                        Machines : 720 √ó 25% = <strong id="calc-machines">180 tonnes CO‚ÇÇ √©conomis√©es</strong>
                    </div>
                    <div style="margin: 10px 0;">
                        Transport : 480 √ó 60% = <strong id="calc-transport">288 tonnes CO‚ÇÇ √©conomis√©es</strong>
                    </div>
                    <div style="border-top: 2px solid #333; padding-top: 10px; margin-top: 15px; font-size: 1.1rem;">
                        <strong>TOTAL √âCONOMIES : <span id="total-economies">948 tonnes CO‚ÇÇ</span></strong><br>
                        <strong>CO√õT TOTAL : 750 000‚Ç¨</strong> (sous budget ‚úÖ)
                    </div>
                </div>

                <div class="reponse-grid">
                    <div class="reponse-card" onclick="repondreEnigme(2, 'a', false)">
                        <strong>Objectif NON atteint</strong><br>
                        <small>Il manque encore des √©conomies</small>
                    </div>
                    <div class="reponse-card" onclick="repondreEnigme(2, 'b', true)">
                        <strong>Objectif ATTEINT !</strong><br>
                        <small>948 tonnes > 960 tonnes cible</small>
                    </div>
                    <div class="reponse-card" onclick="repondreEnigme(2, 'c', false)">
                        <strong>Budget d√©pass√©</strong><br>
                        <small>Trop co√ªteux √† r√©aliser</small>
                    </div>
                </div>

                <div class="correction-explicite" id="correction2">
                    <h4>‚ùå CORRECTION RAPIDE</h4>
                    <div class="bonne-reponse">
                        <strong>‚úÖ LA BONNE R√âPONSE :</strong><br>
                        <span style="color: #27ae60; font-weight: bold;">Objectif ATTEINT ! (948 tonnes √©conomis√©es)</span>
                    </div>
                    <div class="explication-detaillee">
                        <strong>üí° CALCUL D√âTAILL√â :</strong><br>
                        <strong>Objectif :</strong> Passer de 2400 √† 1440 tonnes = -960 tonnes CO‚ÇÇ<br>
                        <strong>Nos solutions :</strong> 480 + 180 + 288 = 948 tonnes √©conomis√©es<br>
                        <strong>R√©sultat :</strong> 2400 - 948 = 1452 tonnes finales<br>
                        <strong>‚úÖ R√âUSSI !</strong> 1452 < 1440 (avec marge de s√©curit√©) + budget respect√© !
                    </div>
                </div>

                <button class="btn btn-indice" onclick="afficherIndice(2)">üí° Aide aux calculs</button>
                <div class="indice-container" id="indice2">
                    <strong>üí° INDICE :</strong> Objectif = -960 tonnes CO‚ÇÇ. Additionnez : 480 + 180 + 288 = ? tonnes. Comparez avec 960 !
                </div>
            </div>
        </div>

        <!-- √âNIGME 3 : LIEN CLIMATIQUE -->
        <div class="enigme-card locked" id="enigme3">
            <div class="enigme-header">
                <div class="enigme-numero">3</div>
                <div class="enigme-info">
                    <h3>üåç IMPACT CLIMATIQUE</h3>
                    <div class="enigme-competence">C3 - Expliquer ph√©nom√®ne</div>
                </div>
            </div>

            <div class="defi-zone">
                <div class="defi-question">
                    ALERTE SCIENTIFIQUE ! Expliquez pourquoi 960 tonnes CO‚ÇÇ √©conomis√©es = impact climatique majeur :
                </div>

                <div style="background: white; padding: 20px; border-radius: 10px; margin: 15px 0;">
                    <h4>üî¨ Donn√©es scientifiques d'urgence :</h4>
                    <ul style="text-align: left; margin: 10px 0; padding-left: 20px;">
                        <li><strong>960 tonnes CO‚ÇÇ</strong> = √©missions annuelles de <strong>200 voitures</strong></li>
                        <li>1 tonne CO‚ÇÇ reste <strong>100 ans</strong> dans l'atmosph√®re</li>
                        <li>CO‚ÇÇ = principal <strong>gaz √† effet de serre</strong> d'origine humaine</li>
                        <li>Effet de serre amplifi√© = <strong>r√©chauffement climatique</strong></li>
                    </ul>
                </div>

                <div class="reponse-grid">
                    <div class="reponse-card" onclick="repondreEnigme(3, 'a', false)">
                        <strong>√âconomies d'argent uniquement</strong><br>
                        <small>Impact seulement financier</small>
                    </div>
                    <div class="reponse-card" onclick="repondreEnigme(3, 'b', true)">
                        <strong>R√©duction effet de serre</strong><br>
                        <small>Moins de CO‚ÇÇ = moins de r√©chauffement</small>
                    </div>
                    <div class="reponse-card" onclick="repondreEnigme(3, 'c', false)">
                        <strong>Am√©lioration de l'air local</strong><br>
                        <small>Seulement qualit√© air bureau</small>
                    </div>
                </div>

                <div class="correction-explicite" id="correction3">
                    <h4>‚ùå CORRECTION SCIENTIFIQUE</h4>
                    <div class="bonne-reponse">
                        <strong>‚úÖ LA BONNE R√âPONSE :</strong><br>
                        <span style="color: #27ae60; font-weight: bold;">R√©duction de l'effet de serre (moins de r√©chauffement climatique)</span>
                    </div>
                    <div class="explication-detaillee">
                        <strong>üí° M√âCANISME CLIMATIQUE :</strong><br>
                        <strong>1.</strong> CO‚ÇÇ √©mis ‚Üí s'accumule dans l'atmosph√®re<br>
                        <strong>2.</strong> CO‚ÇÇ = gaz √† effet de serre ‚Üí pi√®ge chaleur solaire<br>
                        <strong>3.</strong> Plus de CO‚ÇÇ = plus de chaleur pi√©g√©e = r√©chauffement<br>
                        <strong>4.</strong> 960 tonnes CO‚ÇÇ √©vit√©es = contribution directe √† limiter le r√©chauffement !<br>
                        <strong>IMPACT :</strong> √âquivalent √† retirer 200 voitures de la circulation pendant 1 an !
                    </div>
                </div>

                <button class="btn btn-indice" onclick="afficherIndice(3)">üí° Rappel scientifique</button>
                <div class="indice-container" id="indice3">
                    <strong>üí° INDICE :</strong> Le CO‚ÇÇ est un gaz √† effet de serre. Plus il y en a dans l'atmosph√®re, plus la plan√®te se r√©chauffe. Moins de CO‚ÇÇ = moins de r√©chauffement !
                </div>
            </div>
        </div>

        <!-- √âNIGME 4 : PLAN D'ACTION -->
        <div class="enigme-card locked" id="enigme4">
            <div class="enigme-header">
                <div class="enigme-numero">4</div>
                <div class="enigme-info">
                    <h3>üìã STRAT√âGIE D'URGENCE</h3>
                    <div class="enigme-competence">C4 - Proposer solutions</div>
                </div>
            </div>

            <div class="defi-zone">
                <div class="defi-question">
                    DERNI√àRE LIGNE DROITE ! Ordonnez ces actions par priorit√© d'ex√©cution (1 √† 4) :
                </div>

                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <strong>‚è∞ CONTRAINTES TEMPORELLES :</strong><br>
                    ‚Ä¢ Isolation renforc√©e : 6 mois de travaux<br>
                    ‚Ä¢ Machines efficaces : 3 mois livraison + installation<br>
                    ‚Ä¢ Flotte √©lectrique : 2 mois de livraison<br>
                    ‚Ä¢ Formation √©co-gestes : 1 mois de d√©ploiement<br>
                    <strong>üìÖ D√âLAI TOTAL : 12 mois maximum</strong>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 20px 0;">
                    <div class="action-priorite" style="background: white; padding: 15px; border-radius: 8px; border: 2px solid #dee2e6;">
                        <h5>üöö Flotte √©lectrique</h5>
                        <p>Livraison rapide (2 mois)</p>
                        <select id="priorite-flotte" style="width: 100%; margin-top: 10px; padding: 5px;">
                            <option value="">Choisir priorit√©</option>
                            <option value="1">1 - Premier</option>
                            <option value="2">2 - Deuxi√®me</option>
                            <option value="3">3 - Troisi√®me</option>
                            <option value="4">4 - Quatri√®me</option>
                        </select>
                    </div>

                    <div class="action-priorite" style="background: white; padding: 15px; border-radius: 8px; border: 2px solid #dee2e6;">
                        <h5>üë• Formation √©co-gestes</h5>
                        <p>D√©ploiement rapide (1 mois)</p>
                        <select id="priorite-formation" style="width: 100%; margin-top: 10px; padding: 5px;">
                            <option value="">Choisir priorit√©</option>
                            <option value="1">1 - Premier</option>
                            <option value="2">2 - Deuxi√®me</option>
                            <option value="3">3 - Troisi√®me</option>
                            <option value="4">4 - Quatri√®me</option>
                        </select>
                    </div>

                    <div class="action-priorite" style="background: white; padding: 15px; border-radius: 8px; border: 2px solid #dee2e6;">
                        <h5>‚ö° Machines efficaces</h5>
                        <p>Installation moyenne (3 mois)</p>
                        <select id="priorite-machines" style="width: 100%; margin-top: 10px; padding: 5px;">
                            <option value="">Choisir priorit√©</option>
                            <option value="1">1 - Premier</option>
                            <option value="2">2 - Deuxi√®me</option>
                            <option value="3">3 - Troisi√®me</option>
                            <option value="4">4 - Quatri√®me</option>
                        </select>
                    </div>

                    <div class="action-priorite" style="background: white; padding: 15px; border-radius: 8px; border: 2px solid #dee2e6;">
                        <h5>üè† Isolation renforc√©e</h5>
                        <p>Travaux longs (6 mois)</p>
                        <select id="priorite-isolation" style="width: 100%; margin-top: 10px; padding: 5px;">
                            <option value="">Choisir priorit√©</option>
                            <option value="1">1 - Premier</option>
                            <option value="2">2 - Deuxi√®me</option>
                            <option value="3">3 - Troisi√®me</option>
                            <option value="4">4 - Quatri√®me</option>
                        </select>
                    </div>
                </div>

                <button class="btn btn-urgent" onclick="validerPriorisation()">‚ö° VALIDER LE PLAN DE SAUVETAGE</button>

                <div class="correction-explicite" id="correction4">
                    <h4>‚ùå CORRECTION STRAT√âGIQUE</h4>
                    <div class="bonne-reponse">
                        <strong>‚úÖ LA BONNE PRIORISATION :</strong><br>
                        <strong>1.</strong> Isolation renforc√©e (d√©marrer imm√©diatement - 6 mois)<br>
                        <strong>2.</strong> Machines efficaces (commander maintenant - 3 mois)<br>
                        <strong>3.</strong> Flotte √©lectrique (commander apr√®s - 2 mois)<br>
                        <strong>4.</strong> Formation √©co-gestes (en parall√®le final - 1 mois)
                    </div>
                    <div class="explication-detaillee">
                        <strong>üí° LOGIQUE TEMPORELLE :</strong><br>
                        <strong>STRAT√âGIE :</strong> Lancer d'abord les actions les plus longues !<br>
                        <strong>Mois 1-6 :</strong> Isolation (travaux)<br>
                        <strong>Mois 4-6 :</strong> Machines (livraison + installation)<br>
                        <strong>Mois 7-8 :</strong> Flotte √©lectrique<br>
                        <strong>Mois 9 :</strong> Formation √©co-gestes<br>
                        <strong>‚úÖ R√âSULTAT :</strong> Tout termin√© en 9 mois (3 mois d'avance) !
                    </div>
                </div>

                <button class="btn btn-indice" onclick="afficherIndice(4)">üí° Aide planning</button>
                <div class="indice-container" id="indice4">
                    <strong>üí° INDICE :</strong> En mode urgence, commencez toujours par ce qui prend le plus de temps ! 6 mois > 3 mois > 2 mois > 1 mois
                </div>
            </div>
        </div>

        <!-- √âNIGME 5 : COMMUNICATION D'URGENCE -->
        <div class="enigme-card locked" id="enigme5">
            <div class="enigme-header">
                <div class="enigme-numero">5</div>
                <div class="enigme-info">
                    <h3>üì¢ COMMUNICATION DE CRISE</h3>
                    <div class="enigme-competence">C6 - Communication</div>
                </div>
            </div>

            <div class="defi-zone">
                <div class="defi-question">
                    ULTIME D√âFI ! R√©digez le message de victoire pour annoncer le plan de sauvetage :
                </div>

                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <strong>üìã CONSIGNES MESSAGE :</strong><br>
                    ‚Ä¢ S'adresser √† TOUS les salari√©s d'ECOTECH<br>
                    ‚Ä¢ Annoncer l'objectif atteint (-40% √©missions CO‚ÇÇ)<br>
                    ‚Ä¢ Mentionner les 3 solutions principales<br>
                    ‚Ä¢ Utiliser vocabulaire PSE professionnel<br>
                    ‚Ä¢ Ton rassurant mais mobilisateur
                </div>

                <textarea id="message-victoire" 
                          style="width: 100%; height: 120px; padding: 15px; border: 2px solid #dee2e6; border-radius: 8px; font-family: inherit; font-size: 1rem; resize: vertical;" 
                          placeholder="Votre message d'annonce de victoire (vocabulaire PSE : √©missions CO‚ÇÇ, transition √©nerg√©tique, d√©veloppement durable, empreinte carbone...)"></textarea>
                
                <button class="btn btn-urgent" onclick="analyserCommunication()">üì¢ DIFFUSER LE MESSAGE</button>
                
                <div class="correction-explicite" id="correction5">
                    <h4>üí° EXEMPLE DE COMMUNICATION D'URGENCE</h4>
                    <div class="bonne-reponse">
                        <strong>‚úÖ MOD√àLE DE MESSAGE PROFESSIONNEL :</strong><br>
                        <div style="background: white; color: #333; padding: 15px; border-radius: 8px; margin: 10px 0; font-style: italic; border-left: 4px solid #27ae60;">
                            "Chers collaborateurs, <strong>MISSION ACCOMPLIE !</strong> Gr√¢ce √† notre plan d'urgence climatique, ECOTECH r√©ussira √† r√©duire ses √©missions CO‚ÇÇ de 40% (960 tonnes √©conomis√©es/an). Notre strat√©gie : isolation renforc√©e, machines √©co-efficaces et flotte √©lectrique. Cette transition √©nerg√©tique sauve nos contrats publics et positionne notre entreprise comme leader du d√©veloppement durable. Ensemble, nous avons relev√© le d√©fi climatique !"
                        </div>
                    </div>
                    <div class="explication-detaillee">
                        <strong>üí° POINTS CL√âS COMMUNICATION CRISE :</strong><br>
                        ‚úÖ Annonce claire du succ√®s (MISSION ACCOMPLIE)<br>
                        ‚úÖ Donn√©es chiffr√©es pr√©cises (40%, 960 tonnes)<br>
                        ‚úÖ Solutions concr√®tes mentionn√©es<br>
                        ‚úÖ Vocabulaire PSE professionnel<br>
                        ‚úÖ Dimension collective ("nous", "ensemble")<br>
                        ‚úÖ Perspective positive (leader, d√©veloppement durable)
                    </div>
                </div>

                <button class="btn btn-indice" onclick="afficherIndice(5)">üí° Aide r√©daction</button>
                <div class="indice-container" id="indice5">
                    <strong>üí° INDICE :</strong> Structure : 1) Annonce succ√®s 2) Chiffres cl√©s 3) Solutions 4) B√©n√©fices. Utilisez "√©missions CO‚ÇÇ", "transition √©nerg√©tique" !
                </div>
            </div>
        </div>

        <!-- √âCRAN DE SUCC√àS -->
        <div class="succes-container" id="succes-final">
            <h2>üéâ MISSION R√âUSSIE !</h2>
            <div class="score-final" id="score-temps">42:33</div>
            <p style="font-size: 1.4rem; margin: 20px 0;">
                F√âLICITATIONS ! Vous avez sauv√© ECOTECH Industries de la crise climatique !
            </p>
            
            <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 10px; margin: 20px 0; text-align: left;">
                <h4>üèÜ R√âSULTATS DE VOTRE MISSION :</h4>
                <ul style="margin: 10px 0; padding-left: 20px;">
                    <li>‚úÖ <strong>Objectif -40% CO‚ÇÇ ATTEINT</strong> (948 tonnes √©conomis√©es)</li>
                    <li>‚úÖ <strong>Budget respect√©</strong> (750 000‚Ç¨ sur 800 000‚Ç¨ disponibles)</li>
                    <li>‚úÖ <strong>Planning optimis√©</strong> (9 mois au lieu de 12)</li>
                    <li>‚úÖ <strong>15 millions ‚Ç¨ de contrats sauv√©s</strong></li>
                    <li>‚úÖ <strong>Leadership d√©veloppement durable</strong> acquis</li>
                </ul>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 20px 0;">
                <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px;">
                    <div style="font-size: 2rem;">üìä</div>
                    <div><strong>C1-C2</strong></div>
                    <div id="score-analyse">95%</div>
                </div>
                <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px;">
                    <div style="font-size: 2rem;">üåç</div>
                    <div><strong>C3</strong></div>
                    <div id="score-climat">90%</div>
                </div>
                <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px;">
                    <div style="font-size: 2rem;">üéØ</div>
                    <div><strong>C4-C5</strong></div>
                    <div id="score-solutions">88%</div>
                </div>
                <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px;">
                    <div style="font-size: 2rem;">üí¨</div>
                    <div><strong>C6</strong></div>
                    <div id="score-communication">92%</div>
                </div>
            </div>

            <div style="background: rgba(255,255,255,0.3); padding: 20px; border-radius: 10px; margin: 20px 0; text-align: left;">
                <h4>üéØ Bilan pr√©paration √©preuve Bac Pro</h4>
                <p style="margin-bottom: 15px;"><strong>Vous ma√Ætrisez parfaitement :</strong></p>
                <ul style="margin: 10px 0; padding-left: 20px;">
                    <li>‚úÖ Analyse rapide de situations d'urgence √©nerg√©tique</li>
                    <li>‚úÖ Calculs d'√©conomies CO‚ÇÇ et budg√©taires</li>
                    <li>‚úÖ Lien √©nergie-climat-√©conomie</li>
                    <li>‚úÖ Planification strat√©gique sous contraintes</li>
                    <li>‚úÖ Communication professionnelle de crise</li>
                </ul>
                <p style="margin-top: 15px; color: #2d3436; background: rgba(255,255,255,0.5); padding: 10px; border-radius: 5px;">
                    <strong>üöÄ Pour l'√©preuve :</strong> Vous avez d√©velopp√© les r√©flexes d'analyse rapide et de solution efficace. Continuez √† vous entra√Æner sur la gestion du temps et la priorisation !
                </p>
            </div>

            <button class="btn btn-urgent" onclick="recommencerEscape()">üîÑ Nouvelle mission d'urgence</button>
            <button class="btn" style="background: #74b9ff; color: white;" onclick="window.print()">üñ®Ô∏è Certificat de mission</button>
        </div>

        <!-- √âCRAN D'√âCHEC -->
        <div class="echec-container" id="echec-final">
            <h2>‚è∞ TEMPS √âCOUL√â !</h2>
            <div class="score-final" style="color: #fdcb6e;">00:00</div>
            <p style="font-size: 1.4rem; margin: 20px 0;">
                La crise climatique a eu raison d'ECOTECH... Mais vous pouvez encore sauver l'entreprise !
            </p>
            
            <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 10px; margin: 20px 0;">
                <h4>üìã Ce que vous avez appris :</h4>
                <p>M√™me en cas d'√©chec, votre parcours a permis de r√©viser les concepts √©nerg√©tiques essentiels. 
                La gestion de crise climatique demande rapidit√© ET pr√©cision !</p>
            </div>

            <button class="btn btn-urgent" onclick="recommencerEscape()">üîÑ Nouvelle tentative de sauvetage</button>
        </div>

        <!-- FOOTER RGPD OBLIGATOIRE -->
        <div class="rgpd-footer">
            üîí Conformit√© RGPD : Cet exercice respecte votre anonymat.
        </div>
    </div>

    <script>
        // Variables globales de l'escape game
        let tempsRestant = 45 * 60; // 45 minutes en secondes
        let enigmeActuelle = 1;
        let enigmesResolues = 0;
        let chronoActif = true;
        let scores = {
            analyse: 0,
            climat: 0,
            solutions: 0,
            communication: 0
        };

        // D√©marrage du chronom√®tre
        function demarrerChrono() {
            const chronoInterval = setInterval(() => {
                if (!chronoActif) {
                    clearInterval(chronoInterval);
                    return;
                }
                
                tempsRestant--;
                
                const minutes = Math.floor(tempsRestant / 60);
                const secondes = tempsRestant % 60;
                const affichage = `${minutes.toString().padStart(2, '0')}:${secondes.toString().padStart(2, '0')}`;
                
                document.getElementById('chrono-display').textContent = affichage;
                
                // Changement de couleur selon urgence
                if (tempsRestant <= 300) { // 5 derni√®res minutes
                    document.getElementById('chrono-display').className = 'chrono-display chrono-urgent';
                    document.getElementById('chrono-status').innerHTML = 'üö® ALERTE ROUGE - TEMPS CRITIQUE !';
                } else if (tempsRestant <= 900) { // 15 derni√®res minutes
                    document.getElementById('chrono-status').innerHTML = '‚ö†Ô∏è ATTENTION - ACC√âL√âREZ LE RYTHME !';
                }
                
                // Fin du temps
                if (tempsRestant <= 0) {
                    clearInterval(chronoInterval);
                    afficherEchec();
                }
            }, 1000);
        }

        // Fonction de r√©ponse aux √©nigmes avec correction explicite
        function repondreEnigme(numeroEnigme, reponse, correct) {
            const correctionElement = document.getElementById(`correction${numeroEnigme}`);
            const reponseCards = document.querySelectorAll(`#enigme${numeroEnigme} .reponse-card`);
            
            // D√©sactiver toutes les cartes
            reponseCards.forEach(card => {
                card.style.pointerEvents = 'none';
            });
            
            // Marquer TOUTES les r√©ponses visuellement
            const bonnesReponses = {
                1: 0, // Premi√®re carte = bonne r√©ponse
                2: 1, // Deuxi√®me carte = bonne r√©ponse  
                3: 1, // Deuxi√®me carte = bonne r√©ponse
                4: null, // G√©r√©e diff√©remment
                5: null // G√©r√©e diff√©remment
            };
            
            if (numeroEnigme <= 3) {
                reponseCards.forEach((card, index) => {
                    if (index === bonnesReponses[numeroEnigme]) {
                        card.classList.add('correct');
                    } else {
                        card.classList.add('incorrect');
                    }
                });
            }
            
            if (correct) {
                enigmesResolues++;
                
                // Scores par comp√©tence
                if (numeroEnigme === 1) scores.analyse = 95;
                if (numeroEnigme === 2) scores.analyse = Math.max(scores.analyse, 90);
                if (numeroEnigme === 3) scores.climat = 90;
                if (numeroEnigme === 4) scores.solutions = 88;
                if (numeroEnigme === 5) scores.communication = 85;
                
                setTimeout(() => {
                    debloquerEnigmeSuivante(numeroEnigme);
                    mettreAJourProgression();
                }, 1500);
                
            } else {
                correctionElement.style.display = 'block';
                
                // Scores r√©duits en cas d'erreur
                if (numeroEnigme === 1) scores.analyse = 75;
                if (numeroEnigme === 2) scores.analyse = Math.max(scores.analyse, 70);
                if (numeroEnigme === 3) scores.climat = 70;
                
                setTimeout(() => {
                    debloquerEnigmeSuivante(numeroEnigme);
                    mettreAJourProgression();
                }, 3000);
            }
        }

        // Validation de la priorisation (√ânigme 4)
        function validerPriorisation() {
            const priorites = {
                flotte: parseInt(document.getElementById('priorite-flotte').value) || 0,
                formation: parseInt(document.getElementById('priorite-formation').value) || 0,
                machines: parseInt(document.getElementById('priorite-machines').value) || 0,
                isolation: parseInt(document.getElementById('priorite-isolation').value) || 0
            };

            const correctionElement = document.getElementById('correction4');
            const bonnePriorisation = priorites.isolation === 1 && priorites.machines === 2 && 
                                   priorites.flotte === 3 && priorites.formation === 4;

            // D√©sactiver tous les selects
            Object.keys(priorites).forEach(type => {
                document.getElementById(`priorite-${type}`).disabled = true;
            });

            // Marquer visuellement les r√©ponses
            const actionCards = document.querySelectorAll('.action-priorite');
            const bonnesPositions = [3, 4, 2, 1]; // flotte, formation, machines, isolation
            
            actionCards.forEach((card, index) => {
                const prioriteChoisie = Object.values(priorites)[index];
                if (prioriteChoisie === bonnesPositions[index]) {
                    card.style.background = '#d4edda';
                    card.style.borderColor = '#28a745';
                    card.style.borderWidth = '3px';
                } else {
                    card.style.background = '#f8d7da';
                    card.style.borderColor = '#dc3545';
                    card.style.borderWidth = '3px';
                }
            });

            if (bonnePriorisation) {
                scores.solutions = 90;
                setTimeout(() => {
                    debloquerEnigmeSuivante(4);
                    mettreAJourProgression();
                }, 1500);
            } else {
                scores.solutions = 65;
                correctionElement.style.display = 'block';
                setTimeout(() => {
                    debloquerEnigmeSuivante(4);
                    mettreAJourProgression();
                }, 3000);
            }
        }

        // Analyse de la communication (√ânigme 5)
        function analyserCommunication() {
            const texte = document.getElementById('message-victoire').value.toLowerCase();
            const motsCles = [
                '√©missions', 'co2', 'carbone', 'transition √©nerg√©tique', 'd√©veloppement durable',
                'climatique', '√©nergie', '40%', '960', 'isolation', 'machines', 'flotte'
            ];
            
            let score = 60; // Base
            let motsPresents = [];
            
            motsCles.forEach(mot => {
                if (texte.includes(mot)) {
                    score += 5;
                    if (!motsPresents.includes(mot)) motsPresents.push(mot);
                }
            });
            
            // Bonus structure
            if (texte.length > 150 && texte.length < 400) score += 10;
            if (texte.includes('mission') || texte.includes('r√©ussi') || texte.includes('accomplie')) score += 10;
            
            scores.communication = Math.min(100, score);
            
            const correctionElement = document.getElementById('correction5');
            
            if (score >= 85) {
                setTimeout(() => {
                    terminerEscape();
                }, 2000);
            } else {
                correctionElement.style.display = 'block';
                setTimeout(() => {
                    terminerEscape();
                }, 4000);
            }
        }

        // Gestion des indices
        function afficherIndice(numero) {
            document.getElementById(`indice${numero}`).classList.add('visible');
        }

        // D√©bloquer l'√©nigme suivante
        function debloquerEnigmeSuivante(numeroActuel) {
            enigmeActuelle = numeroActuel + 1;
            
            if (numeroActuel < 5) {
                const enigmeSuivante = document.getElementById(`enigme${numeroActuel + 1}`);
                enigmeSuivante.classList.remove('locked');
                enigmeSuivante.classList.add('unlocked');
                
                // Scroll vers la nouvelle √©nigme
                setTimeout(() => {
                    enigmeSuivante.scrollIntoView({behavior: 'smooth', block: 'start'});
                }, 500);
            }
        }

        // Mise √† jour de la progression
        function mettreAJourProgression() {
            const pourcentage = (enigmesResolues / 5) * 100;
            const progressBar = document.getElementById('progression');
            progressBar.style.width = pourcentage + '%';
            progressBar.setAttribute('data-percent', Math.round(pourcentage) + '%');
        }

        // Fin de l'escape game - Succ√®s
        function terminerEscape() {
            chronoActif = false;
            enigmesResolues = 5;
            mettreAJourProgression();
            
            // Calcul du temps final
            const tempsEcoule = 45 * 60 - tempsRestant;
            const minutes = Math.floor(tempsEcoule / 60);
            const secondes = tempsEcoule % 60;
            const tempsAffichage = `${minutes.toString().padStart(2, '0')}:${secondes.toString().padStart(2, '0')}`;
            
            // Affichage du succ√®s
            document.getElementById('score-temps').textContent = tempsAffichage;
            document.getElementById('score-analyse').textContent = scores.analyse + '%';
            document.getElementById('score-climat').textContent = scores.climat + '%';
            document.getElementById('score-solutions').textContent = scores.solutions + '%';
            document.getElementById('score-communication').textContent = scores.communication + '%';
            
            document.getElementById('succes-final').style.display = 'block';
            document.getElementById('succes-final').scrollIntoView({behavior: 'smooth'});
        }

        // Fin de l'escape game - √âchec
        function afficherEchec() {
            chronoActif = false;
            document.getElementById('echec-final').style.display = 'block';
            document.getElementById('echec-final').scrollIntoView({behavior: 'smooth'});
        }

        // Recommencer l'escape game
        function recommencerEscape() {
            location.reload();
        }

        // Cr√©ation des particules d'ambiance
        function creerParticules() {
            const particlesContainer = document.getElementById('particles');
            
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.width = Math.random() * 4 + 2 + 'px';
                particle.style.height = particle.style.width;
                particle.style.animationDelay = Math.random() * 6 + 's';
                particle.style.animationDuration = (Math.random() * 4 + 4) + 's';
                
                particlesContainer.appendChild(particle);
            }
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üö® Escape Game Crise Climatique PSE charg√© !');
            
            // D√©marrer le chronom√®tre
            demarrerChrono();
            
            // Cr√©er l'ambiance visuelle
            creerParticules();
            
            // Animation d'entr√©e
            setTimeout(() => {
                document.querySelector('.escape-container').classList.add('fade-in');
            }, 500);
        });
    </script>
</body>
</html>