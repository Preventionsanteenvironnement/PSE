<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R√©vision C.11 - Analyse d'une Situation de Travail - Bac Pro Terminale</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
            transition: all 0.3s ease;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }
        
        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .btn-back {
            background: rgba(255,255,255,0.1);
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            border: 2px solid rgba(255,255,255,0.2);
            cursor: pointer;
        }
        
        .btn-back:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }
        
        .score-bar {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 50px;
        }
        
        .score-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .score-item .icon {
            font-size: 18px;
        }
        
        /* √âcrans */
        .screen {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .screen.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* √âcran d'accueil */
        .welcome-screen {
            text-align: center;
            padding: 30px 0;
        }
        
        .welcome-title {
            font-size: 42px;
            font-weight: 900;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .welcome-subtitle {
            font-size: 18px;
            color: rgba(255,255,255,0.7);
            margin-bottom: 30px;
        }
        
        /* Objectifs */
        .objectifs-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3));
            border: 2px solid rgba(102, 126, 234, 0.5);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            text-align: left;
        }
        
        .objectifs-card h3 {
            font-size: 18px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .objectif-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            font-size: 14px;
            line-height: 1.5;
        }
        
        .objectif-item:last-child {
            border-bottom: none;
        }
        
        .objectif-item .check {
            color: #4CAF50;
            font-size: 18px;
            flex-shrink: 0;
        }
        
        .competences-row {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .comp-badge {
            background: rgba(255,255,255,0.15);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
        }
        
        .comp-badge.c1 { background: rgba(16, 185, 129, 0.3); border: 1px solid #10b981; }
        .comp-badge.c2 { background: rgba(102, 126, 234, 0.3); border: 1px solid #667eea; }
        .comp-badge.c3 { background: rgba(245, 158, 11, 0.3); border: 1px solid #f59e0b; }
        .comp-badge.c4 { background: rgba(239, 68, 68, 0.3); border: 1px solid #ef4444; }
        .comp-badge.c5 { background: rgba(168, 85, 247, 0.3); border: 1px solid #a855f7; }
        .comp-badge.c6 { background: rgba(34, 197, 94, 0.3); border: 1px solid #22c55e; }
        
        /* Niveaux */
        .niveaux-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 25px;
        }
        
        .niveau-card {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .niveau-card:hover:not(.locked) {
            background: rgba(255,255,255,0.1);
            transform: translateX(5px);
            border-color: rgba(102, 126, 234, 0.5);
        }
        
        .niveau-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .niveau-card.completed {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }
        
        .niveau-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            flex-shrink: 0;
        }
        
        .niveau-card:nth-child(1) .niveau-icon { background: linear-gradient(135deg, #667eea, #764ba2); }
        .niveau-card:nth-child(2) .niveau-icon { background: linear-gradient(135deg, #f093fb, #f5576c); }
        .niveau-card:nth-child(3) .niveau-icon { background: linear-gradient(135deg, #4facfe, #00f2fe); }
        .niveau-card:nth-child(4) .niveau-icon { background: linear-gradient(135deg, #43e97b, #38f9d7); }
        .niveau-card:nth-child(5) .niveau-icon { background: linear-gradient(135deg, #fa709a, #fee140); }
        
        .niveau-info {
            flex: 1;
        }
        
        .niveau-info h4 {
            font-size: 16px;
            margin-bottom: 4px;
        }
        
        .niveau-info p {
            font-size: 12px;
            color: rgba(255,255,255,0.6);
        }
        
        .niveau-progress {
            width: 80px;
            text-align: right;
        }
        
        .niveau-progress .percent {
            font-size: 18px;
            font-weight: 700;
        }
        
        .progress-mini {
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .progress-mini-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        
        .lock-icon {
            font-size: 24px;
            color: rgba(255,255,255,0.3);
        }
        
        /* √âcran de jeu */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .game-title {
            font-size: 20px;
            font-weight: 700;
        }
        
        .game-progress {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-counter {
            font-size: 14px;
            color: rgba(255,255,255,0.7);
        }
        
        .progress-track {
            width: 200px;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 3px;
            transition: width 0.3s ease;
        }
        
        /* Carte */
        .flashcard {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            text-align: center;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .card-competence {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
        }
        
        .card-type {
            font-size: 12px;
            font-weight: 600;
            color: rgba(255,255,255,0.6);
        }
        
        /* Question */
        .question-text {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 25px;
            line-height: 1.4;
        }
        
        .highlight {
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }
        
        /* Input mot-cl√© */
        .keyword-input-container {
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
        }
        
        .keyword-input {
            width: 100%;
            padding: 20px;
            border: 3px solid rgba(255,255,255,0.2);
            border-radius: 15px;
            background: rgba(255,255,255,0.05);
            color: white;
            font-size: 18px;
            font-weight: 600;
            text-align: center;
            transition: all 0.3s ease;
            margin-bottom: 15px;
        }
        
        .keyword-input:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }
        
        .keyword-input::placeholder {
            color: rgba(255,255,255,0.3);
            font-weight: 400;
        }
        
        .hint-text {
            font-size: 14px;
            color: rgba(255,255,255,0.5);
        }
        
        .hint-text strong {
            color: #764ba2;
        }
        
        /* Options QCM */
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
        }
        
        .option-btn {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.15);
            border-radius: 12px;
            padding: 16px 20px;
            color: white;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .option-btn:hover {
            background: rgba(102, 126, 234, 0.2);
            border-color: rgba(102, 126, 234, 0.5);
            transform: translateX(5px);
        }
        
        .option-btn.selected {
            background: rgba(102, 126, 234, 0.3);
            border-color: #667eea;
        }
        
        .option-btn.correct {
            background: rgba(76, 175, 80, 0.3);
            border-color: #4CAF50;
        }
        
        .option-btn.incorrect {
            background: rgba(244, 67, 54, 0.3);
            border-color: #f44336;
        }
        
        .option-letter {
            width: 30px;
            height: 30px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            flex-shrink: 0;
        }
        
        /* Vrai/Faux */
        .vf-container {
            display: flex;
            gap: 20px;
            justify-content: center;
        }
        
        .vf-btn {
            width: 140px;
            height: 80px;
            border-radius: 15px;
            border: 3px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.05);
            color: white;
            font-size: 20px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .vf-btn:hover {
            transform: scale(1.05);
        }
        
        .vf-btn.vrai:hover { background: rgba(76, 175, 80, 0.3); border-color: #4CAF50; }
        .vf-btn.faux:hover { background: rgba(244, 67, 54, 0.3); border-color: #f44336; }
        
        .vf-btn.selected.vrai { background: rgba(76, 175, 80, 0.3); border-color: #4CAF50; }
        .vf-btn.selected.faux { background: rgba(244, 67, 54, 0.3); border-color: #f44336; }
        
        /* Boutons action */
        .action-row {
            display: flex;
            gap: 12px;
            margin-top: 25px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 14px 30px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 2px solid rgba(255,255,255,0.2);
        }
        
        .btn-secondary:hover {
            background: rgba(255,255,255,0.15);
        }
        
        .btn-hint {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
            border: 2px solid rgba(245, 158, 11, 0.3);
        }
        
        .btn-hint:hover {
            background: rgba(245, 158, 11, 0.3);
        }
        
        /* Feedback - FOND OPAQUE OBLIGATOIRE */
        .feedback-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .feedback-overlay.visible {
            display: flex;
            animation: fadeIn 0.3s ease;
        }
        
        .feedback-card {
            background: linear-gradient(135deg, #2a2a3e, #1e1e2f);
            border-radius: 25px;
            padding: 35px;
            max-width: 500px;
            width: 100%;
            text-align: center;
            border: 3px solid;
            color: white;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }
        
        .feedback-card.correct {
            border-color: #4CAF50;
        }
        
        .feedback-card.incorrect {
            border-color: #f44336;
        }
        
        .feedback-icon {
            font-size: 60px;
            margin-bottom: 20px;
        }
        
        .feedback-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 15px;
        }
        
        .feedback-explanation {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            font-size: 16px;
            line-height: 1.5;
        }
        
        .feedback-keyword {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            font-weight: 700;
            margin: 15px 0;
            display: inline-block;
        }
        
        .feedback-tip {
            font-size: 14px;
            color: rgba(255,255,255,0.7);
            font-style: italic;
            margin-top: 15px;
        }
        
        /* √âcran r√©sultats */
        .results-screen {
            text-align: center;
            padding: 30px 0;
        }
        
        .results-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 20px;
        }
        
        .results-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: #4CAF50;
        }
        
        .stat-label {
            font-size: 12px;
            color: rgba(255,255,255,0.6);
            margin-top: 5px;
        }
        
        .errors-section {
            background: rgba(244, 67, 54, 0.1);
            border: 2px solid rgba(244, 67, 54, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
        }
        
        .errors-section h4 {
            color: #f44336;
            margin-bottom: 15px;
        }
        
        .error-item {
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            font-size: 14px;
        }
        
        .error-item:last-child {
            border-bottom: none;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 15px; }
            .welcome-title { font-size: 28px; }
            .question-text { font-size: 18px; }
            .flashcard { padding: 20px; min-height: 300px; }
            .vf-container { flex-direction: column; align-items: center; }
            .vf-btn { width: 200px; }
            .progress-track { width: 100px; }
            .btn { padding: 12px 20px; font-size: 14px; }
            .feedback-card { padding: 25px; }
            .niveau-card { padding: 15px; }
        }
        
        @media (max-width: 480px) {
            .welcome-title { font-size: 24px; }
            .flashcard { padding: 15px; }
            .feedback-card { padding: 20px; }
        }
        
        .font-dyslexie {
            font-family: 'OpenDyslexic', sans-serif;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- √âcran d'accueil -->
        <div id="homeScreen" class="screen active">
            <div class="header">
                <a href="#" class="btn-back">üè† Menu Principal</a>
                <div class="score-bar">
                    <div class="score-item">
                        <span class="icon">üéØ</span>
                        <span id="totalScore">0</span>
                    </div>
                    <div class="score-item">
                        <span class="icon">‚≠ê</span>
                        <span id="totalStars">0</span>
                    </div>
                </div>
            </div>
            
            <div class="welcome-screen">
                <h1 class="welcome-title">Flashcards C.11</h1>
                <p class="welcome-subtitle">Analyse d'une situation de travail</p>
                
                <!-- Objectifs p√©dagogiques -->
                <div class="objectifs-card">
                    <h3>üéØ Objectifs du Module C.11</h3>
                    <div class="objectif-item">
                        <span class="check">‚úì</span>
                        <div>
                            <strong>R√©pertorier les composantes</strong> d'une situation de travail avec probl√©matique d'activit√© physique<br>
                            <em>D√©terminants, travail prescrit/r√©el, t√¢ches/activit√©s, ergonomie, effets</em>
                        </div>
                    </div>
                    <div class="objectif-item">
                        <span class="check">‚úì</span>
                        <div>
                            <strong>Mettre en √©vidence les relations causales</strong> entre effets constat√©s et facteurs<br>
                            <em>Causalit√© multifactorielle, liens d√©terminants ‚Üî effets</em>
                        </div>
                    </div>
                    <div class="objectif-item">
                        <span class="check">‚úì</span>
                        <div>
                            <strong>Proposer des mesures de pr√©vention</strong> visant suppression/r√©duction du risque<br>
                            <em>Hi√©rarchie : suppression > protection collective > EPI > formation</em>
                        </div>
                    </div>
                    <div class="competences-row">
                        <span class="comp-badge c1">C1</span>
                        <span class="comp-badge c2">C2</span>
                        <span class="comp-badge c3">C3</span>
                        <span class="comp-badge c4">C4</span>
                        <span class="comp-badge c5">C5</span>
                        <span class="comp-badge c6">C6</span>
                    </div>
                </div>
                
                <!-- Niveaux -->
                <div class="niveaux-grid">
                    <div class="niveau-card" onclick="startLevel(1)">
                        <div class="niveau-icon">üìä</div>
                        <div class="niveau-info">
                            <h4>Niveau 1 : Composantes de la Situation</h4>
                            <p>D√©terminants, travail prescrit/r√©el, t√¢ches/activit√©s, ergonomie</p>
                        </div>
                        <div class="niveau-progress">
                            <div class="percent" id="level1Percent">0%</div>
                            <div class="progress-mini">
                                <div class="progress-mini-fill" id="level1Progress"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="niveau-card" onclick="startLevel(2)">
                        <div class="niveau-icon">üîó</div>
                        <div class="niveau-info">
                            <h4>Niveau 2 : Relations Causales</h4>
                            <p>Causalit√© multifactorielle, liens cause-effet, hypoth√®ses</p>
                        </div>
                        <div class="niveau-progress">
                            <div class="percent" id="level2Percent">0%</div>
                            <div class="progress-mini">
                                <div class="progress-mini-fill" id="level2Progress"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="niveau-card" onclick="startLevel(3)">
                        <div class="niveau-icon">üõ°Ô∏è</div>
                        <div class="niveau-info">
                            <h4>Niveau 3 : Mesures de Pr√©vention</h4>
                            <p>Hi√©rarchie pr√©vention, suppression, protection, formation</p>
                        </div>
                        <div class="niveau-progress">
                            <div class="percent" id="level3Percent">0%</div>
                            <div class="progress-mini">
                                <div class="progress-mini-fill" id="level3Progress"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="niveau-card" onclick="startLevel(4)">
                        <div class="niveau-icon">‚ö°</div>
                        <div class="niveau-info">
                            <h4>Niveau 4 : Cas Professionnels</h4>
                            <p>Applications sectorielles, analyse compl√®te, solutions</p>
                        </div>
                        <div class="niveau-progress">
                            <div class="percent" id="level4Percent">0%</div>
                            <div class="progress-mini">
                                <div class="progress-mini-fill" id="level4Progress"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="niveau-card" onclick="startLevel(5)">
                        <div class="niveau-icon">üèÜ</div>
                        <div class="niveau-info">
                            <h4>Niveau 5 : Quiz Final Expert</h4>
                            <p>R√©vision compl√®te module - Pr√©paration √©preuve</p>
                        </div>
                        <div class="niveau-progress">
                            <div class="percent" id="level5Percent">0%</div>
                            <div class="progress-mini">
                                <div class="progress-mini-fill" id="level5Progress"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- √âcran de jeu -->
        <div id="gameScreen" class="screen">
            <div class="header">
                <a href="#" class="btn-back" onclick="goHome()">‚Üê Retour</a>
                <div class="score-bar">
                    <div class="score-item">
                        <span class="icon">üéØ</span>
                        <span id="currentScore">0</span>
                    </div>
                    <div class="score-item">
                        <span class="icon">‚≠ê</span>
                        <span id="currentStars">0</span>
                    </div>
                </div>
            </div>
            
            <div class="game-header">
                <h2 class="game-title" id="levelTitle">Niveau 1</h2>
                <div class="game-progress">
                    <span class="card-counter"><span id="currentCard">1</span>/<span id="totalCards">10</span></span>
                    <div class="progress-track">
                        <div class="progress-fill" id="gameProgress"></div>
                    </div>
                </div>
            </div>
            
            <!-- Carte -->
            <div class="flashcard">
                <div class="card-header">
                    <span class="card-competence comp-badge c1" id="cardCompetence">C1</span>
                    <span class="card-type" id="cardType">MOT-CL√â</span>
                </div>
                
                <div id="questionSection">
                    <!-- Contenu dynamique -->
                </div>
                
                <div class="action-row">
                    <button class="btn btn-hint" onclick="showHint()">üí° Indice</button>
                    <button class="btn btn-primary" onclick="validateAnswer()">‚úì Valider</button>
                    <button class="btn btn-secondary" onclick="skipCard()">‚è≠Ô∏è Passer</button>
                </div>
            </div>
        </div>
        
        <!-- √âcran r√©sultats -->
        <div id="resultsScreen" class="screen">
            <div class="header">
                <a href="#" class="btn-back" onclick="goHome()">üè† Menu</a>
                <div class="score-bar">
                    <div class="score-item">
                        <span class="icon">üéØ</span>
                        <span id="finalScore">0</span>
                    </div>
                    <div class="score-item">
                        <span class="icon">‚≠ê</span>
                        <span id="finalStars">0</span>
                    </div>
                </div>
            </div>
            
            <div class="results-screen">
                <h2 class="results-title" id="resultsTitle">Niveau Termin√© !</h2>
                
                <div class="results-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="correctCount">0</div>
                        <div class="stat-label">Bonnes r√©ponses</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="pointsEarned">0</div>
                        <div class="stat-label">Points gagn√©s</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="successRate">0%</div>
                        <div class="stat-label">Taux de r√©ussite</div>
                    </div>
                </div>
                
                <div id="errorsSection" class="errors-section" style="display: none;">
                    <h4>üìö Points √† revoir</h4>
                    <div id="errorsList"></div>
                </div>
                
                <div class="action-row">
                    <button class="btn btn-primary" onclick="retryLevel()">üîÑ Recommencer</button>
                    <button class="btn btn-secondary" onclick="goHome()">üè† Menu Principal</button>
                    <button class="btn btn-secondary" onclick="nextLevel()">‚û°Ô∏è Niveau Suivant</button>
                </div>
            </div>
        </div>
        
        <!-- Overlay feedback - FOND OPAQUE -->
        <div class="feedback-overlay" id="feedbackOverlay">
            <div class="feedback-card" id="feedbackCard">
                <div class="feedback-icon" id="feedbackIcon">‚úÖ</div>
                <h3 class="feedback-title" id="feedbackTitle">Bravo !</h3>
                <div class="feedback-explanation" id="feedbackExplanation"></div>
                <div class="feedback-keyword" id="feedbackKeyword"></div>
                <div class="feedback-tip" id="feedbackTip"></div>
                <div class="action-row">
                    <button class="btn btn-primary" onclick="closeFeedback()">Continuer</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // === VARIABLES GLOBALES ===
        let currentLevel = 1;
        let currentCardIndex = 0;
        let levelCorrect = 0;
        let levelPoints = 0;
        let levelErrors = [];
        let totalScore = localStorage.getItem('c11_score') || 0;
        let totalStars = localStorage.getItem('c11_stars') || 0;
        let hintUsed = false;
        
        // Progression par niveau
        let levelProgress = {
            1: JSON.parse(localStorage.getItem('c11_level1')) || { completed: false, score: 0, stars: 0 },
            2: JSON.parse(localStorage.getItem('c11_level2')) || { completed: false, score: 0, stars: 0 },
            3: JSON.parse(localStorage.getItem('c11_level3')) || { completed: false, score: 0, stars: 0 },
            4: JSON.parse(localStorage.getItem('c11_level4')) || { completed: false, score: 0, stars: 0 },
            5: JSON.parse(localStorage.getItem('c11_level5')) || { completed: false, score: 0, stars: 0 }
        };
        
        // === DONN√âES FLASHCARDS ===
        const levels = {
            1: { // Composantes de la situation
                title: "Niveau 1 : Composantes de la Situation",
                competence: "C1-C2",
                cards: [
                    {
                        type: "keyword",
                        question: "Nom de la science qui √©tudie l'adaptation du <span class='highlight'>travail √† l'homme</span> ?",
                        answer: "ergonomie",
                        hint: "Ergo _ _ _ _ _ _",
                        explanation: "ERGONOMIE = science de l'adaptation du travail √† l'homme (et non l'inverse). Objectif : pr√©vention primaire des risques professionnels.",
                        keyword: "Ergonomie = travail adapt√© √† l'homme",
                        tip: "Vient du grec 'ergon' (travail) + 'nomos' (lois). Lois du travail humain."
                    },
                    {
                        type: "qcm",
                        question: "Quels √©l√©ments appartiennent aux <span class='highlight'>d√©terminants op√©rateur</span> ?",
                        options: [
                            "√Çge, formation, exp√©rience personnelle",
                            "√âquipements, cadence, temp√©rature",
                            "Machines, proc√©dures, horaires",
                            "Organisation, environnement, management"
                        ],
                        answer: 0,
                        explanation: "D√âTERMINANTS OP√âRATEUR = caract√©ristiques intrins√®ques de la personne : √¢ge, formation, exp√©rience, √©tat de sant√©, morphologie.",
                        keyword: "Op√©rateur = intrins√®que √† la personne",
                        tip: "Si √ßa appartient √† la personne ‚Üí op√©rateur. Si fourni par l'entreprise ‚Üí entreprise."
                    },
                    {
                        type: "vf",
                        question: "Le <span class='highlight'>travail prescrit</span> correspond exactement au travail r√©ellement effectu√©.",
                        answer: false,
                        explanation: "FAUX ! Travail prescrit = mission officielle (fiche de poste). Travail r√©el = ce qui est vraiment fait. Il y a toujours un √âCART √† analyser.",
                        keyword: "Prescrit ‚â† R√©el = √âcart √† analyser",
                        tip: "L'√©cart prescrit/r√©el est normal et source d'adaptation humaine."
                    },
                    {
                        type: "keyword",
                        question: "Comment appelle-t-on les <span class='highlight'>cons√©quences observables</span> d'une situation de travail ?",
                        answer: "effets",
                        hint: "E _ _ _ _ _",
                        explanation: "EFFETS = cons√©quences observables sur l'op√©rateur ET l'entreprise. Peuvent √™tre positifs (b√©n√©fiques) ou n√©gatifs (pr√©judiciables).",
                        keyword: "Effets = cons√©quences observables",
                        tip: "Toujours analyser effets sur 2 dimensions : op√©rateur ET entreprise."
                    },
                    {
                        type: "qcm",
                        question: "Diff√©rence entre <span class='highlight'>t√¢che et activit√©</span> ?",
                        options: [
                            "T√¢che = ce qu'il faut faire, Activit√© = comment on le fait",
                            "T√¢che = travail facile, Activit√© = travail difficile",
                            "T√¢che = objectif, Activit√© = r√©sultat",
                            "Aucune diff√©rence, c'est synonyme"
                        ],
                        answer: 0,
                        explanation: "T√ÇCHE = ce qu'il faut faire (objectif). ACTIVIT√â = comment la personne s'y prend r√©ellement (postures, gestes, strat√©gies).",
                        keyword: "T√¢che = quoi / Activit√© = comment",
                        tip: "Activit√© r√©v√®le l'adaptation humaine aux contraintes de la t√¢che."
                    },
                    {
                        type: "keyword",
                        question: "Facteurs qui influencent une situation de travail : les <span class='highlight'>d√©terminants</span>...",
                        answer: "entreprise",
                        hint: "D√©terminants e _ _ _ _ _ _ _ _ _",
                        explanation: "D√âTERMINANTS ENTREPRISE = facteurs fournis par l'organisation : √©quipements, environnement, formation, proc√©dures, cadence...",
                        keyword: "Entreprise = fourni par l'organisation",
                        tip: "D√©terminants entreprise = tout ce que l'employeur peut modifier."
                    },
                    {
                        type: "vf",
                        question: "L'<span class='highlight'>ergonomie</span> intervient apr√®s les accidents pour les analyser.",
                        answer: false,
                        explanation: "FAUX ! Ergonomie = PR√âVENTION PRIMAIRE. Intervention AVANT probl√®mes pour concevoir situations de travail s√ªres et efficaces.",
                        keyword: "Ergonomie = pr√©vention AVANT",
                        tip: "Ergonomie prospective vs ergonomie corrective (post-incident)."
                    },
                    {
                        type: "qcm",
                        question: "Exemples d'<span class='highlight'>effets positifs</span> sur l'op√©rateur ?",
                        options: [
                            "Douleurs, fatigue, stress",
                            "Apprentissage, satisfaction, d√©veloppement",
                            "Accidents, maladies professionnelles",
                            "Absent√©isme, turnover, conflits"
                        ],
                        answer: 1,
                        explanation: "EFFETS POSITIFS OP√âRATEUR = apprentissage, satisfaction au travail, d√©veloppement des comp√©tences, reconnaissance, √©panouissement.",
                        keyword: "Positif op√©rateur = d√©veloppement",
                        tip: "Travail peut √™tre source d'√©panouissement si bien con√ßu."
                    },
                    {
                        type: "keyword",
                        question: "M√©thode d'analyse syst√©matique : <span class='highlight'>QQ</span>OQCP ?",
                        answer: "qui quoi",
                        hint: "_ _ _ ? _ _ _ _ ?",
                        explanation: "QQOQCP = Qui ? Quoi ? O√π ? Quand ? Comment ? Pourquoi ? M√©thode exhaustive d'analyse de situation.",
                        keyword: "QQOQCP = analyse exhaustive",
                        tip: "6 questions pour ne rien oublier dans l'analyse ergonomique."
                    },
                    {
                        type: "vf",
                        question: "Les <span class='highlight'>d√©terminants</span> n'influencent pas les effets constat√©s.",
                        answer: false,
                        explanation: "FAUX ! D√©terminants (op√©rateur + entreprise) ‚Üí conditionnent le travail r√©el ‚Üí g√©n√®rent les effets observ√©s. Relation causale directe.",
                        keyword: "D√©terminants ‚Üí Effets = causalit√©",
                        tip: "Modifier d√©terminants = modifier effets (principe pr√©vention)."
                    }
                ]
            },
            2: { // Relations causales
                title: "Niveau 2 : Relations Causales",
                competence: "C2-C3",
                cards: [
                    {
                        type: "keyword",
                        question: "Nature des liens entre plusieurs <span class='highlight'>causes</span> et un effet ?",
                        answer: "multifactoriel",
                        hint: "Multi _ _ _ _ _ _ _ _ _",
                        explanation: "MULTIFACTORIEL = plusieurs d√©terminants convergent vers m√™me effet. TMS = r√©p√©titivit√© √ó efforts √ó postures √ó temps d'exposition.",
                        keyword: "Multifactoriel = plusieurs causes convergent",
                        tip: "Suppression 1 seul facteur peut suffire √† r√©duire le risque."
                    },
                    {
                        type: "qcm",
                        question: "Que met en √©vidence le <span class='highlight'>sch√©ma de compr√©hension</span> ?",
                        options: [
                            "Seulement les accidents survenus",
                            "L'organisation hi√©rarchique de l'entreprise",
                            "Les relations entre d√©terminants, travail r√©el et effets",
                            "Les salaires et conditions contractuelles"
                        ],
                        answer: 2,
                        explanation: "SCH√âMA DE COMPR√âHENSION = outil visuel montrant les liens causaux entre tous les √©l√©ments : d√©terminants ‚Üí travail r√©el ‚Üí effets.",
                        keyword: "Sch√©ma = liens causaux visuels",
                        tip: "Comme une 'carte d'identit√©' compl√®te de la situation de travail."
                    },
                    {
                        type: "vf",
                        question: "Les <span class='highlight'>TMS</span> ont toujours une seule cause identifiable.",
                        answer: false,
                        explanation: "FAUX ! TMS = troubles MULTIFACTORIELS. Combinaison r√©p√©titivit√© + efforts + contraintes posturales + facteurs individuels et organisationnels.",
                        keyword: "TMS = multifactoriels toujours",
                        tip: "Jamais 1 seule cause pour les TMS, toujours un 'cocktail' de facteurs."
                    },
                    {
                        type: "keyword",
                        question: "Relation de <span class='highlight'>cause √† effet</span> entre d√©terminants et cons√©quences ?",
                        answer: "causalit√©",
                        hint: "Cau _ _ _ _ _ _",
                        explanation: "CAUSALIT√â = lien logique cause ‚Üí effet. D√©terminants d√©favorables ‚Üí contraintes travail r√©el ‚Üí effets n√©gatifs observ√©s.",
                        keyword: "Causalit√© = cause ‚Üí effet",
                        tip: "Identifier causalit√© = cibler interventions de pr√©vention efficaces."
                    },
                    {
                        type: "qcm",
                        question: "Structure d'une <span class='highlight'>hypoth√®se causale</span> ?",
                        options: [
                            "Probl√®me ‚Üí Solution ‚Üí R√©sultat",
                            "Il semble que [causes] ‚Üí am√®nent [modalit√©s] ‚Üí ce qui entra√Æne [effets]",
                            "Avant ‚Üí Pendant ‚Üí Apr√®s",
                            "Qui ‚Üí Quoi ‚Üí O√π ‚Üí Quand"
                        ],
                        answer: 1,
                        explanation: "HYPOTH√àSE CAUSALE = 'Il semble que [d√©terminants] ‚Üí am√®nent [travail r√©el] ‚Üí ce qui entra√Æne [effets]'. Structure m√©thodologique.",
                        keyword: "Hypoth√®se = Il semble que ‚Üí am√®nent ‚Üí entra√Æne",
                        tip: "Structure 'Si... alors...' de raisonnement ergonomique."
                    },
                    {
                        type: "vf",
                        question: "Un m√™me <span class='highlight'>d√©terminant</span> peut g√©n√©rer plusieurs effets diff√©rents.",
                        answer: true,
                        explanation: "VRAI ! Ex : cadence √©lev√©e ‚Üí fatigue + stress + erreurs + TMS + d√©motivation. Un d√©terminant peut avoir effets multiples.",
                        keyword: "1 d√©terminant ‚Üí effets multiples",
                        tip: "Analyser TOUS les effets possibles d'un m√™me d√©terminant."
                    },
                    {
                        type: "keyword",
                        question: "M√©canisme des <span class='highlight'>TMS</span> : r√©p√©titivit√© + efforts + postures + ?",
                        answer: "temps",
                        hint: "T _ _ _ _",
                        explanation: "TMS = R√©p√©titivit√© √ó Efforts √ó Postures contraignantes √ó TEMPS d'exposition. √âquation du risque biom√©canique.",
                        keyword: "TMS = R √ó E √ó P √ó T",
                        tip: "4 facteurs multiplicateurs : r√©duire 1 seul peut diviser le risque."
                    },
                    {
                        type: "qcm",
                        question: "Pourquoi analyser les <span class='highlight'>liens de causalit√©</span> ?",
                        options: [
                            "Pour punir les responsables",
                            "Pour cibler les interventions de pr√©vention",
                            "Pour augmenter la production",
                            "Pour r√©duire les salaires"
                        ],
                        answer: 1,
                        explanation: "ANALYSER CAUSALIT√â = identifier o√π intervenir efficacement. Agir sur les CAUSES (d√©terminants) plut√¥t que sur les EFFETS.",
                        keyword: "Causalit√© ‚Üí pr√©vention cibl√©e",
                        tip: "Mieux vaut pr√©venir (causes) que gu√©rir (effets)."
                    },
                    {
                        type: "vf",
                        question: "Les <span class='highlight'>secteurs d'activit√©</span> diff√©rents ont des m√©canismes de TMS totalement diff√©rents.",
                        answer: false,
                        explanation: "FAUX ! M√©canismes biom√©caniques identiques : logistique, tertiaire, industrie... M√™me √©quation R√óE√óP√óT, contextes diff√©rents.",
                        keyword: "TMS = m√™mes m√©canismes tous secteurs",
                        tip: "Secteurs diff√©rents, biom√©canique humaine identique."
                    },
                    {
                        type: "keyword",
                        question: "Outil graphique organisant tous les √©l√©ments d'une situation : sch√©ma de ?",
                        answer: "compr√©hension",
                        hint: "Sch√©ma de c _ _ _ _ _ _ _ _ _ _ _",
                        explanation: "SCH√âMA DE COMPR√âHENSION = repr√©sentation visuelle compl√®te : d√©terminants, travail prescrit, activit√©s r√©elles, effets.",
                        keyword: "Sch√©ma compr√©hension = vue d'ensemble",
                        tip: "Comme un 'plan' de la situation de travail analys√©e."
                    }
                ]
            },
            3: { // Mesures de pr√©vention
                title: "Niveau 3 : Mesures de Pr√©vention",
                competence: "C4-C5",
                cards: [
                    {
                        type: "qcm",
                        question: "Hi√©rarchie des <span class='highlight'>mesures de pr√©vention</span> (par efficacit√©) ?",
                        options: [
                            "EPI > Formation > Protection collective > Suppression",
                            "Formation > EPI > Suppression > Protection collective",
                            "Suppression > R√©duction > Protection collective > EPI + Formation",
                            "Protection collective > EPI > Suppression > Formation"
                        ],
                        answer: 2,
                        explanation: "HI√âRARCHIE PR√âVENTION = 1) Suppression risque, 2) R√©duction risque, 3) Protection collective, 4) Protection individuelle + Formation.",
                        keyword: "Hi√©rarchie = Supprimer > R√©duire > Collectif > Individuel",
                        tip: "Plus on monte dans la hi√©rarchie, plus c'est efficace et durable."
                    },
                    {
                        type: "keyword",
                        question: "√âlimination compl√®te du <span class='highlight'>risque</span> √† la source ?",
                        answer: "suppression",
                        hint: "S _ _ _ _ _ _ _ _ _",
                        explanation: "SUPPRESSION RISQUE = √©limination totale du danger (automatisation, substitution produit, changement process). Mesure la plus efficace.",
                        keyword: "Suppression = √©limination totale",
                        tip: "Si on supprime le risque, plus besoin de protection !"
                    },
                    {
                        type: "vf",
                        question: "La <span class='highlight'>protection collective</span> est plus efficace que les EPI.",
                        answer: true,
                        explanation: "VRAI ! Protection collective prot√®ge TOUT LE MONDE automatiquement (aspiration, isolation...). EPI prot√®ge 1 seule personne si bien utilis√©.",
                        keyword: "Collectif > Individuel = √©vidence",
                        tip: "Principe n¬∞6 pr√©vention : collectif prioritaire sur individuel."
                    },
                    {
                        type: "keyword",
                        question: "√âquipements de Protection <span class='highlight'>Individuelle</span> : sigle ?",
                        answer: "epi",
                        hint: "E _ _",
                        explanation: "EPI = √âquipements de Protection Individuelle. Derni√®re barri√®re de protection. N√©cessitent formation, entretien, port effectif.",
                        keyword: "EPI = protection individuelle",
                        tip: "EPI efficaces SI : adapt√©s + entretenus + port√©s + form√©s."
                    },
                    {
                        type: "qcm",
                        question: "Exemples de <span class='highlight'>r√©duction du risque</span> en manutention ?",
                        options: [
                            "Gants de protection uniquement",
                            "Formation gestes et postures uniquement",
                            "Aide m√©canique, exosquelettes, rotation des postes",
                            "Augmentation du rythme de travail"
                        ],
                        answer: 2,
                        explanation: "R√âDUCTION RISQUE = diminuer l'exposition : aides m√©caniques (diable, transpalette), exosquelettes, rotation postes, pauses.",
                        keyword: "R√©duction = diminuer exposition",
                        tip: "Si on peut pas supprimer, on r√©duit l'intensit√©/la dur√©e."
                    },
                    {
                        type: "vf",
                        question: "La <span class='highlight'>formation</span> suffit toujours √† pr√©venir les accidents.",
                        answer: false,
                        explanation: "FAUX ! Formation = mesure compl√©mentaire indispensable mais insuffisante seule. Doit s'accompagner de mesures techniques et organisationnelles.",
                        keyword: "Formation = n√©cessaire mais pas suffisante",
                        tip: "Formation efficace si environnement de travail adapt√©."
                    },
                    {
                        type: "keyword",
                        question: "Protection qui b√©n√©ficie √† <span class='highlight'>tous les salari√©s</span> simultan√©ment ?",
                        answer: "collective",
                        hint: "Protection c _ _ _ _ _ _ _ _ _",
                        explanation: "PROTECTION COLLECTIVE = mesures qui prot√®gent automatiquement tous les travailleurs : ventilation, garde-corps, insonorisation...",
                        keyword: "Collective = protection automatique tous",
                        tip: "Avantage : pas besoin de comportement particulier de chacun."
                    },
                    {
                        type: "qcm",
                        question: "Qu'est-ce que le <span class='highlight'>cadre vert</span> en ergonomie ?",
                        options: [
                            "Zone de stockage des d√©chets verts",
                            "Espace de travail √©cologiquement favorable",
                            "Zone de manutention recommand√©e (hauteur optimale)",
                            "Bureau avec plantes vertes"
                        ],
                        answer: 2,
                        explanation: "CADRE VERT = zone de manutention optimale entre les genoux et les √©paules. Minimise contraintes rachidiennes.",
                        keyword: "Cadre vert = zone manutention optimale",
                        tip: "Vert = go ! Rouge = stop ! Orange = attention !"
                    },
                    {
                        type: "vf",
                        question: "Les <span class='highlight'>exosquelettes</span> √©liminent totalement le risque de TMS.",
                        answer: false,
                        explanation: "FAUX ! Exosquelettes = R√âDUCTION risque, pas suppression. Diminuent effort musculaire mais peuvent cr√©er autres contraintes.",
                        keyword: "Exosquelettes = r√©duction, pas suppression",
                        tip: "Nouvelles technologies = aides pr√©cieuses mais pas solutions miracles."
                    },
                    {
                        type: "keyword",
                        question: "Formation sp√©cifique aux <span class='highlight'>Risques li√©s √† l'Activit√© Physique</span> : sigle ?",
                        answer: "prap",
                        hint: "P _ _ _",
                        explanation: "PRAP = Pr√©vention des Risques li√©s √† l'Activit√© Physique. Formation aux gestes, postures, analyse poste, am√©lioration conditions travail.",
                        keyword: "PRAP = formation activit√© physique",
                        tip: "PRAP = acteur de sa propre pr√©vention et de celle des autres."
                    }
                ]
            },
            4: { // Cas professionnels
                title: "Niveau 4 : Cas Professionnels",
                competence: "C5-C6",
                cards: [
                    {
                        type: "qcm",
                        question: "Cas Yassine (cariste) : principal <span class='highlight'>d√©terminant entreprise</span> probl√©matique ?",
                        options: [
                            "Son √¢ge (24 ans) et sa formation (CAP)",
                            "Entrep√¥t non chauff√© + manutention 3 tonnes/jour",
                            "Sa taille (1,90m) et son poids (90kg)",
                            "Son anciennet√© (18 mois) dans le poste"
                        ],
                        answer: 1,
                        explanation: "YASSINE = d√©terminants entreprise probl√©matiques : environnement froid + charge de travail excessive (3 tonnes/jour ‚Üí 80 colis/h).",
                        keyword: "Yassine = environnement + charge excessive",
                        tip: "Distinguer ce qui rel√®ve de la personne vs de l'organisation."
                    },
                    {
                        type: "vf",
                        question: "Cas St√©phanie (h√¥tesse) : les <span class='highlight'>TMS tertiaires</span> sont moins graves qu'en industrie.",
                        answer: false,
                        explanation: "FAUX ! TMS tertiaire = m√™mes m√©canismes biom√©caniques. R√©p√©titivit√© + contraintes posturales peuvent √™tre tr√®s s√©v√®res (caisse, bureau).",
                        keyword: "TMS = gravit√© identique tous secteurs",
                        tip: "Secteur tertiaire ‚â† travail sans risque physique."
                    },
                    {
                        type: "keyword",
                        question: "Florian (boucher) : quelle partie du corps principalement touch√©e par les <span class='highlight'>TMS</span> ?",
                        answer: "membres sup√©rieurs",
                        hint: "Membres s _ _ _ _ _ _ _ _ _",
                        explanation: "FLORIAN = TMS membres sup√©rieurs droits (√©paule, coude, poignet) + dos. D√©coupe 7h/jour ‚Üí mouvements r√©p√©titifs bras.",
                        keyword: "Boucher = membres sup√©rieurs + dos",
                        tip: "Activit√© de d√©coupe = sollicitation intensive MS dominante."
                    },
                    {
                        type: "qcm",
                        question: "Mesure de pr√©vention <span class='highlight'>prioritaire</span> pour Yassine (manutention) ?",
                        options: [
                            "Port d'une ceinture lombaire obligatoire",
                            "Formation gestes et postures uniquement",
                            "Aide m√©canique (transpalette, diable) + r√©organisation",
                            "Augmentation des pauses de 5 minutes"
                        ],
                        answer: 2,
                        explanation: "YASSINE = priorit√© R√âDUCTION risque : aides m√©caniques + r√©organisation flux. Puis protection collective (chauffage), formation compl√©mentaire.",
                        keyword: "Manutention = aide m√©canique prioritaire",
                        tip: "Hi√©rarchie : technique > organisationnel > humain."
                    },
                    {
                        type: "vf",
                        question: "L'<span class='highlight'>analyse ergonomique</span> doit se limiter aux aspects physiques du travail.",
                        answer: false,
                        explanation: "FAUX ! Analyse ergonomique = approche globale : aspects physiques ET cognitifs ET organisationnels ET psychosociaux.",
                        keyword: "Ergonomie = approche globale travail",
                        tip: "Homme au travail = √™tre complexe, analyse doit l'√™tre aussi."
                    },
                    {
                        type: "keyword",
                        question: "Cas St√©phanie : contrainte posturale principale en <span class='highlight'>caisse</span> ?",
                        answer: "rotation tronc",
                        hint: "Rotation t _ _ _ _",
                        explanation: "ST√âPHANIE = rotation tronc toutes les 3 secondes (tapis ‚Üí scanner ‚Üí client). Contrainte rachidienne majeure + r√©p√©titivit√©.",
                        keyword: "Caisse = rotation tronc r√©p√©titive",
                        tip: "Poste caisse = pi√®ge biom√©canique si mal con√ßu."
                    },
                    {
                        type: "qcm",
                        question: "Communication des <span class='highlight'>solutions</span> : √† qui s'adresser en priorit√© ?",
                        options: [
                            "Uniquement √† la direction g√©n√©rale",
                            "Uniquement aux salari√©s concern√©s",
                            "Encadrement + salari√©s + instances repr√©sentatives",
                            "Uniquement au service de sant√© au travail"
                        ],
                        answer: 2,
                        explanation: "COMMUNICATION = approche participative : encadrement (d√©cision) + salari√©s (expertise usage) + IRP (repr√©sentation collective).",
                        keyword: "Solutions = approche participative",
                        tip: "R√©ussite pr√©vention = adh√©sion de tous les acteurs."
                    },
                    {
                        type: "vf",
                        question: "Les <span class='highlight'>co√ªts de pr√©vention</span> sont toujours sup√©rieurs aux co√ªts des accidents.",
                        answer: false,
                        explanation: "FAUX ! Pr√©vention = investissement rentable. Co√ªts accidents (directs + indirects) souvent 3-5 fois sup√©rieurs aux investissements pr√©vention.",
                        keyword: "Pr√©vention = investissement rentable",
                        tip: "‚Ç¨ pr√©vention < ‚Ç¨‚Ç¨‚Ç¨ r√©paration + image + juridique + humain."
                    },
                    {
                        type: "keyword",
                        question: "Document qui √©value <span class='highlight'>tous les risques</span> de l'entreprise ?",
                        answer: "document unique",
                        hint: "Document u _ _ _ _ _",
                        explanation: "DOCUMENT UNIQUE (EvRP) = √©valuation obligatoire de tous les risques professionnels. Base l√©gale de la politique pr√©vention.",
                        keyword: "Document unique = base pr√©vention",
                        tip: "Obligatoire d√®s le 1er salari√©. Mise √† jour annuelle minimum."
                    },
                    {
                        type: "qcm",
                        question: "Acteurs de la <span class='highlight'>pr√©vention</span> en entreprise ?",
                        options: [
                            "Uniquement l'employeur et les salari√©s",
                            "Employeur + salari√©s + m√©decin travail + IRP + IPRP",
                            "Uniquement l'inspection du travail",
                            "Uniquement les syndicats"
                        ],
                        answer: 1,
                        explanation: "ACTEURS PR√âVENTION = employeur (responsable) + salari√©s + m√©decin du travail + IRP + IPRP (intervenants externes).",
                        keyword: "Pr√©vention = responsabilit√© partag√©e",
                        tip: "Chacun son r√¥le, tous concern√©s par la pr√©vention."
                    }
                ]
            },
            5: { // Quiz final
                title: "Niveau 5 : Quiz Final Expert",
                competence: "C1-C6",
                cards: [] // Sera rempli avec un mix al√©atoire
            }
        };
        
        // G√©n√©rer le niveau 5 (mix al√©atoire)
        function generateLevel5() {
            let allCards = [];
            for (let i = 1; i <= 4; i++) {
                levels[i].cards.forEach(card => {
                    allCards.push({...card, fromLevel: i});
                });
            }
            // M√©langer et prendre 15 cartes
            allCards.sort(() => Math.random() - 0.5);
            levels[5].cards = allCards.slice(0, 15);
        }
        generateLevel5();
        
        // === FONCTIONS ===
        function startLevel(level) {
            currentLevel = level;
            currentCardIndex = 0;
            levelCorrect = 0;
            levelPoints = 0;
            levelErrors = [];
            
            document.getElementById('homeScreen').classList.remove('active');
            document.getElementById('gameScreen').classList.add('active');
            document.getElementById('levelTitle').textContent = levels[level].title;
            document.getElementById('totalCards').textContent = levels[level].cards.length;
            
            showCard();
        }
        
        function showCard() {
            const cards = levels[currentLevel].cards;
            const card = cards[currentCardIndex];
            hintUsed = false;
            
            document.getElementById('currentCard').textContent = currentCardIndex + 1;
            document.getElementById('gameProgress').style.width = ((currentCardIndex / cards.length) * 100) + '%';
            
            // Comp√©tence
            const compBadge = document.getElementById('cardCompetence');
            compBadge.textContent = card.fromLevel ? `C${card.fromLevel}` : levels[currentLevel].competence;
            compBadge.className = 'card-competence comp-badge c' + (card.fromLevel || currentLevel);
            
            // Type de carte
            const typeNames = { keyword: 'MOT-CL√â', qcm: 'QCM', vf: 'VRAI / FAUX' };
            document.getElementById('cardType').textContent = typeNames[card.type] || card.type;
            
            // Contenu
            const questionSection = document.getElementById('questionSection');
            
            if (card.type === 'keyword') {
                questionSection.innerHTML = `
                    <p class="question-text">${card.question}</p>
                    <div class="keyword-input-container">
                        <input type="text" class="keyword-input" id="keywordAnswer" placeholder="√âcris ta r√©ponse..." autocomplete="off">
                        <p class="hint-text" id="hintText">üí° Clique sur "Indice" si besoin</p>
                    </div>
                `;
                document.getElementById('keywordAnswer').addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') validateAnswer();
                });
            }
            else if (card.type === 'qcm') {
                let optionsHTML = card.options.map((opt, i) => `
                    <button class="option-btn" data-index="${i}" onclick="selectOption(this)">
                        <span class="option-letter">${String.fromCharCode(65 + i)}</span>
                        <span>${opt}</span>
                    </button>
                `).join('');
                
                questionSection.innerHTML = `
                    <p class="question-text">${card.question}</p>
                    <div class="options-container">${optionsHTML}</div>
                `;
            }
            else if (card.type === 'vf') {
                questionSection.innerHTML = `
                    <p class="question-text">${card.question}</p>
                    <div class="vf-container">
                        <button class="vf-btn vrai" onclick="selectVF(this, true)">‚úì VRAI</button>
                        <button class="vf-btn faux" onclick="selectVF(this, false)">‚úó FAUX</button>
                    </div>
                `;
            }
        }
        
        function selectOption(btn) {
            document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
        }
        
        function selectVF(btn, value) {
            document.querySelectorAll('.vf-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            btn.dataset.value = value;
        }
        
        function showHint() {
            const card = levels[currentLevel].cards[currentCardIndex];
            if (card.hint) {
                document.getElementById('hintText').innerHTML = `üí° <strong>Indice :</strong> ${card.hint}`;
                hintUsed = true;
            }
        }
        
        function validateAnswer() {
            const card = levels[currentLevel].cards[currentCardIndex];
            let isCorrect = false;
            let userAnswer = '';
            
            if (card.type === 'keyword') {
                userAnswer = document.getElementById('keywordAnswer').value.trim().toLowerCase();
                // Normaliser (accents, etc.)
                const normalize = str => str.normalize('NFD').replace(/[\u0300-\u036f]/g, '').toLowerCase();
                isCorrect = normalize(userAnswer) === normalize(card.answer) || 
                            userAnswer.includes(normalize(card.answer)) ||
                            normalize(card.answer).includes(userAnswer);
            }
            else if (card.type === 'qcm') {
                const selected = document.querySelector('.option-btn.selected');
                if (!selected) { alert('S√©lectionne une r√©ponse'); return; }
                userAnswer = parseInt(selected.dataset.index);
                isCorrect = userAnswer === card.answer;
            }
            else if (card.type === 'vf') {
                const selected = document.querySelector('.vf-btn.selected');
                if (!selected) { alert('S√©lectionne une r√©ponse'); return; }
                userAnswer = selected.dataset.value === 'true';
                isCorrect = userAnswer === card.answer;
            }
            
            // Points
            let points = 0;
            if (isCorrect) {
                points = hintUsed ? 5 : 10;
                levelCorrect++;
                levelPoints += points;
            } else {
                levelErrors.push({
                    question: card.question,
                    correct: card.answer,
                    explanation: card.explanation
                });
            }
            
            showFeedback(isCorrect, card, points);
        }
        
        function showFeedback(isCorrect, card, points) {
            const overlay = document.getElementById('feedbackOverlay');
            const feedbackCard = document.getElementById('feedbackCard');
            
            feedbackCard.className = `feedback-card ${isCorrect ? 'correct' : 'incorrect'}`;
            document.getElementById('feedbackIcon').textContent = isCorrect ? '‚úÖ' : '‚ùå';
            document.getElementById('feedbackTitle').textContent = isCorrect ? 
                (points === 10 ? 'Excellent !' : 'Bien !') : 'Incorrect';
            
            document.getElementById('feedbackExplanation').textContent = card.explanation;
            document.getElementById('feedbackKeyword').textContent = card.keyword;
            document.getElementById('feedbackTip').textContent = `üí° ${card.tip}`;
            
            overlay.classList.add('visible');
        }
        
        function closeFeedback() {
            document.getElementById('feedbackOverlay').classList.remove('visible');
            nextCard();
        }
        
        function nextCard() {
            const cards = levels[currentLevel].cards;
            if (currentCardIndex < cards.length - 1) {
                currentCardIndex++;
                showCard();
            } else {
                showResults();
            }
        }
        
        function skipCard() {
            nextCard();
        }
        
        function showResults() {
            const cards = levels[currentLevel].cards;
            const successRate = Math.round((levelCorrect / cards.length) * 100);
            
            // Sauvegarder progression
            levelProgress[currentLevel] = {
                completed: true,
                score: levelPoints,
                stars: successRate >= 80 ? 3 : successRate >= 60 ? 2 : 1,
                successRate: successRate
            };
            localStorage.setItem(`c11_level${currentLevel}`, JSON.stringify(levelProgress[currentLevel]));
            
            // Mettre √† jour totaux
            totalScore = parseInt(totalScore) + levelPoints;
            totalStars = parseInt(totalStars) + levelProgress[currentLevel].stars;
            localStorage.setItem('c11_score', totalScore);
            localStorage.setItem('c11_stars', totalStars);
            
            // Afficher r√©sultats
            document.getElementById('gameScreen').classList.remove('active');
            document.getElementById('resultsScreen').classList.add('active');
            
            document.getElementById('resultsTitle').textContent = `${levels[currentLevel].title} - Termin√© !`;
            document.getElementById('correctCount').textContent = levelCorrect;
            document.getElementById('pointsEarned').textContent = levelPoints;
            document.getElementById('successRate').textContent = successRate + '%';
            document.getElementById('finalScore').textContent = totalScore;
            document.getElementById('finalStars').textContent = totalStars;
            
            // Erreurs
            const errorsSection = document.getElementById('errorsSection');
            const errorsList = document.getElementById('errorsList');
            if (levelErrors.length > 0) {
                errorsSection.style.display = 'block';
                errorsList.innerHTML = levelErrors.map(error => `
                    <div class="error-item">
                        <strong>Q:</strong> ${error.question.replace(/<[^>]*>/g, '')}<br>
                        <strong>R√©ponse:</strong> ${error.correct}<br>
                        <em>${error.explanation}</em>
                    </div>
                `).join('');
            } else {
                errorsSection.style.display = 'none';
            }
        }
        
        function retryLevel() {
            startLevel(currentLevel);
        }
        
        function nextLevel() {
            if (currentLevel < 5) {
                startLevel(currentLevel + 1);
            } else {
                goHome();
            }
        }
        
        function goHome() {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('homeScreen').classList.add('active');
            updateHomeDisplay();
        }
        
        function updateHomeDisplay() {
            document.getElementById('totalScore').textContent = totalScore;
            document.getElementById('totalStars').textContent = totalStars;
            
            // Mise √† jour progression niveaux
            for (let i = 1; i <= 5; i++) {
                const progress = levelProgress[i];
                const card = document.querySelector(`.niveau-card:nth-child(${i})`);
                const percent = document.getElementById(`level${i}Percent`);
                const progressBar = document.getElementById(`level${i}Progress`);
                
                if (progress.completed) {
                    card.classList.add('completed');
                    percent.textContent = progress.successRate + '%';
                    progressBar.style.width = progress.successRate + '%';
                } else {
                    percent.textContent = '0%';
                    progressBar.style.width = '0%';
                }
            }
        }
        
        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            updateHomeDisplay();
        });
    </script>
    
    <!-- Footer RGPD √©pur√© -->
    <div style="text-align: center; padding: 20px; font-size: 12px; color: rgba(255,255,255,0.5);">
        üîí Conformit√© RGPD : Cet exercice respecte votre anonymat.
    </div>
</body>
</html>