<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module C.3 - Diagnostic des Acteurs de Pr√©vention - 1√®re Bac Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=OpenDyslexic:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-pse: #2E86AB;
            --secondary-pse: #A23B72;
            --success-pse: #219653;
            --warning-pse: #F2994A;
            --danger-pse: #EB5757;
            --dark-pse: #2F3542;
            --light-pse: #F1F2F6;
            --accent-pse: #3498DB;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            line-height: 1.6;
        }

        .dyslexie-font {
            font-family: 'OpenDyslexic', sans-serif;
        }

        /* RESPONSIVE MOBILE-FIRST */
        .container {
            width: 100%;
            max-width: 100vw;
            padding: 15px;
            margin: 0 auto;
        }

        @media (min-width: 768px) {
            .container {
                padding: 20px;
                max-width: 1200px;
            }
        }

        @media (min-width: 1024px) {
            .container {
                padding: 30px;
            }
        }

        /* EN-T√äTE P√âDAGOGIQUE OBLIGATOIRE */
        .cadre-pedagogique {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 3px solid var(--primary-pse);
        }

        .module-info h2 {
            color: var(--primary-pse);
            font-size: 1.3em;
            margin-bottom: 10px;
            text-align: center;
        }

        .objectif {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 5px solid var(--primary-pse);
        }

        .competences-travaillees {
            margin-top: 15px;
        }

        .competences-list {
            list-style: none;
            display: grid;
            gap: 8px;
            margin-top: 10px;
        }

        .competences-list li {
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.9em;
        }

        .competence-c1 { border-left: 5px solid #E74C3C; background: #fef2f2; }
        .competence-c2 { border-left: 5px solid #3498DB; background: #eff6ff; }
        .competence-c3 { border-left: 5px solid #2ECC71; background: #f0fdf4; }
        .competence-c4 { border-left: 5px solid #F39C12; background: #fffbeb; }

        .niveau-cible {
            text-align: center;
            font-weight: 600;
            color: var(--dark-pse);
            margin-top: 15px;
            padding: 10px;
            background: linear-gradient(135deg, #fff3e0, #ffe0b2);
            border-radius: 8px;
        }

        /* MAIN EXERCISE */
        .exercice-principal {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success-pse), var(--primary-pse));
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .score-display {
            text-align: center;
            font-size: 1.2em;
            margin: 15px 0;
            font-weight: 600;
        }

        /* DIAGNOSTIC SECTIONS */
        .diagnostic-section {
            margin: 25px 0;
            padding: 20px;
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            border-radius: 12px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .diagnostic-section.active {
            border-color: var(--primary-pse);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(46, 134, 171, 0.15);
        }

        .section-title {
            font-size: 1.1em;
            font-weight: 600;
            color: var(--dark-pse);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-number {
            background: var(--primary-pse);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            font-weight: 700;
        }

        /* SYST√àME CLIC-S√âLECTION */
        .instructions-interaction {
            background: linear-gradient(135deg, #fff9c4, #fef08a);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 5px solid var(--warning-pse);
        }

        .clickable-element {
            padding: 12px 15px;
            margin: 8px;
            background: linear-gradient(135deg, #ffffff, #f8fafc);
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
            min-width: 120px;
            text-align: center;
            user-select: none;
        }

        .clickable-element:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .clickable-element.selected {
            border: 3px solid var(--warning-pse);
            background: linear-gradient(135deg, #FFA726, #FF9800);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(255, 167, 38, 0.4);
        }

        .clickable-element.correct {
            border: 3px solid var(--success-pse);
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
        }

        .clickable-element.incorrect {
            border: 3px solid var(--danger-pse);
            background: linear-gradient(135deg, #F44336, #C62828);
            color: white;
        }

        .drop-zone {
            min-height: 60px;
            border: 3px dashed #bdc3c7;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            background: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .drop-zone.active {
            border-color: var(--primary-pse);
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
        }

        .drop-zone.filled {
            border-color: var(--success-pse);
            background: linear-gradient(135deg, #e8f5e8, #c8e6c8);
        }

        /* CORRECTION EXPLICITE OBLIGATOIRE */
        .correction-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }

        .correction-card {
            background: linear-gradient(135deg, #ffffff, #f8fafc);
            border-radius: 15px;
            padding: 25px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .correction-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .correction-header.success {
            color: var(--success-pse);
        }

        .correction-header.error {
            color: var(--danger-pse);
        }

        .correction-content {
            margin: 15px 0;
        }

        .bonne-reponse {
            background: linear-gradient(135deg, #e8f5e8, #c8e6c8);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 5px solid var(--success-pse);
        }

        .explication {
            background: linear-gradient(135deg, #fff9c4, #fef08a);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 5px solid var(--warning-pse);
        }

        .btn-continue {
            background: linear-gradient(135deg, var(--primary-pse), var(--accent-pse));
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            margin-top: 15px;
            width: 100%;
            transition: all 0.3s ease;
        }

        .btn-continue:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(46, 134, 171, 0.3);
        }

        /* GAMIFICATION */
        .level-system {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .level-badge {
            background: rgba(255,255,255,0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
        }

        .points-display {
            font-size: 1.2em;
            font-weight: 700;
        }

        /* FOOTER RGPD √âPUR√â */
        .rgpd-footer {
            text-align: center;
            padding: 20px;
            color: rgba(255,255,255,0.8);
            font-size: 0.9em;
        }

        /* RESPONSIVE AM√âLIORATIONS */
        @media (max-width: 768px) {
            .competences-list {
                grid-template-columns: 1fr;
            }
            
            .clickable-element {
                min-width: 100px;
                margin: 5px;
                padding: 10px 12px;
            }
            
            .correction-card {
                margin: 10px;
                padding: 20px;
            }
        }

        /* ACCESSIBILIT√â */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0,0,0,0);
            border: 0;
        }

        /* ANIMATIONS */
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% { transform: translate3d(0,0,0); }
            40%, 43% { transform: translate3d(0,-10px,0); }
            70% { transform: translate3d(0,-5px,0); }
            90% { transform: translate3d(0,-2px,0); }
        }

        .bounce {
            animation: bounce 1s ease-in-out;
        }

        .fade-in {
            opacity: 0;
            animation: fadeIn 0.5s ease-in forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- EN-T√äTE P√âDAGOGIQUE OBLIGATOIRE -->
        <div class="cadre-pedagogique">
            <div class="module-info">
                <h2>Module C.3 : Les acteurs de pr√©vention</h2>
                <div class="objectif">
                    <strong>Objectif :</strong> Identifier les missions des acteurs de pr√©vention internes et externes en milieu professionnel.
                </div>
            </div>
            
            <div class="competences-travaillees">
                <h3>Comp√©tences travaill√©es dans cet exercice :</h3>
                <ul class="competences-list">
                    <li class="competence-c1"><strong>C1</strong> - Traiter une information</li>
                    <li class="competence-c2"><strong>C2</strong> - Appliquer une d√©marche d'analyse dans une situation donn√©e</li>
                    <li class="competence-c3"><strong>C3</strong> - Expliquer un ph√©nom√®ne physiologique, un enjeu environnemental, une disposition r√©glementaire, en lien avec une mesure de pr√©vention</li>
                    <li class="competence-c4"><strong>C4</strong> - Proposer une solution pour r√©soudre un probl√®me</li>
                </ul>
            </div>
            
            <div class="niveau-cible">
                <strong>Niveau :</strong> Bac Pro Premi√®re
            </div>
        </div>

        <!-- SYST√àME DE GAMIFICATION -->
        <div class="level-system">
            <div class="level-badge">
                <span id="current-level">Apprenti Pr√©venteur</span>
            </div>
            <div class="points-display">
                <span id="total-points">0</span> points
            </div>
        </div>

        <!-- BARRE DE PROGRESSION -->
        <div class="progress-bar">
            <div class="progress-fill" id="progress-bar"></div>
        </div>
        <div class="score-display">
            Progression : <span id="progress-text">0/12</span> activit√©s compl√©t√©es
        </div>

        <!-- EXERCICE PRINCIPAL -->
        <div class="exercice-principal">
            
            <!-- INSTRUCTIONS UTILISATEUR OBLIGATOIRES -->
            <div class="instructions-interaction">
                <h5>üì± COMMENT MANIPULER :</h5>
                <p><strong>1.</strong> Cliquez sur un √©l√©ment pour le s√©lectionner (il s'illumine) 
                <strong>2.</strong> Cliquez sur la zone de destination appropri√©e 
                <strong>3.</strong> L'√©l√©ment se place automatiquement !</p>
            </div>

            <!-- SECTION 1: IDENTIFICATION DES ACTEURS INTERNES -->
            <div class="diagnostic-section" id="section-1">
                <div class="section-title">
                    <div class="section-number">1</div>
                    Identification des acteurs internes
                </div>
                <p><strong>Consigne :</strong> Associez chaque acteur interne √† son r√¥le principal dans l'entreprise.</p>
                
                <div class="actors-pool" style="margin: 15px 0;">
                    <div class="clickable-element" data-actor="employeur">Employeur</div>
                    <div class="clickable-element" data-actor="salarie-competent">Salari√© comp√©tent</div>
                    <div class="clickable-element" data-actor="cse">CSE</div>
                    <div class="clickable-element" data-actor="sst">SST</div>
                </div>

                <div class="roles-zones">
                    <div class="drop-zone" data-role="responsable-securite">
                        <span>Responsable l√©gal de la s√©curit√© dans l'entreprise</span>
                    </div>
                    <div class="drop-zone" data-role="delegue-prevention">
                        <span>Assiste l'employeur dans la mise en ≈ìuvre de la pr√©vention</span>
                    </div>
                    <div class="drop-zone" data-role="representation-personnel">
                        <span>Instance de repr√©sentation du personnel (‚â•11 salari√©s)</span>
                    </div>
                    <div class="drop-zone" data-role="premiers-secours">
                        <span>Form√© aux premiers secours et acteur de pr√©vention</span>
                    </div>
                </div>

                <button class="btn-validate" onclick="validateSection(1)">Valider mes r√©ponses</button>
            </div>

            <!-- SECTION 2: MISSIONS DES ACTEURS EXTERNES -->
            <div class="diagnostic-section" id="section-2">
                <div class="section-title">
                    <div class="section-number">2</div>
                    Missions des acteurs externes
                </div>
                <p><strong>Consigne :</strong> Reliez chaque organisme externe √† ses missions sp√©cifiques.</p>
                
                <div class="actors-pool" style="margin: 15px 0;">
                    <div class="clickable-element" data-actor="inspection-travail">Inspection du travail</div>
                    <div class="clickable-element" data-actor="spst">SPST</div>
                    <div class="clickable-element" data-actor="carsat">CARSAT</div>
                </div>

                <div class="missions-grid">
                    <div class="drop-zone" data-mission="controle-loi">
                        <span>Contr√¥le l'application de la l√©gislation du travail</span>
                    </div>
                    <div class="drop-zone" data-mission="suivi-medical">
                        <span>Assure le suivi m√©dical des salari√©s</span>
                    </div>
                    <div class="drop-zone" data-mission="tarification-at">
                        <span>Fixe le taux de cotisation AT/MP</span>
                    </div>
                </div>

                <button class="btn-validate" onclick="validateSection(2)">Valider mes r√©ponses</button>
            </div>

            <!-- SECTION 3: SITUATIONS PROFESSIONNELLES -->
            <div class="diagnostic-section" id="section-3">
                <div class="section-title">
                    <div class="section-number">3</div>
                    Analyse de situations
                </div>
                <p><strong>Consigne :</strong> Pour chaque situation, identifiez l'acteur le plus appropri√©.</p>

                <div class="situation-item">
                    <div class="situation-text">
                        <strong>Situation A :</strong> Un salari√© s'est bless√© gravement √† la main avec une machine dangereuse.
                    </div>
                    <div class="actors-pool">
                        <div class="clickable-element" data-situation="A" data-actor="sst-secours">SST (premiers secours)</div>
                        <div class="clickable-element" data-situation="A" data-actor="cse-enquete">CSE (enqu√™te)</div>
                        <div class="clickable-element" data-situation="A" data-actor="inspection">Inspection du travail</div>
                    </div>
                    <div class="drop-zone" data-situation="A">
                        <span>Acteur prioritaire dans cette situation</span>
                    </div>
                </div>

                <div class="situation-item">
                    <div class="situation-text">
                        <strong>Situation B :</strong> L'entreprise souhaite r√©viser son DUERP (Document Unique).
                    </div>
                    <div class="actors-pool">
                        <div class="clickable-element" data-situation="B" data-actor="salarie-competent-duerp">Salari√© comp√©tent</div>
                        <div class="clickable-element" data-situation="B" data-actor="spst-conseil">SPST</div>
                        <div class="clickable-element" data-situation="B" data-actor="carsat-aide">CARSAT</div>
                    </div>
                    <div class="drop-zone" data-situation="B">
                        <span>Acteur principal pour cette mission</span>
                    </div>
                </div>

                <button class="btn-validate" onclick="validateSection(3)">Valider mes r√©ponses</button>
            </div>

            <!-- SECTION 4: QUIZ DIAGNOSTIC FINAL -->
            <div class="diagnostic-section" id="section-4">
                <div class="section-title">
                    <div class="section-number">4</div>
                    Diagnostic final
                </div>
                <p><strong>Test de connaissances :</strong> R√©pondez aux questions suivantes.</p>

                <div class="quiz-questions">
                    <div class="quiz-item">
                        <h4>Question 1 : Qui est responsable l√©galement de la s√©curit√© dans l'entreprise ?</h4>
                        <div class="quiz-options">
                            <div class="clickable-element quiz-option" data-question="q1" data-answer="correct">L'employeur</div>
                            <div class="clickable-element quiz-option" data-question="q1" data-answer="incorrect">Le salari√© comp√©tent</div>
                            <div class="clickable-element quiz-option" data-question="q1" data-answer="incorrect">Le CSE</div>
                        </div>
                    </div>

                    <div class="quiz-item">
                        <h4>Question 2 : √Ä partir de quel effectif le CSE devient-il obligatoire ?</h4>
                        <div class="quiz-options">
                            <div class="clickable-element quiz-option" data-question="q2" data-answer="incorrect">5 salari√©s</div>
                            <div class="clickable-element quiz-option" data-question="q2" data-answer="correct">11 salari√©s</div>
                            <div class="clickable-element quiz-option" data-question="q2" data-answer="incorrect">50 salari√©s</div>
                        </div>
                    </div>

                    <div class="quiz-item">
                        <h4>Question 3 : Quel organisme fixe le taux de cotisation AT/MP ?</h4>
                        <div class="quiz-options">
                            <div class="clickable-element quiz-option" data-question="q3" data-answer="incorrect">SPST</div>
                            <div class="clickable-element quiz-option" data-question="q3" data-answer="correct">CARSAT</div>
                            <div class="clickable-element quiz-option" data-question="q3" data-answer="incorrect">Inspection du travail</div>
                        </div>
                    </div>
                </div>

                <button class="btn-validate" onclick="validateSection(4)">Valider le quiz</button>
            </div>
        </div>
    </div>

    <!-- CORRECTION OVERLAY -->
    <div class="correction-overlay" id="correction-overlay">
        <div class="correction-card">
            <div class="correction-header" id="correction-header">
                <h3 id="correction-title"></h3>
            </div>
            <div class="correction-content" id="correction-content">
                <!-- Contenu dynamique -->
            </div>
            <button class="btn-continue" onclick="closeCorrection()">Continuer</button>
        </div>
    </div>

    <!-- FOOTER RGPD √âPUR√â -->
    <div class="rgpd-footer">
        üîí Conformit√© RGPD : Cet exercice respecte votre anonymat.
    </div>

    <script>
        // Variables globales
        let selectedElement = null;
        let currentSection = 1;
        let totalPoints = 0;
        let completedActivities = 0;
        const totalActivities = 12;
        let sectionData = {
            1: { correct: ['employeur-responsable-securite', 'salarie-competent-delegue-prevention', 'cse-representation-personnel', 'sst-premiers-secours'] },
            2: { correct: ['inspection-travail-controle-loi', 'spst-suivi-medical', 'carsat-tarification-at'] },
            3: { correct: ['A-sst-secours', 'B-salarie-competent-duerp'] },
            4: { correct: ['q1-correct', 'q2-correct', 'q3-correct'] }
        };

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            updateDisplay();
        });

        // Configuration des √©v√©nements
        function setupEventListeners() {
            // Syst√®me clic-s√©lection
            document.querySelectorAll('.clickable-element').forEach(element => {
                element.addEventListener('click', handleElementClick);
            });

            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.addEventListener('click', handleZoneClick);
            });

            // Gestion du clavier pour accessibilit√©
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeCorrection();
                }
            });
        }

        // Gestion clic sur √©l√©ment
        function handleElementClick(e) {
            e.preventDefault();
            
            // D√©s√©lectionner l'√©l√©ment pr√©c√©dent
            if (selectedElement) {
                selectedElement.classList.remove('selected');
            }
            
            // S√©lectionner le nouvel √©l√©ment
            selectedElement = e.target;
            selectedElement.classList.add('selected');
            
            // Effet audio discret (optionnel)
            playSound('select');
        }

        // Gestion clic sur zone
        function handleZoneClick(e) {
            if (!selectedElement) {
                showMessage('S√©lectionnez d\'abord un √©l√©ment √† placer !', 'warning');
                return;
            }

            const zone = e.currentTarget;
            
            // V√©rification si la zone est d√©j√† occup√©e
            if (zone.classList.contains('filled')) {
                showMessage('Cette zone est d√©j√† occup√©e !', 'warning');
                return;
            }

            // Placement de l'√©l√©ment
            zone.textContent = selectedElement.textContent;
            zone.classList.add('filled');
            zone.dataset.placedElement = selectedElement.dataset.actor || selectedElement.dataset.answer;
            
            // Masquer l'√©l√©ment s√©lectionn√©
            selectedElement.style.display = 'none';
            selectedElement.classList.remove('selected');
            selectedElement = null;

            // Effet visuel
            zone.classList.add('bounce');
            setTimeout(() => zone.classList.remove('bounce'), 1000);

            playSound('place');
        }

        // Validation des sections
        function validateSection(sectionNum) {
            const section = document.getElementById(`section-${sectionNum}`);
            let correctCount = 0;
            let totalCount = 0;
            let corrections = [];

            switch(sectionNum) {
                case 1:
                    // Validation acteurs internes
                    const zones1 = section.querySelectorAll('.drop-zone');
                    zones1.forEach(zone => {
                        totalCount++;
                        const placed = zone.dataset.placedElement;
                        const expected = getExpectedAnswer(zone.dataset.role);
                        
                        if (placed === expected) {
                            zone.classList.add('correct');
                            correctCount++;
                        } else {
                            zone.classList.add('incorrect');
                            corrections.push({
                                question: zone.querySelector('span').textContent,
                                given: placed || 'Aucune r√©ponse',
                                correct: expected,
                                explanation: getExplanation(zone.dataset.role)
                            });
                        }
                    });
                    break;

                case 2:
                    // Validation acteurs externes
                    const zones2 = section.querySelectorAll('.drop-zone');
                    zones2.forEach(zone => {
                        totalCount++;
                        const placed = zone.dataset.placedElement;
                        const expected = getExpectedAnswer(zone.dataset.mission);
                        
                        if (placed === expected) {
                            zone.classList.add('correct');
                            correctCount++;
                        } else {
                            zone.classList.add('incorrect');
                            corrections.push({
                                question: zone.querySelector('span').textContent,
                                given: placed || 'Aucune r√©ponse',
                                correct: expected,
                                explanation: getExplanation(zone.dataset.mission)
                            });
                        }
                    });
                    break;

                case 3:
                    // Validation situations
                    const zones3 = section.querySelectorAll('.drop-zone');
                    zones3.forEach(zone => {
                        totalCount++;
                        const placed = zone.dataset.placedElement;
                        const expected = getExpectedAnswer(zone.dataset.situation);
                        
                        if (placed === expected) {
                            zone.classList.add('correct');
                            correctCount++;
                        } else {
                            zone.classList.add('incorrect');
                            corrections.push({
                                question: zone.dataset.situation === 'A' ? 'Salari√© bless√© gravement' : 'R√©vision DUERP',
                                given: placed || 'Aucune r√©ponse',
                                correct: expected,
                                explanation: getExplanation(zone.dataset.situation)
                            });
                        }
                    });
                    break;

                case 4:
                    // Validation quiz
                    const questions = section.querySelectorAll('.quiz-item');
                    questions.forEach((questionDiv, index) => {
                        totalCount++;
                        const selectedOption = questionDiv.querySelector('.quiz-option.selected');
                        
                        if (selectedOption) {
                            if (selectedOption.dataset.answer === 'correct') {
                                selectedOption.classList.add('correct');
                                correctCount++;
                            } else {
                                selectedOption.classList.add('incorrect');
                                // Marquer la bonne r√©ponse
                                const correctOption = questionDiv.querySelector('[data-answer="correct"]');
                                correctOption.classList.add('correct');
                                
                                corrections.push({
                                    question: `Question ${index + 1}`,
                                    given: selectedOption.textContent,
                                    correct: correctOption.textContent,
                                    explanation: getQuizExplanation(index + 1)
                                });
                            }
                        } else {
                            corrections.push({
                                question: `Question ${index + 1}`,
                                given: 'Aucune r√©ponse',
                                correct: questionDiv.querySelector('[data-answer="correct"]').textContent,
                                explanation: getQuizExplanation(index + 1)
                            });
                        }
                    });
                    break;
            }

            // Calcul des points
            const points = Math.round((correctCount / totalCount) * 100);
            totalPoints += points;
            completedActivities += totalCount;

            // Mise √† jour de l'affichage
            updateDisplay();

            // Affichage de la correction
            showCorrection(correctCount, totalCount, corrections, points);

            // D√©sactiver la section
            section.style.opacity = '0.7';
            section.querySelector('.btn-validate').disabled = true;
        }

        // Affichage de la correction
        function showCorrection(correct, total, corrections, points) {
            const overlay = document.getElementById('correction-overlay');
            const header = document.getElementById('correction-header');
            const title = document.getElementById('correction-title');
            const content = document.getElementById('correction-content');

            let html = '';
            
            if (correct === total) {
                header.className = 'correction-header success';
                title.innerHTML = `‚úÖ Parfait ! ${correct}/${total} bonnes r√©ponses`;
                html = `
                    <div class="bonne-reponse">
                        <strong>üéâ Excellent travail !</strong><br>
                        Vous avez obtenu ${points} points pour cette section.
                    </div>
                    <div class="explication">
                        <strong>üí° Continuez ainsi !</strong><br>
                        Votre compr√©hension des acteurs de pr√©vention est excellente.
                    </div>
                `;
            } else {
                header.className = 'correction-header error';
                title.innerHTML = `‚ùå ${correct}/${total} bonnes r√©ponses`;
                
                html += `<div class="explication">
                    <strong>üìö Points √† retenir :</strong><br>
                    Vous avez obtenu ${points} points. Voici les corrections :
                </div>`;

                corrections.forEach(correction => {
                    html += `
                        <div class="correction-item" style="margin: 15px 0; padding: 15px; border-left: 4px solid var(--danger-pse); background: #fef2f2; border-radius: 8px;">
                            <h4>‚ùå ${correction.question}</h4>
                            <div class="bonne-reponse">
                                <strong>‚úÖ Bonne r√©ponse :</strong> ${correction.correct}
                            </div>
                            <div class="explication">
                                <strong>üí° Explication :</strong> ${correction.explanation}
                            </div>
                        </div>
                    `;
                });
            }

            content.innerHTML = html;
            overlay.style.display = 'flex';
            playSound(correct === total ? 'success' : 'error');
        }

        // Fermeture de la correction
        function closeCorrection() {
            document.getElementById('correction-overlay').style.display = 'none';
        }

        // Mise √† jour de l'affichage
        function updateDisplay() {
            document.getElementById('total-points').textContent = totalPoints;
            document.getElementById('progress-text').textContent = `${completedActivities}/${totalActivities}`;
            
            const progress = (completedActivities / totalActivities) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;

            // Mise √† jour du niveau
            updateLevel();
        }

        // Mise √† jour du niveau
        function updateLevel() {
            const levelElement = document.getElementById('current-level');
            if (totalPoints >= 300) {
                levelElement.textContent = 'Expert Pr√©vention';
            } else if (totalPoints >= 200) {
                levelElement.textContent = 'Pr√©venteur Confirm√©';
            } else if (totalPoints >= 100) {
                levelElement.textContent = 'Pr√©venteur Junior';
            } else {
                levelElement.textContent = 'Apprenti Pr√©venteur';
            }
        }

        // R√©cup√©ration des r√©ponses attendues
        function getExpectedAnswer(key) {
            const answers = {
                'responsable-securite': 'employeur',
                'delegue-prevention': 'salarie-competent',
                'representation-personnel': 'cse',
                'premiers-secours': 'sst',
                'controle-loi': 'inspection-travail',
                'suivi-medical': 'spst',
                'tarification-at': 'carsat',
                'A': 'sst-secours',
                'B': 'salarie-competent-duerp'
            };
            return answers[key];
        }

        // Explications
        function getExplanation(key) {
            const explanations = {
                'responsable-securite': 'L\'employeur a une obligation l√©gale de s√©curit√© envers ses salari√©s (Code du travail).',
                'delegue-prevention': 'Le salari√© comp√©tent est d√©sign√© par l\'employeur pour l\'assister dans la pr√©vention.',
                'representation-personnel': 'Le CSE repr√©sente les salari√©s et veille √† leur sant√©/s√©curit√© (‚â•11 salari√©s).',
                'premiers-secours': 'Le SST est form√© aux premiers secours et contribue √† la pr√©vention.',
                'controle-loi': 'L\'inspection du travail v√©rifie l\'application du Code du travail.',
                'suivi-medical': 'Le SPST assure la surveillance m√©dicale et la pr√©vention des risques.',
                'tarification-at': 'La CARSAT calcule les cotisations AT/MP selon la sinistralit√© de l\'entreprise.',
                'A': 'En cas d\'accident grave, le SST donne les premiers secours en priorit√©.',
                'B': 'Le salari√© comp√©tent participe √† la r√©daction du DUERP avec l\'employeur.'
            };
            return explanations[key];
        }

        // Explications quiz
        function getQuizExplanation(questionNum) {
            const explanations = {
                1: 'L\'employeur a une obligation g√©n√©rale de s√©curit√© envers tous ses salari√©s selon le Code du travail.',
                2: 'Le CSE (Comit√© Social et √âconomique) est obligatoire dans les entreprises d\'au moins 11 salari√©s.',
                3: 'La CARSAT fixe le taux de cotisation AT/MP en fonction des accidents et maladies professionnelles de l\'entreprise.'
            };
            return explanations[questionNum];
        }

        // Gestion du quiz
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.quiz-option').forEach(option => {
                option.addEventListener('click', function(e) {
                    // D√©s√©lectionner les autres options de la m√™me question
                    const questionDiv = e.target.closest('.quiz-item');
                    questionDiv.querySelectorAll('.quiz-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // S√©lectionner cette option
                    e.target.classList.add('selected');
                });
            });
        });

        // Messages utilisateur
        function showMessage(message, type = 'info') {
            // Simple alert pour le moment - pourrait √™tre am√©lior√© avec une notification personnalis√©e
            if (type === 'warning') {
                alert('‚ö†Ô∏è ' + message);
            } else {
                alert('‚ÑπÔ∏è ' + message);
            }
        }

        // Son discret (optionnel)
        function playSound(type) {
            // Impl√©mentation basique du son
            // Vous pouvez ajouter des fichiers audio r√©els si souhait√©
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance();
                utterance.volume = 0.1;
                utterance.rate = 3;
                
                switch(type) {
                    case 'success':
                        utterance.text = 'Bravo';
                        break;
                    case 'error':
                        utterance.text = 'Attention';
                        break;
                    default:
                        utterance.text = 'Clic';
                }
                
                // Lecture discr√®te
                setTimeout(() => {
                    speechSynthesis.speak(utterance);
                }, 100);
            }
        }

        // Accessibilit√© - support clavier
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                if (e.target.classList.contains('clickable-element')) {
                    e.preventDefault();
                    e.target.click();
                } else if (e.target.classList.contains('drop-zone')) {
                    e.preventDefault();
                    e.target.click();
                }
            }
        });

        // Ajout des attributs d'accessibilit√©
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.clickable-element').forEach((element, index) => {
                element.setAttribute('tabindex', '0');
                element.setAttribute('role', 'button');
                element.setAttribute('aria-label', `√âl√©ment ${element.textContent} - Cliquez pour s√©lectionner`);
            });

            document.querySelectorAll('.drop-zone').forEach((zone, index) => {
                zone.setAttribute('tabindex', '0');
                zone.setAttribute('role', 'button');
                zone.setAttribute('aria-label', `Zone de d√©p√¥t - ${zone.textContent}`);
            });
        });
    </script>
</body>
</html>