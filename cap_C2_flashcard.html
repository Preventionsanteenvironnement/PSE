<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R√©vision C2 - Sant√© & S√©curit√© au Travail - CAP</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;800;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #2c3e50;
            --secondary: #e67e22; /* Safety Orange */
            --accent: #3498db;
            --success: #27ae60;
            --danger: #e74c3c;
            --bg-gradient: linear-gradient(135deg, #1a252f 0%, #2c3e50 50%, #34495e 100%);
        }
        
        body {
            font-family: 'Nunito', sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
            transition: all 0.3s ease;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }
        
        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .btn-back {
            background: rgba(255,255,255,0.1);
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            border: 2px solid rgba(255,255,255,0.2);
            cursor: pointer;
        }
        
        .btn-back:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
            border-color: var(--secondary);
        }
        
        .score-bar {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(0,0,0,0.3);
            padding: 10px 20px;
            border-radius: 50px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .score-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 15px;
            font-weight: 800;
        }
        
        /* √âcrans */
        .screen {
            display: none;
            animation: slideUp 0.5s ease;
        }
        
        .screen.active {
            display: block;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* √âcran d'accueil */
        .welcome-screen {
            text-align: center;
            padding: 20px 0;
        }
        
        .welcome-title {
            font-size: 42px;
            font-weight: 900;
            margin-bottom: 5px;
            color: var(--secondary);
            text-shadow: 0 4px 15px rgba(230, 126, 34, 0.4);
        }
        
        .welcome-subtitle {
            font-size: 18px;
            color: rgba(255,255,255,0.8);
            margin-bottom: 30px;
            font-weight: 600;
        }
        
        /* Objectifs */
        .objectifs-card {
            background: rgba(0, 0, 0, 0.2);
            border-left: 5px solid var(--secondary);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            text-align: left;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .objectifs-card h3 {
            font-size: 18px;
            margin-bottom: 15px;
            color: var(--secondary);
        }
        
        .objectif-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 8px 0;
            font-size: 15px;
            line-height: 1.4;
        }
        
        .objectif-item .check {
            color: var(--secondary);
            font-size: 18px;
            font-weight: bold;
        }
        
        /* Niveaux */
        .niveaux-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .niveau-card {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .niveau-card::before {
            content: ''; position: absolute; top: 0; left: 0; width: 5px; height: 100%; background: transparent; transition: 0.3s;
        }
        
        .niveau-card:hover:not(.locked) {
            background: rgba(255,255,255,0.1);
            transform: translateX(8px);
            border-color: rgba(255,255,255,0.3);
        }
        
        .niveau-card:hover:not(.locked)::before { background: var(--secondary); }
        
        .niveau-card.locked { opacity: 0.4; cursor: not-allowed; filter: grayscale(100%); }
        
        .niveau-card.completed {
            border-color: var(--success);
            background: rgba(39, 174, 96, 0.1);
        }
        .niveau-card.completed::before { background: var(--success); }
        
        .niveau-icon {
            width: 55px; height: 55px; border-radius: 15px;
            display: flex; align-items: center; justify-content: center;
            font-size: 26px; flex-shrink: 0; background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .niveau-info { flex: 1; text-align: left; }
        .niveau-info h4 { font-size: 17px; margin-bottom: 5px; }
        .niveau-info p { font-size: 13px; color: rgba(255,255,255,0.6); }
        
        .niveau-progress { width: 80px; text-align: right; }
        .niveau-progress .percent { font-size: 18px; font-weight: 800; }
        .progress-mini { height: 6px; background: rgba(0,0,0,0.5); border-radius: 3px; margin-top: 5px; overflow: hidden; }
        .progress-mini-fill { height: 100%; background: var(--secondary); border-radius: 3px; transition: width 0.5s ease; }
        .completed .progress-mini-fill { background: var(--success); }
        
        /* √âcran de jeu */
        .game-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px; background: rgba(0,0,0,0.2); padding: 15px 20px; border-radius: 15px;
        }
        .game-title { font-size: 18px; font-weight: 800; color: var(--secondary); }
        .game-progress { display: flex; align-items: center; gap: 15px; }
        .card-counter { font-size: 15px; font-weight: bold; }
        .progress-bar { width: 120px; height: 8px; background: rgba(0,0,0,0.5); border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--secondary); transition: width 0.3s ease; }
        
        /* Carte Flashcard */
        .flashcard {
            background: linear-gradient(145deg, #ecf0f1, #bdc3c7);
            color: #2c3e50;
            border-radius: 20px;
            padding: 40px 30px;
            min-height: 420px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 15px 35px rgba(0,0,0,0.4);
            position: relative;
        }
        
        .card-type {
            position: absolute; top: 20px; right: 20px;
            background: var(--primary); color: white;
            padding: 6px 14px; border-radius: 20px;
            font-size: 12px; font-weight: 800; letter-spacing: 1px;
        }
        
        .question-section {
            flex: 1; display: flex; flex-direction: column; justify-content: center;
            text-align: center; padding: 20px 0;
        }
        
        .question-text { font-size: 24px; font-weight: 800; line-height: 1.4; margin-bottom: 30px; }
        .question-text .highlight { color: var(--secondary); position: relative; display: inline-block; }
        .question-text .highlight::after { content:''; position:absolute; bottom:-2px; left:0; width:100%; height:3px; background:var(--secondary); opacity:0.3; }
        
        /* Input mot-cl√© */
        .keyword-input {
            background: white; border: 3px solid #bdc3c7; border-radius: 12px;
            padding: 15px 25px; font-size: 22px; font-weight: 800; color: var(--primary);
            text-align: center; width: 100%; max-width: 400px; margin: 0 auto;
            transition: all 0.3s ease; box-shadow: inset 0 3px 6px rgba(0,0,0,0.05);
        }
        .keyword-input:focus { outline: none; border-color: var(--secondary); box-shadow: 0 0 15px rgba(230, 126, 34, 0.3); }
        .keyword-input::placeholder { color: #95a5a6; font-weight: 600; }
        
        .hint-text { font-size: 15px; color: #7f8c8d; margin-top: 15px; font-weight: 600; }
        .hint-text strong { color: var(--secondary); letter-spacing: 2px;}
        
        /* Options QCM */
        .options-container { display: flex; flex-direction: column; gap: 12px; width: 100%; max-width: 500px; margin: 0 auto; }
        
        .option-btn {
            background: white; border: 2px solid #bdc3c7; border-radius: 12px;
            padding: 15px 20px; color: var(--primary); font-size: 16px; font-weight: 700;
            cursor: pointer; transition: all 0.2s ease; text-align: left;
            display: flex; align-items: center; gap: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        
        .option-btn:hover { border-color: var(--accent); transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,0.1); }
        .option-btn.selected { background: #ebf5fb; border-color: var(--accent); border-width: 3px; }
        
        .option-letter {
            width: 32px; height: 32px; background: #ecf0f1; border-radius: 8px;
            display: flex; align-items: center; justify-content: center; font-weight: 900; color: #7f8c8d;
        }
        .selected .option-letter { background: var(--accent); color: white; }
        
        /* Vrai/Faux */
        .vf-container { display: flex; gap: 25px; justify-content: center; }
        .vf-btn {
            width: 150px; height: 80px; border-radius: 15px; border: 3px solid #bdc3c7;
            background: white; color: var(--primary); font-size: 22px; font-weight: 900;
            cursor: pointer; transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex; align-items: center; justify-content: center; gap: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .vf-btn:hover { transform: scale(1.05); }
        .vf-btn.vrai.selected { background: var(--success); color: white; border-color: var(--success); }
        .vf-btn.faux.selected { background: var(--danger); color: white; border-color: var(--danger); }
        
        /* Boutons action */
        .action-row { display: flex; gap: 15px; margin-top: 25px; justify-content: center; flex-wrap: wrap; }
        
        .btn {
            padding: 15px 35px; border-radius: 12px; font-size: 16px; font-weight: 800;
            cursor: pointer; transition: all 0.3s ease; border: none; text-transform: uppercase; letter-spacing: 1px;
        }
        .btn-primary { background: var(--secondary); color: white; box-shadow: 0 5px 15px rgba(230, 126, 34, 0.3); }
        .btn-primary:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(230, 126, 34, 0.5); background: #d35400; }
        .btn-secondary { background: #95a5a6; color: white; }
        .btn-secondary:hover { background: #7f8c8d; }
        .btn-hint { background: transparent; color: #7f8c8d; border: 2px solid #bdc3c7; }
        .btn-hint:hover { border-color: var(--secondary); color: var(--secondary); }
        
        /* FEEDBACK OVERLAY OPAQUE */
        .feedback-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(15, 20, 25, 0.95);
            display: none; align-items: center; justify-content: center; z-index: 1000; padding: 20px;
        }
        .feedback-overlay.visible { display: flex; animation: fadeIn 0.3s ease; }
        
        .feedback-card {
            background: #fff; border-radius: 20px; padding: 40px; max-width: 500px; width: 100%;
            text-align: center; border-top: 8px solid; color: var(--primary); box-shadow: 0 25px 50px rgba(0,0,0,0.5);
        }
        .feedback-card.correct { border-color: var(--success); }
        .feedback-card.incorrect { border-color: var(--danger); }
        
        .feedback-icon { font-size: 65px; margin-bottom: 10px; }
        .feedback-title { font-size: 28px; font-weight: 900; margin-bottom: 5px; }
        .feedback-card.correct .feedback-title { color: var(--success); }
        .feedback-card.incorrect .feedback-title { color: var(--danger); }
        
        .feedback-explanation { background: #f8f9fa; border-radius: 12px; padding: 20px; text-align: left; margin: 25px 0; border: 1px solid #e0e0e0; }
        .feedback-explanation h4 { font-size: 15px; color: var(--primary); margin-bottom: 10px; text-transform: uppercase; }
        .feedback-explanation p { font-size: 15px; line-height: 1.6; color: #34495e; font-weight: 600; }
        
        .keyword-box { background: rgba(52, 152, 219, 0.1); border-left: 4px solid var(--accent); padding: 10px 15px; margin-top: 15px; font-weight: 800; color: var(--accent); border-radius: 0 8px 8px 0; }
        
        /* Streak Popup */
        .streak-popup {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: var(--secondary); padding: 20px 40px; border-radius: 50px;
            font-size: 28px; font-weight: 900; z-index: 1001; display: none;
            box-shadow: 0 10px 30px rgba(230, 126, 34, 0.6); color: white;
            animation: streakPop 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes streakPop {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            30% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            70% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
        }
        
        /* √âcran r√©sultats */
        .results-screen { text-align: center; padding: 30px 0; }
        .results-score { font-size: 70px; font-weight: 900; color: var(--secondary); margin: 10px 0; text-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        
        .results-stats { display: flex; justify-content: center; gap: 20px; margin: 30px 0; flex-wrap: wrap; }
        .stat-item { background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); border-radius: 15px; padding: 20px; min-width: 130px; }
        .stat-value { font-size: 36px; font-weight: 900; color: white; }
        .stat-label { font-size: 11px; color: rgba(255,255,255,0.6); margin-top: 5px; text-transform: uppercase; font-weight: 800; letter-spacing: 1px; }
        
        .errors-recap { background: rgba(231, 76, 60, 0.1); border-left: 5px solid var(--danger); border-radius: 8px; padding: 20px; margin: 25px 0; text-align: left; }
        .errors-recap h4 { color: #ff7675; margin-bottom: 15px; font-size: 16px; text-transform: uppercase; }
        .errors-recap ul { margin-left: 20px; font-size: 15px; line-height: 1.6; }
        .errors-recap li { margin: 8px 0; font-weight: 600; }
        
        @media (max-width: 600px) {
            .welcome-title { font-size: 32px; }
            .question-text { font-size: 20px; }
            .flashcard { padding: 25px 20px; min-height: 380px; }
            .keyword-input { font-size: 18px; padding: 12px; }
            .btn { padding: 14px 20px; font-size: 14px; width: 100%; }
            .option-btn { font-size: 14px; padding: 12px 15px; }
            .vf-container { gap: 15px; }
            .vf-btn { width: 130px; height: 70px; font-size: 18px; }
            .action-row { flex-direction: column; }
            .feedback-card { padding: 25px; }
            .stat-item { padding: 15px; min-width: 100px; }
            .stat-value { font-size: 28px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="btn-back" onclick="goHome()">‚¨ÖÔ∏è Menu Principal</button>
            <div class="score-bar">
                <div class="score-item">üõ°Ô∏è <span id="totalPoints">0</span> pts</div>
                <div class="score-item">üî• <span id="currentStreak">0</span></div>
            </div>
        </div>
        
        <div class="screen active" id="homeScreen">
            <div class="welcome-screen">
                <h1 class="welcome-title">MODULE C2</h1>
                <p class="welcome-subtitle">Sant√© et S√©curit√© au travail</p>
                
                <div class="objectifs-card">
                    <h3>üéØ Objectifs de r√©vision :</h3>
                    <div class="objectif-item">
                        <span class="check">‚úì</span>
                        <span>Identifier les enjeux humains et socio-√©conomiques</span>
                    </div>
                    <div class="objectif-item">
                        <span class="check">‚úì</span>
                        <span>Diff√©rencier l'accident du travail (AT) de la maladie professionnelle (MP)</span>
                    </div>
                    <div class="objectif-item">
                        <span class="check">‚úì</span>
                        <span>Conna√Ætre les droits et obligations (employeur / salari√©)</span>
                    </div>
                    <div class="objectif-item">
                        <span class="check">‚úì</span>
                        <span>Ma√Ætriser les d√©marches de d√©claration et d'indemnisation</span>
                    </div>
                </div>
                
                <div class="niveaux-grid">
                    <div class="niveau-card" onclick="startLevel(1)">
                        <div class="niveau-icon">üë•</div>
                        <div class="niveau-info">
                            <h4>Niveau 1 : Les Enjeux</h4>
                            <p>Dommages physiques, co√ªt financier, remplacement...</p>
                        </div>
                        <div class="niveau-progress">
                            <span class="percent" id="level1Percent">0%</span>
                            <div class="progress-mini"><div class="progress-mini-fill" id="level1Bar" style="width: 0%"></div></div>
                        </div>
                    </div>
                    
                    <div class="niveau-card" id="level2Card" onclick="startLevel(2)">
                        <div class="niveau-icon">‚ö†Ô∏è</div>
                        <div class="niveau-info">
                            <h4>Niveau 2 : AT et MP</h4>
                            <p>√âv√©nement soudain, l√©sion, exposition chronique, 4 crit√®res...</p>
                        </div>
                        <div class="niveau-progress">
                            <span class="percent" id="level2Percent">0%</span>
                            <div class="progress-mini"><div class="progress-mini-fill" id="level2Bar" style="width: 0%"></div></div>
                        </div>
                    </div>
                    
                    <div class="niveau-card" id="level3Card" onclick="startLevel(3)">
                        <div class="niveau-icon">‚öñÔ∏è</div>
                        <div class="niveau-info">
                            <h4>Niveau 3 : Droits & Obligations</h4>
                            <p>Droit de retrait, Code du travail, jeunes travailleurs...</p>
                        </div>
                        <div class="niveau-progress">
                            <span class="percent" id="level3Percent">0%</span>
                            <div class="progress-mini"><div class="progress-mini-fill" id="level3Bar" style="width: 0%"></div></div>
                        </div>
                    </div>
                    
                    <div class="niveau-card" id="level4Card" onclick="startLevel(4)">
                        <div class="niveau-icon">üìù</div>
                        <div class="niveau-info">
                            <h4>Niveau 4 : D√©claration & Indemnit√©s</h4>
                            <p>D√©lai de 24h/48h, CPAM, prestations en nature et esp√®ces...</p>
                        </div>
                        <div class="niveau-progress">
                            <span class="percent" id="level4Percent">0%</span>
                            <div class="progress-mini"><div class="progress-mini-fill" id="level4Bar" style="width: 0%"></div></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="screen" id="gameScreen">
            <div class="game-header">
                <div class="game-title" id="levelTitle">Niveau X</div>
                <div class="game-progress">
                    <span class="card-counter" id="cardCounter">1/5</span>
                    <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width: 0%"></div></div>
                </div>
            </div>
            
            <div class="flashcard" id="flashcard">
                <div class="card-type" id="cardType">QCM</div>
                
                <div class="question-section">
                    <div class="question-text" id="questionText">Question...</div>
                    
                    <div id="keywordContainer" style="display: none; width: 100%;">
                        <input type="text" class="keyword-input" id="keywordInput" placeholder="Votre r√©ponse...">
                        <div class="hint-text" id="hintText" style="display: none;">Indice : <strong id="hintContent"></strong></div>
                    </div>
                    
                    <div class="options-container" id="optionsContainer" style="display: none;"></div>
                    
                    <div class="vf-container" id="vfContainer" style="display: none;">
                        <button class="vf-btn vrai" onclick="selectVF(true)">VRAI</button>
                        <button class="vf-btn faux" onclick="selectVF(false)">FAUX</button>
                    </div>
                </div>
                
                <div class="action-row">
                    <button class="btn btn-hint" id="hintBtn" onclick="showHint()">üí° Indice</button>
                    <button class="btn btn-primary" onclick="validateAnswer()">VALIDER LA R√âPONSE</button>
                </div>
            </div>
        </div>
        
        <div class="screen" id="resultsScreen">
            <div class="results-screen">
                <div style="font-size: 80px;" id="resultsIcon">üèÜ</div>
                <h2 style="font-size: 32px; font-weight: 900; margin-top: 10px;" id="resultsTitle">Niveau Termin√© !</h2>
                <div class="results-score" id="resultsScore">100%</div>
                
                <div class="results-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="statCorrect">0</div>
                        <div class="stat-label">Correctes</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="statIncorrect">0</div>
                        <div class="stat-label">Erreurs</div>
                    </div>
                </div>
                
                <div class="errors-recap" id="errorsRecap" style="display: none;">
                    <h4>‚ö†Ô∏è Notions √† revoir :</h4>
                    <ul id="errorsList"></ul>
                </div>
                
                <div class="action-row" style="margin-top: 40px;">
                    <button class="btn btn-secondary" onclick="goHome()">Menu Principal</button>
                    <button class="btn btn-primary" onclick="nextLevel()" id="nextLevelBtn">NIVEAU SUIVANT ‚ûî</button>
                    <button class="btn btn-primary" onclick="retryLevel()" id="retryBtn" style="display: none;">‚Üª REJOUER LE NIVEAU</button>
                </div>
            </div>
        </div>
        
        <div class="feedback-overlay" id="feedbackOverlay">
            <div class="feedback-card" id="feedbackCard">
                <div class="feedback-icon" id="feedbackIcon">‚úÖ</div>
                <h3 class="feedback-title" id="feedbackTitle">Correct !</h3>
                
                <div class="feedback-explanation">
                    <h4>EXPLICATION</h4>
                    <p id="feedbackText">Texte explicatif...</p>
                    <div class="keyword-box" id="feedbackKeyword">√Ä retenir</div>
                </div>
                
                <button class="btn btn-primary" style="width: 100%; margin-top: 10px;" onclick="nextCard()">CONTINUER ‚ûî</button>
            </div>
        </div>
        
        <div class="streak-popup" id="streakPopup">COMBO x3 !</div>
        
    </div>

    <script>
        // === DONN√âES DU MODULE C2 (SANT√â & S√âCURIT√â) ===
        // Conform√©ment aux manuels Delagrave & Foucher
        const levels = {
            1: {
                title: "Niveau 1 : Les Enjeux",
                cards: [
                    {
                        type: "vf",
                        question: "La <span class='highlight'>douleur physique</span> ressentie apr√®s une blessure est un enjeu socio-√©conomique.",
                        answer: false,
                        explanation: "FAUX ! La douleur physique, la blessure ou les s√©quelles font partie des enjeux HUMAINS (atteinte √† la sant√© physique ou morale).",
                        keyword: "Douleur = Enjeu Humain"
                    },
                    {
                        type: "qcm",
                        question: "Quel est un enjeu <span class='highlight'>socio-√©conomique</span> majeur pour l'entreprise suite √† un accident ?",
                        options: [
                            "La souffrance de la famille",
                            "Le co√ªt financier pour remplacer le salari√©",
                            "Le risque d'incapacit√© permanente",
                            "La perte de motivation personnelle"
                        ],
                        answer: 1,
                        explanation: "Le remplacement du salari√©, les journ√©es perdues et le manque √† gagner repr√©sentent l'enjeu financier (socio-√©conomique) pour l'entreprise.",
                        keyword: "Entreprise = Co√ªt de remplacement"
                    },
                    {
                        type: "keyword",
                        question: "Quel mot d√©signe l'enjeu li√© √† l'atteinte √† la <span class='highlight'>sant√© physique ou morale</span> de la victime ?",
                        answer: "humain",
                        hint: "Enjeu h _ _ _ _ _",
                        explanation: "L'enjeu humain concerne directement la victime (blessures, s√©quelles, d√©c√®s, souffrance).",
                        keyword: "Enjeu humain = Sant√©"
                    },
                    {
                        type: "qcm",
                        question: "Selon les statistiques, quelle tranche d'√¢ge est la plus victime d'accidents du travail ?",
                        options: [
                            "Les seniors de plus de 55 ans",
                            "Les travailleurs de 35 √† 45 ans",
                            "Les jeunes de moins de 25 ans",
                            "Les stagiaires de 3√®me"
                        ],
                        answer: 2,
                        explanation: "Les jeunes de moins de 25 ans ont proportionnellement beaucoup plus d'accidents en raison de leur manque d'exp√©rience et d'appr√©hension des risques.",
                        keyword: "Jeunes -25 ans = Plus √† risque"
                    }
                ]
            },
            2: {
                title: "Niveau 2 : L'AT et la MP",
                cards: [
                    {
                        type: "keyword",
                        question: "Caract√©ristique principale de l'accident du travail : c'est une action <span class='highlight'>...</span>",
                        answer: "soudaine",
                        hint: "S _ _ _ _ _ _ _",
                        explanation: "L'Accident du Travail (AT) est un √©v√©nement entra√Ænant une l√©sion corporelle ou psychique r√©sultant d'une action SOUDAINE (ex: une chute, une coupure).",
                        keyword: "AT = Action Soudaine"
                    },
                    {
                        type: "keyword",
                        question: "La maladie professionnelle (MP) est la cons√©quence d'une exposition <span class='highlight'>...</span> √† un risque.",
                        answer: "chronique",
                        hint: "C _ _ _ _ _ _ _ _ (ou prolong√©e)",
                        explanation: "Une Maladie Professionnelle s'installe lentement dans le temps. C'est le r√©sultat d'une exposition CHRONIQUE (r√©p√©t√©e) √† un risque (ex: bruit, gestes r√©p√©titifs).",
                        keyword: "MP = Exposition Chronique"
                    },
                    {
                        type: "vf",
                        question: "Un accident de voiture sur le trajet direct 'domicile-entreprise' est consid√©r√© comme un <span class='highlight'>Accident du Travail proprement dit</span>.",
                        answer: false,
                        explanation: "FAUX ! Il s'agit d'un accident de TRAJET, et non d'un accident du travail proprement dit (qui lui, a lieu sur le lieu de travail).",
                        keyword: "Trajet ‚â† Travail proprement dit"
                    },
                    {
                        type: "qcm",
                        question: "Combien de crit√®res faut-il respecter obligatoirement pour qu'une Maladie soit reconnue 'Professionnelle' ?",
                        options: [
                            "2 crit√®res",
                            "3 crit√®res",
                            "4 crit√®res",
                            "Il n'y a pas de crit√®res, le m√©decin d√©cide seul"
                        ],
                        answer: 2,
                        explanation: "Il y a 4 crit√®res stricts √† respecter simultan√©ment (√™tre salari√©, maladie inscrite au tableau, travaux list√©s, d√©lai respect√©).",
                        keyword: "Maladie Pro = 4 Crit√®res stricts"
                    },
                    {
                        type: "qcm",
                        question: "Une tendinite √† l'√©paule d√©velopp√©e apr√®s 5 ans en caisse de supermarch√© est :",
                        options: [
                            "Un accident de trajet",
                            "Un accident du travail",
                            "Une maladie professionnelle",
                            "Un accident de droit commun"
                        ],
                        answer: 2,
                        explanation: "C'est une Maladie Professionnelle car elle s'est d√©velopp√©e suite √† une exposition chronique (r√©p√©tition du mouvement pendant 5 ans).",
                        keyword: "Tendinite = Maladie Pro (Chroniques)"
                    }
                ]
            },
            3: {
                title: "Niveau 3 : Droits & Obligations",
                cards: [
                    {
                        type: "keyword",
                        question: "Comment s'appelle le droit de quitter son poste face √† un danger <span class='highlight'>grave et imminent</span> ?",
                        answer: "droit de retrait",
                        hint: "Droit de r _ _ _ _ _ _",
                        explanation: "Le droit de retrait permet √† un salari√© de quitter son poste de travail s'il juge la situation imm√©diatement dangereuse pour sa vie, sans risquer de sanction.",
                        keyword: "Danger imminent = Droit de retrait"
                    },
                    {
                        type: "vf",
                        question: "L'employeur est le seul responsable de la s√©curit√©. Le salari√© n'a <span class='highlight'>aucune obligation</span>.",
                        answer: false,
                        explanation: "FAUX ! Le Code du travail pr√©cise qu'il incombe √† chaque travailleur de prendre soin de sa s√©curit√© et de celle de ses coll√®gues (respect des consignes).",
                        keyword: "Salari√© = Obligation de s√©curit√©"
                    },
                    {
                        type: "qcm",
                        question: "Quelle obligation sp√©cifique l'employeur a-t-il envers un 'nouvel embauch√©' ?",
                        options: [
                            "Lui donner un salaire double le premier mois",
                            "L'informer et le former √† la s√©curit√© d√®s son arriv√©e",
                            "Lui interdire de parler aux autres salari√©s",
                            "Lui faire passer un examen √©crit"
                        ],
                        answer: 1,
                        explanation: "L'employeur doit organiser l'accueil s√©curit√© : informer et former le nouvel arrivant aux risques professionnels et aux consignes de s√©curit√©.",
                        keyword: "Nouvel embauch√© = Formation s√©curit√©"
                    },
                    {
                        type: "vf",
                        question: "Un apprenti de <span class='highlight'>17 ans</span> a le droit de r√©aliser des travaux dangereux (ex: hauteur) sans aucune d√©rogation.",
                        answer: false,
                        explanation: "FAUX ! Afin de prot√©ger leur sant√©, la loi interdit formellement d'affecter les mineurs √† des travaux dangereux, sauf d√©rogation stricte (inspection du travail).",
                        keyword: "Mineurs = Interdiction travaux dangereux"
                    }
                ]
            },
            4: {
                title: "Niveau 4 : D√©claration & Indemnisation",
                cards: [
                    {
                        type: "keyword",
                        question: "Combien d'heures maximum a le salari√© pour pr√©venir son employeur de son accident ?",
                        answer: "24",
                        hint: "_ _ heures",
                        explanation: "La victime doit informer ou faire informer son employeur dans les 24 HEURES maximum.",
                        keyword: "Salari√© = Pr√©vient sous 24h"
                    },
                    {
                        type: "keyword",
                        question: "Combien d'heures maximum a l'employeur pour d√©clarer l'accident √† la CPAM ?",
                        answer: "48",
                        hint: "_ _ heures",
                        explanation: "C'est l'employeur qui doit envoyer la d√©claration officielle d'accident √† la CPAM dans un d√©lai de 48 HEURES.",
                        keyword: "Employeur = D√©clare sous 48h (CPAM)"
                    },
                    {
                        type: "qcm",
                        question: "Comment s'appelle l'indemnisation qui permet la prise en charge m√©dicale √† <span class='highlight'>100%</span> (m√©decin, m√©dicaments) ?",
                        options: [
                            "Les prestations familiales",
                            "Les indemnit√©s journali√®res",
                            "Les prestations en esp√®ces",
                            "Les prestations en nature"
                        ],
                        answer: 3,
                        explanation: "Les prestations en NATURE correspondent √† la prise en charge des soins √† 100% (soins, pharmacie, h√¥pital) pour √©viter d'avancer les frais.",
                        keyword: "Soins m√©dicaux = Prestations en Nature"
                    },
                    {
                        type: "keyword",
                        question: "Quel nom portent les versements de la CPAM pour remplacer la <span class='highlight'>perte de salaire</span> pendant l'arr√™t ?",
                        answer: "indemnit√©s journali√®res",
                        hint: "I _ _ _ _ _ _ _ _ _  j _ _ _ _ _ _ _ _ _ _ _",
                        explanation: "Les Indemnit√©s Journali√®res (IJ) sont des prestations en esp√®ces. Elles compensent financi√®rement les jours de travail non effectu√©s.",
                        keyword: "Perte salaire = Indemnit√©s Journali√®res"
                    },
                    {
                        type: "qcm",
                        question: "Que verse la CPAM si l'accident laisse des s√©quelles graves et d√©finitives (amputation, paralysie) ?",
                        options: [
                            "Une prime de licenciement",
                            "Une rente d'incapacit√©",
                            "Un remboursement mutuelle",
                            "Un salaire √† vie par l'employeur"
                        ],
                        answer: 1,
                        explanation: "La S√©curit√© sociale versera une 'Rente d'incapacit√©', calcul√©e selon le taux de s√©quelles fix√© par le m√©decin de la CPAM.",
                        keyword: "S√©quelles = Rente d'incapacit√©"
                    }
                ]
            }
        };
        
        // === MOTEUR DU JEU ===
        let totalPoints = 0;
        let currentStreak = 0;
        let currentLevel = 1;
        let currentCardIndex = 0;
        let levelCorrect = 0;
        let levelErrors = [];
        let levelProgress = { 1: 0, 2: 0, 3: 0, 4: 0 };
        let userAnswer = null;
        let hintUsed = false;
        
        function normalizeString(str) {
            // Retire les accents, met en minuscules, retire le mot "heures" ou "h" pour faciliter les r√©ponses chiffres
            return str.toLowerCase()
                      .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
                      .replace(/heures/g, "").replace(/heure/g, "").replace(/h/g, "")
                      .trim();
        }

        function goHome() {
            showScreen('homeScreen');
            updateUI();
        }
        
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }
        
        function startLevel(level) {
            if (level > 1 && levelProgress[level - 1] < 50) {
                alert('üîí Oups ! Il faut valider le niveau pr√©c√©dent pour d√©bloquer celui-ci.');
                return;
            }
            currentLevel = level;
            currentCardIndex = 0;
            levelCorrect = 0;
            levelErrors = [];
            showScreen('gameScreen');
            loadCard();
        }
        
        function loadCard() {
            const level = levels[currentLevel];
            const card = level.cards[currentCardIndex];
            
            document.getElementById('levelTitle').textContent = level.title;
            document.getElementById('cardCounter').textContent = `${currentCardIndex + 1} / ${level.cards.length}`;
            document.getElementById('progressFill').style.width = `${((currentCardIndex) / level.cards.length) * 100}%`;
            
            // Setup card UI
            document.getElementById('cardType').textContent = card.type.toUpperCase();
            document.getElementById('questionText').innerHTML = card.question;
            
            // Reset areas
            document.getElementById('keywordContainer').style.display = 'none';
            document.getElementById('optionsContainer').style.display = 'none';
            document.getElementById('vfContainer').style.display = 'none';
            document.getElementById('hintText').style.display = 'none';
            document.getElementById('keywordInput').value = '';
            
            userAnswer = null;
            hintUsed = false;
            
            if (card.type === 'keyword') {
                document.getElementById('keywordContainer').style.display = 'block';
                setTimeout(() => document.getElementById('keywordInput').focus(), 100);
            } else if (card.type === 'qcm') {
                showQCM(card.options);
            } else if (card.type === 'vf') {
                document.getElementById('vfContainer').style.display = 'flex';
                document.querySelectorAll('.vf-btn').forEach(b => b.classList.remove('selected'));
            }
        }
        
        function showQCM(options) {
            const container = document.getElementById('optionsContainer');
            container.style.display = 'flex';
            container.innerHTML = '';
            options.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerHTML = `<div class="option-letter">${String.fromCharCode(65 + idx)}</div><div>${opt}</div>`;
                btn.onclick = () => {
                    document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                    userAnswer = idx;
                };
                container.appendChild(btn);
            });
        }
        
        function selectVF(val) {
            document.querySelectorAll('.vf-btn').forEach(b => b.classList.remove('selected'));
            event.target.closest('.vf-btn').classList.add('selected');
            userAnswer = val;
        }
        
        function showHint() {
            document.getElementById('hintContent').textContent = levels[currentLevel].cards[currentCardIndex].hint;
            document.getElementById('hintText').style.display = 'block';
            hintUsed = true;
        }
        
        function validateAnswer() {
            const card = levels[currentLevel].cards[currentCardIndex];
            let isCorrect = false;
            
            if (card.type === 'keyword') {
                let input = normalizeString(document.getElementById('keywordInput').value);
                let expected = normalizeString(card.answer);
                if (input === "" && expected !== "") return alert("Veuillez saisir une r√©ponse.");
                // Tolerance : checks if the input contains the expected word, or vice versa
                isCorrect = (input === expected || input.includes(expected) || expected.includes(input)) && input.length > 0;
            } else if (card.type === 'qcm' || card.type === 'vf') {
                if (userAnswer === null) return alert("Veuillez s√©lectionner une r√©ponse.");
                isCorrect = (userAnswer === card.answer);
            }
            
            showFeedback(isCorrect, card);
        }
        
        function showFeedback(isCorrect, card) {
            const cardUI = document.getElementById('feedbackCard');
            if (isCorrect) {
                levelCorrect++;
                currentStreak++;
                totalPoints += hintUsed ? 5 : 10;
                cardUI.className = 'feedback-card correct';
                document.getElementById('feedbackIcon').textContent = '‚úÖ';
                document.getElementById('feedbackTitle').textContent = 'Excellente r√©ponse !';
                if (currentStreak > 2) triggerStreak();
            } else {
                currentStreak = 0;
                levelErrors.push(card.keyword);
                cardUI.className = 'feedback-card incorrect';
                document.getElementById('feedbackIcon').textContent = '‚ùå';
                document.getElementById('feedbackTitle').textContent = 'Pas tout √† fait...';
            }
            
            document.getElementById('feedbackText').innerHTML = card.explanation;
            document.getElementById('feedbackKeyword').textContent = "üìå " + card.keyword;
            
            updateUI();
            document.getElementById('feedbackOverlay').classList.add('visible');
        }
        
        function nextCard() {
            document.getElementById('feedbackOverlay').classList.remove('visible');
            currentCardIndex++;
            if (currentCardIndex >= levels[currentLevel].cards.length) {
                endLevel();
            } else {
                loadCard();
            }
        }
        
        function endLevel() {
            const total = levels[currentLevel].cards.length;
            const percent = Math.round((levelCorrect / total) * 100);
            
            // Save progress if better than before
            if(percent > levelProgress[currentLevel]) levelProgress[currentLevel] = percent;
            
            document.getElementById('resultsIcon').textContent = percent === 100 ? 'üèÜ' : (percent >= 50 ? 'üëç' : 'üìö');
            document.getElementById('resultsTitle').textContent = percent === 100 ? 'Parfait !' : (percent >= 50 ? 'Niveau valid√© !' : '√Ä r√©viser');
            document.getElementById('resultsScore').textContent = `${percent}%`;
            document.getElementById('statCorrect').textContent = levelCorrect;
            document.getElementById('statIncorrect').textContent = total - levelCorrect;
            
            const recap = document.getElementById('errorsRecap');
            if (levelErrors.length > 0) {
                document.getElementById('errorsList').innerHTML = levelErrors.map(e => `<li>${e}</li>`).join('');
                recap.style.display = 'block';
            } else {
                recap.style.display = 'none';
            }
            
            document.getElementById('nextLevelBtn').style.display = (percent >= 50 && currentLevel < 4) ? 'block' : 'none';
            document.getElementById('retryBtn').style.display = (percent < 100) ? 'block' : 'none';
            
            updateUI();
            showScreen('resultsScreen');
        }
        
        function nextLevel() { startLevel(currentLevel + 1); }
        function retryLevel() { startLevel(currentLevel); }
        
        function triggerStreak() {
            const popup = document.getElementById('streakPopup');
            popup.textContent = `COMBO x${currentStreak} ! üî•`;
            popup.style.display = 'block';
            setTimeout(() => popup.style.display = 'none', 1000);
        }
        
        function updateUI() {
            document.getElementById('totalPoints').textContent = totalPoints;
            document.getElementById('currentStreak').textContent = currentStreak;
            
            for (let i = 1; i <= 4; i++) {
                const percent = levelProgress[i];
                const card = document.getElementById(`level${i}Card`);
                if (!card) continue;
                
                document.getElementById(`level${i}Percent`).textContent = `${percent}%`;
                document.getElementById(`level${i}Bar`).style.width = `${percent}%`;
                
                card.classList.remove('locked', 'completed');
                if (percent >= 50) card.classList.add('completed');
                else if (i > 1 && levelProgress[i-1] < 50) card.classList.add('locked');
            }
        }
        
        // Enter key listener for inputs
        document.getElementById('keywordInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') validateAnswer();
        });
        
        // Initial setup
        updateUI();
    </script>
</body>
</html>